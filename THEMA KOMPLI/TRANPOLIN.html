<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Deutsch B2 Pr√ºfung - Komplett</title>
  <style>
    /* ===== GLOBAL STYLES ===== */
    :root {
      --primary-color: #1e3a5f;
      --secondary-color: #2c5282;
      --accent-color: #4da6ff;
      --light-color: #ebf8ff;
      --text-color: #2d3748;
      --white: #ffffff;
      --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      --transition: all 0.3s ease;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      margin: 0;
      min-height: 100vh;
      background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
      color: var(--white);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    button {
      cursor: pointer;
    }
    
    /* ===== START PAGE STYLES ===== */
    .start-container {
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      padding: 20px;
      min-height: 100vh;
    }
    
    .start-content {
      max-width: 600px;
      width: 100%;
      background-color: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      padding: 40px;
      box-shadow: var(--shadow);
      text-align: center;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .logo {
      margin-bottom: 20px;
    }
    
    .logo-icon {
      font-size: 48px;
      margin-bottom: 10px;
    }
    
    h1 {
      font-size: 32px;
      margin-bottom: 10px;
      font-weight: 700;
    }
    
    .subtitle {
      font-size: 18px;
      margin-bottom: 30px;
      opacity: 0.9;
    }
    
    .card {
      background-color: var(--white);
      border-radius: 12px;
      padding: 25px;
      margin-bottom: 30px;
      box-shadow: var(--shadow);
      color: var(--text-color);
    }
    
    .card h2 {
      font-size: 20px;
      margin-bottom: 15px;
      color: var(--primary-color);
    }
    
    .card p {
      margin-bottom: 20px;
      line-height: 1.5;
    }
    
    select {
      width: 100%;
      padding: 12px 16px;
      font-size: 16px;
      border-radius: 8px;
      border: 2px solid var(--accent-color);
      outline: none;
      background-color: var(--white);
      color: var(--text-color);
      cursor: pointer;
      transition: var(--transition);
    }
    
    select:focus {
      border-color: var(--secondary-color);
      box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.3);
    }
    
    .timer-container {
      margin: 25px 0;
    }
    
    .timer-label {
      font-size: 16px;
      margin-bottom: 10px;
    }
    
    .timer {
      font-size: 48px;
      font-weight: 700;
      color: var(--accent-color);
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }
    
    .progress-bar {
      height: 8px;
      width: 100%;
      background-color: rgba(255, 255, 255, 0.2);
      border-radius: 4px;
      overflow: hidden;
      margin-top: 10px;
    }
    
    .progress {
      height: 100%;
      width: 100%;
      background-color: var(--accent-color);
      border-radius: 4px;
      transform: scaleX(1);
      transform-origin: left;
      transition: transform 1s linear;
    }
    
    .info-text {
      font-size: 14px;
      margin-top: 20px;
      opacity: 0.8;
    }
    
    .button-container {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }
    
    .btn {
      flex: 1;
      padding: 12px 20px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      background-color: var(--accent-color);
      color: white;
      text-decoration: none;
      display: inline-block;
      text-align: center;
    }
    
    .btn:hover {
      background-color: #3399ff;
    }
    
    /* ===== EXAM PAGE STYLES ===== */
    .exam-body {
      background: #f5f5f5;
      color: #333;
      line-height: 1.45;
      -webkit-font-smoothing: antialiased;
    }
    
    /* Header Styles */
    header.topbar {
      background: #1e3a5f;
      color: #fff;
      padding: 12px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      min-height: 80px;
    }

    .brand {
      display: flex;
      gap: 15px;
      align-items: center;
    }

    .brand .logo {
      width: 80px;
      height: 40px;
      background: #e74c3c;
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      color: white;
      font-size: 18px;
    }

    .meta .main-title {
      font-weight: 800;
      font-size: 18px;
    }

    .meta .sub-title {
      font-size: 13px;
      opacity: 0.9;
    }

    .timer {
      font-weight: 700;
      font-size: 18px;
      color: #fff;
      margin: 0 20px;
    }

    .buttons-grid {
      display: grid;
      grid-template-columns: repeat(2, auto);
      gap: 10px 20px;
    }

    .exam-btn {
      padding: 12px 20px;
      border-radius: 6px;
      border: none;
      background: #4da6ff;
      color: white;
      font-weight: 700;
      font-size: 15px;
      cursor: pointer;
      transition: background 0.2s ease-in-out;
      min-width: 150px;
      text-align: center;
    }

    .exam-btn:hover {
      background: #336fbf;
    }
    
    .exam-btn.save {
      background: #4da6ff;
      color: #000;
    }
    
    .exam-btn.save:hover {
      background: #3399ff;
    }
    
    .exam-btn.submit {
      background: #4da6ff;
    }
    
    .exam-btn.submit:hover {
      background: #3399ff;
    }
    
    .exam-btn.result {
      background: #4da6ff;
    }
    
    .exam-btn.result:hover {
      background: #3399ff;
    }
    
    .exam-btn.next {
      background: #4da6ff;
      color: #fff;
    }
    
    .exam-btn.next:hover {
      background: #3399ff;
    }
    
    .exam-btn.reset {
      background: #4da6ff;
    }
    
    .exam-btn.reset:hover {
      background: #3399ff;
    }
    
    .exam-btn.reset-section {
      background: #d35400;
      font-size: 12px;
      padding: 6px 10px;
      min-width: auto;
    }
    
    .exam-btn.reset-section:hover {
      background: #e67e22;
    }
    
    .exam-btn.no-match {
      background: #95a5a6;
      font-size: 12px;
      padding: 6px 10px;
      min-width: auto;
      margin-top: 5px;
    }
    
    .exam-btn.no-match.selected {
      background: #e74c3c;
    }
    
    /* Top Tiles */
    .top-tiles {
      display: flex;
      justify-content: center;
      gap: 8px;
      padding: 8px 12px;
      background: #1e3a5f;
      border-bottom: 1px solid #0f223a;
    }
    
    .tile {
      flex: 1;
      max-width: 180px;
      text-align: center;
      padding: 12px;
      border-radius: 6px;
      border: 1px solid #ccc;
      background: #3b4a63;
      color: #fff;
      font-weight: 600;
      font-size: 13px;
      cursor: pointer;
      transition: all 0.2s ease-in-out;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 60px;
    }
    
    .tile:hover {
      background: #4a5b78;
    }
    
    .tile.active {
      background: #ffffff;
      color: #000;
      border-color: #bbb;
    }
    
    .tile.done {
      background: #2ecc71;
      color: #fff;
      border-color: #27ae60;
    }
    
    .tile.done::after {
      content: " ‚úÖ";
      margin-left: 5px;
    }
    
    .tile .points {
      background: rgba(255,255,255,0.2);
      padding: 4px 8px;
      border-radius: 12px;
      font-weight: 700;
      font-size: 11px;
      margin-top: 4px;
    }
    
    .tile.active .points {
      background: #e9eefc;
      color: #2c3e50;
    }
    
    /* Container Styles */
    .container {
      display: grid;
      grid-template-columns: 1fr 420px;
      gap: 16px;
      padding: 16px;
      max-width: 1200px;
      margin: 12px auto;
    }
    
    .container-full {
      display: grid;
      grid-template-columns: 1fr;
      gap: 16px;
      padding: 16px;
      max-width: 1200px;
      margin: 12px auto;
    }
    
    .container-split {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
      padding: 16px;
      max-width: 1200px;
      margin: 12px auto;
    }
    
    .left-panel {
      background: white;
      border-radius: 8px;
      padding: 18px;
      box-shadow: 0 1px 6px rgba(0,0,0,0.06);
      max-height: 76vh;
      overflow: auto;
    }
    
    .left-panel .passage {
      font-size: 14px;
      color: #2c3e50;
      line-height: 1.8;
    }
    
    .left-panel h2 {
      font-size: 16px;
      margin-bottom: 10px;
    }
    
    .right-panel {
      background: white;
      border-radius: 8px;
      padding: 12px;
      box-shadow: 0 1px 6px rgba(0,0,0,0.06);
      display: flex;
      flex-direction: column;
      gap: 12px;
      max-height: 76vh;
      overflow: auto;
    }
    
    .main-panel {
      background: white;
      border-radius: 8px;
      padding: 25px;
      box-shadow: 0 1px 6px rgba(0,0,0,0.06);
      max-height: 76vh;
      overflow: auto;
    }
    
    .panel-title {
      font-size: 18px;
      margin-bottom: 15px;
      color: #1e3a5f;
      font-weight: 700;
    }
    
    /* Question Styles */
    .question-head {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }
    
    .question-body {
      margin-top: 8px;
    }
    
    .options {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    .option {
      background: #fbfdff;
      border: 1px solid #e1e8f6;
      padding: 10px;
      border-radius: 8px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .option:hover {
      background: #f0f6ff;
    }
    
    .option.selected {
      background: #e8fbe9;
      border-color: #2ecc71;
    }
    
    .option .radio {
      width: 18px;
      height: 18px;
      border-radius: 50%;
      border: 2px solid #cfdff6;
      background: #fff;
      display: inline-block;
      flex-shrink: 0;
    }
    
    .option.selected .radio {
      background: #3498db;
      border-color: #3498db;
      box-shadow: inset 0 -3px 0 rgba(0,0,0,0.05);
    }
    
    .text-container {
      margin-bottom: 20px;
      padding: 15px;
      border: 1px solid #e1e8f6;
      border-radius: 8px;
      background: #fbfdff;
      position: relative;
      min-height: 120px;
    }
    
    .text-container:hover {
      background: #f0f6ff;
    }
    
    .text-title {
      font-weight: 700;
      margin-bottom: 8px;
      color: #2c3e50;
    }
    
    .text-content {
      font-size: 14px;
      color: #2c3e50;
      line-height: 1.6;
    }
    
    .title-slot {
      min-height: 40px;
      margin-top: 10px;
      padding: 8px;
      border: 2px dashed #c8d9f6;
      border-radius: 6px;
      background: #f8fbff;
    }
    
    .title-slot.has-title {
      background: #e8fbe9;
      border-color: #2ecc71;
    }
    
    .title-slot.has-x {
      background: #f8d7da;
      border-color: #e74c3c;
      color: #c0392b;
      font-weight: bold;
    }
    
    .headings-bank {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-top: 0;
    }
    
    .heading-item {
      padding: 10px;
      border: 1px solid #dbe7fb;
      border-radius: 8px;
      background: #f8fbff;
      cursor: grab;
    }
    
    .heading-item:hover {
      background: #e9f0ff;
    }
    
    .heading-item.used {
      opacity: 0.5;
      cursor: not-allowed;
      background: #f8d7da;
      border-color: #f5c6cb;
    }
    
    .result-correct {
      color: #27ae60;
      font-weight: bold;
    }
    
    .result-incorrect {
      color: #c0392b;
      font-weight: bold;
    }
    
    .result-item {
      margin: 10px 0;
      padding: 10px;
      border-radius: 6px;
      background: #f8f9fa;
    }
    
    .instructions {
      color: #7f8c8d;
      font-size: 14px;
      line-height: 1.6;
      margin-bottom: 15px;
    }
    
    .question-text {
      font-weight: 600;
      margin-bottom: 15px;
      font-size: 15px;
      color: #2c3e50;
    }
    
    .all-questions {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    
    .question-block {
      margin-bottom: 20px;
      padding: 15px;
      border: 1px solid #e1e8f6;
      border-radius: 8px;
      background: #fbfdff;
    }
    
    .texts-list, .situations-list {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    
    .text-item, .situation-item {
      padding: 15px;
      border: 1px solid #e1e8f6;
      border-radius: 8px;
      background: #fbfdff;
    }
    
    .text-letter {
      font-weight: bold;
      color: #2c3e50;
      margin-bottom: 8px;
    }
    
    .situation-number {
      font-weight: bold;
      color: #2c3e50;
      margin-bottom: 8px;
    }
    
    .fill-blank-container {
      margin: 20px 0;
    }
    
    .blank-word {
      display: inline-block;
      min-width: 120px;
      padding: 4px 8px;
      margin: 0 6px;
      background: #fff;
      cursor: pointer;
      position: relative;
      border: 1px solid #dbe7fb;
      border-radius: 4px;
    }
    
    .blank-word.has-answer {
      background: #e8fbe9;
      border-color: #2ecc71;
    }
    
    .options-popup {
      position: absolute;
      top: 100%;
      left: 0;
      background: white;
      border: 1px solid #dbe7fb;
      border-radius: 6px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      z-index: 100;
      min-width: 150px;
    }
    
    .option-item {
      padding: 8px 12px;
      cursor: pointer;
      border-bottom: 1px solid #f0f4fb;
    }
    
    .option-item:hover {
      background: #f0f6ff;
    }
    
    .option-item:last-child {
      border-bottom: none;
    }
    
    .horizontal-options {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    
    .option-row {
      display: flex;
      align-items: center;
      gap: 15px;
      padding: 10px;
      border: 1px solid #e1e8f6;
      border-radius: 8px;
      background: #fbfdff;
    }
    
    .option-number {
      font-weight: bold;
      color: #2c3e50;
      min-width: 30px;
    }
    
    .option-buttons {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    
    .option-btn {
      padding: 8px 16px;
      border: 1px solid #dbe7fb;
      border-radius: 6px;
      background: #f8fbff;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .option-btn:hover {
      background: #e9f0ff;
    }
    
    .option-btn.selected {
      background: #3498db;
      color: white;
      border-color: #3498db;
    }
    
    .word-bank-vertical {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    .bank-word-vertical {
      padding: 10px;
      border: 1px solid #dbe7fb;
      border-radius: 6px;
      background: #f8fbff;
      text-align: center;
      cursor: grab;
    }
    
    .bank-word-vertical.used {
      opacity: 0.5;
      cursor: not-allowed;
      background: #f8d7da;
      border-color: #f5c6cb;
    }
    
    .blank-slot {
      display: inline-block;
      min-width: 100px;
      padding: 4px 8px;
      margin: 0 6px;
      background: #fff;
      min-height: 30px;
      vertical-align: middle;
      border: 1px solid #dbe7fb;
      border-radius: 4px;
      cursor: pointer;
    }
    
    .blank-slot.has-answer {
      background: #e8fbe9;
      border-color: #2ecc71;
    }
    
    .footer-buttons {
      display: flex;
      gap: 10px;
    }
    
    .situation-item.used {
      opacity: 0.7;
      cursor: not-allowed;
      background: #f8d7da;
      border-color: #f5c6cb;
      color: #333;
    }
    
    /* Listening Section Styles */
    .listening-task {
      margin-bottom: 10px;
    }
    
    .true-false-table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
      font-size: 14px;
    }
    
    .true-false-table th {
      background: #3498db;
      color: white;
      padding: 15px;
      text-align: left;
      font-weight: 600;
      font-size: 14px;
    }
    
    .true-false-table td {
      padding: 15px;
      border-bottom: 1px solid #e1e8f6;
      vertical-align: top;
    }
    
    .true-false-table tr:nth-child(even) {
      background: #f8f9fa;
    }
    
    .true-false-table tr:hover {
      background: #e3f2fd;
    }
    
    .answer-options {
      display: flex;
      gap: 25px;
    }
    
    .answer-option {
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      padding: 10px 15px;
      border-radius: 4px;
      transition: background 0.2s;
      font-weight: 500;
    }
    
    .answer-option:hover {
      background: #e3f2fd;
    }
    
    .answer-option input {
      margin: 0;
      transform: scale(1.2);
    }

    .correct-answer {
      background: #d4edda !important;
      border-left: 4px solid #28a745;
    }
    
    .incorrect-answer {
      background: #f8d7da !important;
      border-left: 4px solid #dc3545;
    }
    
    /* Writing Section Styles */
    .writing-task {
      margin-bottom: 20px;
      padding: 15px;
      border: 1px solid #e1e8f6;
      border-radius: 8px;
      background: #fbfdff;
    }
    
    .writing-prompt {
      font-size: 14px;
      color: #2c3e50;
      line-height: 1.6;
      margin-bottom: 15px;
    }
    
    .writing-requirements {
      background: #f8f9fa;
      padding: 12px;
      border-radius: 6px;
      border-left: 4px solid #3498db;
      margin-bottom: 15px;
    }
    
    .writing-requirements h4 {
      margin: 0 0 8px 0;
      color: #2c3e50;
    }
    
    .writing-requirements ul {
      margin: 0;
      padding-left: 20px;
    }
    
    .writing-requirements li {
      margin-bottom: 5px;
      color: #2c3e50;
    }
    
    .writing-area {
      flex: 1;
      display: flex;
      flex-direction: column;
    }
    
    .writing-textarea {
      flex: 1;
      min-height: 500px;
      padding: 15px;
      border: 2px solid #e1e8f6;
      border-radius: 8px;
      font-size: 14px;
      line-height: 1.6;
      resize: vertical;
      font-family: Arial, sans-serif;
    }
    
    .writing-textarea:focus {
      outline: none;
      border-color: #3498db;
    }
    
    .word-counter {
      margin-top: 10px;
      text-align: right;
      font-size: 13px;
      color: #7f8c8d;
      padding: 8px 0;
    }
    
    .word-counter .count {
      font-weight: bold;
      color: #2c3e50;
    }
    
    /* Results Page Styles */
    .results-body {
      background: #f7fafc;
      color: #0f1724;
      line-height: 1.6;
    }
    
    .results-header {
      background: #1e3a5f;
      color: #fff;
      padding: 18px 20px;
      display: flex;
      align-items: center;
      gap: 16px;
    }
    
    .results-logo {
      background: #fff;
      color: #1e3a5f;
      padding: 8px 12px;
      border-radius: 6px;
      font-weight: 800;
    }
    
    .results-title {
      font-size: 18px;
      font-weight: 700;
    }
    
    .results-container {
      max-width: 1100px;
      margin: 22px auto;
      padding: 20px;
    }
    
    .results-tiles {
      display: flex;
      gap: 12px;
      margin: 18px 0;
    }
    
    .results-tile {
      flex: 1;
      background: #fff;
      border-radius: 10px;
      padding: 16px;
      box-shadow: 0 6px 18px rgba(2, 6, 23, 0.06);
      border-left: 6px solid #1e3a5f;
    }
    
    .results-tile h3 {
      margin: 0;
      font-size: 16px;
      color: #1e3a5f;
    }
    
    .results-tile .score {
      font-size: 20px;
      font-weight: 800;
      margin-top: 8px;
    }
    
    .section-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 12px;
    }
    
    .section-table th,
    .section-table td {
      padding: 8px;
      border-bottom: 1px solid #e6eef8;
      text-align: left;
      font-size: 14px;
    }
    
    .summary {
      background: #fff;
      padding: 16px;
      border-radius: 10px;
      margin-top: 18px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .summary .left {
      font-weight: 700;
    }
    
    .summary .right {
      text-align: right;
    }
    
    .controls {
      display: flex;
      gap: 10px;
      margin-top: 18px;
    }
    
    .results-btn {
      background: #4da6ff;
      border: none;
      color: #fff;
      padding: 10px 14px;
      border-radius: 8px;
      font-weight: 700;
      cursor: pointer;
      transition: background 0.3s;
    }
    
    .results-btn:hover {
      background: #3a8ce0;
    }
    
    .button-like {
      text-decoration: none;
    }
    
    .small-muted {
      color: #6b7280;
      font-size: 13px;
    }
    
    input[type="number"] {
      width: 90px;
      padding: 8px;
      border: 1px solid #d7e6fb;
      border-radius: 6px;
    }
    
    .note {
      font-size: 13px;
      color: #6b7280;
      margin-top: 8px;
    }
    
    /* Footer */
    footer.controls {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 20px;
      background: white;
      border-top: 1px solid #e1e8f6;
      margin-top: 20px;
    }
    
    .status {
      font-size: 14px;
      color: #7f8c8d;
    }
    
    .ghost {
      background: transparent;
      border: 2px solid #2c3e50;
      color: #2c3e50;
    }
    
    .ghost:hover {
      background: #2c3e50;
      color: white;
    }

    /* Responsive Styles */
    @media (max-width: 980px) {
      .container {
        grid-template-columns: 1fr;
        padding: 12px;
      }
      
      .container-split {
        grid-template-columns: 1fr;
      }
      
      .right-panel {
        order: 2;
      }
      
      .top-tiles {
        padding-left: 8px;
        padding-right: 8px;
      }
      
      header.topbar {
        flex-direction: column;
        gap: 15px;
        text-align: center;
      }
      
      .buttons-grid {
        grid-template-columns: 1fr;
      }
      
      .answer-options {
        flex-direction: column;
        gap: 10px;
      }
      
      footer.controls {
        flex-direction: column;
        gap: 15px;
      }
      
      .results-tiles {
        flex-direction: column;
      }
      
      .summary {
        flex-direction: column;
        gap: 10px;
        text-align: center;
      }
      
      .controls {
        flex-direction: column;
      }
    }
    
    @media (max-width: 600px) {
      .start-content {
        padding: 25px 20px;
      }
      
      h1 {
        font-size: 28px;
      }
      
      .card {
        padding: 20px 15px;
      }
    }

    /* === ÿ™ÿ≠ÿ≥ŸäŸÜÿßÿ™ ÿÆÿßÿµÿ© ŸÑŸÑŸáŸàÿßÿ™ŸÅ ÿßŸÑÿµÿ∫Ÿäÿ±ÿ© ÿ¨ÿØÿß === */
    @media (max-width: 480px) {
      /* 1. ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑÿ≠ÿßŸàŸäÿßÿ™ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ© */
      .container, .container-split, .container-full {
        grid-template-columns: 1fr !important;
        padding: 8px !important;
        gap: 10px !important;
      }
      
      /* 2. ÿ¨ÿπŸÑ ÿßŸÑŸÑŸàÿ≠ÿßÿ™ (panels) ÿ™ÿ£ÿÆÿ∞ ÿπÿ±ÿ∂ ŸÉÿßŸÖŸÑ */
      .left-panel, .right-panel, .main-panel {
        max-height: none !important;
        height: auto !important;
        overflow: visible !important;
        margin-bottom: 10px;
      }
      
      /* 3. ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑŸáŸäÿØÿ± */
      .topbar {
        flex-direction: column !important;
        align-items: stretch !important;
        padding: 10px !important;
      }
      
      .brand {
        justify-content: center;
        margin-bottom: 10px;
      }
      
      /* 4. ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑÿ£ÿ≤ÿ±ÿßÿ± ŸÅŸä ÿßŸÑŸáŸäÿØÿ± */
      .buttons-grid {
        grid-template-columns: 1fr !important;
        width: 100%;
      }
      
      .exam-btn {
        width: 100% !important;
        margin: 2px 0 !important;
        font-size: 14px !important;
        padding: 12px 8px !important;
      }
      
      /* 5. ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑÿ™ÿßŸäŸÑÿßÿ™ */
      .top-tiles {
        flex-wrap: wrap;
        justify-content: center;
      }
      
      .tile {
        flex: 0 0 calc(33% - 5px) !important;
        max-width: calc(33% - 5px) !important;
        margin: 2px;
        font-size: 11px !important;
        padding: 8px 4px !important;
      }
      
      /* 6. ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑŸÜÿµŸàÿµ */
      .passage, .text-content, .question-text {
        font-size: 15px !important;
        line-height: 1.5 !important;
      }
      
      /* 7. ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑÿÆŸäÿßÿ±ÿßÿ™ */
      .option {
        padding: 12px 10px !important;
        margin: 4px 0 !important;
      }
      
      /* 8. ÿ™ÿ≠ÿ≥ŸäŸÜ ÿ¨ÿØÿßŸàŸÑ True/False */
      .true-false-table {
        display: block;
        overflow-x: auto;
        white-space: nowrap;
      }
      
      /* 9. ÿ™ÿ≠ÿ≥ŸäŸÜ ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑŸÉÿ™ÿßÿ®ÿ© */
      .writing-textarea {
        min-height: 300px !important;
        font-size: 16px !important;
      }
      
      /* 10. ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑŸÅŸàÿ™ÿ± */
      footer.controls {
        flex-direction: column !important;
        gap: 10px !important;
      }
      
      .footer-buttons {
        width: 100%;
        display: flex;
        gap: 5px;
      }
      
      .footer-buttons .exam-btn {
        flex: 1;
      }
      
      /* 11. ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨ */
      .results-tiles {
        flex-direction: column !important;
      }
      
      .results-tile {
        margin-bottom: 10px;
      }
    }

    /* === ÿ™ÿ≠ÿ≥ŸäŸÜÿßÿ™ ŸÑŸÑŸáŸàÿßÿ™ŸÅ ÿßŸÑŸÖÿ™Ÿàÿ≥ÿ∑ÿ© === */
    @media (min-width: 481px) and (max-width: 768px) {
      .container, .container-split {
        grid-template-columns: 1fr !important;
      }
      
      .tile {
        max-width: 180px !important;
      }
    }
  </style>
</head>
<body id="body">
  <!-- Start Page -->
  <div id="start-page" class="start-container">
    <div class="start-content">
      <div class="logo">
        <div class="logo-icon">üìù</div>
        <h1>Deutsch B2 Pr√ºfung</h1>
        <div class="subtitle">Bereiten Sie sich auf Ihre Pr√ºfung vor</div>
      </div>
      <div class="card">
        <h2>Pr√ºfungsbereich ausw√§hlen</h2>
        <p>W√§hlen Sie bitte den Bereich aus, den Sie √ºben m√∂chten. Die Pr√ºfung startet automatisch in <span id="time-display">30</span> Sekunden.</p>
        <select id="sectionSelect">
          <option value="lesen">Lesen</option>
          <option value="hoeren">H√∂ren</option>
          <option value="schreiben">Schreiben</option>
        </select>
        <div class="button-container">
          <button id="cancelBtn" class="btn">Abbrechen</button>
          <button id="startBtn" class="btn">Jetzt starten</button>
        </div>
      </div>
      <div class="timer-container">
        <div class="timer-label">Die Pr√ºfung startet in:</div>
        <div class="timer" id="countdown">30</div>
        <div class="progress-bar">
          <div class="progress" id="progress"></div>
        </div>
      </div>
      <div class="info-text">Stellen Sie sicher, dass Sie in einer ruhigen Umgebung sind und gen√ºgend Zeit haben.</div>
    </div>
  </div>

  <!-- Lesen Page -->
  <div id="lesen-page" class="exam-page" style="display: none;">
    <header class="topbar" role="banner">
      <div class="brand">
        <div class="logo">test</div>
        <div class="meta">
          <div class="main-title">Deutsch - B2 (√úbung)</div>
          <div class="sub-title">Lesen ‚Äî Testbeispiel</div>
        </div>
      </div>

      <div id="timer-lesen" class="timer" aria-live="polite">Verbleibende Zeit: 90:00</div>

      <div class="buttons-grid">
        <button id="resetBtn-lesen" class="exam-btn reset">üîÑ Von neu beginnen</button>
        <button id="saveBtn-lesen" class="exam-btn save">üìã Speichern</button>
        <button id="resultBtn-lesen" class="exam-btn result">üìä Ergebnis</button>
        <button id="submitBtn-lesen" class="exam-btn submit">üèÅ Abgabe</button>
        <button class="exam-btn next" id="nextBtn-lesen">‚û°Ô∏è N√§chste Pr√ºfung</button>
      </div>
    </header>

    <div class="top-tiles" id="topTiles-lesen" role="navigation" aria-label="Sections overview"></div>

    <div class="container">
      <main class="left-panel" id="leftPanel-lesen">
        <div class="passage" id="passage-lesen">
          <h2 id="passageTitle-lesen">Aufgabe</h2>
          <div id="passageContent-lesen"></div>
        </div>
      </main>

      <aside class="right-panel" id="rightPanel-lesen" aria-labelledby="questionTitle-lesen">
        <div class="question-head">
          <div>
            <div id="sectionName-lesen" style="font-weight:800"></div>
            <div id="questionTitle-lesen" style="font-size:13px;color:#55607a">Frage</div>
          </div>
          <button id="resetSectionBtn-lesen" class="exam-btn reset-section" style="display:none;">Teil zur√ºcksetzen</button>
        </div>
        <div class="question-body" id="questionBody-lesen"></div>
        <div id="headingsBankContainer-lesen"></div>
      </aside>
    </div>

    <footer class="controls">
      <div class="footer-buttons">
        <button id="prevBtn-lesen" class="exam-btn ghost">Zur√ºck</button>
        <button id="nextBtn-lesen" class="exam-btn ghost">Weiter</button>
      </div>
      <div class="status"><span id="statusText-lesen">Nicht gespeichert</span></div>
    </footer>
  </div>

  <!-- H√∂ren Page -->
  <div id="hoeren-page" class="exam-page" style="display: none;">
    <header class="topbar" role="banner">
      <div class="brand">
        <div class="logo">test</div>
        <div class="meta">
          <div class="main-title">Deutsch - B2 (√úbung)</div>
          <div class="sub-title">H√∂rverstehen ‚Äî Testbeispiel</div>
        </div>
      </div>

      <div id="timer-hoeren" class="timer" aria-live="polite">Verbleibende Zeit: 17:00</div>

      <div class="buttons-grid">
        <button id="resetBtn-hoeren" class="exam-btn reset">üîÑ Von neu beginnen</button>
        <button id="saveBtn-hoeren" class="exam-btn save">üìã Speichern</button>
        <button id="resultBtn-hoeren" class="exam-btn result">üìä Ergebnis</button>
        <button id="submitBtn-hoeren" class="exam-btn submit">üèÅ Abgabe</button>
        <button class="exam-btn next" id="nextBtn-hoeren">‚û°Ô∏è N√§chste Pr√ºfung</button>
      </div>
    </header>

    <div class="top-tiles" id="topTiles-hoeren" role="navigation" aria-label="Sections overview"></div>

    <div class="container-full">
      <main class="main-panel" id="mainPanel-hoeren">
        <div id="contentContainer-hoeren"></div>
      </main>
    </div>

    <footer class="controls">
      <div class="footer-buttons">
        <button id="prevBtn-hoeren" class="exam-btn ghost">Zur√ºck</button>
        <button id="nextBtn-hoeren" class="exam-btn ghost">Weiter</button>
      </div>
      <div class="status"><span id="statusText-hoeren">Nicht gespeichert</span></div>
    </footer>
  </div>

  <!-- Schreiben Page -->
  <div id="schreiben-page" class="exam-page" style="display: none;">
    <header class="topbar" role="banner">
      <div class="brand">
        <div class="logo">test</div>
        <div class="meta">
          <div class="main-title">Deutsch - B2 (√úbung)</div>
          <div class="sub-title">Schreiben ‚Äî Testbeispiel</div>
        </div>
      </div>

      <div id="timer-schreiben" class="timer" aria-live="polite">Verbleibende Zeit: 30:00</div>

      <div class="buttons-grid">
        <button id="resetBtn-schreiben" class="exam-btn reset">üîÑ Von neu beginnen</button>
        <button id="saveBtn-schreiben" class="exam-btn save">üìã Speichern</button>
        <button id="resultBtn-schreiben" class="exam-btn result">üìä Ergebnis</button>
        <button id="submitBtn-schreiben" class="exam-btn submit">üèÅ Abgabe</button>
        <button class="exam-btn next" id="nextBtn-schreiben">‚û°Ô∏è N√§chste Pr√ºfung</button>
      </div>
    </header>

    <div class="top-tiles" id="topTiles-schreiben" role="navigation" aria-label="Sections overview"></div>

    <div class="container-split">
      <main class="left-panel" id="leftPanel-schreiben">
        <div class="passage" id="passage-schreiben">
          <h2 id="passageTitle-schreiben">Aufgabe</h2>
          <div id="passageContent-schreiben"></div>
        </div>
      </main>

      <aside class="right-panel" id="rightPanel-schreiben">
        <div id="writingContainer-schreiben"></div>
      </aside>
    </div>

    <footer class="controls">
      <div class="footer-buttons">
        <button id="prevBtn-schreiben" class="exam-btn ghost">Zur√ºck</button>
        <button id="nextBtn-schreiben" class="exam-btn ghost">Weiter</button>
      </div>
      <div class="status"><span id="statusText-schreiben">Nicht gespeicherÿ™</span></div>
    </footer>
  </div>

  <!-- Ergebnisse Page -->
  <div id="ergebnisse-page" class="results-page" style="display: none;">
    <header class="results-header">
      <div class="results-logo">test</div>
      <div class="results-title">Gesamtergebnis ‚Äî Deutsch B2</div>
    </header>

    <div class="results-container">
      <div class="results-tiles" id="topTiles-ergebnisse"></div>
      <div id="details-ergebnisse"></div>
      <div class="summary" id="finalSummary-ergebnisse"></div>
      <div class="controls">
        <a class="button-like" href="#" id="backBtn-ergebnisse">
          <button class="results-btn">üîÅ Zur√ºck zur Startseite</button>
        </a>
        <button id="calcBtn-ergebnisse" class="results-btn">‚úÖ Ergebnisse anzeigen</button>
      </div>
      <div class="note">Hinweis: Schreiben (45 Punkte) wird manuell eingegeben, falls nicht automatisch vorhanden.</div>
    </div>
  </div>

  <script>
    // ===== PAGE NAVIGATION =====
    function showPage(pageId) {
      // Hide all pages
      document.getElementById('start-page').style.display = 'none';
      document.getElementById('lesen-page').style.display = 'none';
      document.getElementById('hoeren-page').style.display = 'none';
      document.getElementById('schreiben-page').style.display = 'none';
      document.getElementById('ergebnisse-page').style.display = 'none';
      
      // Change body class based on page
      document.getElementById('body').className = '';
      if (pageId === 'ergebnisse-page') {
        document.getElementById('body').className = 'results-body';
      } else if (pageId !== 'start-page') {
        document.getElementById('body').className = 'exam-body';
      }
      
      // Show selected page
      document.getElementById(pageId).style.display = 'block';
      
      // Initialize the page if needed
      if (pageId === 'lesen-page' && typeof initLesenPage === 'function') {
        initLesenPage();
      } else if (pageId === 'hoeren-page' && typeof initHoerenPage === 'function') {
        initHoerenPage();
      } else if (pageId === 'schreiben-page' && typeof initSchreibenPage === 'function') {
        initSchreibenPage();
      } else if (pageId === 'ergebnisse-page' && typeof initErgebnissePage === 'function') {
        initErgebnissePage();
      }
    }

    // ===== START PAGE FUNCTIONALITY =====
    let initialCounter = 30;
    let counter = initialCounter;
    let countdownInterval;
    let countdownRunning = false;
    let examStarted = false;
    const timerEl = document.getElementById("countdown");
    const timeDisplayEl = document.getElementById("time-display");
    const progressEl = document.getElementById("progress");
    const selectEl = document.getElementById("sectionSelect");
    const startBtn = document.getElementById("startBtn");
    const cancelBtn = document.getElementById("cancelBtn");

    function startCountdown() {
      // prevent double-starts or starting after exam already began
      if (countdownRunning || examStarted) return;
      countdownRunning = true;
      // disable start button while counting
      try { startBtn.disabled = true; startBtn.setAttribute('aria-disabled','true'); } catch(e){}
      // reset counter & UI
      counter = initialCounter;
      timerEl.textContent = counter;
      timeDisplayEl.textContent = counter;
      progressEl.style.transform = "scaleX(0)";
      timerEl.style.color = "";

      countdownInterval = setInterval(() => {
        counter--;
        timerEl.textContent = counter;
        timeDisplayEl.textContent = counter;
        const progressValue = (initialCounter - counter) / initialCounter;
        progressEl.style.transform = `scaleX(${progressValue})`;
        if (counter <= 0) {
          clearInterval(countdownInterval);
          countdownInterval = null;
          countdownRunning = false;
          progressEl.style.transform = "scaleX(1)";
          // ensure exam starts only once
          if (!examStarted) {
            examStarted = true;
            startExam();
          }
          // safety: re-enable start button (page usually navigates away)
          try { startBtn.disabled = false; startBtn.removeAttribute('aria-disabled'); } catch(e){}
        }
      }, 1000);
    }

    function stopCountdown(reset = true) {
      if (countdownInterval) {
        clearInterval(countdownInterval);
        countdownInterval = null;
      }
      countdownRunning = false;
      try { startBtn.disabled = false; startBtn.removeAttribute('aria-disabled'); } catch(e){}
      progressEl.style.transform = "scaleX(0)";
      if (reset) {
        counter = initialCounter;
        timerEl.textContent = counter;
        timeDisplayEl.textContent = counter;
      } else {
        timerEl.textContent = "Gestoppt";
      }
    }

    function startExam() {
      // guard to ensure startExam is triggered once
      if (!examStarted) examStarted = true;
      const selectedSection = selectEl.value;
      if (selectedSection === 'lesen') {
        showPage('lesen-page');
      } else if (selectedSection === 'hoeren') {
        showPage('hoeren-page');
      } else if (selectedSection === 'schreiben') {
        showPage('schreiben-page');
      }
    }

    // wire buttons: start will now start the countdown (not the exam directly)
    startBtn.addEventListener('click', startCountdown);

    cancelBtn.addEventListener('click', () => {
      stopCountdown(true);
      timerEl.textContent = "Abgebrochen";
      timerEl.style.color = "#e53e3e";
    });

    // NOTE: removed automatic startCountdown() on page load to prevent the timer starting twice
// ===== LESEN PAGE FUNCTIONALITY =====
    function initLesenPage() {
      /* ===== Self-contained exam (embedded) ===== */
      const exam = {
        id: "exam-001",
        durationSec: 90 * 60,
        sections: [
          { 
            id: "s1", 
            title: "Leseverstehen, Teil 1", 
            points: 25,
            passageTitle: "Aufgabe: Lesen Sie zuerst die zehn √úberschriften. Lesen Sie dann die f√ºnf Texte und entscheiden Sie, welche √úberschrift (a-j) am besten zu welchem Text (1-5) passt.",
            passage: "",
            questions: [],
            texts: [
              {
                id: "text1",
                content: "Die meisten Menschen verbinden den Begriff ‚ÄûBarrierefreiheit‚Äú mit dem Zugang zu Geb√§uden oder Transportmitteln. Dabei betrifft Barrierefreiheit viel mehr Bereiche unseres Alltags, so zum Beispiel auch die Informations und Kommunikationstechnologie. Die APA, die Austria Presse Agentur, hat deshalb einen Nachrichtendienst in einfacher und leicht verst√§ndlicher Sprache ins Leben gerufen. Er wandet sich an Menschen die Lese- oder Lernschwierigkeiten haben oder die die deutsche Sprache noch nicht so gut beherrschen. F√ºr diesen Nachrichtendienst werden die wichtigsten Meldungen des Tages aus Politik, Wirtschaft, Sport, Kultur und Lokalnachrichten f√ºr die Niveaustufen A2 und B1 geschrieben. Interessenten k√∂nnen sich die Texte f√ºnfmal pro Woche am sp√§ten Nachmittag per E-Mail schicken lassen oder √ºber eine besondere Informationsplattform bekommen. Das Projekt wird vom Sozialministerium gef√∂rdert und wurde gemeinsam mit einem Grazer Unternehmen entwickelt, das auf Text√ºbertragungen f√ºr verschiedene Schwierigkeitsstufen spezialisiert ist. Der Nachrichtendienst wurde bereits als innovativer Beitrag zum Thema Barrierefreiheit ausgezeichnet.",
                correctAnswer: "i"
              },
              {
                id: "text2", 
                content: "Die WOH, die Weltgesundheitsorganisation warnt vor den Folgen ‚Äûungesunder‚Äú Werbung im Internet. Kinder und Jugendiche treffen beim Nutzen der Sozialen Medien h√§ufig auf Anzeigen f√ºr ungesunde Lebensmittel wie S√º√üigkeiten oder salzige und fettreiche Snacks. So werden √úbergewicht und damit zusammenh√§ngende Krankheiten im Erwachsenenalter gef√∂rdert, mahnt die Organisation. Sie fordert deshalb Regierungen dazu auf, diese Werbung zum Schutze der Kinder st√§rker zu begrenzen. Die WHO weist au√üerdem auf die Gefahr von Bewegungsmangel im Zusammenhang mit den Neuen Medien hin. Das betrifft nicht nur Jugendliche, sondern auch Kleinkinder Gerade in den ersten Lebensjahren sollte der nat√ºrliche Bewegungsdrang der Kinder genutzt werden, damit sie Freude an Bewegung und Sport entwickeln. Kleinkinder sollten sich mindestens drei Stunden pro Jahr bewegen und so wenig Zeit wie m√∂glich vor einem Bildschirm verbringen. √úberhaupt sollten Kinder, die j√ºnger als zwei Jahre sind, grunds√§tzlich nicht vor ein Tablet oder einen PC gesetzt werden. Denn wer viel sitzt, wird in der Folge leichter krank.",
                correctAnswer: "f"
              },
              {
                id: "text3",
                content: "Sch√ºlerinnen und Sch√ºler sollen im Schulunterricht auch den Umgang mit Nachrichten lernen. Das forderten k√ºrzlich in Wein die Teilnehmenden an einer Konferenz zur politischen Bildung von Jugendlichen. Das Ziel dabei ist, jungen Menschen den kritischen Umgang mit den Inhalten und der Pr√§sentation von Nachrichten beizubringen. Heute ist der Zugriff auf Nachrichtensendungen so einfach wie noch nie. Viele Nachrichtensendungen des ORF k√∂nnen mindestens eine Woche lang im Internet abgerufen werden. Sch√ºlerinnen und Sch√ºler k√∂nnen sie so zur eigenen Arbeit nutzen oder gemeinsam in der Klasse besprechen. Die Konferenz nannte auch gleich konkrete Fragen f√ºr die Analyse von Nachrichtensendungen: Welche Nachrichten werden angeboten - Politik und Wirtschaft, Unf√§lle. Sport oder Prominews? Berichten die Moderatorinnen und Moderatoren sachlich oder machen sie pers√∂nliche Bemerkungen zu den einzelnen Nachrichten? Wie ist die Reihenfolge, wie lange sind die Beitr√§ge? Am besten eignen sich die Unterrichtsf√§cher Politische Bildung, Geschichte ind Deutsch oder Englisch, so die Expertenrunde.",
                correctAnswer: "e"
              },
              {
                id: "text4",
                content: "Mit dem Trampolin den K√∂rper in Schwung bringen f√ºr viele Menschen ist das Sprungger√§t eine gute M√∂glichkeit, sich mit viel spa√ü und ohne allzu gro√üen Aufwand zu bewegen. Besonders beleibt ist dasTrampolin bei Kindern. Expertinnen und Experten betonen auch die Vorteile des H√ºpfens auf dem Trampolin. Die Bewegung auf dem Trampolin f√∂rdet nicht nur die Beweglichkeit ‚Äösondern auch die Koordination. Allerdings ist sie nicht ganz ungef√§hrlich. Orthop√§den weisen auf die extrem hohe Unfallgefahr hin. Die √Ñrzteschaft m√∂chte kindren und Eltern keineswegs die Freude am Trampolinspringen verderben. Vielmehr m√∂chte sie dazu aufrufen, einige Sicherheitsregeln zu befolgen, mit denen sich Unf√§lle leicht vermeiden lassen. Eine harte, ebene Stellfl√§che und ein Sicherheitsnetz sind dabei unverzichtbare Voraussetzungen, Viele Sportvereine bieten Kurse an, in denen Kinder sicheres Trampolinspringen lernen k√∂nnen.",
                correctAnswer: "j"
              },
              {
                id: "text5",
                content: "Die Klage, dass Jugendliche und Junge Erwachsene kein Interesse mehr an Nachrichten haben, ist unbegr√ºndet. So lautet zumindest eine der Schlussfolgerungen aus einer Studie zum durchschnittlichen Medienkonsum junger Menschen mit dem Schwerpunkt Nachrichten. Demnach lesen oder h√∂ren in √ñsterreich nahezu 50% der Personen unter 30 Jahren t√§glich Nachrichten viele der Befragten gaben an, dass sie sich nicht auf die Inthalte der Sozialen Medien verlassen m√∂chten, da ihre Glaubw√ºrdigkeit oft angezweifelt wird. Den Klassischen Medien wie Nachrichtensendungen oder Tageszeitungen wird hingegen eher geglaubt. Soziale Netzwerke k√∂nnen herk√∂mmliche Nachrichtenquellen nicht ersetzen, so die vorherrschende Meinung auch wenn diese Quellen in der Gestaltung often als eher langweilig empfunden werden.",
                correctAnswer: "b"
              }
            ],
            headings: [
              {id: "a", text: "Viele Trampoline haben erhebliche Sicherheitsm√§ngel"},
              {id: "b", text: "Traditionelle Nachrichtenmedien immer noch getragt"},
              {id: "c", text: "Soziale Medien ersetzen alte Informationsquellen"},
              {id: "d", text: "Sch√ºler bereiten Nachrichtensendungen vor"},
              {id: "e", text: "Mit Nachrichten im Unterricht arbeiten"},
              {id: "f", text: "Medienkonsum f√∂rdert ungesunde Lebensweise"},
              {id: "g", text: "Kritik an der Nachrichtensprache"},
              {id: "h", text: "Jugendliche konsumieren mehr Fett und Zucker"},
              {id: "i", text: "Informationen leichter verstehen"},
              {id: "j", text: "Fachleute warnen vor unsachgem√§√üer Nutzung von Sprungger√§ten"}
            ]
          },
          { 
            id: "s2", 
            title: "Leseverstehen, Teil 2", 
            points: 25,
            passageTitle: "Der Puppenmacher",
            passage: `Die Schaufensterpuppe ist eine Pariserin und hatte erstmals 1849 in der Hauptstadt der Mode ihren Auftritt. Der franz√∂sische Schneider Alexis Lavigne gilt als ihr Erfinder, auch wenn er damals seine Kleiderkreationen noch auf einer Schneiderpuppe vorf√ºhrte.
Bald schon taten es ihm andere Pariser Kollegen gleich. Sie begannen, ihre Modelle vor den Gesch√§ften aufzustellen, um die Passanten in die Verkaufsr√§ume zu locken. Als Anfang des 20. Jahrhunderts die ersten gro√üen Kaufh√§user er√∂ffneten, erlebte die Schaufensterpuppe ihren Durchbruch. Der Puppenmacher Lester Gaba entwickelte in den 1930er Jahren das erste lebensecht wirkende Modell, Cynthia. Sie durfte sogar mit auf Veranstaltungen, was beide ber√ºhmt machte. Fortan spiegelte die Schaufensterpuppe Zeitgeist und Sch√∂nheitsideale. 

Der Linzer Puppenmacher Andr√© Bauernfeind hat als Sammler begonnen, mittlerweile sind Schaufensterpuppen sein Beruf. Der 37-J√§hrige, der mehr als 1000 Modelle besitzt, ist √∂sterreichweit der Einzige, bei dem man sie reparieren lassen, aber auch mieten kann. Wer ihn an seinem Arbeitsplatz aufsucht, muss in den Keller. Die Eisent√ºr steht offen, l√§dt ein in sein gro√ües Atelier voller Schaufensterpuppen: Kinder, Frauen und M√§nner, mit Per√ºcke, geschminkt oder farblos, sitzend, liegend, d√ºrr, oder mollig, in Kisten verpackt oder in Einzelteilen von der Decke h√§ngend.

W√§hrend sich die Puppen in der Welt drau√üen perfekt pr√§sentieren, wird hier in der Werkstatt mitunter ordentlich an ihrer Oberfl√§che gekratzt. Der 37-J√§hrige ist so etwas wie ein Sch√∂nheitschirurg f√ºr Schaufensterpuppen. Er macht sie wieder hell, verpasst ihnen aber auch Ganzk√∂rper-Liftings, wenn gew√ºnscht. Die bestehende Farbe wird dann entfernt, anschlie√üend eine Grundierung und Farbe aufgetragen. Er klebt ihnen falsche Wimpern an und tr√§gt mit einem Pinsel Schminke auf. Die Kosmetikprodukte kommen meistens aus der Drogerie, tragen aber manchmal auch Luxusnamen wie Armani oder Dior. Nur herk√∂mmlichen Nagellack kann Bauernfeld nicht verwenden, weil dieser die √ñlfarbe aufl√∂st.

Nicht selten fehlt den Puppen ein Finger, ein Ohr oder eine Nase. Dann greift der Linzer zur Modelltermasse, deren Zusammensetzung streng geheim ist.Weniger geheim sind die Preise: F√ºr 45 Euro fertigt er eine neue Nase, rekonstruiert ein Ohr oder auch ein Kinn. Wer allerdings einen Kopf modellieren lassen m√∂chte, muss mit 2500 Euro und acht Wochen rechnen, f√ºr einen gesamten K√∂rper mit 15.000 Euro und Monaten.

Obgleich er als Child am liebsten mit Autos spielte, faszinierten ihn schon fr√ºh diese Mannequins in den Schaufenstern. Heute kommt er an keinem Schaufenster vorbei, ohne einen Blick hineinzuwerfen. ‚ÄûIch erkenne schon an ihrem Standsockel um welchen Hersteller es sich handelt", sagt der gelernte Dekorateur. Sein erstes Exemplar kaufte er w√§hrend seiner Ausbildung. 3500 Schilling wollte der Besitzer haben, man einigte sich auf Ratenzahlungen. Ein Jahr lang hat herabgezahlt. Die Puppe aus der Serie Ragazza mit der Nummer 9908 bekam bald Gesellschaft, die Sammlung vergr√∂√üerte sich sukzessive, z√§hlte schon bald mehr als 100 Exponate.

Aus dem Hobby wurde sp√§ter ein Beruf. Bauernfeind verfeinerte sein Handwerk und √ºbernahm schlie√ülich ein altes Schaufensterpuppen-Unternehmen im Linz. Heute ist er Besitzer 1200 Puppen, vermietet und repariert sie, stellt Sonderanfertigungen her. Bauernfeind verkauft auch f√ºr andere Hersteller. Er besitzt exklusive die Handelsvertretung f√ºr eine belgische Schaufensterpuppen-Firma. Alle anderen renommierten Hersteller aus Europa haben irgendwann ihre Produktion nach Asien verlagert.

Qualit√§t und Nachhaltigkeit sind ihm wichtig. Gemeinsam mit einem Farblieferanten hat er deshalb eine Farbe f√ºr Puppen entwickelt, die nicht nur √∂kologisch einwandfrei, sondern auch f√ºr den Menschen unbedenklich ist. ‚ÄûSchlie√ülich dringen die Farbstoffe in die Textilien ein. Meine Farbe k√∂nnte man sogar essen, und es w√ºrde nichts passieren."

Weltweit gibt es etwa 100 Hersteller von Schaufensterpuppen, die zweimal im Jahr eine neue Kollektion herausbringen. Denn wie die Mode sind auch die Puppen Trends unterworfen: ‚ÄûIn Frankreich, England und den USA werden nat√ºrliche Modelle immer beliebter, w√§hrend bei uns noch abstrakte Modelle dominieren. Es l√§sst aber beobachten, dass man von einer Einheit gut wegkommt und dass immer h√§uftiger vielfarbige Figurtypen gew√ºncht werden", sagt der Puppenmacher.`,
            questions: [
              {
                id: "s2q1",
                type: "single",
                text: "Die erste Schaufensterpuppe wurde",
                options: [
                  {id: "s2q1o1", text: "Anfang des 20. Jahrhunderts von einem Puppenmacher erschaffen."},
                  {id: "s2q1o2", text: "f√ºr die ersten gro√üen Kaufh√§user produziert."},
                  {id: "s2q1o3", text: "von einem franz√∂sischen Schneider erfunden."}
                ],
                correctAnswer: "s2q1o3"
              },
              {
                id: "s2q2",
                type: "single", 
                text: "Bei der Restaurierung der Schaufensterpuppen",
                options: [
                  {id: "s2q2o1", text: "darf Herr Bauernfeind keinen normalen Nagellack auftragen."},
                  {id: "s2q2o2", text: "k√∂nnen keine Luxusmarken eingesetzt werden."},
                  {id: "s2q2o3", text: "verwendet er nur billige Produkte."}
                ],
                correctAnswer: "s2q2o1"
              },
              {
                id: "s2q3",
                type: "single",
                text: "Der Puppenmacher",
                options: [
                  {id: "s2q3o1", text: "hat schon als Kind gerne mit Puppen gespielt."},
                  {id: "s2q3o2", text: "konnte seine erste Schaufensterpuppe nicht auf einmal zahlen."},
                  {id: "s2q3o3", text: "organisierte eine Ausstellung mit Schaufensterpuppen."}
                ],
                correctAnswer: "s2q3o2"
              },
              {
                id: "s2q4",
                type: "single",
                text: "Herr Bauernfeind",
                options: [
                  {id: "s2q4o1", text: "er√∂ffnete die erste Linzer Firma f√ºr Schaufensterpuppen."},
                  {id: "s2q4o2", text: "handelt mit Schaufensterpuppen anderer Produzenten."},
                  {id: "s2q4o3", text: "stellt heute keine Schaufensterpuppen mehr her."}
                ],
                correctAnswer: "s2q4o2"
              },
              {
                id: "s2q5", 
                type: "single",
                text: "Schaufensterpuppen",
                options: [
                  {id: "s2q5o1", text: "k√∂nnen mit umweltfreundlichen Farben bemalt werden."},
                  {id: "s2q5o2", text: "sind nicht von Tendenzen der Mode abh√§ngig."},
                  {id: "s2q5o3", text: "sollen immer die gleiche Form haben."}
                ],
                correctAnswer: "s2q5o1"
              }
            ]
          },
          { 
            id: "s3", 
            title: "Leseverstehen, Teil 3", 
            points: 25,
            passageTitle:"Aufgabe: Lesen Sie die zehn Situationen (11-20) und die zw√∂lf Texte (A-L). Welcher Text passt zu welcher Situation? Sie k√∂nnen jeden Text nur einmal verwenden. Manchmal passt kein Text. W√§hlen Sie dann 'x'.",
            passage: "",
            questions:[],
            texts: [
              {id: "a", text: "Theater Marabu: In Pollekes elfj√§hrigem Leben scheint im Augenblick etwas falsch zu laufen. Es st√∂rt sie ja gar nicht, dass ihre Eltern geschieden sind. Sie hat ihren Papa sehr lieb, und sie hat eine prima Mama. Ihr Lehrer ist eigentlich auch ganz in Ordnung, aber muss der sich gleich in ihre Mama verlieben? Und dann ist Polleke sogar selbst schuld an allem. Aber sie gibt die Hoffnung nicht auf, dass am Ende doch alles gut wird, auch mit Mimun, dem liebsten Jungen auf der ganzen Erde und im ganzen Weltall... Datum: 01.11., Uhrzeit: 16.00 Uhr, Ort: Theaterwerkstatt, Alter: ab 9 Jahren", correctAnswer: "12"},
              {id: "b", text: "Rasmus und der Landstreicher: Nach dem Kinderbuch von Astrid Lindgren. Rasmus ist in einem Kinderheim aufgewachsen, er hat keine Eltern. Eines Tages l√§uft er davon und will sich Eltern suchen. Die erste Nacht schl√§ft er in einer Scheune im Stroh, und am Morgen entdeckt er neben sich Oskar. Oskar ist ein Landstreicher, der keine Wohnung hat. Zuerst hat Rasmus Angst vor ihm, aber schon bald merkt er, dass Oskar ein pr√§chtiger Mensch ist. Gemeinsam suchen sie Eltern f√ºr Rasmus. Doch als sie endlich prima Eltern gefunden haben, da wollen die beiden sich nicht mehr trennen. Datum: 6.11., Uhrzeit: 15.00 Uhr, Ort: B√ºrgerkino, Alter: ab 5 Jahren", correctAnswer: "16"},
              {id: "c", text: "Claus von Wagner: Im Feld: Die Verf√ºhrung des Buches 'Im Feld' handelt von einem jungen Mann, der bisher mit den W√∂lfen gereult hat. Er hat stets gemacht, was alle gemacht haben, und sich nach der Mehrheit gerichtet: F√ºhrerschein, Studium, Beruf, Freundin, iPod. In dieser Reihenfolge, Nun soll er pl√∂tzlich Vater werden. Doch der Antibeld ergreift die Flucht, um nachzudenken. Verfolgt von st√§dtischen Beamten, der Polizei, den Reportern eines regionalen H√∂rfunksenders und seinen eigenen √Ñngsten, st√ºrzt er sich in pointenreiche Analysen des Weltzustandes‚Ä¶ Datum: 30.10. bis 01.11., Uhrzeit: 20.00 Uhr, Ort: Kinopolis", correctAnswer: null},
              {id: "d", text: "Geschlossene Gesellschaft: Drama von Jean-Paul-Sartre: Drei Personen, ein Mann und zwei Frauen, werden nach ihrem Tod in einem Zimmer eingesperrt, das keiner der drei jemals wieder verlassen und niemand anderes je betreten wird: Der Ort des Geschehens ist die H√∂lle. Alle drei sind sich bewusst, dass sie sich in der H√∂lle befinden, und machen sich auf das Schlimmste gefasst, aber die erwartete Folter und die k√∂rperlichen Qualen stellen sich nicht ein, nur eine leichte Hitze ist zu versp√ºren. Tastend versuchen Sie, voneinander den Grund f√ºr die H√∂llenfahrt zu erfahren, ohne jedoch ihre eigene Schuld zu offenbaren. Datum: 01.11., Uhrzeit: 20.00 Uhr, Ort: Euro Theater Central", correctAnswer: null},
              {id: "e", text: "Beehovens Bonn: Im Dezember 1770 erblickte Ludwig von Beethoven in der Bonngasse 20 das Licht der Welt. Wer ahnte damals, dass mit ihm ein musikalisches Genie geboren wurde, dessen Musik heute in aller Welt bekannt ist? Bis 1792 lebte Beethoven in Bonn, bevor er nach Wien ging und zu einem der ber√ºhmtesten Komponisten der Welt wurde. Es werden Orte und Pl√§tze aufgesucht, wo der weltber√ºhmte Komponist wirkte und die faszinierende Einblicke in das Alltagsleben dieses gro√üen Bonners erm√∂glichen. Datum: 01.12. bis 31.12., Ort: Touristeninformation", correctAnswer: "19"},
              {id: "f", text: "Radtour am Rhein: Hinweis: Diese Tour ist nur von Gruppen auf Anfrage buchbar! Die Fahrr√§der sind mitzubringen. Die Tour wird vom ADFC angeboten und verl√§uft am Rhein, einem der geschichtstr√§chtigsten Fl√ºsse der Welt. Er symbolisiert wie f√ºr viele Rheinanwohner auch f√ºr Bond √ºber Jahrhunderte hinweg bis auf den heutigen Tag die Lebensader der Stadt. Entlang des linksrheinischen Rheinufers sprechen die steinernen Zeitzeugen der Bonner Geschichte f√ºr sich, wobei auch die zukunftsweisenden Aspekte der Stadt nicht zu kurz kommen. Datum: 01.02. bis 31.12. Ort und Uhrzeit: nach Vereinbarung", correctAnswer: "13"},
              {id: "g", text: "Weihnachtsmarkt in Koblenz: √úber 100 festlich geschm√ºckte Holzh√§uschen, der Duft von Lebkuchen und Gl√ºhwein liegt in der Luft. Weihnachtsmelodien erklingen im malerischen Ambiente der historischen Altstadt unweit der Einkaufsstra√üen: Das ist der Koblenzer Weihnachtsmarkt 2007. Alles, was das Herz in der Weihnachtszeit begehrte, findet sich hier wieder, denn auch in diesem Jahr warten wieder ein umfangreiches Angebot an Kunsthandwerk und Weihnachtsschmuck und eine riesige Auswahl an Geschenkartikein auf die Besucher. Abgerundet durch Weihnachtsb√§ckerei und viele Attraktionen, wird der Besuch auf dem Koblenzer Weihnachtsmarkt zu einem Erlebnis, das Sie sich nicht entgehen lassen sollen. Datum: 23.11. - 23.12., Ort: Fu√üg√§ngerzone im Zentrum", correctAnswer: null},
              {id: "h", text: "Drei Fl√∂he in Bethlehem: Im Jahr I machten sich drei Fl√∂he aus Deutschland auf den Weg nach Israel, um einmal so richtig zu entspannen. Leider war zu diesem Zeitpunkt eine Volksz√§hlung im vollen Gange und die einzige √úbernachtungsm√∂glichkeit fanden sie in einem Stall bei Bethlehem. Dass sie diese Unterkunft auch noch mit einem kleinen Kind teilen m√ºssten, damit rechnete keiner der drei Fl√∂he. Und dass dieses Kind auch noch eine Ber√ºhmtheit war, machte die ganze Sache f√ºr die drei Fl√∂he zu einem aufregenden Abenteuer. Dieses neue Kinderst√ºck aus der Feder von Dirk Zimmer erz√§hlt die Weihnachtsgeschichte auf humorvolle und gef√ºhrvolle Weise aus der Sicht der drei Fl√∂hen. Datum: 26.11. ‚Äì 22.12., Uhrzeit: jeweils 15.00 Uhr, Ort: Innenhof des Rathauses. Alter: ab 5 Jahre", correctAnswer: "11"},
              {id: "i", text: "Weihnachtsshow: 'Stille Nacht' trifft 'Last Christmas'. Gospel umarmt Soul, und Pop k√ºsst Klassik. Als 1997 die Idee entstand, eine Weihnachtsshow zu entwickeln, die die sch√∂nsten Weihnachtslieder aller Zeiten und aller Genre in sich vereint, konnte sich keiner so recht vorstellen, dass diese Show einmal zur erfolgreichsten Weihnachtsshow Deutschlands avancieren w√ºrde. Seit zehn Jahren begeistert nun die Band 'Christmas Moments' von Thomas Schwab & Band das Publikum sowohl in den gro√üen Konzerthallen der Republik (unter anderem Arena Trier, Ph√∂nixhalle Mainz) als auch vor den Fernsehern (ARD- Ausstrahlungen seit 2004), 'Christmas Moments' trifft mitten ins Herz und konnte in den letzten Jahren mehr als 500.000 Zuschauer begeistern. Datum: 11.12., Uhrzeit: 20.00 Uhr, Ort: Rhein-Mosel-Halle", correctAnswer: "14"},
              {id: "j", text: "Lasse Lindgren Ensemble: Jazz vom Feinsten mit durchaus gewollten konservativen Z√ºgen. Der Trompeter Lasse Lindgren ist einer der innovativen Spitzen-Trompeter der aktuellen Jazzszene in Schweden, der in vielen internationalen Biobands und zusammen mit anderen ber√ºhmten Jazzmusikern gespielt hat. Von der 'Tageszeitung 'Svenska Dagbladet' wurde er als 'einer der kompetentesten Trompetenspieler dieses Landes bezeichnet und Randy Brecker schrieb: 'Es ist so erfrischend, etwas zu h√∂ren, was wirklich originell ist! Lass Lindgren. Du bist ein wundervoller Spieler und Komponist'. Sein neuestes Projekt ist ein Glaubensbekenntnis an die Kraft und Energie des Jazz mit eigener Handschrift: Lasse Lindgren hat eine virtuose, immer transparente Hingabe zu seinem Instrument. Datum: 1.11., Uhrzeit : 19.00 Uhr, Ort: Irish Pub im Stadtzentrum", correctAnswer: "15"},
              {id: "k", text: "10 Jahre F√úR DIE KATZ: Unglaublich! 10 Jahre ist es bereits her, seit F√úR DIE KATZ wie ein Faustschlag ins Licht der √ñffentlichkeit traten und sich binnen k√ºrzester Zeit in die Spitzenriege der deutschen Komiker katapultierten. Heute befinden sich die beiden mit Preisen √ºberh√§uften Weltb√ºrger Benno Rex und Karl Salzburger auf dem vorl√§ufigen H√∂hepunkt ihrer eindrucksvollen Karriere und gelten als die vielseitigsten, kreativsten und f√ºr Presse wie Fans schlichtweg lustigsten Komodianten Deutschlands ihre Wortsch√∂pfungen und Charaktere erweisen sich immer wieder als richtungsweisende Leitsterne f√ºr die gesamte Comedy-Branche. Datum: 5.11., Uhrzeit: 20.00 Uhr, Ort: Haus des Kabaretts", correctAnswer: "20"},
              {id: "l", text: "Weihnachtsvariete im Caf√© Spitz: Das Weihnachtsvariete erwartet Sie auch in diesem Jahr mit atemberaubender Akrobatik, traumhafter Jonglage, erg√§nzt von Livermusikern. Seien Sie dabei und staunen Sie vielleicht mit ihrer Familie, mit ihren Lieblingskollegen oder der ganzen Firma oder einfach nur mit ihrem oder ihrer Liebsten. Karl-Heinz Helmschrot hat auch in diesem Jahr wieder eine faszinierende Gruppe von sehr unterschiedlichen K√ºnstlern zusammengestellt. Zum 10-j√§hrigen Jubil√§um - 10 K√ºnstler! Nicht zust√§ndig ist er f√ºr Ihr leibliches Wohl! Daf√ºr haben die K√∂che des Caf√© Spitz wieder eine internationale Karte zusammengestellt, also freuen Sie sich auf K√∂stlichkeiten aus aller Welt. Datum: 9.12., Uhrzeit: 21.00 Uhr, Ort: Caf√© Spitz", correctAnswer: "17"}
            ],
            situations: [
              {id: "11", text: "Sie wollen mit Ihren Kindern eine etwas andere, eher lustige Seite von Weihnachten erleben."},
              {id: "12", text: "Sie m√∂chten mit Ihrer zw√∂lfj√§hrigen Tochter ein altersgerechtes Theaterst√ºck besuchen."},
              {id: "13", text: "Sie wollen eine Stadtbesichtigung mit ein wenig Sport verbinden."},
              {id: "14", text: "Sie m√∂chten an einem Abend alte und neue Weihnachtslieder h√∂ren."},
              {id: "15", text: "Sie lieben Auftritte von herausragenden Musikern."},
              {id: "16", text: "Sie m√∂chten zusammen mit Ihrem kleinen Neffen einen Kinderfilm sehen."},
              {id: "17", text: "Sie m√∂chten im Dezember essen gehen und ein buntes, k√ºnstlerisches Programm genie√üen."},
              {id: "18", text: "Sie wollen Ihrem Freund, der Tanztheater liebt, eine Eintrittskarte zum Geburtstag schenken."},
              {id: "19", text: "Ihre Schwester interessiert sich f√ºr die Biographien gr√∂√üer Musiker."},
              {id: "20", text: "Sie wollen mit Bekannten ausgehen und mal wieder herzhaft lachen."}
            ]
          },
          { 
            id: "s4", 
            title: "Sprachbausteine, Teil 1", 
            points: 15,
            passageTitle: "Aufgabe: Erg√§nzen Sie den Text. W√§hlen Sie f√ºr jede L√ºcke das passende Wort.",
            passage: "",
            questions: [],
            fillBlanks: [
              {
                id: "21",
                options: ["k√∂nnt", "m√ºsst", "sollt"],
                correctAnswer: "sollt"
              },
              {
                id: "22",
                options: ["an", "f√ºr", "zu"],
                correctAnswer: "zu"
              },
              {
                id: "23",
                options: ["bei", "mit", "zu"],
                correctAnswer: "bei"
              },
              {
                id: "24",
                options: ["einiges", "etwas", "vieles"],
                correctAnswer: "einiges"
              },
              {
                id: "25",
                options: ["das", "dem", "den"],
                correctAnswer: "den"
              },
              {
                id: "26",
                options: ["ist", "sind", "waren"],
                correctAnswer: "k√∂nnen"
              },
              {
                id: "27",
                options: ["wann", "wie", "wo"],
                correctAnswer: "da"
              },
              {
                id: "28",
                options: ["Dabei", "Damit", "Dann"],
                correctAnswer: "Dabei"
              },
              {
                id: "29",
                options: ["dabei", "daneben", "darin"],
                correctAnswer: "dem"
              },
              {
                id: "30",
                options: ["man", "sich", "sie"],
                correctAnswer: "etwas"
              }
            ],
            fillText: `Liebe Lina, leber Florian,

nun sind wir schon einige Monate in unserer neuen Wohnung, und ihr habt uns noch immer nicht
besucht. Ihr ________ doch endlich unser neues Heim und unsere kleine Stadt Kennenlernen.
Deshalb m√∂chten wir euch ________ das verl√§ngerte Wochenende Anfang Juni einladen. Wenn ihr am
Donnerstagabend anreist, haben wir drei ganze Tage zur Verf√ºgung. Wohnen k√∂nnt ihr nat√ºrlich
 ________ uns. Emma f√§hrt im Juni in Urlaub, und sie √ºberl√§sst euch gern ihr Zimmer.

Die Stadt Steyr hat ________ zu bieten. Wir k√∂nnen eine F√ºhrung durch die historische Altstadt
machen, die romantischen Innenh√∂fe besichtigen und auf ________ Tum der Stadtpfarrkirche steigen.
Da geht es √ºber 228 Stufen 60 Meter hinauf. Bei einem l√§ngeren Rundgang ________ Auch die
wunderbare Schlossbibliothek und das Tapetenzimmer zu besichtigen. Besonders interessant ist
die Runde durch den Wehrgraten, ________ man an den alten Bauten den Wandel der Industrie
nachvollziehen kann, ________ erf√§hrt man alles √ºber die Eisenindustrie, die den Reichtum der Stadt
begr√ºndet hat.

Au√üerdem finden an  ________ Wochenende die j√§hrlichen Literaturtage Stadt. Bei dieser Veranstaltung
pr√§sentieren zeitgen√∂ssische Autorinnen und Autoren ihre Neuerscheinungen. Die Lesungen
finden zum Gro√üteil in den pr√§chtigen Arkadenh√∂fen statt. Die Stimmung dort ist wirklich eine ganz
besondere. Lina, das w√§re doch was f√ºr dich, oder?

Auch die Umgebung kann ________ sehen lassen. Praktisch vor den Toren der Stadt beginnt der
Nationalpark Kalkalpen, Dort kann man wunderbar wandern und Rad fahren. Ihr k√∂nnt in der Stadt
auch R√§der ausleihen.

Wir hoffen sehr, dass ihr noch keine Plane f√ºr das Wochenende habt und zu uns kommen k√∂nnt.
Viele liebe Gr√º√üe und hoffentlich bis bald!

Chiara und Mark`
          },
          { 
            id: "s5", 
            title: "Sprachbausteine, Teil 2", 
            points: 15,
            passageTitle: "Aufgabe: Lesen Sie den Text und entscheiden Sie, welches Wort aus dem Kasten (a-o) in die L√ºcken 31-40 passt. Sie k√∂nnen jedes Wort im Kasten nur einmal verwenden. Nicht alle W√∂rter passen in den Text.",
            passage: "",
            questions: [],
            fillBlanks2: [
              {options: ["AB", "AUF", "AUS", "AU√üERDEM", "DASS", "ENTHALTEN", "ENTHALTEN", "F√úR", "HINTER", "OB", "SOGAR", "SONDERN", "VERWENDET", "WENN", "WIRKLICH"],
                correctAnswer: "ob"
              },
              {
                id: "32", 
                options: ["AB", "AUF", "AUS", "AU√üERDEM", "DASS", "ENTHALTEN", "ENTHALTEN", "F√úR", "HINTER", "OB", "SOGAR", "SONDERN", "VERWENDET", "WENN", "WIRKLICH"],
                correctAnswer: "Au√üerdem"
              },
              {
                id: "33",
                options: ["AB", "AUF", "AUS", "AU√üERDEM", "DASS", "ENTHALTEN", "ENTHALTEN", "F√úR", "HINTER", "OB", "SOGAR", "SONDERN", "VERWENDET", "WENN", "WIRKLICH"],
                correctAnswer: "enthalten"
              },
              {
                id: "34",
                options: ["AB", "AUF", "AUS", "AU√üERDEM", "DASS", "ENTHALTEN", "ENTLASTET", "F√úR", "HINTER", "OB", "SOGAR", "SONDERN", "VERWENDET", "WENN", "WIRKLICH"],
                correctAnswer: "hinter"
              },
              {
                id: "35",
                options: ["AB", "AUF", "AUS", "AU√üERDEM", "DASS", "ENTHALTEN", "ENTLASTET", "F√úR", "HINTER", "OB", "SOGAR", "SONDERN", "VERWENDET", "WENN", "WIRKLICH"],
                correctAnswer: "sch√ºtzen"
              },
              {
                id: "36",
                options: ["AB", "AUF", "AUS", "AU√üERDEM", "DASS", "ENTHALTEN", "ENTLASTET", "F√úR", "HINTER", "OB", "SOGAR", "SONDERN", "VERWENDET", "WENN", "WIRKLICH"],
                correctAnswer: "aus"
              },
              {
                id: "37",
                options: ["AB", "AUF", "AUS", "AU√üERDEM", "DASS", "ENTHALTEN", "ENTLASTET", "F√úR", "HINTER", "OB", "SOGAR", "SONDERN", "VERWENDET", "WENN", "WIRKLICH"],
                correctAnswer: "auf"
              },
              {
                id: "38",
                options: ["AB", "AUF", "AUS", "AU√üERDEM", "DASS", "ENTHALTEN", "ENTLASTET", "F√úR", "HINTER", "OB", "SOGAR", "SONDERN", "VERWENDET", "WENN", "WIRKLICH"],
                correctAnswer: "verwendet"
              },
              {
                id: "39",
                options: ["AB", "AUF", "AUS", "AU√üERDEM", "DASS", "ENTHALTEN", "ENTLASTET", "F√úR", "HINTER", "OB", "SOGAR", "SONDERN", "VERWENDET", "WENN", "WIRKLICH"],
                correctAnswer: "dabei"
              },
              {
                id: "40",
                options: ["AB", "AUF", "AUS", "AU√üERDEM", "DASS", "ENTHALTEN", "ENTLASTET", "F√úR", "HINTER", "OB", "SOGAR", "SONDERN", "VERWENDET", "WENN", "WIRKLICH"],
                correctAnswer: "dass"
              }
            ],
            wordBank: ["AB", "AUF", "AUS", "AU√üERDEM", "DASS", "ENTHALTEN", "ENTLASTET", "F√úR", "HINTER", "OB", "SOGAR", "SONDERN", "VERWENDET", "WENN", "WIRKLICH"],
            fillText2: `
<div class="fill-blank-container">
  <p>
    Was steckt hinter "Bio"? <br><br>
    √úberall gibt es inzwischen Bio-Lebensmittel ‚Äì aber h√§ufig fehlen den K√§ufern Hintergrundinformationen. 
    Viele Verbraucher fragen sich beispielsweise, 
    <span class="blank-slot" data-blank-id="31">________</span> Bio-Produkte nun auch wirklich die ges√ºnderen sind. 
    Skepsis macht sich breit, sp√§testens wenn wieder einmal ein Skandal in den Nachrichten ist. 
    <span class="blank-slot" data-blank-id="32">________</span> sind Bio-Produkte teurer ‚Äì und den Aufpreis will man nur zahlen, 
    wenn man sicher ist, dass die Bio-Lebensmittel die bessere Wahl sind. 
    Der Informationsdienst der Bundesministeriums f√ºr Ern√§hrung, Landwirtschaft und Verbraucherschutz gibt dar√ºber eine eindeutige Auskunft: 
    Bio-Lebensmittel sind ges√ºnder. Sie 
    <span class="blank-slot" data-blank-id="33">________</span> weniger Nitrat, mehr N√§hrstoffe und sind besser geeignet, wenn man Allergien hat.
  </p>

  <p>
    Doch Bio-Lebensmittel sind nicht nur gut f√ºr die Gesundheit. 
    Bei vielen Verbrauchern steht 
    <span class="blank-slot" data-blank-id="34">________</span> ihrem Einkaufsverhalten ein √∂kologisches Bewusstsein. 
    Bio-Verbraucher machen sich Gedanken √ºber die Herkunft der Lebensmittel, denn auch die umweltfreundliche Landwirtschaft ist besser f√ºr Tiere und Pflanzen, kurz: Sie 
    <span class="blank-slot" data-blank-id="35">________</span> unsere Umwelt. 
    Und viele Bio-Verbraucher wollen als gesunde Menschen in einer gesunden Umwelt leben und auch der n√§chsten Generation eine gesunde Umwelt hinterlassen.
  </p>

  <p>
    Bio-Lebensmittel kommen 
    <span class="blank-slot" data-blank-id="36">________</span> √∂kologischer Landwirtschaft, die im Einklang mit der Natur steht. 
    Die Mindestrichtlinien der Bio-Landwirtschaft beinhalten eine artgerechte Tierhaltung: Alle Tiere m√ºssen ausreichend Platz haben, es gibt keine langen Tiertransporte, keine Gentechnik. 
    Die Produkte werden m√∂glichst in der n√§heren Umgebung verkauft, beispielsweise 
    <span class="blank-slot" data-blank-id="37">________</span> Wochenm√§rkten oder in Bio-Superm√§rkten. 
    Au√üerdem d√ºrfen weder Kunstd√ºnger noch chemische Sch√§dlingsbek√§mpfungsmittel 
    <span class="blank-slot" data-blank-id="38">________</span> werden.
  </p>

  <p>
    Wenn die Bio-Lebensmittel weiterverarbeitet werden ‚Äì beispielsweise aus Bio-Eiern, Bio-Mehl und Bio-Zucker ein Bio-Kuchen gebacken wird ‚Äì, 
    d√ºrfen 
    <span class="blank-slot" data-blank-id="39">________</span> nur Bio-Lebensmittel benutzt werden. <br>
    F√ºr Bio-Produkte gibt es √ºbrigens auch ein Zertifikat, das Bio-Siegel. 
    Diese Richtlinien garantieren, 
    <span class="blank-slot" data-blank-id="40">________</span> die Produkte wirklich "bio" sind.
  </p>
</div>
`
          }
        ]
      };

      /* ===== State & DOM refs ===== */
      let state = { 
        sectionIndex: 0, 
        questionIndex: 0, 
        answers: {}, 
        marked: {}, 
        remaining: exam.durationSec,
        showResults: false,
        timerStarted: false,
        timerInterval: null
      };
      const topTiles = document.getElementById('topTiles-lesen');
      const passageTitleEl = document.getElementById('passageTitle-lesen');
      const passageContentEl = document.getElementById('passageContent-lesen');
      const sectionNameEl = document.getElementById('sectionName-lesen');
      const questionTitleEl = document.getElementById('questionTitle-lesen');
      const questionBodyEl = document.getElementById('questionBody-lesen');
      const headingsBankContainer = document.getElementById('headingsBankContainer-lesen');
      const timerEl = document.getElementById('timer-lesen');
      const statusText = document.getElementById('statusText-lesen');
      const resultBtn = document.getElementById('resultBtn-lesen');
      const resetBtn = document.getElementById('resetBtn-lesen');
      const resetSectionBtn = document.getElementById('resetSectionBtn-lesen');

      /* ===== Timer Functions ===== */
      function startTimer(){
        if(state.timerInterval) {
          clearInterval(state.timerInterval);
        }
        
        state.timerStarted = true;
        state.timerInterval = setInterval(()=>{
          if(state.remaining <= 0){
            clearInterval(state.timerInterval);
            timerEl.textContent = 'Zeit abgelaufen';
            return;
          }
          state.remaining--;
          updateTimerDisplay();
        }, 1000);
      }

      function resetTimer(){
        if(state.timerInterval) {
          clearInterval(state.timerInterval);
        }
        state.remaining = exam.durationSec;
        state.timerStarted = false;
        updateTimerDisplay();
        startTimer();
      }

      function updateTimerDisplay(){
        const min = Math.floor(state.remaining / 60);
        const sec = state.remaining % 60;
        timerEl.textContent = `Verbleibende Zeit: ${min.toString().padStart(2, '0')}:${sec.toString().padStart(2, '0')}`;
      }

      /* ===== Reset Section Function ===== */
      function resetCurrentSection() {
        const currentSection = exam.sections[state.sectionIndex];
        
        if (confirm(`M√∂chten Sie wirklich den Teil "${currentSection.title}" zur√ºcksetzen? Alle Antworten in diesem Teil werden gel√∂scht.`)) {
          if (currentSection.id === 's1') {
            currentSection.texts.forEach(text => {
              delete state.answers[text.id];
            });
          } else if (currentSection.id === 's2') {
            currentSection.questions.forEach(question => {
              delete state.answers[question.id];
            });
          } else if (currentSection.id === 's3') {
            currentSection.situations.forEach(situation => {
              delete state.answers[situation.id];
            });
          } else if (currentSection.id === 's4') {
            currentSection.fillBlanks.forEach(blank => {
              delete state.answers[blank.id];
            });
          } else if (currentSection.id === 's5') {
            currentSection.fillBlanks2.forEach(blank => {
              delete state.answers[blank.id];
            });
          }
          
          renderAll();
        }
      }

      /* ===== Render ===== */
      function renderTopTiles(){ 
        topTiles.innerHTML=''; 
        exam.sections.forEach((sec,idx)=>{ 
          const div=document.createElement('div'); 
          div.className='tile'+(idx===state.sectionIndex?' active':'')+(isSectionDone(sec)?' done':''); 
          div.innerHTML=`<div>${sec.title}</div><div class="points">${sec.points} P</div>`; 
          div.onclick=()=>{state.sectionIndex=idx; state.questionIndex=0; state.showResults=false; renderAll();}; 
          topTiles.appendChild(div); 
        }); 
      }

      function isSectionDone(section){
        if(section.id==='s1') return section.texts.every(t=>state.answers[t.id]);
        if(section.id==='s2') return section.questions.every(q=>state.answers[q.id]);
        if(section.id==='s3') return section.situations.every(h=>state.answers[h.id] || state.answers[h.id] === 'X');
        if(section.id==='s4') return section.fillBlanks.every(b=>state.answers[b.id]);
        if(section.id==='s5') return section.fillBlanks2.every(b=>state.answers[b.id]);
        return false;
      }

      function renderAll(){
        renderTopTiles();
        const section = exam.sections[state.sectionIndex];
        sectionNameEl.textContent = section.title;
        passageTitleEl.textContent = section.passageTitle;
        
        resetSectionBtn.style.display = 'block';
        
        if(state.showResults){
          renderResults();
          return;
        }
        
        if(section.id === 's1'){
          renderPart1();
        } else if(section.id === 's2'){
          renderPart2();
        } else if(section.id === 's3'){
          renderPart3();
        } else if(section.id === 's4'){
          renderSprachbausteine1();
        } else if(section.id === 's5'){
          renderSprachbausteine2();
        }
      }

      function renderPart1(){
        const section = exam.sections[state.sectionIndex];
        
        let textsHTML = `<div class="instructions">Ziehen Sie die passenden √úberschriften auf die Texte. Sie k√∂nnen jede √úberschrift nur einmal verwenden.</div>`;
        
        section.texts.forEach((text, idx) => {
          const number = idx + 1;
          const selectedHeading = state.answers[text.id];
          
          textsHTML += `
            <div class="text-container">
              <div class="text-title">Text ${number}</div>
              <div class="text-content">${text.content}</div>
              <div class="title-slot ${selectedHeading ? 'has-title' : ''}" data-text-id="${text.id}">
                ${selectedHeading ? getHeadingTextById(selectedHeading) : 'Ziehen Sie hier eine √úberschrift hin'}
              </div>
            </div>
          `;
        });
        
        passageContentEl.innerHTML = textsHTML;
        
        let headingsHTML = `<div class="headings-bank">`;
        section.headings.forEach(heading => {
          const isUsed = section.texts.some(text => state.answers[text.id] === heading.id);
          
          headingsHTML += `
            <div class="heading-item ${isUsed ? 'used' : ''}" draggable="${!isUsed}" data-heading-id="${heading.id}">
              ${heading.id}) ${heading.text}
            </div>
          `;
        });
        
        headingsHTML += `</div>`;
        
        headingsBankContainer.innerHTML = headingsHTML;
        
        setupDragAndDrop();
        
        questionBodyEl.innerHTML = '';
        questionTitleEl.textContent = '';
      }

      function getHeadingTextById(id){
        const section = exam.sections[state.sectionIndex];
        const heading = section.headings.find(h => h.id === id);
        return heading ? `${heading.id}) ${heading.text}` : '';
      }

      function setupDragAndDrop(){
        const headingItems = document.querySelectorAll('.heading-item:not(.used)');
        const titleSlots = document.querySelectorAll('.title-slot');
        
        headingItems.forEach(item => {
          item.addEventListener('dragstart', (e) => {
            e.dataTransfer.setData('text/plain', e.target.dataset.headingId);
          });
        });
        
        titleSlots.forEach(slot => {
          slot.addEventListener('dragover', (e) => {
            e.preventDefault();
            slot.style.background = '#e8f4ff';
          });
          
          slot.addEventListener('dragleave', (e) => {
            slot.style.background = slot.classList.contains('has-title') ? '#e8fbe9' : '#f8fbff';
          });
          
          slot.addEventListener('drop', (e) => {
            e.preventDefault();
            const headingId = e.dataTransfer.getData('text/plain');
            const textId = slot.dataset.textId;
            
            Object.keys(state.answers).forEach(key => {
              if(state.answers[key] === headingId) {
                delete state.answers[key];
              }
            });
            
            state.answers[textId] = headingId;
            renderAll();
          });
        });
      }

      function renderPart2(){
        const section = exam.sections[state.sectionIndex];
        
        passageContentEl.innerHTML = `<div class="passage">${section.passage}</div>`;
        
        let questionsHTML = `<div class="all-questions">`;
        
        section.questions.forEach((question, idx) => {
          const questionNumber = idx + 6;
          const userAnswer = state.answers[question.id];
          
          questionsHTML += `
            <div class="question-block">
              <div class="question-text">${questionNumber}. ${question.text}</div>
              <div class="options">
                ${question.options.map(opt => `
                  <div class="option ${userAnswer === opt.id ? 'selected' : ''}" 
                       onclick="window.lesenApp.selectOption('${question.id}', '${opt.id}')">
                    <div class="radio"></div>
                    <div>${opt.text}</div>
                  </div>
                `).join('')}
              </div>
            </div>
          `;
        });
        
        questionsHTML += `</div>`;
        
        questionBodyEl.innerHTML = questionsHTML;
        questionTitleEl.textContent = '';
        headingsBankContainer.innerHTML = '';
      }

      function renderPart3(){
        const section = exam.sections[state.sectionIndex];
        
        let textsHTML = `
          <div class="instructions">Ziehen Sie die passenden Situationen auf die Texte. Sie k√∂nnen jede Situation nur einmal verwenden. Manchmal passt keine Situation.</div>
          <div class="texts-list">
            <h3>Texte (A-L)</h3>
        `;
        
        section.texts.forEach(text => {
          const userAnswer = Object.keys(state.answers).find(key => state.answers[key] === text.id);
          const selectedSituation = userAnswer ? section.situations.find(h => h.id === userAnswer) : null;
          
          textsHTML += `
            <div class="text-item" data-text-id="${text.id}">
              <div class="text-letter">${text.id})</div>
              <div class="text-content">${text.text}</div>
              <div class="title-slot ${userAnswer ? 'has-title' : ''} ${userAnswer === 'X' ? 'has-x' : ''}" data-text-id="${text.id}">
                ${selectedSituation ? selectedSituation.text : (userAnswer === 'X' ? 'X - Keine passende Situation' : 'Ziehen Sie hier eine Situation hin')}
              </div>
            </div>
          `;
        });
        
        textsHTML += `</div>`;
        
        passageContentEl.innerHTML = textsHTML;
        
        let situationsHTML = `
          <div class="situations-list">
            <h3>Situationen (11-20)</h3>
        `;
        
        section.situations.forEach((situation, idx) => {
          const situationNumber = parseInt(situation.id);
          const isUsed = state.answers[situation.id];
          const isX = state.answers[situation.id] === 'X';
          
          situationsHTML += `
            <div class="situation-item ${isUsed ? 'used' : ''}" draggable="${!isUsed}" data-situation-id="${situation.id}">
              <div class="situation-number">${situationNumber}.</div>
              <div class="situation-text">${situation.text}</div>
              ${!isUsed ? `<button class="exam-btn no-match ${isX ? 'selected' : ''}" onclick="window.lesenApp.markNoMatch('${situation.id}')">X - Kein passender Text</button>` : ''}
            </div>
          `;
        });
        
        situationsHTML += `</div>`;
        
        questionBodyEl.innerHTML = situationsHTML;
        questionTitleEl.textContent = '';
        headingsBankContainer.innerHTML = '';
        
        setupPart3DragAndDrop();
      }

      function markNoMatch(situationId) {
        Object.keys(state.answers).forEach(key => {
          if(state.answers[key] === situationId) {
            delete state.answers[key];
          }
        });
        
        state.answers[situationId] = 'X';
        try{ localStorage.setItem('lesenAnswers', JSON.stringify(state.answers)); }catch(e){}
        
        renderAll();
      }

      function setupPart3DragAndDrop(){
        const situationItems = document.querySelectorAll('.situation-item:not(.used)');
        const textSlots = document.querySelectorAll('.text-item .title-slot');
        
        situationItems.forEach(item => {
          item.addEventListener('dragstart', (e) => {
            e.dataTransfer.setData('text/plain', e.target.dataset.situationId);
          });
        });
        
        textSlots.forEach(slot => {
          slot.addEventListener('dragover', (e) => {
            e.preventDefault();
            slot.style.background = '#e8f4ff';
          });
          
          slot.addEventListener('dragleave', (e) => {
            const hasTitle = slot.classList.contains('has-title');
            const hasX = slot.classList.contains('has-x');
            slot.style.background = hasTitle ? '#e8fbe9' : (hasX ? '#f8d7da' : '#f8fbff');
          });
          
          slot.addEventListener('drop', (e) => {
            e.preventDefault();
            const situationId = e.dataTransfer.getData('text/plain');
            const textId = slot.dataset.textId;
            
            Object.keys(state.answers).forEach(key => {
              if(state.answers[key] === situationId) {
                delete state.answers[key];
              }
            });
            
            state.answers[situationId] = textId;
            renderAll();
          });
        });
      }

      function renderSprachbausteine1(){
        const section = exam.sections[state.sectionIndex];
        
        let textWithBlanks = section.fillText;
        
        const blankPlaceholders = [];
        section.fillBlanks.forEach(blank => {
          blankPlaceholders.push(`BLANK_${blank.id}`);
        });
        
        let tempText = textWithBlanks;
        blankPlaceholders.forEach((placeholder, index) => {
          tempText = tempText.replace('________', placeholder);
        });
        
        section.fillBlanks.forEach(blank => {
          const userAnswer = state.answers[blank.id];
          const displayText = userAnswer ? userAnswer : '________';
          tempText = tempText.replace(`BLANK_${blank.id}`, `<span class="blank-word ${userAnswer ? 'has-answer' : ''}" data-blank-id="${blank.id}">${displayText}</span>`);
        });
        
        passageContentEl.innerHTML = `
          <div class="instructions">Klicken Sie auf jede L√ºcke und w√§hlen Sie das passende Wort aus. Sie k√∂nnen die L√ºcken in beliebiger Reihenfolge ausf√ºllen.</div>
          <div class="fill-blank-container">${tempText}</div>
        `;
        
        document.querySelectorAll('.blank-word').forEach(blank => {
          blank.addEventListener('click', (e) => {
            showOptionsPopup(e.target);
          });
        });
        
        let optionsHTML = `<div class="horizontal-options" style="gap: 8px;">`;
        
        section.fillBlanks.forEach(blank => {
          const userAnswer = state.answers[blank.id];
          
          optionsHTML += `
            <div class="option-row" style="padding: 8px; margin-bottom: 5px;">
              <div class="option-number">${blank.id}</div>
              <div class="option-buttons">
                ${blank.options.map(opt => `
                  <div class="option-btn ${userAnswer === opt ? 'selected' : ''}" 
                       onclick="window.lesenApp.selectSprachbausteine1('${blank.id}', '${opt}')" 
                       style="padding: 6px 12px; font-size: 12px;">
                    ${opt}
                  </div>
                `).join('')}
              </div>
            </div>
          `;
        });
        
        optionsHTML += `</div>`;
        
        questionBodyEl.innerHTML = optionsHTML;
        questionTitleEl.textContent = '';
        headingsBankContainer.innerHTML = '';
      }

      function showOptionsPopup(blankElement){
        const existingPopup = document.querySelector('.options-popup');
        if(existingPopup) {
          existingPopup.remove();
        }
        
        const blankId = blankElement.getAttribute('data-blank-id');
        const section = exam.sections.find(s => s.id === 's4');
        const blank = section.fillBlanks.find(b => b.id === blankId);
        
        if(!blank) return;
        
        const popup = document.createElement('div');
        popup.className = 'options-popup';
        
        blank.options.forEach(opt => {
          const optionItem = document.createElement('div');
          optionItem.className = 'option-item';
          optionItem.textContent = opt;
          optionItem.onclick = () => {
            selectSprachbausteine1(blankId, opt);
            popup.remove();
          };
          popup.appendChild(optionItem);
        });
        
        blankElement.appendChild(popup);
      }

      function selectSprachbausteine1(blankId, answer){
        state.answers[blankId] = answer;
        renderAll();
      }

      function renderSprachbausteine2(){
        const section = exam.sections[state.sectionIndex];
        // Build text but replace blanks with unique placeholders first (prevents ambiguous replacements)
        let textWithPlaceholders = section.fillText2;
        const placeholders = [];
        section.fillBlanks2.forEach(blank => {
          const ph = `BLANK_${blank.id}`;
          placeholders.push({id: blank.id, ph});
          // replace first occurrence of the visual underline with placeholder
          textWithPlaceholders = textWithPlaceholders.replace('________', ph);
        });

        // Now replace placeholders with actual span elements showing current answer (or underscore)
        placeholders.forEach(item => {
          const userAnswer = state.answers[item.id];
          const displayText = userAnswer ? userAnswer : '________';
          const span = `<span class="blank-slot ${userAnswer ? 'has-answer' : ''}" data-blank-id="${item.id}">${displayText}</span>`;
          textWithPlaceholders = textWithPlaceholders.replace(item.ph, span);
        });

        passageContentEl.innerHTML = `
          <div class="instructions">Ziehen Sie die passenden W√∂rter aus dem Kasten in die L√ºcken. Jedes Wort kann nur einmal verwendet werden.</div>
          <div class="fill-blank-container">${textWithPlaceholders}</div>
        `;

        // attach click handlers to slots
        document.querySelectorAll('.blank-slot').forEach(slot => {
          slot.addEventListener('click', (e) => {
            // use the element itself to open popup
            showSprachbausteine2Options(slot);
          });
        });

        // Build word bank on the right
        let wordBankHTML = `<div class="word-bank-vertical" style="gap: 8px;">`;
        const usedWords = Object.values(state.answers);
        // Use section.wordBank if present, otherwise derive from fillBlanks2 options
        const bank = section.wordBank && section.wordBank.length ? section.wordBank : (section.fillBlanks2[0] ? section.fillBlanks2[0].options : []);
        bank.forEach(word => {
          const isUsed = usedWords.includes(word);
          wordBankHTML += `
            <div class="bank-word-vertical ${isUsed ? 'used' : ''}" 
                 draggable="${!isUsed}" 
                 data-word="${word}"
                 ${!isUsed ? `onclick="window.lesenApp.selectSprachbausteine2FromBank('${word}')"` : ''}>
              ${word}
            </div>
          `;
        });
        wordBankHTML += `</div>`;
        questionBodyEl.innerHTML = wordBankHTML;
        questionTitleEl.textContent = '';
        headingsBankContainer.innerHTML = '';

        setupSprachbausteine2DragAndDrop();
      }

      // --- Added functions to handle drag/drop and clicks for Sprachbausteine Teil 2 ---
      let lastClickedSprachSlot = null;

      function setupSprachbausteine2DragAndDrop(){
        // bank words: make draggable if not used, attach dragstart
        const bankWords = Array.from(document.querySelectorAll('.bank-word-vertical'));
        bankWords.forEach(el => {
          const word = el.dataset.word;
          if(!el.classList.contains('used')){
            el.setAttribute('draggable','true');
          } else {
            el.setAttribute('draggable','false');
          }
          // ensure single attached listener
          el.removeEventListener('dragstart', el._dstart);
          el._dstart = (e) => {
            e.dataTransfer.setData('text/plain', word);
            // also set an indicator
            e.dataTransfer.setData('source', 'bank');
          };
          el.addEventListener('dragstart', el._dstart);

          // keep onclick behavior (select into clicked slot)
          el.removeEventListener('click', el._onclick);
          el._onclick = () => {
            if(el.classList.contains('used')) return;
            selectSprachbausteine2FromBank(word);
          };
          el.addEventListener('click', el._onclick);
        });

        // blank slots: allow drop
        const slots = Array.from(document.querySelectorAll('.blank-slot'));
        slots.forEach(slot => {
          slot.addEventListener('dragover', (e) => {
            e.preventDefault();
            slot.classList.add('drag-over');
          });
          slot.addEventListener('dragleave', (e) => {
            slot.classList.remove('drag-over');
          });
          slot.addEventListener('drop', (e) => {
            e.preventDefault();
            slot.classList.remove('drag-over');
            const word = e.dataTransfer.getData('text/plain') || e.dataTransfer.getData('text/html');
            if(!word) return;
            // Determine blank id
            const blankId = slot.dataset.blankId;
            if(!blankId) return;
            // If this word is already used in another slot, free it
            Object.keys(state.answers).forEach(k => {
              if(state.answers[k] === word){
                delete state.answers[k];
              }
            });
            // If slot had a previous answer, free that bank word
            const prev = state.answers[blankId];
            if(prev){
              const prevEl = Array.from(document.querySelectorAll('.bank-word-vertical')).find(b=>b.dataset.word === prev);
              if(prevEl){
                prevEl.classList.remove('used');
                prevEl.setAttribute('draggable','true');
                prevEl.addEventListener('click', prevEl._onclick);
              }
            }
            // mark bank word used
            const bankEl = Array.from(document.querySelectorAll('.bank-word-vertical')).find(b=>b.dataset.word === word);
            if(bankEl){
              bankEl.classList.add('used');
              bankEl.setAttribute('draggable','false');
              // remove click to prevent double-placing
              bankEl.removeEventListener('click', bankEl._onclick);
            }
            // assign to state and re-render
            state.answers[blankId] = word;
            renderAll();
          });
        });
      }

      function showSprachbausteine2Options(slot){
        // highlight selected slot so click from bank knows target
        document.querySelectorAll('.blank-slot').forEach(s => s.classList.remove('selected-sprach'));
        slot.classList.add('selected-sprach');
        lastClickedSprachSlot = slot;
      }

      function selectSprachbausteine2FromBank(word){
        // choose target slot: prefer lastClicked, otherwise first empty
        let slot = lastClickedSprachSlot;
        if(!slot){
          slot = Array.from(document.querySelectorAll('.blank-slot')).find(s => {
            const id = s.dataset.blankId;
            return !state.answers[id];
          });
        }
        if(!slot) {
          // if none available, do nothing
          return;
        }
        const blankId = slot.dataset.blankId;
        // free previous occurrence of word
        Object.keys(state.answers).forEach(k => {
          if(state.answers[k] === word){
            delete state.answers[k];
          }
        });
        // free previous word in target slot
        const prev = state.answers[blankId];
        if(prev){
          const prevEl = Array.from(document.querySelectorAll('.bank-word-vertical')).find(b=>b.dataset.word === prev);
          if(prevEl){
            prevEl.classList.remove('used');
            prevEl.setAttribute('draggable','true');
            if(prevEl._onclick) prevEl.addEventListener('click', prevEl._onclick);
          }
        }
        // mark selected bank word as used
        const bankEl = Array.from(document.querySelectorAll('.bank-word-vertical')).find(b=>b.dataset.word === word);
        if(bankEl){
          bankEl.classList.add('used');
          bankEl.setAttribute('draggable','false');
          if(bankEl._onclick) try{ bankEl.removeEventListener('click', bankEl._onclick); }catch(e){}
        }
        // assign value
        state.answers[blankId] = word;
        try{ localStorage.setItem('lesenAnswers', JSON.stringify(state.answers)); }catch(e){}
        
        lastClickedSprachSlot = null;
        renderAll();
      }

      function selectOption(questionId, optionId){
        state.answers[questionId] = optionId;
        try{ localStorage.setItem('lesenAnswers', JSON.stringify(state.answers)); }catch(e){}
        
        renderAll();
      }

      function renderResults(){
        let resultsHTML = `<h2>Ergebnisse</h2>`;
        let totalCorrect = 0;
        let totalQuestions = 0;
        
        exam.sections.forEach(section => {
          resultsHTML += `<div class="result-item"><h3>${section.title}</h3>`;
          
          if(section.id === 's1'){
            section.texts.forEach(text => {
              totalQuestions++;
              const userAnswer = state.answers[text.id];
              const isCorrect = userAnswer === text.correctAnswer;
              if(isCorrect) totalCorrect++;
              
              resultsHTML += `
                <div>Text ${text.id}: ${userAnswer || 'Nicht beantwortet'} 
                ${userAnswer ? `<span class="${isCorrect ? 'result-correct' : 'result-incorrect'}">${isCorrect ? '‚úì' : '‚úó'}</span>` : ''}
                </div>
              `;
            });
          } else if(section.id === 's2'){
            section.questions.forEach(question => {
              totalQuestions++;
              const userAnswer = state.answers[question.id];
              const isCorrect = userAnswer === question.correctAnswer;
              if(isCorrect) totalCorrect++;
              
              resultsHTML += `
                <div>${question.text}: ${userAnswer || 'Nicht beantwortet'} 
                ${userAnswer ? `<span class="${isCorrect ? 'result-correct' : 'result-incorrect'}">${isCorrect ? '‚úì' : '‚úó'}</span>` : ''}
                </div>
              `;
            });
          } else if(section.id === 's3'){
            section.situations.forEach(situation => {
              totalQuestions++;
              const userAnswer = state.answers[situation.id];
              const correctText = section.texts.find(t => t.correctAnswer === situation.id);
              const isCorrect = userAnswer === (correctText ? correctText.id : null);
              if(isCorrect) totalCorrect++;
              
              resultsHTML += `
                <div>Situation ${situation.id}: ${userAnswer || 'Nicht beantwortet'} 
                ${userAnswer ? `<span class="${isCorrect ? 'result-correct' : 'result-incorrect'}">${isCorrect ? '‚úì' : '‚úó'}</span>` : ''}
                </div>
              `;
            });
          } else if(section.id === 's4'){
            section.fillBlanks.forEach(blank => {
              totalQuestions++;
              const userAnswer = state.answers[blank.id];
              const isCorrect = userAnswer === blank.correctAnswer;
              if(isCorrect) totalCorrect++;
              
              resultsHTML += `
                <div>L√ºcke ${blank.id}: ${userAnswer || 'Nicht beantwortet'} 
                ${userAnswer ? `<span class="${isCorrect ? 'result-correct' : 'result-incorrect'}">${isCorrect ? '‚úì' : '‚úó'}</span>` : ''}
                </div>
              `;
            });
          } else if(section.id === 's5'){
            section.fillBlanks2.forEach(blank => {
              totalQuestions++;
              const userAnswer = state.answers[blank.id];
              const isCorrect = userAnswer === blank.correctAnswer;
              if(isCorrect) totalCorrect++;
              
              resultsHTML += `
                <div>L√ºcke ${blank.id}: ${userAnswer || 'Nicht beantwortet'} 
                ${userAnswer ? `<span class="${isCorrect ? 'result-correct' : 'result-incorrect'}">${isCorrect ? '‚úì' : '‚úó'}</span>` : ''}
                </div>
              `;
            });
          }
          
          resultsHTML += `</div>`;
        });
        
        const percentage = totalQuestions > 0 ? Math.round((totalCorrect / totalQuestions) * 100) : 0;
        resultsHTML += `<div class="result-item"><h3>Gesamtergebnis: ${totalCorrect}/${totalQuestions} (${percentage}%)</h3></div>`;
        
        passageContentEl.innerHTML = resultsHTML;
        questionBodyEl.innerHTML = '';
        sectionNameEl.textContent = 'Ergebnisse';
        questionTitleEl.textContent = '';
      }

      /* ===== Event Listeners ===== */
      document.getElementById('prevBtn-lesen').addEventListener('click', ()=>{
        if(state.sectionIndex > 0){
          state.sectionIndex--;
          state.questionIndex = 0;
          renderAll();
        }
      });

      document.getElementById('nextBtn-lesen').addEventListener('click', ()=>{
        if(state.sectionIndex < exam.sections.length - 1){
          state.sectionIndex++;
          state.questionIndex = 0;
          renderAll();
        }
      });

      resultBtn.addEventListener('click', ()=>{
        state.showResults = !state.showResults;
        renderAll();
      });

      resetBtn.addEventListener('click', ()=>{
        if(confirm('M√∂chten Sie wirklich von neu beginnen? Alle Antworten werden gel√∂scht.')){
          state.answers = {};
          state.marked = {};
          state.showResults = false;
          resetTimer();
          renderAll();
        }
      });

      resetSectionBtn.addEventListener('click', resetCurrentSection);

      document.getElementById('saveBtn-lesen').addEventListener('click', ()=>{
        statusText.textContent = 'Gespeichert';
        setTimeout(()=>{statusText.textContent = 'Nicht gespeichert'}, 2000);
      });

      document.getElementById('submitBtn-lesen').addEventListener('click', ()=>{
        if(confirm('M√∂chten Sie die Pr√ºfung wirklich abgeben?')){
          state.showResults = true;
          renderAll();
        }
      });

      document.getElementById('nextBtn-lesen').addEventListener('click', ()=>{
        showPage('hoeren-page');
      });

      /* ===== Initialize ===== */
      updateTimerDisplay();
      renderAll();
      startTimer();
      
      // Expose functions to global scope for event handlers
      window._lesenState = state;
      window.lesenApp = {
        selectOption,
        markNoMatch,
        selectSprachbausteine1,
        selectSprachbausteine2FromBank
      };
    }

    // ===== H√ñREN PAGE FUNCTIONALITY =====
    function initHoerenPage() {
      /* ===== Self-contained exam (embedded) ===== */
      const exam = {
        id: "exam-h√∂rverstehen",
        durationSec: 17 * 60, // 17 minutes in seconds
        sections: [
          { 
            id: "h√∂rverstehen1", 
            title: "H√∂rverstehen, Teil 1", 
            points: 25,
            correctAnswers: { "41": "richtig", "42": "richtig", "43": "falsch", "44": "falsch", "45": "richtig" },
            questions: [
              {
                id: "41",
                text: "Ein deutsches Forschungsschiff ist am S√ºdpol in Schwierigkeiten geraten. Zum Gl√ºck sind keine Menschen zu Schaden gekommen."
              },
              {
                id: "42", 
                text: "Die Firma Brain International steckt in wirtschaftlichen Schwierigkeiten."
              },
              {
                id: "43",
                text: "Die EU will neue Gesetze zur Kontrolle sozialer Netzwerke einf√ºhren."
              },
              {
                id: "44",
                text: "Die Banken wollen ein neues Gesetz, das die Kreditvergabe an kleine Unternehmen erleichtert."
              },
              {
                id: "45",
                text: "Die CDU bleibt nach den B√ºrgermeisterwahlen an der Regierung."
              }
            ]
          },
          { 
            id: "h√∂rverstehen2", 
            title: "H√∂rverstehen, Teil 2", 
            points: 25,
            correctAnswers: { "46": "falsch", "47": "richtig", "48": "richtig", "49": "falsch", "50": "richtig", "51": "richtig", "52": "falsch", "53": "richtig", "54": "falsch", "55": "richtig" },
            questions: [
              {
                id: "46",
                text: "Vanessa versucht, so viele Orte wie m√∂glich zu besuchen."
              },
              {
                id: "47",
                text: "Mit den Arbeitsbedingungen in der Werbeagentur war Vanessa unzufrieden."
              },
              {
                id: "48", 
                text: "Wenn Vanessa unter Menschen ist, schadet das manchmal ihrer Konzentration."
              },
              {
                id: "49",
                text: "Die Sicherheit, die eine feste Stelle bietet, bedeutet Vanessa nicht viel."
              },
              {
                id: "50",
                text: "Vanessa ist sich sicher, dass sie nie mehr als Angestellte arbeiten m√∂chte."
              },
              {
                id: "51",
                text: "Dass sie immer wieder neue Auftraggeber suchen muss, hat f√ºr Vanessa auch Vorteil."
              },
              {
                id: "52",
                text: "Vanessa Eltern w√ºrden auch gerne √∂fter verreisen."
              },
              {
                id: "53",
                text: "Es fiel Vanessa leicht, sich von pers√∂nlichen Gegenst√§nden zu trennen."
              },
              {
                id: "54",
                text: "Vanessa glaubt, dass man in Zukunft in mehr Berufen ortsunabh√§ngig arbeiten kann."
              },
              {
                id: "55",
                text: "Auch wer ortsunabh√§ngig arbeitet, sollte nicht zu oft den Ort wechseln."
              }
            ]
          },
          { 
            id: "h√∂rverstehen3", 
            title: "H√∂rverstehen, Teil 3 ", 
            points: 25,
            correctAnswers: { "56": "richtig", "57": "falsch", "58": "falsch", "59": "falsch", "60": "richtig" },
            questions: [
              {
                id: "56",
                text: "fundb√ºro"
              },
              {
                id: "57",
                text: "."
              },
              {
                id: "58",
                text: "."
              },
              {
                id: "59",
                text: "."
              },
              {
                id: "60",
                text: "."
              }
            ]
          }
        ]
      };

      /* ===== State & DOM refs ===== */
      let state = { 
        sectionIndex: 0, 
        answers: {}, 
        remaining: exam.durationSec,
        showResults: false,
        timerStarted: false,
        timerInterval: null
      };
      
      const topTiles = document.getElementById('topTiles-hoeren');
      const contentContainer = document.getElementById('contentContainer-hoeren');
      const timerEl = document.getElementById('timer-hoeren');
      const statusText = document.getElementById('statusText-hoeren');

      /* ===== Timer Functions ===== */
      function startTimer() {
        if (state.timerInterval) {
          clearInterval(state.timerInterval);
        }
        
        state.timerStarted = true;
        state.timerInterval = setInterval(() => {
          if (state.remaining <= 0) {
            clearInterval(state.timerInterval);
            timerEl.textContent = 'Zeit abgelaufen';
            return;
          }
          state.remaining--;
          updateTimerDisplay();
        }, 1000);
      }

      function resetTimer() {
        if (state.timerInterval) {
          clearInterval(state.timerInterval);
        }
        state.remaining = exam.durationSec;
        state.timerStarted = false;
        updateTimerDisplay();
        startTimer();
      }

      function updateTimerDisplay() {
        const min = Math.floor(state.remaining / 60);
        const sec = state.remaining % 60;
        timerEl.textContent = `Verbleibende Zeit: ${min.toString().padStart(2, '0')}:${sec.toString().padStart(2, '0')}`;
      }

      /* ===== Render ===== */
      function renderTopTiles() { 
        topTiles.innerHTML = ''; 
        exam.sections.forEach((sec, idx) => { 
          const div = document.createElement('div'); 
          div.className = 'tile' + (idx === state.sectionIndex ? ' active' : '') + (isSectionDone(sec) ? ' done' : ''); 
          div.innerHTML = `<div>${sec.title}</div><div class="points">${sec.points} P</div>`; 
          div.onclick = () => { state.sectionIndex = idx; state.showResults = false; renderAll(); }; 
          topTiles.appendChild(div); 
        }); 
      }

      function isSectionDone(section) {
        const answers = state.answers[section.id];
        if (!answers) return false;
        
        // ÿ™ÿ≠ŸÇŸÇ ÿ•ÿ∞ÿß ÿ™ŸÖÿ™ ÿßŸÑÿ•ÿ¨ÿßÿ®ÿ© ÿπŸÑŸâ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ© ŸÅŸä Ÿáÿ∞ÿß ÿßŸÑŸÇÿ≥ŸÖ
        const answeredQuestions = Object.keys(answers).length;
        const totalQuestions = section.questions.length;
        
        return answeredQuestions === totalQuestions;
      }

      function renderAll() {
        renderTopTiles();
        
        if (state.showResults) {
          renderResults();
          return;
        }
        
        renderListeningSection();
      }

      function renderListeningSection() {
        const section = exam.sections[state.sectionIndex];
        const currentAnswers = state.answers[section.id] || {};
        
        let contentHTML = `
          <div class="panel-title">${section.title}</div>
          <div class="instructions">
            Sie h√∂ren die Nachrichten. Entscheiden Sie beim H√∂ren, ob die Aussagen richtig oder falsch sind. 
            Sie h√∂ren die Nachrichten nur einmal. Sie haben jetzt 30 Sekunden, um die Aussagen zu lesen.
          </div>
          
          <div class="listening-task">
            <table class="true-false-table">
              <thead>
                <tr>
                  <th style="width: 10%">Nr.</th>
                  <th style="width: 60%">Aussage</th>
                  <th style="width: 30%">Ihre Antwort</th>
                </tr>
              </thead>
              <tbody>
        `;
        
        section.questions.forEach((question, index) => {
          const currentAnswer = currentAnswers[question.id] || '';
          contentHTML += `
            <tr>
              <td><strong>${question.id}</strong></td>
              <td class="question-text">${question.text}</td>
              <td>
                <div class="answer-options">
                  <label class="answer-option">
                    <input 
                      type="radio" 
                      name="q${section.id}_${question.id}" 
                      value="richtig" 
                      ${currentAnswer === 'richtig' ? 'checked' : ''}
                      onchange="window.hoerenApp.updateListeningAnswer('${section.id}', '${question.id}', this.value)"
                    >
                    Richtig
                  </label>
                  <label class="answer-option">
                    <input 
                      type="radio" 
                      name="q${section.id}_${question.id}" 
                      value="falsch" 
                      ${currentAnswer === 'falsch' ? 'checked' : ''}
                      onchange="window.hoerenApp.updateListeningAnswer('${section.id}', '${question.id}', this.value)"
                    >
                    Falsch
                  </label>
                </div>
              </td>
            </tr>
          `;
        });
        
        contentHTML += `
              </tbody>
            </table>
          </div>
        `;
        
        contentContainer.innerHTML = contentHTML;
      }

      function updateListeningAnswer(sectionId, questionId, answer) {
        if (!state.answers[sectionId]) {
          state.answers[sectionId] = {};
        }
        state.answers[sectionId][questionId] = answer;
        try{ localStorage.setItem('hoerenAnswers', JSON.stringify(state.answers)); }catch(e){}
        
        
        // ÿ•ÿπÿßÿØÿ© ÿπÿ±ÿ∂ ÿßŸÑÿ®ŸÑÿßÿ∑ÿßÿ™ ŸÑÿ™ÿ≠ÿØŸäÿ´ ÿ≠ÿßŸÑÿ© "ÿ™ŸÖ"
        renderTopTiles();
      }

      function renderResults() {
        let resultsHTML = `<div class="panel-title">Ergebnisse - H√∂rverstehen</div>`;
        
        exam.sections.forEach(section => {
          const userAnswers = state.answers[section.id] || {};
          let correctCount = 0;
          
          resultsHTML += `
            <div class="listening-task">
              <h3>${section.title} (${section.points} Punkte)</h3>
              <table class="true-false-table">
                <thead>
                  <tr>
                    <th style="width: 10%">Nr.</th>
                    <th style="width: 50%">Aussage</th>
                    <th style="width: 15%">Ihre Antwort</th>
                    <th style="width: 15%">Richtige Antwort</th>
                    <th style="width: 10%">Punkte</th>
                  </tr>
                </thead>
                <tbody>
          `;
          
          section.questions.forEach((question) => {
            const userAnswer = userAnswers[question.id] || '-';
            const correctAnswer = section.correctAnswers[question.id];
            const gotCorrect = userAnswer === correctAnswer;
            const points = gotCorrect ? "1" : "0";
            
            if (gotCorrect) correctCount++;
            
            const rowClass = gotCorrect ? 'correct-answer' : 'incorrect-answer';
            
            resultsHTML += `
              <tr class="${rowClass}">
                <td><strong>${question.id}</strong></td>
                <td class="question-text">${question.text}</td>
                <td>${userAnswer}</td>
                <td>${correctAnswer}</td>
                <td><strong>${points}</strong></td>
              </tr>
            `;
          });
          
          const totalPoints = Math.round((correctCount / section.questions.length) * section.points);
          
          resultsHTML += `
                </tbody>
              </table>
              <div style="margin-top: 15px; padding: 15px; background: #e3f2fd; border-radius: 6px;">
                <strong>Erreichte Punkte: ${correctCount}/${section.questions.length} richtig = ${totalPoints}/${section.points} Punkten</strong>
              </div>
            </div>
          `;
        });
        
        contentContainer.innerHTML = resultsHTML;
      }

      /* ===== Event Listeners ===== */
      document.getElementById('prevBtn-hoeren').addEventListener('click', () => {
        if (state.sectionIndex > 0) {
          state.sectionIndex--;
          state.showResults = false;
          renderAll();
        }
      });

      document.getElementById('nextBtn-hoeren').addEventListener('click', () => {
        if (state.sectionIndex < exam.sections.length - 1) {
          state.sectionIndex++;
          state.showResults = false;
          renderAll();
        }
      });

      document.getElementById('resultBtn-hoeren').addEventListener('click', () => {
        state.showResults = !state.showResults;
        renderAll();
      });

      document.getElementById('resetBtn-hoeren').addEventListener('click', () => {
        if (confirm('M√∂chten Sie wirklich von neu beginnen? Alle Antworten werden gel√∂scht.')) {
          state.answers = {};
          state.showResults = false;
          resetTimer();
          renderAll();
        }
      });

      document.getElementById('saveBtn-hoeren').addEventListener('click', () => {
        statusText.textContent = 'Gespeicherÿ™';
        setTimeout(() => { statusText.textContent = 'Nicht gespeicherÿ™' }, 2000);
      });

      document.getElementById('submitBtn-hoeren').addEventListener('click', () => {
        if (confirm('M√∂chten Sie die Pr√ºfung wirklich abgeben?')) {
          state.showResults = true;
          renderAll();
        }
      });

      document.getElementById('nextBtn-hoeren').addEventListener('click', () => {
        showPage('schreiben-page');
      });

      /* ===== Initialize ===== */
      updateTimerDisplay();
      renderAll();
      startTimer();
      
      // Expose functions to global scope for event handlers
        window._hoerenState = state;
        window.hoerenApp = {
        updateListeningAnswer
      };
    }

    // ===== SCHREIBEN PAGE FUNCTIONALITY =====
    function initSchreibenPage() {
      /* ===== Self-contained exam (embedded) ===== */
      const exam = {
        id: "exam-002",
        durationSec: 30 * 60, // 30 minutes in seconds
        sections: [
          { 
            id: "s1", 
            title: "Schreiben, Teil 1", 
            points: 45,
            passageTitle: "Aufgabe: Schreiben Sie eine E-Mail",
            passage: "",
            writingTask: {
              prompt: `Backstage-Musik

Sie haben Geld bezahlt, um hinter die Kulissen eines Theaterst√ºcks zu gehen. 
Dabei konnten Sie das Archiv der alten Theatermusik, die Masken und die Kost√ºme sehen.`,
              requirements: [
                "Warum waren Sie unzufrieden?",
                "Warum haben Sie sich f√ºr diese Vorstellung entschieden? Was hat Sie daran interessiert?",
                "Was erwarten Sie von den Veranstaltern, um den Service zu verbessern?"
              ],
              wordCount: 0
            }
          }
        ]
      };

      /* ===== State & DOM refs ===== */
      let state = { 
        sectionIndex: 0, 
        answers: {}, 
        remaining: exam.durationSec,
        showResults: false,
        timerStarted: false,
        timerInterval: null
      };
      
      const topTiles = document.getElementById('topTiles-schreiben');
      const passageTitleEl = document.getElementById('passageTitle-schreiben');
      const passageContentEl = document.getElementById('passageContent-schreiben');
      const writingContainer = document.getElementById('writingContainer-schreiben');
      const timerEl = document.getElementById('timer-schreiben');
      const statusText = document.getElementById('statusText-schreiben');

      /* ===== Timer Functions ===== */
      function startTimer() {
        if (state.timerInterval) {
          clearInterval(state.timerInterval);
        }
        
        state.timerStarted = true;
        state.timerInterval = setInterval(() => {
          if (state.remaining <= 0) {
            clearInterval(state.timerInterval);
            timerEl.textContent = 'Zeit abgelaufen';
            return;
          }
          state.remaining--;
          updateTimerDisplay();
        }, 1000);
      }

      function resetTimer() {
        if (state.timerInterval) {
          clearInterval(state.timerInterval);
        }
        state.remaining = exam.durationSec;
        state.timerStarted = false;
        updateTimerDisplay();
        startTimer();
      }

      function updateTimerDisplay() {
        const min = Math.floor(state.remaining / 60);
        const sec = state.remaining % 60;
        timerEl.textContent = `Verbleibende Zeit: ${min.toString().padStart(2, '0')}:${sec.toString().padStart(2, '0')}`;
      }

      /* ===== Render ===== */
      function renderTopTiles() { 
        topTiles.innerHTML = ''; 
        exam.sections.forEach((sec, idx) => { 
          const div = document.createElement('div'); 
          div.className = 'tile' + (idx === state.sectionIndex ? ' active' : '') + (isSectionDone(sec) ? ' done' : ''); 
          div.innerHTML = `<div>${sec.title}</div><div class="points">${sec.points} P</div>`; 
          div.onclick = () => { state.sectionIndex = idx; state.showResults = false; renderAll(); }; 
          topTiles.appendChild(div); 
        }); 
      }

      function isSectionDone(section) {
        return state.answers[section.id] && state.answers[section.id].length > 0;
      }

      function renderAll() {
        renderTopTiles();
        const section = exam.sections[state.sectionIndex];
        passageTitleEl.textContent = section.passageTitle;
        
        if (state.showResults) {
          renderResults();
          return;
        }
        
        renderWritingSection();
      }

      function renderWritingSection() {
        const section = exam.sections[state.sectionIndex];
        
        // Render the prompt in left panel
        passageContentEl.innerHTML = `
          <div class="writing-task">
            <div class="writing-prompt">${section.writingTask.prompt}</div>
            <div class="instructions" style="border:1px solid #e1e8f6; padding:10px; margin:10px 0; border-radius:6px; background:#ffffff;">Sie haben hinter die Kulissen eines Theaterst√ºcks geschaut. Leider waren Sie nicht zufrieden. 
Schreiben Sie eine Beschwerde an die Veranstalter.</div>
            <div class="writing-requirements">
              <h4>Schreiben Sie in Ihrer E-Mail:</h4>
              <ul>
                ${section.writingTask.requirements.map(req => `<li>${req}</li>`).join('')}
              </ul>
            </div>
            <div class="instructions">
              Schreiben Sie eine E-Mail (ca. 150-200 W√∂rter). Achten Sie auf den Textaufbau (Anrede, Einleitung, Hauptteil, Schluss) und eine angemessene Formulierung.
            </div>
          </div>
        `;
        
        // Render writing area in right panel
        const currentAnswer = state.answers[section.id] || '';
        const wordCount = countWords(currentAnswer);
        
        writingContainer.innerHTML = `
          <div class="writing-area">
            <textarea 
              class="writing-textarea" 
              placeholder="Schreiben Sie hier Ihre E-Mail..."
              oninput="window.schreibenApp.updateWritingAnswer('${section.id}', this.value)"
            >${currentAnswer}</textarea>
            <div class="word-counter">
              W√∂rter: <span class="count">${wordCount}</span>
            </div>
          </div>
        `;
      }

      function countWords(text) {
        return text.trim() === '' ? 0 : text.trim().split(/\s+/).length;
      }

      function updateWritingAnswer(sectionId, text) {
        state.answers[sectionId] = text;
        try{ localStorage.setItem('schreibenAnswers', JSON.stringify({content: state.answers[sectionId], wordCount: (state.answers[sectionId]||'').trim().split(/\s+/).filter(Boolean).length})); }catch(e){}
        
        const wordCount = countWords(text);
        document.querySelector('.word-counter .count').textContent = wordCount;
      }

      function renderResults() {
        let resultsHTML = `<h2>Ergebnisse</h2>`;
        
        exam.sections.forEach(section => {
          resultsHTML += `<div class="writing-task"><h3>${section.title}</h3>`;
          
          const userAnswer = state.answers[section.id];
          const wordCount = countWords(userAnswer);
          
          resultsHTML += `
            <div class="writing-requirements">
              <h4>Ihre Antwort (${wordCount} W√∂rter):</h4>
              <div style="white-space: pre-wrap; background: white; padding: 15px; border-radius: 6px; border: 1px solid #e1e8f6; margin-top: 10px;">${userAnswer || 'Keine Antwort'}</div>
            </div>
          `;
          
          resultsHTML += `</div>`;
        });
        
        passageContentEl.innerHTML = resultsHTML;
        writingContainer.innerHTML = '';
      }

      /* ===== Event Listeners ===== */
      document.getElementById('prevBtn-schreiben').addEventListener('click', () => {
        if (state.sectionIndex > 0) {
          state.sectionIndex--;
          state.showResults = false;
          renderAll();
        }
      });

      document.getElementById('nextBtn-schreiben').addEventListener('click', () => {
        if (state.sectionIndex < exam.sections.length - 1) {
          state.sectionIndex++;
          state.showResults = false;
          renderAll();
        }
      });

      document.getElementById('resultBtn-schreiben').addEventListener('click', () => {
        state.showResults = !state.showResults;
        renderAll();
      });

      document.getElementById('resetBtn-schreiben').addEventListener('click', () => {
        if (confirm('M√∂chten Sie wirklich von neu beginnen? Alle Antworten werden gel√∂schÿ™.')) {
          state.answers = {};
          state.showResults = false;
          resetTimer();
          renderAll();
        }
      });

      document.getElementById('saveBtn-schreiben').addEventListener('click', () => {
        statusText.textContent = 'Gespeicherÿ™';
        setTimeout(() => { statusText.textContent = 'Nicht gespeicherÿ™' }, 2000);
      });

      document.getElementById('submitBtn-schreiben').addEventListener('click', () => {
        if (confirm('M√∂chten Sie die Pr√ºfung wirklich abgeben?')) {
          state.showResults = true;
          renderAll();
        }
      });

      document.getElementById('nextBtn-schreiben').addEventListener('click', () => {
        showPage('ergebnisse-page');
      });

      /* ===== Initialize ===== */
      updateTimerDisplay();
      renderAll();
      startTimer();
      
      // Expose functions to global scope for event handlers
        window._schreibenState = state;
        window.schreibenApp = {
        updateWritingAnswer
      };
    }

    // ===== ERGEBNISSE PAGE FUNCTIONALITY =====
    function initErgebnissePage() {
      const CONFIG = {
        totals: { 
          lesen: 105, 
          hoeren: 75, 
          schreiben: 45, 
          gesamt: 225 
        },
        counts: { 
          lesen: 40, 
          hoeren: 20 
        },
        hoerenCorrect: {
          "41": "richtig", "42": "richtig", "43": "falsch", "44": "falsch", "45": "richtig",
          "46": "falsch", "47": "richtig", "48": "richtig", "49": "richtig", "50": "falsch",
          "51": "richtig", "52": "falsch", "53": "richtig", "54": "falsch", "55": "richtig",
          "56": "richtig", "57": "richtig", "58": "falsch", "59": "falsch", "60": "richtig"
        },
        lesenCorrect: {
          "text1": "i", "text2": "f", "text3": "e", "text4": "j", "text5": "b",
          "s2q1": "s2q1o3", "s2q2": "s2q2o1", "s2q3": "s2q3o2", "s2q4": "s2q4o2", "s2q5": "s2q5o1",
          "11": "h", "12": "a", "13": "f", "14": "i", "15": "j", "16": "b", "17": "l", "18": "X", "19": "e", "20": "k",
          "21": "sollt", "22": "f√ºr", "23": "bei", "24": "einiges", "25": "den", "26": "sind", "27": "wo", "28": "Dabei", "29": "dem", "30": "sich",
          "31": "OB", "32": "AU√üERDEM", "33": "ENTHALTEN", "34": "HINTER", "35": "ENTLASTET", "36": "AUS", "37": "AUF", "38": "VERWENDET", "39": "WIRKLICH", "40": "DASS"
        }
      };

      // ===== ÿßŸÑÿØŸàÿßŸÑ ÿßŸÑŸÖÿ≥ÿßÿπÿØÿ© ÿßŸÑÿ¨ÿØŸäÿØÿ© =====
      
      // 1. ÿØÿßŸÑÿ© ŸÑÿ™ÿ∑ÿ®Ÿäÿπ ÿßŸÑÿ•ÿ¨ÿßÿ®ÿßÿ™ (ÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ£ŸÜ ÿßŸÑÿ•ÿ¨ÿßÿ®ÿßÿ™ ÿßŸÑŸÅÿßÿ±ÿ∫ÿ© ÿ™ÿ∏Ÿáÿ± ŸÉŸÄ "-")
      function normalizeAnswer(a) {
        if (a === null || a === undefined || a === '') return '-';
        let s = String(a).trim();
        if (s === '' || s === 'undefined' || s === 'null') return '-';
        // ÿ™ÿ≠ŸàŸäŸÑ ÿßŸÑÿ•ÿ¨ÿßÿ®ÿßÿ™ ÿßŸÑÿµÿ≠Ÿäÿ≠ÿ©/ÿÆÿßÿ∑ÿ¶ÿ© ÿ•ŸÑŸâ ŸÜÿµ ŸÖŸàÿ≠ÿØ
        const low = s.toLowerCase();
        if (low === 'richtig') return 'richtig';
        if (low === 'falsch') return 'falsch';
        if (low === 'x') return 'X';
        return s;
      }

      // 2. ÿØÿßŸÑÿ© ŸÑÿ™ÿ≠ŸàŸäŸÑ ÿ±ŸÖÿ≤ ÿßŸÑÿπŸÜŸàÿßŸÜ ÿ•ŸÑŸâ ÿßŸÑŸÜÿµ ÿßŸÑŸÉÿßŸÖŸÑ
      function getHeadingText(headingId) {
        if (!headingId || headingId === '-' || headingId === 'X') return headingId;
        const headings = {
          "a": "Viele Trampoline haben erhebliche Sicherheitsm√§ngel",
          "b": "Traditionelle Nachrichtenmedien immer noch getragt",
          "c": "Soziale Medien ersetzen alte Informationsquellen",
          "d": "Sch√ºler bereiten Nachrichtensendungen vor",
          "e": "Mit Nachrichten im Unterricht arbeiten",
          "f": "Medienkonsum f√∂rdert ungesunde Lebensweise",
          "g": "Kritik an der Nachrichtensprache",
          "h": "Jugendliche konsumieren mehr Fett und Zucker",
          "i": "Informationen leichter verstehen",
          "j": "Fachleute warnen vor unsachgem√§√üer Nutzung von Sprungger√§ten"
        };
        return headings[headingId] || headingId;
      }

      // 3. ÿØÿßŸÑÿ© ŸÑÿ™ÿ≠ŸàŸäŸÑ ÿ±ŸÖÿ≤ ÿßŸÑÿÆŸäÿßÿ± ÿ•ŸÑŸâ ÿßŸÑŸÜÿµ ÿßŸÑŸÉÿßŸÖŸÑ
      function getOptionText(optionId) {
        if (!optionId || optionId === '-') return optionId;
        const options = {
          "s2q1o1": "Anfang des 20. Jahrhunderts von einem Puppenmacher erschaffen",
          "s2q1o2": "f√ºr die ersten gro√üen Kaufh√§user produziert",
          "s2q1o3": "von einem franz√∂sischen Schneider erfunden",
          "s2q2o1": "darf Herr Bauernfeind keinen normalen Nagellack auftragen",
          "s2q2o2": "k√∂nnen keine Luxusmarken eingesetzt werden",
          "s2q2o3": "verwendet er nur billige Produkte",
          "s2q3o1": "hat schon als Kind gerne mit Puppen gespielt",
          "s2q3o2": "konnte seine erste Schaufensterpuppe nicht auf einmal zahlen",
          "s2q3o3": "organisierte eine Ausstellung mit Schaufensterpuppen",
          "s2q4o1": "er√∂ffnete die erste Linzer Firma f√ºr Schaufensterpuppen",
          "s2q4o2": "handelt mit Schaufensterpuppen anderer Produzenten",
          "s2q4o3": "stellt heute keine Schaufensterpuppen mehr her",
          "s2q5o1": "k√∂nnen mit umweltfreundlichen Farben bemalt werden",
          "s2q5o2": "sind nicht von Tendenzen der Mode abh√§ngig",
          "s2q5o3": "sollen immer die gleiche Form haben"
        };
        return options[optionId] || optionId;
      }

      // 4. ÿØÿßŸÑÿ© ŸÑÿ™ŸÜÿ≥ŸäŸÇ ÿßŸÑŸÜÿµ ŸÑŸÖŸÜÿπ Ÿáÿ¨ŸÖÿßÿ™ XSS
      function escapeHtml(s) {
        return String(s)
          .replace(/&/g, '&amp;')
          .replace(/</g, '&lt;')
          .replace(/>/g, '&gt;')
          .replace(/"/g, '&quot;')
          .replace(/'/g, '&#039;');
      }

      // 5. ÿØÿßŸÑÿ© ŸÑÿ®ŸÜÿßÿ° ÿßŸÑÿ¨ÿØÿßŸàŸÑ ŸÖÿπ ÿ™ÿ≠ÿ≥ŸäŸÜÿßÿ™
      function buildTable(title, details, total, max) {
        let html = `<div class="result-item">
                      <h3>${title} - ${total.toFixed(2)}/${max} Punkte</h3>
                      <div class="section-table">
                        <table class="true-false-table" style="margin-top: 15px;">
                          <thead>
                            <tr>
                              <th style="width: 15%">Frage</th>
                              <th style="width: 35%">Ihre Antwort</th>
                              <th style="width: 35%">Richtige Antwort</th>
                              <th style="width: 15%">Ergebnis</th>
                            </tr>
                          </thead>
                          <tbody>`;
        
        details.forEach(x => {
          const isCorrect = x.richtig;
          const rowClass = isCorrect ? 'correct-answer' : 'incorrect-answer';
          const resultIcon = isCorrect ? '‚úÖ Richtig' : '‚ùå Falsch';
          
          // ÿ™ÿ≠ÿØŸäÿØ ŸÜÿµ ÿßŸÑÿπÿ±ÿ∂ ŸÑŸÑÿ•ÿ¨ÿßÿ®ÿßÿ™
          let userDisplay = x.user === '-' ? '-' : escapeHtml(x.user);
          let correctDisplay = x.correct === '-' ? '-' : escapeHtml(x.correct);
          
          // ÿ™ÿ≠ŸàŸäŸÑ ÿ±ŸÖŸàÿ≤ ÿßŸÑÿπŸÜÿßŸàŸäŸÜ ŸàÿßŸÑÿÆŸäÿßÿ±ÿßÿ™ ÿ•ŸÑŸâ ŸÜÿµŸàÿµ
          if (x.frage.startsWith('text')) {
            userDisplay = getHeadingText(userDisplay);
            correctDisplay = getHeadingText(correctDisplay);
          } else if (x.frage.startsWith('s2q')) {
            userDisplay = getOptionText(userDisplay);
            correctDisplay = getOptionText(correctDisplay);
          }
          
          html += `<tr class="${rowClass}">
                    <td><strong>${x.frage}</strong></td>
                    <td>${userDisplay}</td>
                    <td>${correctDisplay}</td>
                    <td><strong>${resultIcon}</strong></td>
                  </tr>`;
        });
        
        html += `</tbody>
                </table>
                <div style="margin-top: 15px; padding: 15px; background: #e3f2fd; border-radius: 6px;">
                  <strong>Erreichte Punkte: ${total.toFixed(2)}/${max} (${((total/max)*100).toFixed(1)}%)</strong>
                </div>
              </div></div>`;
        return html;
      }

      // 6. ÿØÿßŸÑÿ© ŸÑÿ™ÿ≠ÿ≥ŸäŸÜ ÿ™ŸÅÿßÿµŸäŸÑ ŸÇÿ≥ŸÖ ÿßŸÑŸÇÿ±ÿßÿ°ÿ©
      function renderLesenDetails(answers) {
        let html = `<div class="result-item">
                    <h3>üìñ Leseverstehen - Detaillierte Auswertung</h3>`;
        
        // ÿßŸÑÿ¨ÿ≤ÿ° ÿßŸÑÿ£ŸàŸÑ: √úberschriften zuordnen
        let details1 = [];
        for (let i = 1; i <= 5; i++) {
          const id = `text${i}`;
          const userAnswer = normalizeAnswer(answers[id] || '');
          const correctAnswer = CONFIG.lesenCorrect[id] || '-';
          const isCorrect = userAnswer === correctAnswer;
          
          details1.push({
            frage: `Text ${i}`,
            user: userAnswer,
            correct: correctAnswer,
            richtig: isCorrect
          });
        }
        
        // ÿßŸÑÿ¨ÿ≤ÿ° ÿßŸÑÿ´ÿßŸÜŸä: Fragen zum Text
        let details2 = [];
        for (let i = 1; i <= 5; i++) {
          const id = `s2q${i}`;
          const userAnswer = normalizeAnswer(answers[id] || '');
          const correctAnswer = CONFIG.lesenCorrect[id] || '-';
          const isCorrect = userAnswer === correctAnswer;
          
          details2.push({
            frage: `Frage ${i + 5}`,
            user: userAnswer,
            correct: correctAnswer,
            richtig: isCorrect
          });
        }
        
        // ÿßŸÑÿ¨ÿ≤ÿ° ÿßŸÑÿ´ÿßŸÑÿ´: Texte zuordnen
        let details3 = [];
        for (let i = 11; i <= 20; i++) {
          const id = `${i}`;
          const userAnswer = normalizeAnswer(answers[id] || '');
          const correctAnswer = CONFIG.lesenCorrect[id] || '-';
          const isCorrect = userAnswer === correctAnswer;
          
          details3.push({
            frage: `Situation ${i}`,
            user: userAnswer,
            correct: correctAnswer,
            richtig: isCorrect
          });
        }
        
        // Sprachbausteine Teil 1
        let details4 = [];
        for (let i = 21; i <= 30; i++) {
          const id = `${i}`;
          const userAnswer = normalizeAnswer(answers[id] || '');
          const correctAnswer = CONFIG.lesenCorrect[id] || '-';
          const isCorrect = userAnswer === correctAnswer;
          
          details4.push({
            frage: `L√ºcke ${i}`,
            user: userAnswer,
            correct: correctAnswer,
            richtig: isCorrect
          });
        }
        
        // Sprachbausteine Teil 2
        let details5 = [];
        for (let i = 31; i <= 40; i++) {
          const id = `${i}`;
          const userAnswer = normalizeAnswer(answers[id] || '');
          const correctAnswer = CONFIG.lesenCorrect[id] || '-';
          const isCorrect = userAnswer === correctAnswer;
          
          details5.push({
            frage: `L√ºcke ${i}`,
            user: userAnswer,
            correct: correctAnswer,
            richtig: isCorrect
          });
        }
        
        html += `<h4 style="margin-top: 20px; color: #1e3a5f;">Teil 1: √úberschriften zuordnen (Texte 1-5)</h4>`;
        html += buildTableDetails(details1, 25, 25);
        
        html += `<h4 style="margin-top: 20px; color: #1e3a5f;">Teil 2: Fragen zum Text (Fragen 6-10)</h4>`;
        html += buildTableDetails(details2, 25, 25);
        
        html += `<h4 style="margin-top: 20px; color: #1e3a5f;">Teil 3: Texte zuordnen (Situationen 11-20)</h4>`;
        html += buildTableDetails(details3, 25, 25);
        
        html += `<h4 style="margin-top: 20px; color: #1e3a5f;">Sprachbausteine Teil 1 (L√ºcken 21-30)</h4>`;
        html += buildTableDetails(details4, 15, 15);
        
        html += `<h4 style="margin-top: 20px; color: #1e3a5f;">Sprachbausteine Teil 2 (L√ºcken 31-40)</h4>`;
        html += buildTableDetails(details5, 15, 15);
        
        html += `</div>`;
        return html;
      }

      // ÿØÿßŸÑÿ© ŸÖÿ≥ÿßÿπÿØÿ© ŸÑÿ®ŸÜÿßÿ° ÿ¨ÿØŸàŸÑ ÿßŸÑÿ™ŸÅÿßÿµŸäŸÑ
      function buildTableDetails(details, achievedPoints, maxPoints) {
        let html = `<table class="true-false-table" style="margin-top: 10px; margin-bottom: 20px;">
                      <thead>
                        <tr>
                          <th style="width: 20%">Frage</th>
                          <th style="width: 30%">Ihre Antwort</th>
                          <th style="width: 30%">Richtige Antwort</th>
                          <th style="width: 20%">Ergebnis</th>
                        </tr>
                      </thead>
                      <tbody>`;
        
        details.forEach(x => {
          const isCorrect = x.richtig;
          const rowClass = isCorrect ? 'correct-answer' : 'incorrect-answer';
          const resultIcon = isCorrect ? '‚úÖ' : '‚ùå';
          
          let userDisplay = x.user === '-' ? '-' : escapeHtml(x.user);
          let correctDisplay = x.correct === '-' ? '-' : escapeHtml(x.correct);
          
          html += `<tr class="${rowClass}">
                    <td><strong>${x.frage}</strong></td>
                    <td>${userDisplay}</td>
                    <td>${correctDisplay}</td>
                    <td><strong>${resultIcon}</strong></td>
                  </tr>`;
        });
        
        const correctCount = details.filter(x => x.richtig).length;
        const totalQuestions = details.length;
        const points = (correctCount / totalQuestions) * achievedPoints;
        
        html += `</tbody>
                </table>
                <div style="margin-bottom: 20px; padding: 10px; background: #f0f8ff; border-radius: 6px; border-left: 4px solid #3498db;">
                  <strong>Ergebnis: ${correctCount}/${totalQuestions} richtig = ${points.toFixed(2)}/${maxPoints} Punkten</strong>
                </div>`;
        
        return html;
      }

      // 7. ÿØÿßŸÑÿ© ŸÑÿ™ÿ≠ÿ≥ŸäŸÜ ÿ™ŸÅÿßÿµŸäŸÑ ŸÇÿ≥ŸÖ ÿßŸÑÿßÿ≥ÿ™ŸÖÿßÿπ
      function buildHoerenDetails(answers) {
        let details = [];
        
        for (let i = 41; i <= 60; i++) {
          const id = i.toString();
          const userAnswer = normalizeAnswer(answers[id] || '');
          const correctAnswer = CONFIG.hoerenCorrect[id] || '-';
          const isCorrect = userAnswer === correctAnswer;
          
          details.push({
            frage: id,
            user: userAnswer,
            correct: correctAnswer,
            richtig: isCorrect
          });
        }
        
        return buildTableDetails(details, 75, 75);
      }

      // ===== ÿßŸÑÿØŸàÿßŸÑ ÿßŸÑÿ≠ÿßŸÑŸäÿ© ÿßŸÑŸÖÿπÿØŸÑÿ© =====
      
      function readExamResults() {
        try {
          const lesen = {};
          const hoeren = {};
          const schreiben = { content: '', wordCount: 0 };

          // 1) Try to read from in-memory states
          try {
            if (window._lesenState && window._lesenState.answers) {
              Object.keys(window._lesenState.answers).forEach(k => {
                lesen[k] = window._lesenState.answers[k];
              });
            }
          } catch (e) {}

          try {
            if (window._hoerenState && window._hoerenState.answers) {
              Object.keys(window._hoerenState.answers).forEach(sectionId => {
                const sec = window._hoerenState.answers[sectionId] || {};
                Object.keys(sec).forEach(q => {
                  hoeren[q] = sec[q];
                });
              });
            }
          } catch (e) {}

          try {
            if (window._schreibenState && window._schreibenState.answers) {
              const answers = window._schreibenState.answers;
              if (answers['s1']) {
                schreiben.content = answers['s1'];
              } else {
                const keys = Object.keys(answers);
                if (keys.length > 0) schreiben.content = answers[keys[0]] || '';
              }
              schreiben.wordCount = (schreiben.content && schreiben.content.trim()) ? String(schreiben.content).trim().split(/\s+/).filter(Boolean).length : 0;
            }
          } catch (e) {}

          // 2) Fallback to localStorage
          try {
            if (Object.keys(lesen).length === 0) {
              const storedL = localStorage.getItem('lesenAnswers');
              if (storedL) {
                const parsed = JSON.parse(storedL);
                Object.keys(parsed).forEach(k => {
                  lesen[k] = parsed[k];
                });
              }
            }
          } catch (e) {}

          try {
            if (Object.keys(hoeren).length === 0) {
              const storedH = localStorage.getItem('hoerenAnswers');
              if (storedH) {
                const parsed = JSON.parse(storedH);
                Object.keys(parsed).forEach(k => {
                  hoeren[k] = parsed[k];
                });
              }
            }
          } catch (e) {}

          try {
            if (!schreiben.content) {
              const storedS = localStorage.getItem('schreibenAnswers');
              if (storedS) {
                const obj = JSON.parse(storedS);
                schreiben.content = obj.content || '';
                schreiben.wordCount = obj.wordCount || (schreiben.content.trim() ? String(schreiben.content).trim().split(/\s+/).filter(Boolean).length : 0);
              }
            }
          } catch (e) {}

          return { hoeren, lesen, schreiben };
        } catch (e) {
          return { hoeren: {}, lesen: {}, schreiben: {} };
        }
      }

      function gradeHoeren(answers) {
        let correctCount = 0;
        const details = [];
        
        for (let q = 41; q <= 60; q++) {
          const k = String(q);
          const userAnswer = normalizeAnswer(answers[k] || '');
          const correctAnswer = CONFIG.hoerenCorrect[k] || '-';
          const isCorrect = (userAnswer !== '-' && userAnswer.toLowerCase() === correctAnswer.toLowerCase());
          if (isCorrect) correctCount++;
          
          details.push({
            frage: k,
            user: userAnswer,
            correct: correctAnswer,
            richtig: isCorrect
          });
        }
        
        const total = Number((correctCount * (CONFIG.totals.hoeren / CONFIG.counts.hoeren)).toFixed(2));
        return { correctCount, total, details };
      }

      function gradeLesen(answers) {
        let correctCount = 0;
        const details = [];
        
        Object.keys(CONFIG.lesenCorrect).forEach(k => {
          const correctAnswer = CONFIG.lesenCorrect[k];
          const userAnswer = normalizeAnswer(answers[k] || '');
          const isCorrect = (userAnswer !== '-' && userAnswer.toLowerCase() === correctAnswer.toLowerCase());
          if (isCorrect) correctCount++;
          
          details.push({
            frage: k,
            user: userAnswer,
            correct: correctAnswer,
            richtig: isCorrect
          });
        });
        
        const total = Number((correctCount * (CONFIG.totals.lesen / CONFIG.counts.lesen)).toFixed(2));
        return { correctCount, total, details };
      }

      // ===== ÿßŸÑÿØÿßŸÑÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ© ÿßŸÑŸÖÿ≠ÿ≥ŸÜÿ© =====
      function renderResults() {
        const results = readExamResults();
        const hoerenResults = gradeHoeren(results.hoeren || {});
        const lesenResults = gradeLesen(results.lesen || {});
        
        const details = document.getElementById('details-ergebnisse');
        const tiles = document.getElementById('topTiles-ergebnisse');
        const sScoreRaw = localStorage.getItem('schreibenScore');
        const sScore = sScoreRaw ? Number(sScoreRaw) : 0;

        details.innerHTML = '';
        tiles.innerHTML = '';

        // ÿπÿ±ÿ∂ ÿßŸÑÿ®ŸÑÿßÿ∑ÿßÿ™ ÿßŸÑÿπŸÑŸàŸäÿ©
        tiles.innerHTML = `
          <div class="results-tile">
            <h3>üìñ Lesen</h3>
            <div class="score">${lesenResults.total.toFixed(2)} / ${CONFIG.totals.lesen} Punkte</div>
            <div class="small-muted">(${(lesenResults.total / CONFIG.totals.lesen * 100).toFixed(2)} %)</div>
          </div>
          <div class="results-tile">
            <h3>üëÇ H√∂ren</h3>
            <div class="score">${hoerenResults.total.toFixed(2)} / ${CONFIG.totals.hoeren} Punkte</div>
            <div class="small-muted">(${(hoerenResults.total / CONFIG.totals.hoeren * 100).toFixed(2)} %)</div>
          </div>
          <div class="results-tile">
            <h3>‚úçÔ∏è Schreiben</h3>
            <div class="score" id="schreibenScoreDisplay">${sScore.toFixed(2)} / ${CONFIG.totals.schreiben} Punkte</div>
            <div class="small-muted">Manuelle Eingabe</div>
          </div>`;

        // ÿπÿ±ÿ∂ ÿßŸÑÿ™ŸÅÿßÿµŸäŸÑ ÿßŸÑŸÉÿßŸÖŸÑÿ©
        details.innerHTML = `
          <div class="result-item">
            <h2>üìä Detaillierte Ergebnisse</h2>
            <div class="instructions" style="margin-bottom: 20px;">
              Hier sehen Sie eine detaillierte Auswertung Ihrer Pr√ºfung. 
              Gr√ºne Zeilen zeigen richtige Antworten, rote Zeilen zeigen falsche Antworten.
            </div>
          </div>`;

        // ŸÇÿ≥ŸÖ ÿßŸÑŸÇÿ±ÿßÿ°ÿ©
        details.innerHTML += renderLesenDetails(results.lesen || {});
        
        // ŸÇÿ≥ŸÖ ÿßŸÑÿßÿ≥ÿ™ŸÖÿßÿπ
        details.innerHTML += `
          <div class="result-item">
            <h3>üëÇ H√∂rverstehen - Detaillierte Auswertung</h3>
            ${buildHoerenDetails(results.hoeren || {})}
          </div>`;

        // ŸÇÿ≥ŸÖ ÿßŸÑŸÉÿ™ÿßÿ®ÿ©
        const schreibenText = results.schreiben.content ? escapeHtml(results.schreiben.content) : '<span class="small-muted">Kein Text gefunden.</span>';
        const wordCount = results.schreiben.wordCount || '-';
        
        details.innerHTML += `
          <div class="result-item">
            <h3>‚úçÔ∏è Schreiben - Ihre Antwort</h3>
            <div class="small-muted">W√∂rter: ${wordCount}</div>
            <div style="margin-top:10px; padding:15px; background:#fff; border-radius:8px; border:1px solid #eef6ff; min-height:100px; max-height:300px; overflow-y:auto; white-space: pre-wrap;">
              ${schreibenText}
            </div>
            <div style="margin-top:15px; display:flex; gap:10px; align-items:center">
              Punkte (0‚Äì45): 
              <input id="sInput" type="number" min="0" max="45" step="0.5" value="${sScore}" style="width: 80px;"> 
              <button id="saveS" class="results-btn">Speichern</button>
            </div>
          </div>`;

        // ÿ≠ÿ≥ÿßÿ® ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸä
        const total = (lesenResults.total + hoerenResults.total + sScore).toFixed(2);
        const percent = ((total / CONFIG.totals.gesamt) * 100).toFixed(2);
        
        document.getElementById('finalSummary-ergebnisse').innerHTML = `
          <div class="left">
            <strong>Gesamtpunktzahl:</strong> ${total} / ${CONFIG.totals.gesamt} Punkte<br>
            <span class="small-muted">Lesen + H√∂ren + Schreiben</span>
          </div>
          <div class="right">
            <strong>Prozentsatz:</strong> ${percent} %<br>
            <span class="small-muted">${percent >= 60 ? 'Bestanden' : 'Nicht bestanden'}</span>
          </div>`;

        // ÿ•ÿ∂ÿßŸÅÿ© ŸÖÿ≥ÿ™ŸÖÿπ ÿßŸÑÿ≠ÿØÿ´ ŸÑÿ≤ÿ± ÿßŸÑÿ≠ŸÅÿ∏
        document.getElementById('saveS').onclick = () => {
          const v = Number(document.getElementById('sInput').value) || 0;
          localStorage.setItem('schreibenScore', v);
          document.getElementById('schreibenScoreDisplay').textContent = `${v.toFixed(2)} / ${CONFIG.totals.schreiben} Punkte`;
          
          const newTotal = (lesenResults.total + hoerenResults.total + v).toFixed(2);
          const newPercent = ((newTotal / CONFIG.totals.gesamt) * 100).toFixed(2);
          
          document.getElementById('finalSummary-ergebnisse').innerHTML = `
            <div class="left">
              <strong>Gesamtpunktzahl:</strong> ${newTotal} / ${CONFIG.totals.gesamt} Punkte<br>
              <span class="small-muted">Lesen + H√∂ren + Schreiben</span>
            </div>
            <div class="right">
              <strong>Prozentsatz:</strong> ${newPercent} %<br>
              <span class="small-muted">${newPercent >= 60 ? 'Bestanden' : 'Nicht bestanden'}</span>
            </div>`;
        };
      }

      // ===== ÿ™ŸáŸäÿ¶ÿ© ÿßŸÑÿµŸÅÿ≠ÿ© =====
      document.getElementById('calcBtn-ergebnisse').onclick = renderResults;
      document.getElementById('backBtn-ergebnisse').onclick = (e) => {
        e.preventDefault();
        showPage('start-page');
      };
      
      // ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨ ÿπŸÜÿØ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿµŸÅÿ≠ÿ©
      renderResults();
    }

    // ÿ™ÿ≠ÿ≥ŸäŸÜ ŸÜÿ∏ÿßŸÖ ÿßŸÑÿ≥ÿ≠ÿ® ŸàÿßŸÑÿ•ŸÅŸÑÿßÿ™ ŸÑŸÑÿ¥ÿßÿ¥ÿßÿ™ ÿßŸÑÿ™Ÿä ÿ™ÿπŸÖŸÑ ÿ®ÿßŸÑŸÑŸÖÿ≥
    function setupTouchDragAndDrop() {
      if ('ontouchstart' in window) {
        // ÿ™ÿ∫ŸäŸäÿ± ÿ≥ŸÑŸàŸÉ ÿßŸÑÿπŸÜÿßÿµÿ± ÿßŸÑŸÇÿßÿ®ŸÑÿ© ŸÑŸÑÿ≥ÿ≠ÿ®
        document.querySelectorAll('[draggable="true"]').forEach(item => {
          item.addEventListener('touchstart', handleTouchStart);
          item.addEventListener('touchend', handleTouchEnd);
        });
        
        document.querySelectorAll('.title-slot, .blank-slot').forEach(slot => {
          slot.addEventListener('touchmove', handleTouchMove);
          slot.addEventListener('touchend', handleTouchDrop);
        });
      }
    }

    function handleTouchStart(e) {
      // ÿ™ŸÜŸÅŸäÿ∞ ÿßŸÑÿ≥ÿ≠ÿ® ÿπŸÜÿØ ÿßŸÑŸÑŸÖÿ≥
    }

    // ÿßÿ≥ÿ™ÿØÿπÿßÿ° ÿßŸÑÿØÿßŸÑÿ© ÿπŸÜÿØ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿµŸÅÿ≠ÿ©
    document.addEventListener('DOMContentLoaded', setupTouchDragAndDrop);
  </script>
</body>
</html>