<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Deutsch B2 Pr√ºfung - Komplett</title>
  <style>
    /* ===== GLOBAL STYLES ===== */
    :root {
      --primary-color: #1e3a5f;
      --secondary-color: #2c5282;
      --accent-color: #4da6ff;
      --light-color: #ebf8ff;
      --text-color: #2d3748;
      --white: #ffffff;
      --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      --transition: all 0.3s ease;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      margin: 0;
      min-height: 100vh;
      background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
      color: var(--white);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    button {
      cursor: pointer;
    }
    
    /* ===== START PAGE STYLES ===== */
    .start-container {
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      padding: 20px;
      min-height: 100vh;
    }
    
    .start-content {
      max-width: 600px;
      width: 100%;
      background-color: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      padding: 40px;
      box-shadow: var(--shadow);
      text-align: center;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .logo {
      margin-bottom: 20px;
    }
    
    .logo-icon {
      font-size: 48px;
      margin-bottom: 10px;
    }
    
    h1 {
      font-size: 32px;
      margin-bottom: 10px;
      font-weight: 700;
    }
    
    .subtitle {
      font-size: 18px;
      margin-bottom: 30px;
      opacity: 0.9;
    }
    
    .card {
      background-color: var(--white);
      border-radius: 12px;
      padding: 25px;
      margin-bottom: 30px;
      box-shadow: var(--shadow);
      color: var(--text-color);
    }
    
    .card h2 {
      font-size: 20px;
      margin-bottom: 15px;
      color: var(--primary-color);
    }
    
    .card p {
      margin-bottom: 20px;
      line-height: 1.5;
    }
    
    select {
      width: 100%;
      padding: 12px 16px;
      font-size: 16px;
      border-radius: 8px;
      border: 2px solid var(--accent-color);
      outline: none;
      background-color: var(--white);
      color: var(--text-color);
      cursor: pointer;
      transition: var(--transition);
    }
    
    select:focus {
      border-color: var(--secondary-color);
      box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.3);
    }
    
    .timer-container {
      margin: 25px 0;
    }
    
    .timer-label {
      font-size: 16px;
      margin-bottom: 10px;
    }
    
    .timer {
      font-size: 48px;
      font-weight: 700;
      color: var(--accent-color);
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }
    
    .progress-bar {
      height: 8px;
      width: 100%;
      background-color: rgba(255, 255, 255, 0.2);
      border-radius: 4px;
      overflow: hidden;
      margin-top: 10px;
    }
    
    .progress {
      height: 100%;
      width: 100%;
      background-color: var(--accent-color);
      border-radius: 4px;
      transform: scaleX(1);
      transform-origin: left;
      transition: transform 1s linear;
    }
    
    .info-text {
      font-size: 14px;
      margin-top: 20px;
      opacity: 0.8;
    }
    
    .button-container {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }
    
    .btn {
      flex: 1;
      padding: 12px 20px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      background-color: var(--accent-color);
      color: white;
      text-decoration: none;
      display: inline-block;
      text-align: center;
    }
    
    .btn:hover {
      background-color: #3399ff;
    }
    
    /* ===== EXAM PAGE STYLES ===== */
    .exam-body {
      background: #f5f5f5;
      color: #333;
      line-height: 1.45;
      -webkit-font-smoothing: antialiased;
    }
    
    /* Header Styles */
    header.topbar {
      background: #1e3a5f;
      color: #fff;
      padding: 12px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      min-height: 80px;
    }

    .brand {
      display: flex;
      gap: 15px;
      align-items: center;
    }

    .brand .logo {
      width: 80px;
      height: 40px;
      background: #e74c3c;
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      color: white;
      font-size: 18px;
    }

    .meta .main-title {
      font-weight: 800;
      font-size: 18px;
    }

    .meta .sub-title {
      font-size: 13px;
      opacity: 0.9;
    }

    .timer {
      font-weight: 700;
      font-size: 18px;
      color: #fff;
      margin: 0 20px;
    }

    .buttons-grid {
      display: grid;
      grid-template-columns: repeat(2, auto);
      gap: 10px 20px;
    }

    .exam-btn {
      padding: 12px 20px;
      border-radius: 6px;
      border: none;
      background: #4da6ff;
      color: white;
      font-weight: 700;
      font-size: 15px;
      cursor: pointer;
      transition: background 0.2s ease-in-out;
      min-width: 150px;
      text-align: center;
    }

    .exam-btn:hover {
      background: #336fbf;
    }
    
    .exam-btn.save {
      background: #4da6ff;
      color: #000;
    }
    
    .exam-btn.save:hover {
      background: #3399ff;
    }
    
    .exam-btn.submit {
      background: #4da6ff;
    }
    
    .exam-btn.submit:hover {
      background: #3399ff;
    }
    
    .exam-btn.result {
      background: #4da6ff;
    }
    
    .exam-btn.result:hover {
      background: #3399ff;
    }
    
    .exam-btn.next {
      background: #4da6ff;
      color: #fff;
    }
    
    .exam-btn.next:hover {
      background: #3399ff;
    }
    
    .exam-btn.reset {
      background: #4da6ff;
    }
    
    .exam-btn.reset:hover {
      background: #3399ff;
    }
    
    .exam-btn.reset-section {
      background: #d35400;
      font-size: 12px;
      padding: 6px 10px;
      min-width: auto;
    }
    
    .exam-btn.reset-section:hover {
      background: #e67e22;
    }
    
    .exam-btn.no-match {
      background: #95a5a6;
      font-size: 12px;
      padding: 6px 10px;
      min-width: auto;
      margin-top: 5px;
    }
    
    .exam-btn.no-match:hover {
      background: #7f8c8d;
    }
    
    .exam-btn.no-match.selected {
      background: #e74c3c;
    }
    
    /* Top Tiles */
    .top-tiles {
      display: flex;
      justify-content: center;
      gap: 8px;
      padding: 8px 12px;
      background: #1e3a5f;
      border-bottom: 1px solid #0f223a;
    }
    
    .tile {
      flex: 1;
      max-width: 180px;
      text-align: center;
      padding: 12px;
      border-radius: 6px;
      border: 1px solid #ccc;
      background: #3b4a63;
      color: #fff;
      font-weight: 600;
      font-size: 13px;
      cursor: pointer;
      transition: all 0.2s ease-in-out;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 60px;
    }
    
    .tile:hover {
      background: #4a5b78;
    }
    
    .tile.active {
      background: #ffffff;
      color: #000;
      border-color: #bbb;
    }
    
    .tile.done {
      background: #2ecc71;
      color: #fff;
      border-color: #27ae60;
    }
    
    .tile.done::after {
      content: " ‚úÖ";
      margin-left: 5px;
    }
    
    .tile .points {
      background: rgba(255,255,255,0.2);
      padding: 4px 8px;
      border-radius: 12px;
      font-weight: 700;
      font-size: 11px;
      margin-top: 4px;
    }
    
    .tile.active .points {
      background: #e9eefc;
      color: #2c3e50;
    }
    
    /* Container Styles */
    .container {
      display: grid;
      grid-template-columns: 1fr 420px;
      gap: 16px;
      padding: 16px;
      max-width: 1200px;
      margin: 12px auto;
    }
    
    .container-full {
      display: grid;
      grid-template-columns: 1fr;
      gap: 16px;
      padding: 16px;
      max-width: 1200px;
      margin: 12px auto;
    }
    
    .container-split {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
      padding: 16px;
      max-width: 1200px;
      margin: 12px auto;
    }
    
    .left-panel {
      background: white;
      border-radius: 8px;
      padding: 18px;
      box-shadow: 0 1px 6px rgba(0,0,0,0.06);
      max-height: 76vh;
      overflow: auto;
    }
    
    .left-panel .passage {
      font-size: 14px;
      color: #2c3e50;
      line-height: 1.8;
    }
    
    .left-panel h2 {
      font-size: 16px;
      margin-bottom: 10px;
    }
    
    .right-panel {
      background: white;
      border-radius: 8px;
      padding: 12px;
      box-shadow: 0 1px 6px rgba(0,0,0,0.06);
      display: flex;
      flex-direction: column;
      gap: 12px;
      max-height: 76vh;
      overflow: auto;
    }
    
    .main-panel {
      background: white;
      border-radius: 8px;
      padding: 25px;
      box-shadow: 0 1px 6px rgba(0,0,0,0.06);
      max-height: 76vh;
      overflow: auto;
    }
    
    .panel-title {
      font-size: 18px;
      margin-bottom: 15px;
      color: #1e3a5f;
      font-weight: 700;
    }
    
    /* Question Styles */
    .question-head {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }
    
    .question-body {
      margin-top: 8px;
    }
    
    .options {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    .option {
      background: #fbfdff;
      border: 1px solid #e1e8f6;
      padding: 10px;
      border-radius: 8px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .option:hover {
      background: #f0f6ff;
    }
    
    .option.selected {
      background: #e8fbe9;
      border-color: #2ecc71;
    }
    
    .option .radio {
      width: 18px;
      height: 18px;
      border-radius: 50%;
      border: 2px solid #cfdff6;
      background: #fff;
      display: inline-block;
      flex-shrink: 0;
    }
    
    .option.selected .radio {
      background: #3498db;
      border-color: #3498db;
      box-shadow: inset 0 -3px 0 rgba(0,0,0,0.05);
    }
    
    .text-container {
      margin-bottom: 20px;
      padding: 15px;
      border: 1px solid #e1e8f6;
      border-radius: 8px;
      background: #fbfdff;
      position: relative;
      min-height: 120px;
    }
    
    .text-container:hover {
      background: #f0f6ff;
    }
    
    .text-title {
      font-weight: 700;
      margin-bottom: 8px;
      color: #2c3e50;
    }
    
    .text-content {
      font-size: 14px;
      color: #2c3e50;
      line-height: 1.6;
    }
    
    .title-slot {
      min-height: 40px;
      margin-top: 10px;
      padding: 8px;
      border: 2px dashed #c8d9f6;
      border-radius: 6px;
      background: #f8fbff;
    }
    
    .title-slot.has-title {
      background: #e8fbe9;
      border-color: #2ecc71;
    }
    
    .title-slot.has-x {
      background: #f8d7da;
      border-color: #e74c3c;
      color: #c0392b;
      font-weight: bold;
    }
    
    .headings-bank {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-top: 0;
    }
    
    .heading-item {
      padding: 10px;
      border: 1px solid #dbe7fb;
      border-radius: 8px;
      background: #f8fbff;
      cursor: grab;
    }
    
    .heading-item:hover {
      background: #e9f0ff;
    }
    
    .heading-item.used {
      opacity: 0.5;
      cursor: not-allowed;
      background: #f8d7da;
      border-color: #f5c6cb;
    }
    
    .result-correct {
      color: #27ae60;
      font-weight: bold;
    }
    
    .result-incorrect {
      color: #c0392b;
      font-weight: bold;
    }
    
    .result-item {
      margin: 10px 0;
      padding: 10px;
      border-radius: 6px;
      background: #f8f9fa;
    }
    
    .instructions {
      color: #7f8c8d;
      font-size: 14px;
      line-height: 1.6;
      margin-bottom: 15px;
    }
    
    .question-text {
      font-weight: 600;
      margin-bottom: 15px;
      font-size: 15px;
      color: #2c3e50;
    }
    
    .all-questions {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    
    .question-block {
      margin-bottom: 20px;
      padding: 15px;
      border: 1px solid #e1e8f6;
      border-radius: 8px;
      background: #fbfdff;
    }
    
    .texts-list, .situations-list {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    
    .text-item, .situation-item {
      padding: 15px;
      border: 1px solid #e1e8f6;
      border-radius: 8px;
      background: #fbfdff;
    }
    
    .text-letter {
      font-weight: bold;
      color: #2c3e50;
      margin-bottom: 8px;
    }
    
    .situation-number {
      font-weight: bold;
      color: #2c3e50;
      margin-bottom: 8px;
    }
    
    .fill-blank-container {
      margin: 20px 0;
    }
    
    .blank-word {
      display: inline-block;
      min-width: 120px;
      padding: 4px 8px;
      margin: 0 6px;
      background: #fff;
      cursor: pointer;
      position: relative;
      border: 1px solid #dbe7fb;
      border-radius: 4px;
    }
    
    .blank-word.has-answer {
      background: #e8fbe9;
      border-color: #2ecc71;
    }
    
    .options-popup {
      position: absolute;
      top: 100%;
      left: 0;
      background: white;
      border: 1px solid #dbe7fb;
      border-radius: 6px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      z-index: 100;
      min-width: 150px;
    }
    
    .option-item {
      padding: 8px 12px;
      cursor: pointer;
      border-bottom: 1px solid #f0f4fb;
    }
    
    .option-item:hover {
      background: #f0f6ff;
    }
    
    .option-item:last-child {
      border-bottom: none;
    }
    
    .horizontal-options {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    
    .option-row {
      display: flex;
      align-items: center;
      gap: 15px;
      padding: 10px;
      border: 1px solid #e1e8f6;
      border-radius: 8px;
      background: #fbfdff;
    }
    
    .option-number {
      font-weight: bold;
      color: #2c3e50;
      min-width: 30px;
    }
    
    .option-buttons {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    
    .option-btn {
      padding: 8px 16px;
      border: 1px solid #dbe7fb;
      border-radius: 6px;
      background: #f8fbff;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .option-btn:hover {
      background: #e9f0ff;
    }
    
    .option-btn.selected {
      background: #3498db;
      color: white;
      border-color: #3498db;
    }
    
    .word-bank-vertical {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    .bank-word-vertical {
      padding: 10px;
      border: 1px solid #dbe7fb;
      border-radius: 6px;
      background: #f8fbff;
      text-align: center;
      cursor: grab;
    }
    
    .bank-word-vertical.used {
      opacity: 0.5;
      cursor: not-allowed;
      background: #f8d7da;
      border-color: #f5c6cb;
    }
    
    .blank-slot {
      display: inline-block;
      min-width: 100px;
      padding: 4px 8px;
      margin: 0 6px;
      background: #fff;
      min-height: 30px;
      vertical-align: middle;
      border: 1px solid #dbe7fb;
      border-radius: 4px;
      cursor: pointer;
    }
    
    .blank-slot.has-answer {
      background: #e8fbe9;
      border-color: #2ecc71;
    }
    
    .footer-buttons {
      display: flex;
      gap: 10px;
    }
    
    .situation-item.used {
      opacity: 0.7;
      cursor: not-allowed;
      background: #f8d7da;
      border-color: #f5c6cb;
      color: #333;
    }
    
    /* Listening Section Styles */
    .listening-task {
      margin-bottom: 10px;
    }
    
    .true-false-table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
      font-size: 14px;
    }
    
    .true-false-table th {
      background: #3498db;
      color: white;
      padding: 15px;
      text-align: left;
      font-weight: 600;
      font-size: 14px;
    }
    
    .true-false-table td {
      padding: 15px;
      border-bottom: 1px solid #e1e8f6;
      vertical-align: top;
    }
    
    .true-false-table tr:nth-child(even) {
      background: #f8f9fa;
    }
    
    .true-false-table tr:hover {
      background: #e3f2fd;
    }
    
    .answer-options {
      display: flex;
      gap: 25px;
    }
    
    .answer-option {
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      padding: 10px 15px;
      border-radius: 4px;
      transition: background 0.2s;
      font-weight: 500;
    }
    
    .answer-option:hover {
      background: #e3f2fd;
    }
    
    .answer-option input {
      margin: 0;
      transform: scale(1.2);
    }

    .correct-answer {
      background: #d4edda !important;
      border-left: 4px solid #28a745;
    }
    
    .incorrect-answer {
      background: #f8d7da !important;
      border-left: 4px solid #dc3545;
    }
    
    /* Writing Section Styles */
    .writing-task {
      margin-bottom: 20px;
      padding: 15px;
      border: 1px solid #e1e8f6;
      border-radius: 8px;
      background: #fbfdff;
    }
    
    .writing-prompt {
      font-size: 14px;
      color: #2c3e50;
      line-height: 1.6;
      margin-bottom: 15px;
    }
    
    .writing-requirements {
      background: #f8f9fa;
      padding: 12px;
      border-radius: 6px;
      border-left: 4px solid #3498db;
      margin-bottom: 15px;
    }
    
    .writing-requirements h4 {
      margin: 0 0 8px 0;
      color: #2c3e50;
    }
    
    .writing-requirements ul {
      margin: 0;
      padding-left: 20px;
    }
    
    .writing-requirements li {
      margin-bottom: 5px;
      color: #2c3e50;
    }
    
    .writing-area {
      flex: 1;
      display: flex;
      flex-direction: column;
    }
    
    .writing-textarea {
      flex: 1;
      min-height: 500px;
      padding: 15px;
      border: 2px solid #e1e8f6;
      border-radius: 8px;
      font-size: 14px;
      line-height: 1.6;
      resize: vertical;
      font-family: Arial, sans-serif;
    }
    
    .writing-textarea:focus {
      outline: none;
      border-color: #3498db;
    }
    
    .word-counter {
      margin-top: 10px;
      text-align: right;
      font-size: 13px;
      color: #7f8c8d;
      padding: 8px 0;
    }
    
    .word-counter .count {
      font-weight: bold;
      color: #2c3e50;
    }
    
    /* Results Page Styles */
    .results-body {
      background: #f7fafc;
      color: #0f1724;
      line-height: 1.6;
    }
    
    .results-header {
      background: #1e3a5f;
      color: #fff;
      padding: 18px 20px;
      display: flex;
      align-items: center;
      gap: 16px;
    }
    
    .results-logo {
      background: #fff;
      color: #1e3a5f;
      padding: 8px 12px;
      border-radius: 6px;
      font-weight: 800;
    }
    
    .results-title {
      font-size: 18px;
      font-weight: 700;
    }
    
    .results-container {
      max-width: 1100px;
      margin: 22px auto;
      padding: 20px;
    }
    
    .results-tiles {
      display: flex;
      gap: 12px;
      margin: 18px 0;
    }
    
    .results-tile {
      flex: 1;
      background: #fff;
      border-radius: 10px;
      padding: 16px;
      box-shadow: 0 6px 18px rgba(2, 6, 23, 0.06);
      border-left: 6px solid #1e3a5f;
    }
    
    .results-tile h3 {
      margin: 0;
      font-size: 16px;
      color: #1e3a5f;
    }
    
    .results-tile .score {
      font-size: 20px;
      font-weight: 800;
      margin-top: 8px;
    }
    
    .section-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 12px;
    }
    
    .section-table th,
    .section-table td {
      padding: 8px;
      border-bottom: 1px solid #e6eef8;
      text-align: left;
      font-size: 14px;
    }
    
    .summary {
      background: #fff;
      padding: 16px;
      border-radius: 10px;
      margin-top: 18px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .summary .left {
      font-weight: 700;
    }
    
    .summary .right {
      text-align: right;
    }
    
    .controls {
      display: flex;
      gap: 10px;
      margin-top: 18px;
    }
    
    .results-btn {
      background: #4da6ff;
      border: none;
      color: #fff;
      padding: 10px 14px;
      border-radius: 8px;
      font-weight: 700;
      cursor: pointer;
      transition: background 0.3s;
    }
    
    .results-btn:hover {
      background: #3a8ce0;
    }
    
    .button-like {
      text-decoration: none;
    }
    
    .small-muted {
      color: #6b7280;
      font-size: 13px;
    }
    
    input[type="number"] {
      width: 90px;
      padding: 8px;
      border: 1px solid #d7e6fb;
      border-radius: 6px;
    }
    
    .note {
      font-size: 13px;
      color: #6b7280;
      margin-top: 8px;
    }
    
    /* Footer */
    footer.controls {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 20px;
      background: white;
      border-top: 1px solid #e1e8f6;
      margin-top: 20px;
    }
    
    .status {
      font-size: 14px;
      color: #7f8c8d;
    }
    
    .ghost {
      background: transparent;
      border: 2px solid #2c3e50;
      color: #2c3e50;
    }
    
    .ghost:hover {
      background: #2c3e50;
      color: white;
    }

    /* Responsive Styles */
    @media (max-width: 980px) {
      .container {
        grid-template-columns: 1fr;
        padding: 12px;
      }
      
      .container-split {
        grid-template-columns: 1fr;
      }
      
      .right-panel {
        order: 2;
      }
      
      .top-tiles {
        padding-left: 8px;
        padding-right: 8px;
      }
      
      header.topbar {
        flex-direction: column;
        gap: 15px;
        text-align: center;
      }
      
      .buttons-grid {
        grid-template-columns: 1fr;
      }
      
      .answer-options {
        flex-direction: column;
        gap: 10px;
      }
      
      footer.controls {
        flex-direction: column;
        gap: 15px;
      }
      
      .results-tiles {
        flex-direction: column;
      }
      
      .summary {
        flex-direction: column;
        gap: 10px;
        text-align: center;
      }
      
      .controls {
        flex-direction: column;
      }
    }
    
    @media (max-width: 600px) {
      .start-content {
        padding: 25px 20px;
      }
      
      h1 {
        font-size: 28px;
      }
      
      .card {
        padding: 20px 15px;
      }
    }

    /* === ÿ™ÿ≠ÿ≥ŸäŸÜÿßÿ™ ÿÆÿßÿµÿ© ŸÑŸÑŸáŸàÿßÿ™ŸÅ ÿßŸÑÿµÿ∫Ÿäÿ±ÿ© ÿ¨ÿØÿß === */
    @media (max-width: 480px) {
      /* 1. ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑÿ≠ÿßŸàŸäÿßÿ™ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ© */
      .container, .container-split, .container-full {
        grid-template-columns: 1fr !important;
        padding: 8px !important;
        gap: 10px !important;
      }
      
      /* 2. ÿ¨ÿπŸÑ ÿßŸÑŸÑŸàÿ≠ÿßÿ™ (panels) ÿ™ÿ£ÿÆÿ∞ ÿπÿ±ÿ∂ ŸÉÿßŸÖŸÑ */
      .left-panel, .right-panel, .main-panel {
        max-height: none !important;
        height: auto !important;
        overflow: visible !important;
        margin-bottom: 10px;
      }
      
      /* 3. ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑŸáŸäÿØÿ± */
      .topbar {
        flex-direction: column !important;
        align-items: stretch !important;
        padding: 10px !important;
      }
      
      .brand {
        justify-content: center;
        margin-bottom: 10px;
      }
      
      /* 4. ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑÿ£ÿ≤ÿ±ÿßÿ± ŸÅŸä ÿßŸÑŸáŸäÿØÿ± */
      .buttons-grid {
        grid-template-columns: 1fr !important;
        width: 100%;
      }
      
      .exam-btn {
        width: 100% !important;
        margin: 2px 0 !important;
        font-size: 14px !important;
        padding: 12px 8px !important;
      }
      
      /* 5. ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑÿ™ÿßŸäŸÑÿßÿ™ */
      .top-tiles {
        flex-wrap: wrap;
        justify-content: center;
      }
      
      .tile {
        flex: 0 0 calc(33% - 5px) !important;
        max-width: calc(33% - 5px) !important;
        margin: 2px;
        font-size: 11px !important;
        padding: 8px 4px !important;
      }
      
      /* 6. ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑŸÜÿµŸàÿµ */
      .passage, .text-content, .question-text {
        font-size: 15px !important;
        line-height: 1.5 !important;
      }
      
      /* 7. ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑÿÆŸäÿßÿ±ÿßÿ™ */
      .option {
        padding: 12px 10px !important;
        margin: 4px 0 !important;
      }
      
      /* 8. ÿ™ÿ≠ÿ≥ŸäŸÜ ÿ¨ÿØÿßŸàŸÑ True/False */
      .true-false-table {
        display: block;
        overflow-x: auto;
        white-space: nowrap;
      }
      
      /* 9. ÿ™ÿ≠ÿ≥ŸäŸÜ ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑŸÉÿ™ÿßÿ®ÿ© */
      .writing-textarea {
        min-height: 300px !important;
        font-size: 16px !important;
      }
      
      /* 10. ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑŸÅŸàÿ™ÿ± */
      footer.controls {
        flex-direction: column !important;
        gap: 10px !important;
      }
      
      .footer-buttons {
        width: 100%;
        display: flex;
        gap: 5px;
      }
      
      .footer-buttons .exam-btn {
        flex: 1;
      }
      
      /* 11. ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨ */
      .results-tiles {
        flex-direction: column !important;
      }
      
      .results-tile {
        margin-bottom: 10px;
      }
    }

    /* === ÿ™ÿ≠ÿ≥ŸäŸÜÿßÿ™ ŸÑŸÑŸáŸàÿßÿ™ŸÅ ÿßŸÑŸÖÿ™Ÿàÿ≥ÿ∑ÿ© === */
    @media (min-width: 481px) and (max-width: 768px) {
      .container, .container-split {
        grid-template-columns: 1fr !important;
      }
      
      .tile {
        max-width: 180px !important;
      }
    }
  </style>
</head>
<body id="body">
  <!-- Start Page -->
  <div id="start-page" class="start-container">
    <div class="start-content">
      <div class="logo">
        <div class="logo-icon">üìù</div>
        <h1>Deutsch B2 Pr√ºfung</h1>
        <div class="subtitle">Bereiten Sie sich auf Ihre Pr√ºfung vor</div>
      </div>
      <div class="card">
        <h2>Pr√ºfungsbereich ausw√§hlen</h2>
        <p>W√§hlen Sie bitte den Bereich aus, den Sie √ºben m√∂chten. Die Pr√ºfung startet automatisch in <span id="time-display">30</span> Sekunden.</p>
        <select id="sectionSelect">
          <option value="lesen">Lesen</option>
          <option value="hoeren">H√∂ren</option>
          <option value="schreiben">Schreiben</option>
        </select>
        <div class="button-container">
          <button id="cancelBtn" class="btn">Abbrechen</button>
          <button id="startBtn" class="btn">Jetzt starten</button>
        </div>
      </div>
      <div class="timer-container">
        <div class="timer-label">Die Pr√ºfung startet in:</div>
        <div class="timer" id="countdown">30</div>
        <div class="progress-bar">
          <div class="progress" id="progress"></div>
        </div>
      </div>
      <div class="info-text">Stellen Sie sicher, dass Sie in einer ruhigen Umgebung sind und gen√ºgend Zeit haben.</div>
    </div>
  </div>

  <!-- Lesen Page -->
  <div id="lesen-page" class="exam-page" style="display: none;">
    <header class="topbar" role="banner">
      <div class="brand">
        <div class="logo">test</div>
        <div class="meta">
          <div class="main-title">Deutsch - B2 (√úbung)</div>
          <div class="sub-title">Lesen ‚Äî Testbeispiel</div>
        </div>
      </div>

      <div id="timer-lesen" class="timer" aria-live="polite">Verbleibende Zeit: 90:00</div>

      <div class="buttons-grid">
        <button id="resetBtn-lesen" class="exam-btn reset">üîÑ Von neu beginnen</button>
        <button id="saveBtn-lesen" class="exam-btn save">üìã Speichern</button>
        <button id="resultBtn-lesen" class="exam-btn result">üìä Ergebnis</button>
        <button id="submitBtn-lesen" class="exam-btn submit">üèÅ Abgabe</button>
        <button class="exam-btn next" id="nextBtn-lesen">‚û°Ô∏è N√§chste Pr√ºfung</button>
      </div>
    </header>

    <div class="top-tiles" id="topTiles-lesen" role="navigation" aria-label="Sections overview"></div>

    <div class="container">
      <main class="left-panel" id="leftPanel-lesen">
        <div class="passage" id="passage-lesen">
          <h2 id="passageTitle-lesen">Aufgabe</h2>
          <div id="passageContent-lesen"></div>
        </div>
      </main>

      <aside class="right-panel" id="rightPanel-lesen" aria-labelledby="questionTitle-lesen">
        <div class="question-head">
          <div>
            <div id="sectionName-lesen" style="font-weight:800"></div>
            <div id="questionTitle-lesen" style="font-size:13px;color:#55607a">Frage</div>
          </div>
          <button id="resetSectionBtn-lesen" class="exam-btn reset-section" style="display:none;">Teil zur√ºcksetzen</button>
        </div>
        <div class="question-body" id="questionBody-lesen"></div>
        <div id="headingsBankContainer-lesen"></div>
      </aside>
    </div>

    <footer class="controls">
      <div class="footer-buttons">
        <button id="prevBtn-lesen" class="exam-btn ghost">Zur√ºck</button>
        <button id="nextBtn-lesen" class="exam-btn ghost">Weiter</button>
      </div>
      <div class="status"><span id="statusText-lesen">Nicht gespeichert</span></div>
    </footer>
  </div>

  <!-- H√∂ren Page -->
  <div id="hoeren-page" class="exam-page" style="display: none;">
    <header class="topbar" role="banner">
      <div class="brand">
        <div class="logo">test</div>
        <div class="meta">
          <div class="main-title">Deutsch - B2 (√úbung)</div>
          <div class="sub-title">H√∂rverstehen ‚Äî Testbeispiel</div>
        </div>
      </div>

      <div id="timer-hoeren" class="timer" aria-live="polite">Verbleibende Zeit: 17:00</div>

      <div class="buttons-grid">
        <button id="resetBtn-hoeren" class="exam-btn reset">üîÑ Von neu beginnen</button>
        <button id="saveBtn-hoeren" class="exam-btn save">üìã Speichern</button>
        <button id="resultBtn-hoeren" class="exam-btn result">üìä Ergebnis</button>
        <button id="submitBtn-hoeren" class="exam-btn submit">üèÅ Abgabe</button>
        <button class="exam-btn next" id="nextBtn-hoeren">‚û°Ô∏è N√§chste Pr√ºfung</button>
      </div>
    </header>

    <div class="top-tiles" id="topTiles-hoeren" role="navigation" aria-label="Sections overview"></div>

    <div class="container-full">
      <main class="main-panel" id="mainPanel-hoeren">
        <div id="contentContainer-hoeren"></div>
      </main>
    </div>

    <footer class="controls">
      <div class="footer-buttons">
        <button id="prevBtn-hoeren" class="exam-btn ghost">Zur√ºck</button>
        <button id="nextBtn-hoeren" class="exam-btn ghost">Weiter</button>
      </div>
      <div class="status"><span id="statusText-hoeren">Nicht gespeichert</span></div>
    </footer>
  </div>

  <!-- Schreiben Page -->
  <div id="schreiben-page" class="exam-page" style="display: none;">
    <header class="topbar" role="banner">
      <div class="brand">
        <div class="logo">test</div>
        <div class="meta">
          <div class="main-title">Deutsch - B2 (√úbung)</div>
          <div class="sub-title">Schreiben ‚Äî Testbeispiel</div>
        </div>
      </div>

      <div id="timer-schreiben" class="timer" aria-live="polite">Verbleibende Zeit: 30:00</div>

      <div class="buttons-grid">
        <button id="resetBtn-schreiben" class="exam-btn reset">üîÑ Von neu beginnen</button>
        <button id="saveBtn-schreiben" class="exam-btn save">üìã Speichern</button>
        <button id="resultBtn-schreiben" class="exam-btn result">üìä Ergebnis</button>
        <button id="submitBtn-schreiben" class="exam-btn submit">üèÅ Abgabe</button>
        <button class="exam-btn next" id="nextBtn-schreiben">‚û°Ô∏è N√§chste Pr√ºfung</button>
      </div>
    </header>

    <div class="top-tiles" id="topTiles-schreiben" role="navigation" aria-label="Sections overview"></div>

    <div class="container-split">
      <main class="left-panel" id="leftPanel-schreiben">
        <div class="passage" id="passage-schreiben">
          <h2 id="passageTitle-schreiben">Aufgabe</h2>
          <div id="passageContent-schreiben"></div>
        </div>
      </main>

      <aside class="right-panel" id="rightPanel-schreiben">
        <div id="writingContainer-schreiben"></div>
      </aside>
    </div>

    <footer class="controls">
      <div class="footer-buttons">
        <button id="prevBtn-schreiben" class="exam-btn ghost">Zur√ºck</button>
        <button id="nextBtn-schreiben" class="exam-btn ghost">Weiter</button>
      </div>
      <div class="status"><span id="statusText-schreiben">Nicht gespeichert</span></div>
    </footer>
  </div>

  <!-- Ergebnisse Page -->
  <div id="ergebnisse-page" class="results-page" style="display: none;">
    <header class="results-header">
      <div class="results-logo">test</div>
      <div class="results-title">Gesamtergebnis ‚Äî Deutsch B2</div>
    </header>

    <div class="results-container">
      <div class="results-tiles" id="topTiles-ergebnisse"></div>
      <div id="details-ergebnisse"></div>
      <div class="summary" id="finalSummary-ergebnisse"></div>
      <div class="controls">
        <a class="button-like" href="#" id="backBtn-ergebnisse">
          <button class="results-btn">üîÅ Zur√ºck zur Startseite</button>
        </a>
        <button id="calcBtn-ergebnisse" class="results-btn">‚úÖ Ergebnisse anzeigen</button>
      </div>
      <div class="note">Hinweis: Schreiben (45 Punkte) wird manuell eingegeben, falls nicht automatisch vorhanden.</div>
    </div>
  </div>

  <script>
    // ===== PAGE NAVIGATION =====
    function showPage(pageId) {
      // Hide all pages
      document.getElementById('start-page').style.display = 'none';
      document.getElementById('lesen-page').style.display = 'none';
      document.getElementById('hoeren-page').style.display = 'none';
      document.getElementById('schreiben-page').style.display = 'none';
      document.getElementById('ergebnisse-page').style.display = 'none';
      
      // Change body class based on page
      document.getElementById('body').className = '';
      if (pageId === 'ergebnisse-page') {
        document.getElementById('body').className = 'results-body';
      } else if (pageId !== 'start-page') {
        document.getElementById('body').className = 'exam-body';
      }
      
      // Show selected page
      document.getElementById(pageId).style.display = 'block';
      
      // Initialize the page if needed
      if (pageId === 'lesen-page' && typeof initLesenPage === 'function') {
        initLesenPage();
      } else if (pageId === 'hoeren-page' && typeof initHoerenPage === 'function') {
        initHoerenPage();
      } else if (pageId === 'schreiben-page' && typeof initSchreibenPage === 'function') {
        initSchreibenPage();
      } else if (pageId === 'ergebnisse-page' && typeof initErgebnissePage === 'function') {
        initErgebnissePage();
      }
    }

    // ===== START PAGE FUNCTIONALITY =====
    let initialCounter = 30;
    let counter = initialCounter;
    let countdownInterval;
    let countdownRunning = false;
    let examStarted = false;
    const timerEl = document.getElementById("countdown");
    const timeDisplayEl = document.getElementById("time-display");
    const progressEl = document.getElementById("progress");
    const selectEl = document.getElementById("sectionSelect");
    const startBtn = document.getElementById("startBtn");
    const cancelBtn = document.getElementById("cancelBtn");

    function startCountdown() {
      // prevent double-starts or starting after exam already began
      if (countdownRunning || examStarted) return;
      countdownRunning = true;
      // disable start button while counting
      try { startBtn.disabled = true; startBtn.setAttribute('aria-disabled','true'); } catch(e){}
      // reset counter & UI
      counter = initialCounter;
      timerEl.textContent = counter;
      timeDisplayEl.textContent = counter;
      progressEl.style.transform = "scaleX(0)";
      timerEl.style.color = "";

      countdownInterval = setInterval(() => {
        counter--;
        timerEl.textContent = counter;
        timeDisplayEl.textContent = counter;
        const progressValue = (initialCounter - counter) / initialCounter;
        progressEl.style.transform = `scaleX(${progressValue})`;
        if (counter <= 0) {
          clearInterval(countdownInterval);
          countdownInterval = null;
          countdownRunning = false;
          progressEl.style.transform = "scaleX(1)";
          // ensure exam starts only once
          if (!examStarted) {
            examStarted = true;
            startExam();
          }
          // safety: re-enable start button (page usually navigates away)
          try { startBtn.disabled = false; startBtn.removeAttribute('aria-disabled'); } catch(e){}
        }
      }, 1000);
    }

    function stopCountdown(reset = true) {
      if (countdownInterval) {
        clearInterval(countdownInterval);
        countdownInterval = null;
      }
      countdownRunning = false;
      try { startBtn.disabled = false; startBtn.removeAttribute('aria-disabled'); } catch(e){}
      progressEl.style.transform = "scaleX(0)";
      if (reset) {
        counter = initialCounter;
        timerEl.textContent = counter;
        timeDisplayEl.textContent = counter;
      } else {
        timerEl.textContent = "Gestoppt";
      }
    }

    function startExam() {
      // guard to ensure startExam is triggered once
      if (!examStarted) examStarted = true;
      const selectedSection = selectEl.value;
      if (selectedSection === 'lesen') {
        showPage('lesen-page');
      } else if (selectedSection === 'hoeren') {
        showPage('hoeren-page');
      } else if (selectedSection === 'schreiben') {
        showPage('schreiben-page');
      }
    }

    // wire buttons: start will now start the countdown (not the exam directly)
    startBtn.addEventListener('click', startCountdown);

    cancelBtn.addEventListener('click', () => {
      stopCountdown(true);
      timerEl.textContent = "Abgebrochen";
      timerEl.style.color = "#e53e3e";
    });

    // ===== LESEN PAGE FUNCTIONALITY =====
    function initLesenPage() {
      /* ===== Self-contained exam (embedded) ===== */
      const exam = {
        id: "exam-001",
        durationSec: 90 * 60,
        sections: [
          { 
            id: "s1", 
            title: "Leseverstehen, Teil 1", 
            points: 25,
            passageTitle: "Aufgabe: Ziehen Sie die passenden √úberschriften auf die Texte.",
            passage: "",
            questions: [],
            texts: [
              {
                id: "text1",
                content: "Aussteigen, tanken, wegfahren: Wenn die Benzinpreise steigen, ist wieder Hochsaison bei den Benzindieben. Fr√ºh morgens und abends schlagen Sie besonders gerne zu. Viele setzen auf den Schutz der Dunkelheit. Vor Weihnachten und im Januar und Februar h√§ufen sich die F√§lle. Auch am Monatsende, wenn das Geld knapp wird, steigt die Zahl der Benzindiebst√§hle. Doch sparen l√§sst sich durch Benzinklau nicht. Fast alle T√§ter werden von der Polizei gefasst. Schlie√ülich gibt es an jeder Tankstelle eine Kamera, die das Autokennzeichen aufgenommen hat. Tankwart Kurt Jochimsen aus Emden zeig uns einen Fall aus seiner gro√üen Videosammlung. Ein Wagen mit zwei Insassen f√§hrt an die Zapfs√§ule. Der Fahrer tankt, seine Frau geht in den Shop. Sie kauft dort zwei Cola und bezahlt. Aber nicht das Benzin. Der Mann hat inzwischen voll getankt und wartet im Wagen. 'Hier Sehen Sie: Die Frau kommt raussteigt ein und das Fahrzeug f√§hrt davon. Hinterher hei√üt es dann, ich habe doch glatt vergessen, das Benzin zu bezahlen', erkl√§rt Kurt Jochimsen. Bei der Polizei kennt man diese Ausreden. Polizeihauptkommissar Werner Knips: 'Vergessen gilt nicht, es gibt immer eine Anzeige. Und dann wird es richtig teuer.'",
                correctAnswer: "i"
              },
              {
                id: "text2", 
                content: "Viele Autofahrer, die in einen Unfall verwickelt sind, sind so aufgeregt, dass sie vergessen, what zu tun ist. Der Versicherungsexperte Klaus Lenhoff gibt die wichtigsten Tipps: 1. Unfallstelle absichern: Warnblinkanlage einschalten und Warndreieck in 100 Metern Entfernung aufstellen. 2. Rettung aus dem Gefahrenbereich: alle Unfallbeteiligten aus dem Gefahrenbereich retten. Eingeschlossene befreien und Br√§nde sofort bek√§mpfen. 3. Rettungskr√§fte informieren: bei schweren Unf√§llen und wenn es Verletzte gibt, die Polizei (Ruf 110) oder die Rettungsleitstelle (Ruf 112) informieren. Dabei an 'die f√ºnf W's' denken: Wo ist es passiert? Was ist passiert? Wie viele Verletzte? Welche Verletzungen? Warten sie auf R√ºckfragen. 4. Verletzten Hilfe leisten, zum Beispiel: Kontrolle von Atmung und Puls, Atemspende, stabile Seitenlage, Erkennen und Behandeln eines Schocks, Stillen von Blutungen. 5. Lokalisierung auf der Autobahn: Wo hat sich der Unfall ereignet? 6. Beweismittel sichern: am besten Fotos oder eine Skizze von der Unfallstelle machen. 7. Verkehrsflu√ü wiederherstellen, also schnell die Fahrbahn r√§umen. 8. Name, Anschrift und Telefonnummern von Zeugen notieren. 9. Vorsicht bei Aussagen: die Aufregung am Unfallort verleitet zu missverst√§ndlichen √Ñu√üerungen. Keine Aussagen unter Druck machen. 10. Versicherung des Unfallgegners ermitteln.",
                correctAnswer: "b"
              },
              {
                id: "text3",
                content: "Hast du schon mal mit dem Gedanken gespielt, Pilotin zu werden? Nicht? Dann geht es euch wahrscheinlich wie den meisten M√§dchen oder Frauen. Warum wollen eigentlich so wenige Frauen Pilotinnen werden? Nur weil der Beruf angeblich ein typischer M√§nnerberuf ist? Wir haben eine Pilotin getroffen: Monique Bellin ist 39 Jahre alt, wohnt im S√ºden Frankfurts und ist Pilotin. 'Schon seit fr√ºher Kindheit habe ich mich f√ºr die Fliegerei interessiert. Es hat mich schon immer fasziniert, dass es mit Hilfe technischer Mittel m√∂glich ist, die Schwerkraft zu √ºberwinden und die Welt aus der Vogelperspektive zu betrachten. Und irgendwann wollte ich diese Technik dann auch selbst beherrschen', so Belling. Seit sie in diesem Beruf arbeite, habe sich ihre Einstellung zu vielen Dingen ver√§ndert: 'Ich bin toleranter als vor meinem 'Fliegerleben' - vielleicht weil ich versuche, mein Umfeld aus anderen Perspektiven zu betrachten. Auch meine Freizeit und meine Familie sind mir noch kostbarer geworden, seit ich in diesem Beruf t√§tig bin', erkl√§rt sie. Hat sie noch Tr√§ume? 'Aber ja!', sagt Monique Belling: 'Mit einem Shuttle ins Weltall fliegen, um die Erde als Kugel zu sehen und das Gef√ºhl absoluter Schwerelosigkeit zu erleben'.",
                correctAnswer: "c"
              },
              {
                id: "text4",
                content: "Der Schweizer Louis Palmer hat eine Weltumrundung mit seinem 'Solartaxi' fast abgeschlossen. Er habe bereits 47000 km mit seinem Solarauto zur√ºckgelegt, sagte Palmer bei einem Stopp in Paris. 'Nun habe ich fast den ganzen Planeten umrundet, ohne einen Tropfen Benzin zu brauchen'. Die Batterien des bis zu 90 Stundenkilometer schnelle Solarmobils k√∂nnen Energie f√ºr eine Reichweite von 400 km speichern. 'Das Wetter spielt keine Rolle', sagte Palmer. 'Es kann mehrere Tage in Folge regnen, ich fahre ohne Probleme weiter'. Palmer war mit seinem dreir√§drigen 'Taxi' im Juli in Luzern gestartet. Seitdem hat er Europa, Asien, Australien, Neuseeland und Nordamerika durchquert. Er zieht einen Anh√§nger mit sechs Quadratmetern Solarzellen hinter sich her und die Sonnenenergie treibst das Gef√§hrt an. Seit dem Start ist das Solartaxi nur zwei Tage ausgefallen, weil ein Kabel besch√§digt war. Gebaut wurde das innovative Fahrzeug von four Schweizer Ingenieurschulen. Palmer has auch Platz f√ºr Beifahrer: Neben ihm sa√üen schon ber√ºhmte Pers√∂nlichkeiten aus Politik, Wirtschaft und Showgesch√§ft im 'Solartaxi'.",
                correctAnswer: "d"
              },
              {
                id: "text5",
                content: "Die Bundesregierung und ihre Spitzenbeamten sind auf Dienstreisen gern mit dem Flugzeug unterwegs - aber nicht nur, wenn es um Fernreisen geht, sondern auch bei kurzen Inlandsreisen. Wie aus der Antwort des Innenministeriums auf eine Frage eines Abgeordneten hervorgeht, gab die Bundesregierung im letzten Jahr 7,7 Millionen Euro f√ºr innendeutsche Flugreisen aus. Fahrkarten der Bahn hingegen schlugen lediglich mit 3,2 Millionen zu Buche. Der Vergleich mit anderen Jahren zeigt aber, dass sich die meisten Politiker bem√ºhen, immer h√§ufiger vom Flugzeug auf die Bahn umzusteigen. Eine Ausnahme bildet das Kanzleramt (Flugkosten um 30% erh√∂ht gegen√ºber dem Vorjahr) sowie ausgerechnet das Ressort des Bundesumweltministers (plus 7%). Vergleichszahlen f√ºr den erh√∂hten und gesenkten Benzinverbrauch f√ºr die Dienstwagen der Bundesregierung liegen noch nicht vor.",
                correctAnswer: "e"
              }
            ],
            headings: [
              {id: "a", text: "Benzingeld sparen: Tipp vom Tankwart"},
              {id: "b", text: "Die wichtigsten Erste-Hilfe-Ratschl√§ge"},
              {id: "c", text: "Einmal die Welt als Ganzes sehen"},
              {id: "d", text: "Einmal um die Welt ohne einen Tropfen Benzin"},
              {id: "e", text: "Fliegen statt fahren"},
              {id: "f", text: "Innerdeutsche Reisen besonders beliebt"},
              {id: "g", text: "Frau im All"},
              {id: "h", text: "Schweizer nutzen Solartaxis"},
              {id: "i", text: "Steigende Spritpreise: die Tricks der Autofahrer"},
              {id: "j", text: "Die richtige Unfallversicherung"}
            ]
          },
          { 
            id: "s2", 
            title: "Leseverstehen, Teil 2", 
            points: 25,
            passageTitle: "Korbjagd zu Pferde",
            passage: `Wer sich under dem zweimal pro Woche stattfindenden Training auf dem Wiesbadener Hofgut Adamstal eine Art 'Kuschehrunde' vorgestellt hatte, der wird schnell eines Besseren belehrt, und der neugierige Betrachter f√ºhlt sich eher auf einen Fu√üballplatz als in eine Reithalle versetzt. Die festliegenden Spielz√ºge, die es einzustudieren gilt, sind Bestandteil einer Sportart, die hierzulande allenfalls eine Randerscheinung ist: Horse‚ÄìBall.

'Es kommen immer mehr Aktive dazu', versichert jedoch Hans‚ÄìJ√ºrgen Faust (59), Hausherr auf Hofgut Adamstal und Pr√§sident des Deutschen Horse‚ÄìBall‚ÄìVerbandes. Irgendwo in Hagen, D√ºsseldorf, M√ºnchen oder Heidelberg soll es noch ein paar vereinzelte Akteure geben, das eigentliche Geschehen aber spielt sich hier ab, wo einer der wohl kleinsten Sportverb√§nde Deutschlands vor 15 Jahren aus der Taufe gehoben wurde und wo die erste Mannschaft der Reitergruppe Wiesbaden (RGW) identisch ist mit der National‚ÄìAuswahl. Aber diesen Sport betreiben nicht nur Erwachsene: Die j√ºngsten Spieler sind nicht √§lter als acht. Horse‚ÄìBall ist ‚Äìvereinfacht gesagt ‚Äì eine Art Basketball zu Pferde.

An den beiden Enden des zirka 25 mal 70 Meter gro√üen Spielfeldes sind die Korbringe nicht waagerecht, sondern senkrecht ausgerichtet und mit Fangnetzen versehen, in denen die B√§lle nach einem gelungenen Spielzug landen. Keine leichte Aufgabe, wie die bereits erw√§hnten ersten Trainingseindr√ºcke zeigen, aber √úbung macht eben auch hier den Meister. Zumindest auf nationaler, sprich: Wiesbadener Ebene.

Dar√ºber hinaus gilt es, immer wieder Lehrgeld zu zahlen, vor allem bei Gastspielen im Heimatland Frankreich, wo Horse‚ÄìBall vor rund 25 Jahren erfunden wurde und einen viel h√∂heren Stellenwert als hierzulande genie√üt. Sogar eine eigene Profiliga gibt es bei unseren s√ºdwestlichen Nachbarn, die bei den Mitte August anstehenden Europameisterschafts einmal mehr nicht nur Gastgeber, sondern auch wieder Anw√§rter auf den Titel sind.

Wer es √ºbrigens selbst einmal ausprobieren m√∂chte: Im kommenden Monat bieten die Wiesbaden Buffalos f√ºr maximal zw√∂lf Teilnehmer einen Einstiegs‚ÄìLehrgang an. Dabei mitzubringen sind reiterliche Grundkenntnisse und ein so genannter Dreipunkt‚Äì Helm. Alles andere wird ‚Äì inklusive Vierbeiner ‚Äì bei Bedarf gestellt. 'Nat√ºrlich k√∂nnen auch eigene Pferde mitgebracht werden', sagt Faust.

Die Tiere m√ºssen 'sozialvertr√§glich' sein, erl√§utert der 59‚ÄìJ√§hrige, und das nicht nur im Umgang mit dem Reiter, sondern vor allem undereinander. 'Im richtigen Wettkampf kann es auch schon mal zu Zusammenst√∂√üen kommen', wei√ü Faust, f√ºr den Horse‚ÄìBall zu einem ganz pers√∂nlichen 'Steckenpferd' geworden ist, das in der vielf√§ltigen Angebotspalette des riesigen Hofguts eine Art Sonderstatus einnimmt.

Damit es trotz unvermeidlichen K√∂rperkontakts kaum einmal zu ernsthaften Verletzungen kommt, tragen nicht nur die Pferde vorgeschriebene Bandagen an den Beinen, sondern auch f√ºr die Reiter gibt es eine speielle Vorrichtung: Ein Gurt, der under dem Bauch der Tiere die beiden Steigb√ºgel miteinander verbindet, gew√§hrt selbst dann noch sicheren Halt, wenn sich der Spieler aus vollem Galopp heraus aus dem Sattel fallen l√§sst, um den Ball vom Boden aufnehmen zu k√∂nnen. Um die Handhabung dabei ein wenig zu vereinfachen, ist das runde Leder mit Fangriemen versehen, die ein sicheres Zugreifen auch mit einer Hand erm√∂glichen.

Aber noch eine Besonderheit weist Horse‚ÄìBall auf: Es ist die einzige Pferdesportart, bei der der gebraucht einer Gerte (das ist ein kleiner Stock, mit dem das Pferd leicht geschlagen wird) ausdr√ºcklich verboten ist, wie Faust betont. Damit tritt er auch etwaigen Bef√ºrchtungen entgegen, dass es zu Tierqu√§lerei kommen k√∂nnte. Der Chef des Hofgut Adamstal: 'Das Gegenteil ist der Fall. Die Tiere k√∂nnen beim Horse‚ÄìBall ihre nat√ºrlichen Verhaltensweisen ausleben und haben sogar Spa√ü dabei'. Zumindest mehr als der eine oder andere Reiter, wie es angesichts des strengen Trainings den Eindruck macht.`,
            questions: [
              {
                id: "s2q1",
                type: "single",
                text: "Aktive der Wiesbadener Reitergruppe",
                options: [
                  {id: "s2q1o1", text: "bilden die deutsche Nationalmannschaft."},
                  {id: "s2q1o2", text: "spielen schon als Achtj√§hrige in der deutschen Nationalmannschaft mit."},
                  {id: "s2q1o3", text: "unterst√ºtzen die deutsche Nationalmannschaft."}
                ],
                correctAnswer: "s2q1o1"
              },
              {
                id: "s2q2",
                type: "single", 
                text: "Die Basketball-K√∂rbe",
                options: [
                  {id: "s2q2o1", text: "h√§ngen wie beim normalen Basketball."},
                  {id: "s2q2o2", text: "sind mit dem Netz nach oben aufgeh√§ngt."},
                  {id: "s2q2o3", text: "sind so gedreht, dass ihre √ñffnungen nach der Seite zeigen."}
                ],
                correctAnswer: "s2q2o3"
              },
              {
                id: "s2q3",
                type: "single",
                text: "Wer an einem Horse-Ball-Lehrgang teilnimmt,",
                options: [
                  {id: "s2q3o1", text: "braucht ein eigenes Pferd."},
                  {id: "s2q3o2", text: "kann sein eigenes Pferd einsetzen."},
                  {id: "s2q3o3", text: "muss sein Pferd jedes Mal mitbringen."}
                ],
                correctAnswer: "s2q3o2"
              },
              {
                id: "s2q4",
                type: "single",
                text: "Beim Horse-Ball-Spiel",
                options: [
                  {id: "s2q4o1", text: "wird ein Fu√üball verwendet."},
                  {id: "s2q4o2", text: "darf der Ball in die Hand genommen werden."},
                  {id: "s2q4o3", text: "darf der Ball nicht auf den Boden fallen."}
                ],
                correctAnswer: "s2q4o2"
              },
              {
                id: "s2q5", 
                type: "single",
                text: "Das Training ist so streng, dass",
                options: [
                  {id: "s2q5o1", text: "die Reiter often mehr Stress zu empfinden scheinen als die Tiere."},
                  {id: "s2q5o2", text: "die Tiere ihre naturgegebenen Anlagen nicht ausleben k√∂nnen."},
                  {id: "s2q5o3", text: "es Pferden und Reitern often kein Vergn√ºgen macht."}
                ],
                correctAnswer: "s2q5o1"
              }
            ]
          },
          { 
            id: "s3", 
            title: "Leseverstehen, Teil 3", 
            points: 25,
            passageTitle: "Aufgabe: Lesen Sie die zehn Situationen (11-20) und die zw√∂lf Texte (A-L). Welcher Text passt zu welcher Situation? Sie k√∂nnen jeden Text nur einmal verwenden. Manchmal passt kein Text. W√§hlen Sie dann 'x'.",
            passage: "",
            questions: [],
            texts: [
              {id: "A", text: "Ratgeber 'Was bei Erk√§ltung hilft' Erk√§ltungen geh√∂ren leider zum Leben. Sie kommen immer wieder wie Fr√ºhling, Sommer, Herbst und Winter. Jetzt ist wieder Erk√§ltungssaison. Hier sind einige wichtige Tipps. Bei Fieber: mindestens 2-3 Liter Tee oder Wasser pro Day trinken. Feuchte Wadenwickel k√∂nnen helfen. Ist das Fieber nach zwei Tagen nicht weg, unbedingt zum Arzt gehen. Bei Halsweh mit Salzwasser gurgeln (1 Glas Wasser ein Teel√∂ffel Salze) oder Salbeitee trinken.", correctAnswer: "13"},
              {id: "B", text: "Wir zeigen den kosten die Z√§hne! F√ºr alle, die noch viel vorhaben: Sichern Sie sich Top-Leistung zu Top-Konditionen! Genie√üen Sie den ma√ügeschneiderten privaten Versicherungsschutz f√ºr Z√§hne und die zuverl√§ssige Sicherheit der WORMSER. Da lohnt sich der Wechsel: bis zum 31.12. handeln und dauerhaft von Beitrags-Vorteil profitieren. Ein Leben lang! Mehr Informationen kostenfrei under 0700/4332000.", correctAnswer: null},
              {id: "C", text: "Kochen und waschen um 1900 lautet das Thema, wenn Anita Kr√§mer am kommenden Sonntag durch das Museum f√ºr Stadtgeschichte f√ºhrt. Wie wurde damals gekocht und gewaschen? Wie haben unsere Ur- Ur- Gro√üeltern damals gelebt? K√ºhlschrank, Mikrowelle und andere moderne Ger√§te gab es ja in jener Zeit noch nicht. Wie hat man Speisen haltbar gemacht? Wie wurde geb√ºgelt? Auf all diese Fragen hat Frau Kr√§mer eine Antwort. Auch Kinder sind herzlich willkommen. Sie werden auch erfahren, wie often Kinder damals gewaschen wurden. Wie sah es mit der Zahnpflege aus? Eine spannende und unterhaltsame Reise in die Zeit von vor 100 Jahren. Der Eintritt ist frei. Die F√ºhrung findet immer in Gruppen von 10 Personen ab 10 Uhr zu jeder vollen Stunde statt. Museum f√ºr Stadtgeschichte, Alte Waldstra√üe 11.", correctAnswer: "17"},
              {id: "D", text: "Lesen, was gesund macht Jetzt in der neuen Apotheken-Revue: - Ohrprobleme: endlich wieder gut h√∂ren!- Hautpflege: gut gesch√ºtzt durch jede Jahreszeit- Kampo: heilen mit traditioneller japanischer Medizin Diese und noch viele weitere interessante Themen rund um Ihre Gesundheit, plus R√§tselspa√ü und tollen Gewinnspiel. Alle 14 Tage neu in Ihrer Apotheke. Kostenlos!.", correctAnswer: ""},
              {id: "E", text: "Nachhilfe Wenn es um den Computer geht, wissen viele Kinder l√§ngst besser Bescheid als Erwachsene. Fast die H√§lfte (47%) der 10- bis 19-J√§hrigen, in deren Haushalt ein Computer steht, wird vom Vater, Mutter, aber auch von Oma und Opa um Rat gefragt. In der Heinrich-Mann-Schule geben computerbegeisterte Sch√ºler jetzt jeden Samstag von 10-12 Uhr sogar extra Nachhilfekurse f√ºr Erwachsene. Start ist am kommenden Samstag, der Sch√ºlerservice ist kostenlos! Interessierte Sch√ºlerinnen und Sch√ºler, die ihre Erfahrungen weitergeben m√∂chten, k√∂nnen auch gern vorbeikommen und mitmachen.", correctAnswer: "14"},
              {id: "F", text: "Vienna CONEKT Versichern Sie Ihr Auto ab 35 Cent am Tag. Sparen Sie zus√§tzlich mit dem Bonusprogramm und bleiben Sie flexibel: Sie k√∂nnen jederzeit monatlich k√ºndigen. Jetzt Beitrag direkt berechnen: vienna- conekt.de 018084-33556474 Mit der Vienna Conekt haben sie direkt mehr Vorteile: immer g√ºnstig, immer erreichbar (24-Stunden-Schaden-hotline), Ersatzwagengarantie!", correctAnswer: "20"},
              {id: "G", text: "Sofort-Versicherung Die Behandlung kommt vom Arzt. Die F√ºrsorge von ihnen. Die Finanzspritze von uns. Der umfassende Schutz bei Krankheit und Unfall. Auch liebe kann nicht verhindern, dass Ihr Haustier mal krank wird oder einen Unfall hat. Die dadurch notwendige Behandlung oder Operation kann schnell bis zu 1000 Euro kosten. Die neue care-securitas Tierschutzversicherung sch√ºtzt Sie vor diesem Risiko. K√ºmmern Sie sich also um Ihren vierbeinigen Patienten - wir k√ºmmern uns um die Kosten. Weitere Informationen under www.care-securitas.de.", correctAnswer: "19"},
              {id: "H", text: "Kindertheater: warum teilen schwer und betteln grausam ist Dass es viel einfacher ist, egoistisch zu sein als mitf√ºhlend, wei√ü fast jeder. Dass aber auch Menschen, die Hilfe brauchen, der egoistisch sein k√∂nnen, zeig das St√ºck 'Der gute Mensch von Sezuan' von Bertolt Brecht. Und er erz√§hlt es so, dass auch Kinder es verstehen k√∂nnen. Im Theater an der Parkaue wir das St√ºck am Sonntag um 14 Uhr in der Originalfassung gezeigt. Regisseurin Claudia Kipfel: 'Dieses St√ºck kann man so lassen, wie es ist. Kinder verstehen es sofort.' Karten: 0179-666453110, f√ºr Kinder ab 8 Jahren. Preise: 12 Euro, Kinder bis 12 Jahre: 7 Euro. ", correctAnswer: ""},
              {id: "I", text: "Omnitamol 500 Tabletten Wann nehmen Sie Omnitamol? Bei leichten bis m√§√üig starken Schmerzen. Bei Fieber und Erk√§ltungen. Wichtig: Nehmen Sie Omnitamol nur 3-4 Tage ein, danach gehen Sie bitte unbedingt zu Ihrem Arzt oder Zahnarzt, wenn ihre Beschwerden sich nicht gebessert haben. What ist bei Kindern zu ber√ºcksichtigen? Omnitamol 500 Tabletten sind nicht geeignet f√ºr Kinder under 6 Jahren. F√ºr Kinder bieten wir Ihnen gesonderte Pr√§parate an. Fragen Sie Ihren Arzt oder Apotheker. ", correctAnswer: "16"},
              {id: "J", text: "Neue Kleidung kann krank machen Das neue Hemd passt prima zu Lieblingsjeans. Warum also nicht gleich anziehen? Doch Vorsicht: Neue Textilien k√∂nnen Allergien und Hautreizungen ausl√∂sen, vor allem bei Kindern und Menschen mit empfindlicher Haut. Grund: Viele Textilien enthalten Farbstoffe oder andere Chemikalien. Tipp: neue Kleidungsst√ºcke vor dem ersten Tragen waschen. F√ºr Babys und Kleinkinder ist Second-Hand-Kleidung eine gute Alternative, da die Schadstoffe schon ausgewaschen sind.", correctAnswer: "11"},
              {id: "K", text: "Erk√§ltungszeit = Theaterzeit Zu einem hoffentlich husten- und schnupfenfreien Nachmittag f√ºr die ganze Familie l√§dt das Puppentheater Die Langohren am morgigen Sonntag um 15 Uhr ein. Das Ensemble um die professionelle Puppenspielerin Margit Hallmann spielt 'H√§tschi, kleine Anna' und verspricht ein Theatererlebnis f√ºr Erwachsene und Kinder ab 6 Jahren. Die Veranstaltung ist fast ausverkauft. Es gibt noch Restkarten. Tickets under Telefon (0564) 5404420", correctAnswer: "12"},
              {id: "L", text: "Zusatz-Versicherung Liebe Leserin, lieber Leser, gepflegte Z√§hne h√§ngen often von der finanziellen M√∂glichkeiten des Patienten ab. Mit der Krankenkasse alleine kommt often nicht weit. Mit der DENTAL VERSICHEUNG 100Plus von Warnst√§dtHyper verdoppeln Sie bei Zahnersatz den Zuschuss Ihrer gesetzlichen Krankenkasse. Keine Altersbegrenzung, g√ºnstige Monatsbeitr√§ge. Nutzen Sie noch heute diese wichtigen Vorteile. Rufen sie an: 069-780086753 oder informieren Sie sich im Internet under www.neue-zaehne.eu. Wir schicken Ihnen die Unterlagen zu.", correctAnswer: "15"}
            ],
            situations: [
              {id: "11", text: "Ein Kollege hat seit ein paar Tagen Hautprobleme und wei√ü nicht, was die Ursache sein k√∂nnte."},
              {id: "12", text: "Sie m√∂chten etwas mit ihrer 7-j√§hrigen Tochter Unternehmen."},
              {id: "13", text: "Ihre Bekannte hat Fieber, m√∂chte aber keine Tabletten nehmen."},
              {id: "14", text: "Das Ehepaar, das under Ihnen wohnt, m√∂chte etwas √ºber Computer lernen."},
              {id: "15", text: "Sie wollen Informationen √ºber eine Zahnversicherung, ohne telefonieren zu m√ºssen."},
              {id: "16", text: "Ihre Nachbarin ist seit einer Woche erk√§ltet. Nat√ºrliche Heilmittel haben nicht geholfen."},
              {id: "17", text: "Sie bekommen Besuch und m√∂chten am Sonntagvormittag etwas Interessantes Unternehmen."},
              {id: "18", text: "Ihre Freundin interessiert sich f√ºr japanische Medizin. Sie suchen als Geburtstagsgeschenk ein Buch zu diesem Thema."},
              {id: "19", text: "Sie haben ein Haustier, das im letzten Jahr viel Geld f√ºr den Tierarzt gekostet hat. Sie suchen eine M√∂glichkeit, Kosten zu sparen."},
              {id: "20", text: "Sie m√∂chten eine Versicherung f√ºr Ihren Neuwagen abschlie√üen und sofort wissen, was es kostet."}
            ]
          },
          { 
            id: "s4", 
            title: "Sprachbausteine, Teil 1", 
            points: 15,
            passageTitle: "Aufgabe: Erg√§nzen Sie den Text. W√§hlen Sie f√ºr jede L√ºcke das passende Wort.",
            passage: "",
            questions: [],
            fillBlanks: [
              {
                id: "21",
                options: ["dabei", "daraus", "davon"],
                correctAnswer: "davon"
              },
              {
                id: "22",
                options: ["denen", "die", "den"],
                correctAnswer: "denen"
              },
              {
                id: "23",
                options: ["an", "in", "durch"],
                correctAnswer: "an"
              },
              {
                id: "24",
                options: ["Jeder Mittwoch", "Mittwochs", "Zum Mittwoch"],
                correctAnswer: "Mittwochs"
              },
              {
                id: "25",
                options: ["jedem Kurs", "jeden Kurs", "jedes Kurses"],
                correctAnswer: "jedes Kurses"
              },
              {
                id: "26",
                options: ["der", "deren", "dessen"],
                correctAnswer: "dessen"
              },
              {
                id: "27",
                options: ["obwohl", "wobei", "wenn"],
                correctAnswer: "wenn"
              },
              {
                id: "28",
                options: ["Ihnen", "Sie", "Euch"],
                correctAnswer: "Ihnen"
              },
              {
                id: "29",
                options: ["hat", "ist", "wird"],
                correctAnswer: "ist"
              },
              {
                id: "30",
                options: ["eine Di√§t halten m√ºssen", "m√ºssen eine Di√§t halten", "m√ºssen halten eine Di√§t"],
                correctAnswer: "eine Di√§t halten m√ºssen"
              }
            ],
            fillText: `Sehr geehrte Frau Goronsksa,

vielen Dank f√ºr Ihre Anfrage vom 12. September bez√ºglich unserer Sprachurlaube in Deutschland und √ñsterreich. Unsere Organisation underh√§lt insgesamt zehn Schulen, acht ________ in Deutschland und zwei in √ñsterreich, an ________ Sie ausnahmslos sowohl Ihr Deutsch verbessern als auch an einem anspruchsvollen Kultur- und Freizeitprogramm teilnehmen k√∂nnen.

Der Sprachunterricht findet in der Regel ________ f√ºnf Tagen pro Woche statt, jeweils in der Zeit von 9 bis 13 und von 15 bis 17 Uhr. ________ ist kein Nachmittagsunterricht. Das Kursangebot umfasst alle Niveaustufen. Die Mindestdauer f√ºr einen Kurs betr√§gt zwei Wochen, Sie k√∂nnen jedoch auch four, six oder acht Wochen bleiben. Zu Beginn ________ wird ein Einstufungstest durchgef√ºhrt, mit ________ Hilfe wir herausfinden, welcher Kurs f√ºr Sie der geeignete ist. Nach Abschluss Ihres Aufenthaltes erhalten Sie eine Teilnahmebescheinigung. Selbstverst√§ndlich k√∂nnen Sie bei uns Tests auf allen Niveaustufen von A1 bis C1 ablegen und erhalten, ________ Sie den Test bestehen, ein international anerkanntes Zertifikat.

Hinsichtlich unseres Kultur- und Freizeitprogramms gibt es verschiedene Wahlm√∂glichkeiten, die ________ vor Ort angeboten werden. Dazu z√§hlen Ausfl√ºge in die n√§here Umgebung, Museums- und Theaterbesuche und vieles mehr.

Was die √úbernachtung am Kursort angeht, k√∂nnen Sie zwischen einer Unterbringung in einer Gastfamilie und der Unterkunft in einfachen Hotels w√§hlen. Im Unterkunftspreis ________ jeweils Halbpension eingeschlossen, das hei√üt Fr√ºhst√ºck und Mittagessen. Bitte teilen Sie uns mit, wenn Sie bestimmte Lebensmittel ausschlie√üen, z. B. vegetarisch essen oder ________. Alles Weitere entnehmen Sie bitte dem beiliegenden Katalog. Bei weiteren Fragen sind wir gerne f√ºr Sie da.

Mit freundlichen Gr√º√üen Natalie Spengler`
          },
          { 
            id: "s5", 
            title: "Sprachbausteine, Teil 2", 
            points: 15,
            passageTitle: "Aufgabe: Lesen Sie den Text und entscheiden Sie, welches Wort in welche L√ºcke passt. Sie k√∂nnen jedes Wort nur einmal verwenden. Nicht alle W√∂rter passen in den Text.",
            passage: "",
            questions: [],
            fillBlanks2: [
              {
                id: "31",
                options: ["AN", "AUS", "DARAUF", "DAS", "DASS", "DEM", "DENEN", "JETZT", "KEINE", "NICHT NUR", "SO DASS", "√úBRIGENS", "WAS", "WELCHE", "ZU"],
                correctAnswer: "WAS"
              },
              {
                id: "32", 
                options: ["AN", "AUS", "DARAUF", "DAS", "DASS", "DEM", "DENEN", "JETZT", "KEINE", "NICHT NUR", "SO DASS", "√úBRIGENS", "WAS", "WELCHE", "ZU"],
                correctAnswer: "JETZT"
              },
              {
                id: "33",
                options: ["AN", "AUS", "DARAUF", "DAS", "DASS", "DEM", "DENEN", "JETZT", "KEINE", "NICHT NUR", "SO DASS", "√úBRIGENS", "WAS", "WELCHE", "ZU"],
                correctAnswer: "AN"
              },
              {
                id: "34",
                options: ["AN", "AUS", "DARAUF", "DAS", "DASS", "DEM", "DENEN", "JETZT", "KEINE", "NICHT NUR", "SO DASS", "√úBRIGENS", "WAS", "WELCHE", "ZU"],
                correctAnswer: "AUS"
              },
              {
                id: "35",
                options: ["AN", "AUS", "DARAUF", "DAS", "DASS", "DEM", "DENEN", "JETZT", "KEINE", "NICHT NUR", "SO DASS", "√úBRIGENS", "WAS", "WELCHE", "ZU"],
                correctAnswer: "DARAUF"
              },
              {
                id: "36",
                options: ["AN", "AUS", "DARAUF", "DAS", "DASS", "DEM", "DENEN", "JETZT", "KEINE", "NICHT NUR", "SO DASS", "√úBRIGENS", "WAS", "WELCHE", "ZU"],
                correctAnswer: "SO DASS"
              },
              {
                id: "37",
                options: ["AN", "AUS", "DARAUF", "DAS", "DASS", "DEM", "DENEN", "JETZT", "KEINE", "NICHT NUR", "SO DASS", "√úBRIGENS", "WAS", "WELCHE", "ZU"],
                correctAnswer: "NICHT NUR"
              },
              {
                id: "38",
                options: ["AN", "AUS", "DARAUF", "DAS", "DASS", "DEM", "DENEN", "JETZT", "KEINE", "NICHT NUR", "SO DASS", "√úBRIGENS", "WAS", "WELCHE", "ZU"],
                correctAnswer: "DENEN"
              },
              {
                id: "39",
                options: ["AN", "AUS", "DARAUF", "DAS", "DASS", "DEM", "DENEN", "JETZT", "KEINE", "NICHT NUR", "SO DASS", "√úBRIGENS", "WAS", "WELCHE", "ZU"],
                correctAnswer: "DASS"
              },
              {
                id: "40",
                options: ["AN", "AUS", "DARAUF", "DAS", "DASS", "DEM", "DENEN", "JETZT", "KEINE", "NICHT NUR", "SO DASS", "√úBRIGENS", "WAS", "WELCHE", "ZU"],
                correctAnswer: "KEINE"
              }
            ],
            fillText2: `Der Hund als intelligentes Wesen

Hunde sind beliebte Begleiter vieler Menschen. Gerade in den Gro√üst√§dten Deutschlands und √ñsterreichs gibt es eine gro√üe Anzahl an Hundebesitzern, die das Tier als Freund, sometimes even als Helfer sch√§tzen. Bislang galt die Auffassung, Hunde seien zwar treu, aber ________ ihre Intelligenz betrifft, eher mit geringen Begabungen ausgestattet. Doch ________ haben wissenschaftliche Experimente ________ der Universit√§t Wien und am Max-Planck-Institut in Leipzig die Hundeehre gerettet und bewiesen: Der Hund ist ein au√üerordentlich intelligentes Lebewesen und kommt in einer Vielzahl von Strategien, die er anwendet, an menschliche Denkmuster durchaus heran.

Friederike Range von der Universit√§t Wien setzte ihren Hund vor einen Computer. Der Hund sollte ________ verschiedenen Bildern, von denen jeweils zwei auf dem Monitor zu sehen waren, das richtige ausw√§hlen und ________ entweder einen Menschen oder eine Landschaft erkennen. Der Monitor war mit einem Touchscreen ausgestattet, ________ der Hund mit der Schnauze auf das jeweils richtige Bild tippen konnte. Lag er richtig, bekam er ein St√ºck Trockenfutter als Belohnung, lag er falsch, wurde der Bildschirm kurz rot und zeigte gleich im Anschluss das n√§chste Bilderpaar.

Das Ergebnis war verbl√ºffing. Der Hund hing ________ mit einer √§hnlicher Begeisterung und Ausdauer am Bildschirm wir sometimes Jugendlicher an der Playstation, sondern er war auch bei seinen Entscheidungen √§u√üerst treffsicher. Die Leipziger Forscherin Juliane Kaminski setzte ihren Hund vor two Gef√§√üe, von ________ eins Futter enthielt, das andere nicht. Danach schaute sie in die Richtung des Beh√§lters, in dem das Fleischst√ºck lag. Der Hund beobachtete sie dabei und interpretierte die menschliche Mimik richtig.

Dasselbe Experiment mit dem gleichen Ergebnis mit Hundebabys wiederholt. Daraus schlie√üen die Forscher in Leipzig, ________ bestimmte Muster menschlicher Gestik und Mimik von den Hunden very treffsicher interpretiert werden k√∂nnen und diese F√§higkeiten bereits seit langem bei Hunden vorhanden sein m√ºssen. Man kann also mit Recht annehmen, dass die Interpretationsf√§higkeit menschlicher Mimik und Gestik bei den Hunden genetisch verankert ist.

√Ñhnliche Experimente mit W√∂lfen, die als die Vorfahren des Haushundes gelten, brachten ________ vergleichbaren Resultate. Ein weiterer Beweis also daf√ºr, dass der Hund diese F√§higkeiten gelernt und verinnerlicht haben muss.`
          }
        ]
      };

      /* ===== State & DOM refs ===== */
      let state = { 
        sectionIndex: 0, 
        questionIndex: 0, 
        answers: {}, 
        marked: {}, 
        remaining: exam.durationSec,
        showResults: false,
        timerStarted: false,
        timerInterval: null
      };
      const topTiles = document.getElementById('topTiles-lesen');
      const passageTitleEl = document.getElementById('passageTitle-lesen');
      const passageContentEl = document.getElementById('passageContent-lesen');
      const sectionNameEl = document.getElementById('sectionName-lesen');
      const questionTitleEl = document.getElementById('questionTitle-lesen');
      const questionBodyEl = document.getElementById('questionBody-lesen');
      const headingsBankContainer = document.getElementById('headingsBankContainer-lesen');
      const timerEl = document.getElementById('timer-lesen');
      const statusText = document.getElementById('statusText-lesen');
      const resultBtn = document.getElementById('resultBtn-lesen');
      const resetBtn = document.getElementById('resetBtn-lesen');
      const resetSectionBtn = document.getElementById('resetSectionBtn-lesen');

      /* ===== Timer Functions ===== */
      function startTimer(){
        if(state.timerInterval) {
          clearInterval(state.timerInterval);
        }
        
        state.timerStarted = true;
        state.timerInterval = setInterval(()=>{
          if(state.remaining <= 0){
            clearInterval(state.timerInterval);
            timerEl.textContent = 'Zeit abgelaufen';
            return;
          }
          state.remaining--;
          updateTimerDisplay();
        }, 1000);
      }

      function resetTimer(){
        if(state.timerInterval) {
          clearInterval(state.timerInterval);
        }
        state.remaining = exam.durationSec;
        state.timerStarted = false;
        updateTimerDisplay();
        startTimer();
      }

      function updateTimerDisplay(){
        const min = Math.floor(state.remaining / 60);
        const sec = state.remaining % 60;
        timerEl.textContent = `Verbleibende Zeit: ${min.toString().padStart(2, '0')}:${sec.toString().padStart(2, '0')}`;
      }

      /* ===== Reset Section Function ===== */
      function resetCurrentSection() {
        const currentSection = exam.sections[state.sectionIndex];
        
        if (confirm(`M√∂chten Sie wirklich den Teil "${currentSection.title}" zur√ºcksetzen? Alle Antworten in diesem Teil werden gel√∂scht.`)) {
          if (currentSection.id === 's1') {
            currentSection.texts.forEach(text => {
              delete state.answers[text.id];
            });
          } else if (currentSection.id === 's2') {
            currentSection.questions.forEach(question => {
              delete state.answers[question.id];
            });
          } else if (currentSection.id === 's3') {
            currentSection.situations.forEach(situation => {
              delete state.answers[situation.id];
            });
          } else if (currentSection.id === 's4') {
            currentSection.fillBlanks.forEach(blank => {
              delete state.answers[blank.id];
            });
          } else if (currentSection.id === 's5') {
            currentSection.fillBlanks2.forEach(blank => {
              delete state.answers[blank.id];
            });
          }
          
          renderAll();
        }
      }

      /* ===== Render ===== */
      function renderTopTiles(){ 
        topTiles.innerHTML=''; 
        exam.sections.forEach((sec,idx)=>{ 
          const div=document.createElement('div'); 
          div.className='tile'+(idx===state.sectionIndex?' active':'')+(isSectionDone(sec)?' done':''); 
          div.innerHTML=`<div>${sec.title}</div><div class="points">${sec.points} P</div>`; 
          div.onclick=()=>{state.sectionIndex=idx; state.questionIndex=0; state.showResults=false; renderAll();}; 
          topTiles.appendChild(div); 
        }); 
      }

      function isSectionDone(section){
        if(section.id==='s1') return section.texts.every(t=>state.answers[t.id]);
        if(section.id==='s2') return section.questions.every(q=>state.answers[q.id]);
        if(section.id==='s3') return section.situations.every(h=>state.answers[h.id] || state.answers[h.id] === 'X');
        if(section.id==='s4') return section.fillBlanks.every(b=>state.answers[b.id]);
        if(section.id==='s5') return section.fillBlanks2.every(b=>state.answers[b.id]);
        return false;
      }

      function renderAll(){
        renderTopTiles();
        const section = exam.sections[state.sectionIndex];
        sectionNameEl.textContent = section.title;
        passageTitleEl.textContent = section.passageTitle;
        
        resetSectionBtn.style.display = 'block';
        
        if(state.showResults){
          renderResults();
          return;
        }
        
        if(section.id === 's1'){
          renderPart1();
        } else if(section.id === 's2'){
          renderPart2();
        } else if(section.id === 's3'){
          renderPart3();
        } else if(section.id === 's4'){
          renderSprachbausteine1();
        } else if(section.id === 's5'){
          renderSprachbausteine2();
        }
      }

      function renderPart1(){
        const section = exam.sections[state.sectionIndex];
        
        let textsHTML = `<div class="instructions">Ziehen Sie die passenden √úberschriften auf die Texte. Sie k√∂nnen jede √úberschrift nur einmal verwenden.</div>`;
        
        section.texts.forEach((text, idx) => {
          const letter = String.fromCharCode(97 + idx);
          const selectedHeading = state.answers[text.id];
          
          textsHTML += `
            <div class="text-container">
              <div class="text-title">Text ${letter.toUpperCase()}</div>
              <div class="text-content">${text.content}</div>
              <div class="title-slot ${selectedHeading ? 'has-title' : ''}" data-text-id="${text.id}">
                ${selectedHeading ? getHeadingTextById(selectedHeading) : 'Ziehen Sie hier eine √úberschrift hin'}
              </div>
            </div>
          `;
        });
        
        passageContentEl.innerHTML = textsHTML;
        
        let headingsHTML = `<div class="headings-bank">`;
        section.headings.forEach(heading => {
          const isUsed = section.texts.some(text => state.answers[text.id] === heading.id);
          
          headingsHTML += `
            <div class="heading-item ${isUsed ? 'used' : ''}" draggable="${!isUsed}" data-heading-id="${heading.id}">
              ${heading.id}) ${heading.text}
            </div>
          `;
        });
        
        headingsHTML += `</div>`;
        
        headingsBankContainer.innerHTML = headingsHTML;
        
        setupDragAndDrop();
        
        questionBodyEl.innerHTML = '';
        questionTitleEl.textContent = '';
      }

      function getHeadingTextById(id){
        const section = exam.sections[state.sectionIndex];
        const heading = section.headings.find(h => h.id === id);
        return heading ? `${heading.id}) ${heading.text}` : '';
      }

      function setupDragAndDrop(){
        const headingItems = document.querySelectorAll('.heading-item:not(.used)');
        const titleSlots = document.querySelectorAll('.title-slot');
        
        headingItems.forEach(item => {
          item.addEventListener('dragstart', (e) => {
            e.dataTransfer.setData('text/plain', e.target.dataset.headingId);
          });
        });
        
        titleSlots.forEach(slot => {
          slot.addEventListener('dragover', (e) => {
            e.preventDefault();
            slot.style.background = '#e8f4ff';
          });
          
          slot.addEventListener('dragleave', (e) => {
            slot.style.background = slot.classList.contains('has-title') ? '#e8fbe9' : '#f8fbff';
          });
          
          slot.addEventListener('drop', (e) => {
            e.preventDefault();
            const headingId = e.dataTransfer.getData('text/plain');
            const textId = slot.dataset.textId;
            
            Object.keys(state.answers).forEach(key => {
              if(state.answers[key] === headingId) {
                delete state.answers[key];
              }
            });
            
            state.answers[textId] = headingId;
            renderAll();
          });
        });
      }

      function renderPart2(){
        const section = exam.sections[state.sectionIndex];
        
        passageContentEl.innerHTML = `<div class="passage">${section.passage}</div>`;
        
        let questionsHTML = `<div class="all-questions">`;
        
        section.questions.forEach((question, idx) => {
          const questionNumber = idx + 1;
          const userAnswer = state.answers[question.id];
          
          questionsHTML += `
            <div class="question-block">
              <div class="question-text">${questionNumber}. ${question.text}</div>
              <div class="options">
                ${question.options.map(opt => `
                  <div class="option ${userAnswer === opt.id ? 'selected' : ''}" 
                       onclick="window.lesenApp.selectOption('${question.id}', '${opt.id}')">
                    <div class="radio"></div>
                    <div>${opt.text}</div>
                  </div>
                `).join('')}
              </div>
            </div>
          `;
        });
        
        questionsHTML += `</div>`;
        
        questionBodyEl.innerHTML = questionsHTML;
        questionTitleEl.textContent = '';
        headingsBankContainer.innerHTML = '';
      }

      function renderPart3(){
        const section = exam.sections[state.sectionIndex];
        
        let textsHTML = `
          <div class="instructions">Ziehen Sie die passenden Situationen auf die Texte. Sie k√∂nnen jede Situation nur einmal verwenden. Manchmal passt keine Situation.</div>
          <div class="texts-list">
            <h3>Texte (A-L)</h3>
        `;
        
        section.texts.forEach(text => {
          const userAnswer = Object.keys(state.answers).find(key => state.answers[key] === text.id);
          const selectedSituation = userAnswer ? section.situations.find(h => h.id === userAnswer) : null;
          
          textsHTML += `
            <div class="text-item" data-text-id="${text.id}">
              <div class="text-letter">${text.id})</div>
              <div class="text-content">${text.text}</div>
              <div class="title-slot ${userAnswer ? 'has-title' : ''} ${userAnswer === 'X' ? 'has-x' : ''}" data-text-id="${text.id}">
                ${selectedSituation ? selectedSituation.text : (userAnswer === 'X' ? 'X - Keine passende Situation' : 'Ziehen Sie hier eine Situation hin')}
              </div>
            </div>
          `;
        });
        
        textsHTML += `</div>`;
        
        passageContentEl.innerHTML = textsHTML;
        
        let situationsHTML = `
          <div class="situations-list">
            <h3>Situationen (11-20)</h3>
        `;
        
        section.situations.forEach((situation, idx) => {
          const situationNumber = parseInt(situation.id);
          const isUsed = state.answers[situation.id];
          const isX = state.answers[situation.id] === 'X';
          
          situationsHTML += `
            <div class="situation-item ${isUsed ? 'used' : ''}" draggable="${!isUsed}" data-situation-id="${situation.id}">
              <div class="situation-number">${situationNumber}.</div>
              <div class="situation-text">${situation.text}</div>
              ${!isUsed ? `<button class="exam-btn no-match ${isX ? 'selected' : ''}" onclick="window.lesenApp.markNoMatch('${situation.id}')">X - Kein passender Text</button>` : ''}
            </div>
          `;
        });
        
        situationsHTML += `</div>`;
        
        questionBodyEl.innerHTML = situationsHTML;
        questionTitleEl.textContent = '';
        headingsBankContainer.innerHTML = '';
        
        setupPart3DragAndDrop();
      }

      function markNoMatch(situationId) {
        Object.keys(state.answers).forEach(key => {
          if(state.answers[key] === situationId) {
            delete state.answers[key];
          }
        });
        
        state.answers[situationId] = 'X';
        try{ localStorage.setItem('lesenAnswers', JSON.stringify(state.answers)); }catch(e){}
        
        renderAll();
      }

      function setupPart3DragAndDrop(){
        const situationItems = document.querySelectorAll('.situation-item:not(.used)');
        const textSlots = document.querySelectorAll('.text-item .title-slot');
        
        situationItems.forEach(item => {
          item.addEventListener('dragstart', (e) => {
            e.dataTransfer.setData('text/plain', e.target.dataset.situationId);
          });
        });
        
        textSlots.forEach(slot => {
          slot.addEventListener('dragover', (e) => {
            e.preventDefault();
            slot.style.background = '#e8f4ff';
          });
          
          slot.addEventListener('dragleave', (e) => {
            const hasTitle = slot.classList.contains('has-title');
            const hasX = slot.classList.contains('has-x');
            slot.style.background = hasTitle ? '#e8fbe9' : (hasX ? '#f8d7da' : '#f8fbff');
          });
          
          slot.addEventListener('drop', (e) => {
            e.preventDefault();
            const situationId = e.dataTransfer.getData('text/plain');
            const textId = slot.dataset.textId;
            
            Object.keys(state.answers).forEach(key => {
              if(state.answers[key] === situationId) {
                delete state.answers[key];
              }
            });
            
            state.answers[situationId] = textId;
            renderAll();
          });
        });
      }

      function renderSprachbausteine1(){
        const section = exam.sections[state.sectionIndex];
        
        let textWithBlanks = section.fillText;
        
        const blankPlaceholders = [];
        section.fillBlanks.forEach(blank => {
          blankPlaceholders.push(`BLANK_${blank.id}`);
        });
        
        let tempText = textWithBlanks;
        blankPlaceholders.forEach((placeholder, index) => {
          tempText = tempText.replace('________', placeholder);
        });
        
        section.fillBlanks.forEach(blank => {
          const userAnswer = state.answers[blank.id];
          const displayText = userAnswer ? userAnswer : '________';
          tempText = tempText.replace(`BLANK_${blank.id}`, `<span class="blank-word ${userAnswer ? 'has-answer' : ''}" data-blank-id="${blank.id}">${displayText}</span>`);
        });
        
        passageContentEl.innerHTML = `
          <div class="instructions">Klicken Sie auf jede L√ºcke und w√§hlen Sie das passende Wort aus. Sie k√∂nnen die L√ºcken in beliebiger Reihenfolge ausf√ºllen.</div>
          <div class="fill-blank-container">${tempText}</div>
        `;
        
        document.querySelectorAll('.blank-word').forEach(blank => {
          blank.addEventListener('click', (e) => {
            showOptionsPopup(e.target);
          });
        });
        
        let optionsHTML = `<div class="horizontal-options" style="gap: 8px;">`;
        
        section.fillBlanks.forEach(blank => {
          const userAnswer = state.answers[blank.id];
          
          optionsHTML += `
            <div class="option-row" style="padding: 8px; margin-bottom: 5px;">
              <div class="option-number">${blank.id}</div>
              <div class="option-buttons">
                ${blank.options.map(opt => `
                  <div class="option-btn ${userAnswer === opt ? 'selected' : ''}" 
                       onclick="window.lesenApp.selectSprachbausteine1('${blank.id}', '${opt}')" 
                       style="padding: 6px 12px; font-size: 12px;">
                    ${opt}
                  </div>
                `).join('')}
              </div>
            </div>
          `;
        });
        
        optionsHTML += `</div>`;
        
        questionBodyEl.innerHTML = optionsHTML;
        questionTitleEl.textContent = '';
        headingsBankContainer.innerHTML = '';
      }

      function showOptionsPopup(blankElement){
        const existingPopup = document.querySelector('.options-popup');
        if(existingPopup) {
          existingPopup.remove();
        }
        
        const blankId = blankElement.getAttribute('data-blank-id');
        const section = exam.sections.find(s => s.id === 's4');
        const blank = section.fillBlanks.find(b => b.id === blankId);
        
        if(!blank) return;
        
        const popup = document.createElement('div');
        popup.className = 'options-popup';
        
        blank.options.forEach(opt => {
          const optionItem = document.createElement('div');
          optionItem.className = 'option-item';
          optionItem.textContent = opt;
          optionItem.onclick = () => {
            selectSprachbausteine1(blankId, opt);
            popup.remove();
          };
          popup.appendChild(optionItem);
        });
        
        blankElement.appendChild(popup);
      }

      function selectSprachbausteine1(blankId, answer){
        state.answers[blankId] = answer;
        renderAll();
      }

      function renderSprachbausteine2(){
        const section = exam.sections[state.sectionIndex];
        // Build text but replace blanks with unique placeholders first (prevents ambiguous replacements)
        let textWithPlaceholders = section.fillText2;
        const placeholders = [];
        section.fillBlanks2.forEach(blank => {
          const ph = `BLANK_${blank.id}`;
          placeholders.push({id: blank.id, ph});
          // replace first occurrence of the visual underline with placeholder
          textWithPlaceholders = textWithPlaceholders.replace('________', ph);
        });

        // Now replace placeholders with actual span elements showing current answer (or underscore)
        placeholders.forEach(item => {
          const userAnswer = state.answers[item.id];
          const displayText = userAnswer ? userAnswer : '________';
          const span = `<span class="blank-slot ${userAnswer ? 'has-answer' : ''}" data-blank-id="${item.id}">${displayText}</span>`;
          textWithPlaceholders = textWithPlaceholders.replace(item.ph, span);
        });

        passageContentEl.innerHTML = `
          <div class="instructions">Klicken Sie auf jede L√ºcke und w√§hlen Sie das passende Wort aus. Sie k√∂nnen jedes Wort nur einmal verwenden.</div>
          <div class="fill-blank-container">${textWithPlaceholders}</div>
        `;

        // attach click handlers to slots
        document.querySelectorAll('.blank-slot').forEach(slot => {
          slot.addEventListener('click', (e) => {
            // use the element itself to open popup
            showSprachbausteine2Options(slot);
          });
        });

        // Build word bank on the right
        let wordBankHTML = `<div class="word-bank-vertical" style="gap: 8px;">`;
        const usedWords = Object.values(state.answers);
        // Use section.wordBank if present, otherwise derive from fillBlanks2 options
        const bank = section.fillBlanks2[0] ? section.fillBlanks2[0].options : [];
        bank.forEach(word => {
          const isUsed = usedWords.includes(word);
          wordBankHTML += `
            <div class="bank-word-vertical ${isUsed ? 'used' : ''}" 
                 draggable="${!isUsed}" 
                 data-word="${word}"
                 ${!isUsed ? `onclick="window.lesenApp.selectSprachbausteine2FromBank('${word}')"` : ''}>
              ${word}
            </div>
          `;
        });
        wordBankHTML += `</div>`;
        questionBodyEl.innerHTML = wordBankHTML;
        questionTitleEl.textContent = '';
        headingsBankContainer.innerHTML = '';

        setupSprachbausteine2DragAndDrop();
      }

      // --- Added functions to handle drag/drop and clicks for Sprachbausteine Teil 2 ---
      let lastClickedSprachSlot = null;

      function setupSprachbausteine2DragAndDrop(){
        // bank words: make draggable if not used, attach dragstart
        const bankWords = Array.from(document.querySelectorAll('.bank-word-vertical'));
        bankWords.forEach(el => {
          const word = el.dataset.word;
          if(!el.classList.contains('used')){
            el.setAttribute('draggable','true');
          } else {
            el.setAttribute('draggable','false');
          }
          // ensure single attached listener
          el.removeEventListener('dragstart', el._dstart);
          el._dstart = (e) => {
            e.dataTransfer.setData('text/plain', word);
            // also set an indicator
            e.dataTransfer.setData('source', 'bank');
          };
          el.addEventListener('dragstart', el._dstart);

          // keep onclick behavior (select into clicked slot)
          el.removeEventListener('click', el._onclick);
          el._onclick = () => {
            if(el.classList.contains('used')) return;
            selectSprachbausteine2FromBank(word);
          };
          el.addEventListener('click', el._onclick);
        });

        // blank slots: allow drop
        const slots = Array.from(document.querySelectorAll('.blank-slot'));
        slots.forEach(slot => {
          slot.addEventListener('dragover', (e) => {
            e.preventDefault();
            slot.classList.add('drag-over');
          });
          slot.addEventListener('dragleave', (e) => {
            slot.classList.remove('drag-over');
          });
          slot.addEventListener('drop', (e) => {
            e.preventDefault();
            slot.classList.remove('drag-over');
            const word = e.dataTransfer.getData('text/plain') || e.dataTransfer.getData('text/html');
            if(!word) return;
            // Determine blank id
            const blankId = slot.dataset.blankId;
            if(!blankId) return;
            // If this word is already used in another slot, free it
            Object.keys(state.answers).forEach(k => {
              if(state.answers[k] === word){
                delete state.answers[k];
              }
            });
            // If slot had a previous answer, free that bank word
            const prev = state.answers[blankId];
            if(prev){
              const prevEl = Array.from(document.querySelectorAll('.bank-word-vertical')).find(b=>b.dataset.word === prev);
              if(prevEl){
                prevEl.classList.remove('used');
                prevEl.setAttribute('draggable','true');
                prevEl.addEventListener('click', prevEl._onclick);
              }
            }
            // mark bank word used
            const bankEl = Array.from(document.querySelectorAll('.bank-word-vertical')).find(b=>b.dataset.word === word);
            if(bankEl){
              bankEl.classList.add('used');
              bankEl.setAttribute('draggable','false');
              // remove click to prevent double-placing
              bankEl.removeEventListener('click', bankEl._onclick);
            }
            // assign to state and re-render
            state.answers[blankId] = word;
            renderAll();
          });
        });
      }

      function showSprachbausteine2Options(slot){
        // highlight selected slot so click from bank knows target
        document.querySelectorAll('.blank-slot').forEach(s => s.classList.remove('selected-sprach'));
        slot.classList.add('selected-sprach');
        lastClickedSprachSlot = slot;
      }

      function selectSprachbausteine2FromBank(word){
        // choose target slot: prefer lastClicked, otherwise first empty
        let slot = lastClickedSprachSlot;
        if(!slot){
          slot = Array.from(document.querySelectorAll('.blank-slot')).find(s => {
            const id = s.dataset.blankId;
            return !state.answers[id];
          });
        }
        if(!slot) {
          // if none available, do nothing
          return;
        }
        const blankId = slot.dataset.blankId;
        // free previous occurrence of word
        Object.keys(state.answers).forEach(k => {
          if(state.answers[k] === word){
            delete state.answers[k];
          }
        });
        // free previous word in target slot
        const prev = state.answers[blankId];
        if(prev){
          const prevEl = Array.from(document.querySelectorAll('.bank-word-vertical')).find(b=>b.dataset.word === prev);
          if(prevEl){
            prevEl.classList.remove('used');
            prevEl.setAttribute('draggable','true');
            if(prevEl._onclick) prevEl.addEventListener('click', prevEl._onclick);
          }
        }
        // mark selected bank word as used
        const bankEl = Array.from(document.querySelectorAll('.bank-word-vertical')).find(b=>b.dataset.word === word);
        if(bankEl){
          bankEl.classList.add('used');
          bankEl.setAttribute('draggable','false');
          if(bankEl._onclick) try{ bankEl.removeEventListener('click', bankEl._onclick); }catch(e){}
        }
        // assign value
        state.answers[blankId] = word;
        try{ localStorage.setItem('lesenAnswers', JSON.stringify(state.answers)); }catch(e){}
        
        lastClickedSprachSlot = null;
        renderAll();
      }

      function selectOption(questionId, optionId){
        state.answers[questionId] = optionId;
        try{ localStorage.setItem('lesenAnswers', JSON.stringify(state.answers)); }catch(e){}
        
        renderAll();
      }

      function renderResults(){
        let resultsHTML = `<h2>Ergebnisse</h2>`;
        let totalCorrect = 0;
        let totalQuestions = 0;
        
        exam.sections.forEach(section => {
          resultsHTML += `<div class="result-item"><h3>${section.title}</h3>`;
          
          if(section.id === 's1'){
            section.texts.forEach(text => {
              totalQuestions++;
              const userAnswer = state.answers[text.id];
              const isCorrect = userAnswer === text.correctAnswer;
              if(isCorrect) totalCorrect++;
              
              resultsHTML += `
                <div>Text ${text.id}: ${userAnswer || '-'} 
                ${userAnswer ? `<span class="${isCorrect ? 'result-correct' : 'result-incorrect'}">${isCorrect ? '‚úì' : '‚úó'}</span>` : ''}
                </div>
              `;
            });
          } else if(section.id === 's2'){
            section.questions.forEach(question => {
              totalQuestions++;
              const userAnswer = state.answers[question.id];
              const isCorrect = userAnswer === question.correctAnswer;
              if(isCorrect) totalCorrect++;
              
              resultsHTML += `
                <div>${question.text}: ${userAnswer || '-'} 
                ${userAnswer ? `<span class="${isCorrect ? 'result-correct' : 'result-incorrect'}">${isCorrect ? '‚úì' : '‚úó'}</span>` : ''}
                </div>
              `;
            });
          } else if(section.id === 's3'){
            section.situations.forEach(situation => {
              totalQuestions++;
              const userAnswer = state.answers[situation.id];
              const correctText = section.texts.find(t => t.correctAnswer === situation.id);
              const isCorrect = userAnswer === (correctText ? correctText.id : null);
              if(isCorrect) totalCorrect++;
              
              resultsHTML += `
                <div>Situation ${situation.id}: ${userAnswer || '-'} 
                ${userAnswer ? `<span class="${isCorrect ? 'result-correct' : 'result-incorrect'}">${isCorrect ? '‚úì' : '‚úó'}</span>` : ''}
                </div>
              `;
            });
          } else if(section.id === 's4'){
            section.fillBlanks.forEach(blank => {
              totalQuestions++;
              const userAnswer = state.answers[blank.id];
              const isCorrect = userAnswer === blank.correctAnswer;
              if(isCorrect) totalCorrect++;
              
              resultsHTML += `
                <div>L√ºcke ${blank.id}: ${userAnswer || '-'} 
                ${userAnswer ? `<span class="${isCorrect ? 'result-correct' : 'result-incorrect'}">${isCorrect ? '‚úì' : '‚úó'}</span>` : ''}
                </div>
              `;
            });
          } else if(section.id === 's5'){
            section.fillBlanks2.forEach(blank => {
              totalQuestions++;
              const userAnswer = state.answers[blank.id];
              const isCorrect = userAnswer === blank.correctAnswer;
              if(isCorrect) totalCorrect++;
              
              resultsHTML += `
                <div>L√ºcke ${blank.id}: ${userAnswer || '-'} 
                ${userAnswer ? `<span class="${isCorrect ? 'result-correct' : 'result-incorrect'}">${isCorrect ? '‚úì' : '‚úó'}</span>` : ''}
                </div>
              `;
            });
          }
          
          resultsHTML += `</div>`;
        });
        
        const percentage = totalQuestions > 0 ? Math.round((totalCorrect / totalQuestions) * 100) : 0;
        resultsHTML += `<div class="result-item"><h3>Gesamtergebnis: ${totalCorrect}/${totalQuestions} (${percentage}%)</h3></div>`;
        
        passageContentEl.innerHTML = resultsHTML;
        questionBodyEl.innerHTML = '';
        sectionNameEl.textContent = 'Ergebnisse';
        questionTitleEl.textContent = '';
      }

      /* ===== Event Listeners ===== */
      document.getElementById('prevBtn-lesen').addEventListener('click', ()=>{
        if(state.sectionIndex > 0){
          state.sectionIndex--;
          state.questionIndex = 0;
          renderAll();
        }
      });

      document.getElementById('nextBtn-lesen').addEventListener('click', ()=>{
        if(state.sectionIndex < exam.sections.length - 1){
          state.sectionIndex++;
          state.questionIndex = 0;
          renderAll();
        }
      });

      resultBtn.addEventListener('click', ()=>{
        state.showResults = !state.showResults;
        renderAll();
      });

      resetBtn.addEventListener('click', ()=>{
        if(confirm('M√∂chten Sie wirklich von neu beginnen? Alle Antworten werden gel√∂scht.')){
          state.answers = {};
          state.marked = {};
          state.showResults = false;
          resetTimer();
          renderAll();
        }
      });

      resetSectionBtn.addEventListener('click', resetCurrentSection);

      document.getElementById('saveBtn-lesen').addEventListener('click', ()=>{
        statusText.textContent = 'Gespeichert';
        setTimeout(()=>{statusText.textContent = 'Nicht gespeichert'}, 2000);
      });

      document.getElementById('submitBtn-lesen').addEventListener('click', ()=>{
        if(confirm('M√∂chten Sie die Pr√ºfung wirklich abgeben?')){
          state.showResults = true;
          renderAll();
        }
      });

      document.getElementById('nextBtn-lesen').addEventListener('click', ()=>{
        showPage('hoeren-page');
      });

      /* ===== Initialize ===== */
      updateTimerDisplay();
      renderAll();
      startTimer();
      
      // Expose functions to global scope for event handlers
      window._lesenState = state;
      window.lesenApp = {
        selectOption,
        markNoMatch,
        selectSprachbausteine1,
        selectSprachbausteine2FromBank
      };
    }

    // ===== H√ñREN PAGE FUNCTIONALITY =====
    function initHoerenPage() {
      /* ===== Self-contained exam (embedded) ===== */
      const exam = {
        id: "exam-h√∂rverstehen",
        durationSec: 17 * 60, // 17 minutes in seconds
        sections: [
          { 
            id: "h√∂rverstehen1", 
            title: "H√∂rverstehen, Teil 1", 
            points: 25,
            correctAnswers: { "41": "richtig", "42": "falsch", "43": "falsch", "44": "richtig", "45": "falsch" },
            questions: [
              {
                id: "41",
                text: "Wegen Unwettersch√§den wurden Urlauber in einer Notunterkunft untergebracht."
              },
              {
                id: "42", 
                text: "S√§mtliche Waren der Firma Mirella wurden aus den L√§den entfernt."
              },
              {
                id: "43",
                text: "Das Arbeitsplatzangebot in der Bundesrepublik hat einen Tiefstand erreicht."
              },
              {
                id: "44",
                text: "Am 21. Mai ist der Besuch der Sonderausstellung kostenlos."
              },
              {
                id: "45",
                text: "Entlaufene Tiere verursachten einen Unfall auf der Autobahn."
              }
            ]
          },
          { 
            id: "h√∂rverstehen2", 
            title: "H√∂rverstehen, Teil 2", 
            points: 25,
            correctAnswers: { "46": "richtig", "47": "falsch", "48": "richtig", "49": "richtig", "50": "falsch", "51": "falsch", "52": "falsch", "53": "richtig", "54": "falsch", "55": "falsch" },
            questions: [
              {
                id: "46",
                text: "Nadine Wagner ist gerade erst von ihrer Weltreise zur√ºckgekehrt."
              },
              {
                id: "47",
                text: "Sie hatte vor der Weltreise einige Zweifel und Bedenken."
              },
              {
                id: "48", 
                text: "Die Journalistin ist w√§hrend ihrer Reise auch geflogen."
              },
              {
                id: "49",
                text: "Sie hat f√ºr dieses Abenteuer ihre Stelle gek√ºndigt."
              },
              {
                id: "50",
                text: "Ihre Freunde waren unterschiedlicher Meinung √ºber ihr Vorhaben."
              },
              {
                id: "51",
                text: "In Tadschikistan hat sie eine Zeit lang andere Motorradfahrer begleitet."
              },
              {
                id: "52",
                text: "Sie hat auf der Reise ihr ganzes Erspartes aufgebraucht."
              },
              {
                id: "53",
                text: "Nadine Wagner hat auf der Reise gelegentlich gearbeitet."
              },
              {
                id: "54",
                text: "Sie hat am meisten ihre eigene Wohnung vermisst."
              },
              {
                id: "55",
                text: "Nach ihrer R√ºckkehr musste sie nicht lange nach einer neuen Arbeit suchen."
              }
            ]
          },
          { 
            id: "h√∂rverstehen3", 
            title: "H√∂rverstehen, Teil 3", 
            points: 25,
            correctAnswers: { "56": "richtig", "57": "falsch", "58": "falsch", "59": "richtig", "60": "falsch" },
            questions: [
              {
                id: "56",
                text: "Morgen muss man im S√ºden Deutschlands mit Schnee rechnen."
              },
              {
                id: "57",
                text: "Die zwei Jungen sind von zu Hause weggelaufen."
              },
              {
                id: "58",
                text: "Am Samstag k√∂nnen Sie einen Mitarbeiter der Firma anrufen."
              },
              {
                id: "59",
                text: "Wegen einer Demonstration ist es verboten, in die N√ºrnberger Altstadt zu fahren."
              },
              {
                id: "60",
                text: "Die historische elektrische Eisenbahn wird im Dezember wie gewohnt fahren."
              }
            ]
          }
        ]
      };

      /* ===== State & DOM refs ===== */
      let state = { 
        sectionIndex: 0, 
        answers: {}, 
        remaining: exam.durationSec,
        showResults: false,
        timerStarted: false,
        timerInterval: null
      };
      
      const topTiles = document.getElementById('topTiles-hoeren');
      const contentContainer = document.getElementById('contentContainer-hoeren');
      const timerEl = document.getElementById('timer-hoeren');
      const statusText = document.getElementById('statusText-hoeren');

      /* ===== Timer Functions ===== */
      function startTimer() {
        if (state.timerInterval) {
          clearInterval(state.timerInterval);
        }
        
        state.timerStarted = true;
        state.timerInterval = setInterval(() => {
          if (state.remaining <= 0) {
            clearInterval(state.timerInterval);
            timerEl.textContent = 'Zeit abgelaufen';
            return;
          }
          state.remaining--;
          updateTimerDisplay();
        }, 1000);
      }

      function resetTimer() {
        if (state.timerInterval) {
          clearInterval(state.timerInterval);
        }
        state.remaining = exam.durationSec;
        state.timerStarted = false;
        updateTimerDisplay();
        startTimer();
      }

      function updateTimerDisplay() {
        const min = Math.floor(state.remaining / 60);
        const sec = state.remaining % 60;
        timerEl.textContent = `Verbleibende Zeit: ${min.toString().padStart(2, '0')}:${sec.toString().padStart(2, '0')}`;
      }

      /* ===== Render ===== */
      function renderTopTiles() { 
        topTiles.innerHTML = ''; 
        exam.sections.forEach((sec, idx) => { 
          const div = document.createElement('div'); 
          div.className = 'tile' + (idx === state.sectionIndex ? ' active' : '') + (isSectionDone(sec) ? ' done' : ''); 
          div.innerHTML = `<div>${sec.title}</div><div class="points">${sec.points} P</div>`; 
          div.onclick = () => { state.sectionIndex = idx; state.showResults = false; renderAll(); }; 
          topTiles.appendChild(div); 
        }); 
      }

      function isSectionDone(section) {
        const answers = state.answers[section.id];
        if (!answers) return false;
        
        // ÿ™ÿ≠ŸÇŸÇ ÿ•ÿ∞ÿß ÿ™ŸÖÿ™ ÿßŸÑÿ•ÿ¨ÿßÿ®ÿ© ÿπŸÑŸâ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ© ŸÅŸä Ÿáÿ∞ÿß ÿßŸÑŸÇÿ≥ŸÖ
        const answeredQuestions = Object.keys(answers).length;
        const totalQuestions = section.questions.length;
        
        return answeredQuestions === totalQuestions;
      }

      function renderAll() {
        renderTopTiles();
        
        if (state.showResults) {
          renderResults();
          return;
        }
        
        renderListeningSection();
      }

      function renderListeningSection() {
        const section = exam.sections[state.sectionIndex];
        const currentAnswers = state.answers[section.id] || {};
        
        let contentHTML = `
          <div class="panel-title">${section.title}</div>
          <div class="instructions">
            Sie h√∂ren die Nachrichten. Entscheiden Sie beim H√∂ren, ob die Aussagen richtig oder falsch sind. 
            Sie h√∂ren die Nachrichten nur einmal. Sie haben jetzt 30 Sekunden, um die Aussagen zu lesen.
          </div>
          
          <div class="listening-task">
            <table class="true-false-table">
              <thead>
                <tr>
                  <th style="width: 10%">Nr.</th>
                  <th style="width: 60%">Aussage</th>
                  <th style="width: 30%">Ihre Antwort</th>
                </tr>
              </thead>
              <tbody>
        `;
        
        section.questions.forEach((question, index) => {
          const currentAnswer = currentAnswers[question.id] || '';
          contentHTML += `
            <tr>
              <td><strong>${question.id}</strong></td>
              <td class="question-text">${question.text}</td>
              <td>
                <div class="answer-options">
                  <label class="answer-option">
                    <input 
                      type="radio" 
                      name="q${section.id}_${question.id}" 
                      value="richtig" 
                      ${currentAnswer === 'richtig' ? 'checked' : ''}
                      onchange="window.hoerenApp.updateListeningAnswer('${section.id}', '${question.id}', this.value)"
                    >
                    Richtig
                  </label>
                  <label class="answer-option">
                    <input 
                      type="radio" 
                      name="q${section.id}_${question.id}" 
                      value="falsch" 
                      ${currentAnswer === 'falsch' ? 'checked' : ''}
                      onchange="window.hoerenApp.updateListeningAnswer('${section.id}', '${question.id}', this.value)"
                    >
                    Falsch
                  </label>
                </div>
              </td>
            </tr>
          `;
        });
        
        contentHTML += `
              </tbody>
            </table>
          </div>
        `;
        
        contentContainer.innerHTML = contentHTML;
      }

      function updateListeningAnswer(sectionId, questionId, answer) {
        if (!state.answers[sectionId]) {
          state.answers[sectionId] = {};
        }
        state.answers[sectionId][questionId] = answer;
        try{ localStorage.setItem('hoerenAnswers', JSON.stringify(state.answers)); }catch(e){}
        
        
        // ÿ•ÿπÿßÿØÿ© ÿπÿ±ÿ∂ ÿßŸÑÿ®ŸÑÿßÿ∑ÿßÿ™ ŸÑÿ™ÿ≠ÿØŸäÿ´ ÿ≠ÿßŸÑÿ© "ÿ™ŸÖ"
        renderTopTiles();
      }

      function renderResults() {
        let resultsHTML = `<div class="panel-title">Ergebnisse - H√∂rverstehen</div>`;
        
        exam.sections.forEach(section => {
          const userAnswers = state.answers[section.id] || {};
          let correctCount = 0;
          
          resultsHTML += `
            <div class="listening-task">
              <h3>${section.title} (${section.points} Punkte)</h3>
              <table class="true-false-table">
                <thead>
                  <tr>
                    <th style="width: 10%">Nr.</th>
                    <th style="width: 50%">Aussage</th>
                    <th style="width: 15%">Ihre Antwort</th>
                    <th style="width: 15%">Richtige Antwort</th>
                    <th style="width: 10%">Punkte</th>
                  </tr>
                </thead>
                <tbody>
          `;
          
          section.questions.forEach((question) => {
            const userAnswer = userAnswers[question.id] || '-';
            const correctAnswer = section.correctAnswers[question.id];
            const gotCorrect = userAnswer === correctAnswer;
            const points = gotCorrect ? "1" : "0";
            
            if (gotCorrect) correctCount++;
            
            const rowClass = gotCorrect ? 'correct-answer' : 'incorrect-answer';
            
            resultsHTML += `
              <tr class="${rowClass}">
                <td><strong>${question.id}</strong></td>
                <td class="question-text">${question.text}</td>
                <td>${userAnswer}</td>
                <td>${correctAnswer}</td>
                <td><strong>${points}</strong></td>
              </tr>
            `;
          });
          
          const totalPoints = Math.round((correctCount / section.questions.length) * section.points);
          
          resultsHTML += `
                </tbody>
              </table>
              <div style="margin-top: 15px; padding: 15px; background: #e3f2fd; border-radius: 6px;">
                <strong>Erreichte Punkte: ${correctCount}/${section.questions.length} richtig = ${totalPoints}/${section.points} Punkten</strong>
              </div>
            </div>
          `;
        });
        
        contentContainer.innerHTML = resultsHTML;
      }

      /* ===== Event Listeners ===== */
      document.getElementById('prevBtn-hoeren').addEventListener('click', () => {
        if (state.sectionIndex > 0) {
          state.sectionIndex--;
          state.showResults = false;
          renderAll();
        }
      });

      document.getElementById('nextBtn-hoeren').addEventListener('click', () => {
        if (state.sectionIndex < exam.sections.length - 1) {
          state.sectionIndex++;
          state.showResults = false;
          renderAll();
        }
      });

      document.getElementById('resultBtn-hoeren').addEventListener('click', () => {
        state.showResults = !state.showResults;
        renderAll();
      });

      document.getElementById('resetBtn-hoeren').addEventListener('click', () => {
        if (confirm('M√∂chten Sie wirklich von neu beginnen? Alle Antworten werden gel√∂scht.')) {
          state.answers = {};
          state.showResults = false;
          resetTimer();
          renderAll();
        }
      });

      document.getElementById('saveBtn-hoeren').addEventListener('click', () => {
        statusText.textContent = 'Gespeichert';
        setTimeout(() => { statusText.textContent = 'Nicht gespeichert' }, 2000);
      });

      document.getElementById('submitBtn-hoeren').addEventListener('click', () => {
        if (confirm('M√∂chten Sie die Pr√ºfung wirklich abgeben?')) {
          state.showResults = true;
          renderAll();
        }
      });

      document.getElementById('nextBtn-hoeren').addEventListener('click', () => {
        showPage('schreiben-page');
      });

      /* ===== Initialize ===== */
      updateTimerDisplay();
      renderAll();
      startTimer();
      
      // Expose functions to global scope for event handlers
        window._hoerenState = state;
        window.hoerenApp = {
        updateListeningAnswer
      };
    }

    // ===== SCHREIBEN PAGE FUNCTIONALITY =====
    function initSchreibenPage() {
      /* ===== Self-contained exam (embedded) ===== */
      const exam = {
        id: "exam-002",
        durationSec: 30 * 60, // 30 minutes in seconds
        sections: [
          { 
            id: "s1", 
            title: "Schreiben, Teil 1", 
            points: 45,
            passageTitle: "Aufgabe: Schreiben Sie eine E-Mail",
            passage: "",
            writingTask: {
              prompt: `Schmelzk√§se - Alpengeschmack

Die Reinheit der Natur auf Ihrem Teller! 
Schmelzk√§se ist eine besondere Spezialit√§t under den K√§sen und wird aus gereiftem Schnittk√§se 
oder Frischk√§se auf Grundlage einer traditionellen Methode weiterverarbeitet und gleichzeitig 
haltbar gemacht. 

Schmelzk√§se - Alpengeschmack ist in der modernen K√ºche besonders beliebt, da er vielseitig 
einsetzbar ist: Er bindet So√üen und Suppen, verleiht den Gerichten eine feinw√ºrzige Note, ist perfekt 
zum √úberbacken geeignet und darf auf keinem Fr√ºhst√ºcks- oder Abendbrottisch fehlen. 

Zutaten: 
50 % K√§se, S√º√ümolke, Butter, Schmelzsalze, Natriumphosphate, Natriumcitrate, Polyphosphate, 
Magermilch aus Kuhmilch, Milcheiwei√ü, Speisesalz, 
Farbstoffe: Paprikaextrakt, Carotin. 

10 Scheiben, einzeln in Folie verpackt. 
Unge√∂ffnet mindestens 24 Tage haltbar. Nach dem √ñffnen gek√ºhlt lagern. 

Artikelnummer: 9977 8855 
Hersteller: Molkerei Alpengeschmack 
Lindauer Stra√üe 5 
87437 Kempten 
Tel. 0831-181921 
www.molkerei-alpengeschmack.de`,
              requirements: [
                "Erl√§utern Sie, wozu Sie diesen K√§se verwenden.",
                "Beschreiben Sie, welche gesundheitlichen Beschwerden Sie nach dem Essen hatten.",
                "Erkl√§ren Sie, warum die Fremdk√∂rper gesundheitsgef√§hrdend sind.",
                "Beschreiben Sie, wen Sie au√üer dem Hersteller noch informiert haben."
              ],
              wordCount: 0
            }
          }
        ]
      };

      /* ===== State & DOM refs ===== */
      let state = { 
        sectionIndex: 0, 
        answers: {}, 
        remaining: exam.durationSec,
        showResults: false,
        timerStarted: false,
        timerInterval: null
      };
      
      const topTiles = document.getElementById('topTiles-schreiben');
      const passageTitleEl = document.getElementById('passageTitle-schreiben');
      const passageContentEl = document.getElementById('passageContent-schreiben');
      const writingContainer = document.getElementById('writingContainer-schreiben');
      const timerEl = document.getElementById('timer-schreiben');
      const statusText = document.getElementById('statusText-schreiben');

      /* ===== Timer Functions ===== */
      function startTimer() {
        if (state.timerInterval) {
          clearInterval(state.timerInterval);
        }
        
        state.timerStarted = true;
        state.timerInterval = setInterval(() => {
          if (state.remaining <= 0) {
            clearInterval(state.timerInterval);
            timerEl.textContent = 'Zeit abgelaufen';
            return;
          }
          state.remaining--;
          updateTimerDisplay();
        }, 1000);
      }

      function resetTimer() {
        if (state.timerInterval) {
          clearInterval(state.timerInterval);
        }
        state.remaining = exam.durationSec;
        state.timerStarted = false;
        updateTimerDisplay();
        startTimer();
      }

      function updateTimerDisplay() {
        const min = Math.floor(state.remaining / 60);
        const sec = state.remaining % 60;
        timerEl.textContent = `Verbleibende Zeit: ${min.toString().padStart(2, '0')}:${sec.toString().padStart(2, '0')}`;
      }

      /* ===== Render ===== */
      function renderTopTiles() { 
        topTiles.innerHTML = ''; 
        exam.sections.forEach((sec, idx) => { 
          const div = document.createElement('div'); 
          div.className = 'tile' + (idx === state.sectionIndex ? ' active' : '') + (isSectionDone(sec) ? ' done' : ''); 
          div.innerHTML = `<div>${sec.title}</div><div class="points">${sec.points} P</div>`; 
          div.onclick = () => { state.sectionIndex = idx; state.showResults = false; renderAll(); }; 
          topTiles.appendChild(div); 
        }); 
      }

      function isSectionDone(section) {
        return state.answers[section.id] && state.answers[section.id].length > 0;
      }

      function renderAll() {
        renderTopTiles();
        const section = exam.sections[state.sectionIndex];
        passageTitleEl.textContent = section.passageTitle;
        
        if (state.showResults) {
          renderResults();
          return;
        }
        
        renderWritingSection();
      }

      function renderWritingSection() {
        const section = exam.sections[state.sectionIndex];
        
        // Render the prompt in left panel
        passageContentEl.innerHTML = `
          <div class="writing-task">
            <div class="writing-prompt">${section.writingTask.prompt}</div>
            <div class="instructions" style="border:1px solid #e1e8f6; padding:10px; margin:10px 0; border-radius:6px; background:#ffffff;">Sie haben dieses Produkt gekauft, es war aber verunreinigt. 
Der K√§se enthielt Fremdk√∂rper, und Sie sind nach dem Essen erkrankt. 
Schreiben Sie einen Beschwerdebrief an den Hersteller.</div>
            <div class="writing-requirements">
              <h4>Schreiben Sie in Ihrer E-Mail:</h4>
              <ul>
                ${section.writingTask.requirements.map(req => `<li>${req}</li>`).join('')}
              </ul>
            </div>
            <div class="instructions">
              Schreiben Sie eine E-Mail (ca. 150-200 W√∂rter). Achten Sie auf den Textaufbau (Anrede, Einleitung, Hauptteil, Schluss) und eine angemessene Formulierung.
            </div>
          </div>
        `;
        
        // Render writing area in right panel
        const currentAnswer = state.answers[section.id] || '';
        const wordCount = countWords(currentAnswer);
        
        writingContainer.innerHTML = `
          <div class="writing-area">
            <textarea 
              class="writing-textarea" 
              placeholder="Schreiben Sie hier Ihre E-Mail..."
              oninput="window.schreibenApp.updateWritingAnswer('${section.id}', this.value)"
            >${currentAnswer}</textarea>
            <div class="word-counter">
              W√∂rter: <span class="count">${wordCount}</span>
            </div>
          </div>
        `;
      }

      function countWords(text) {
        return text.trim() === '' ? 0 : text.trim().split(/\s+/).length;
      }

      function updateWritingAnswer(sectionId, text) {
        state.answers[sectionId] = text;
        try{ localStorage.setItem('schreibenAnswers', JSON.stringify({content: state.answers[sectionId], wordCount: (state.answers[sectionId]||'').trim().split(/\s+/).filter(Boolean).length})); }catch(e){}
        
        const wordCount = countWords(text);
        document.querySelector('.word-counter .count').textContent = wordCount;
      }

      function renderResults() {
        let resultsHTML = `<h2>Ergebnisse</h2>`;
        
        exam.sections.forEach(section => {
          resultsHTML += `<div class="writing-task"><h3>${section.title}</h3>`;
          
          const userAnswer = state.answers[section.id];
          const wordCount = countWords(userAnswer);
          
          resultsHTML += `
            <div class="writing-requirements">
              <h4>Ihre Antwort (${wordCount} W√∂rter):</h4>
              <div style="white-space: pre-wrap; background: white; padding: 15px; border-radius: 6px; border: 1px solid #e1e8f6; margin-top: 10px;">${userAnswer || 'Keine Antwort'}</div>
            </div>
          `;
          
          resultsHTML += `</div>`;
        });
        
        passageContentEl.innerHTML = resultsHTML;
        writingContainer.innerHTML = '';
      }

      /* ===== Event Listeners ===== */
      document.getElementById('prevBtn-schreiben').addEventListener('click', () => {
        if (state.sectionIndex > 0) {
          state.sectionIndex--;
          state.showResults = false;
          renderAll();
        }
      });

      document.getElementById('nextBtn-schreiben').addEventListener('click', () => {
        if (state.sectionIndex < exam.sections.length - 1) {
          state.sectionIndex++;
          state.showResults = false;
          renderAll();
        }
      });

      document.getElementById('resultBtn-schreiben').addEventListener('click', () => {
        state.showResults = !state.showResults;
        renderAll();
      });

      document.getElementById('resetBtn-schreiben').addEventListener('click', () => {
        if (confirm('M√∂chten Sie wirklich von neu beginnen? Alle Antworten werden gel√∂schÿ™.')) {
          state.answers = {};
          state.showResults = false;
          resetTimer();
          renderAll();
        }
      });

      document.getElementById('saveBtn-schreiben').addEventListener('click', () => {
        statusText.textContent = 'Gespeichert';
        setTimeout(() => { statusText.textContent = 'Nicht gespeichert' }, 2000);
      });

      document.getElementById('submitBtn-schreiben').addEventListener('click', () => {
        if (confirm('M√∂chten Sie die Pr√ºfung wirklich abgeben?')) {
          state.showResults = true;
          renderAll();
        }
      });

      document.getElementById('nextBtn-schreiben').addEventListener('click', () => {
        showPage('ergebnisse-page');
      });

      /* ===== Initialize ===== */
      updateTimerDisplay();
      renderAll();
      startTimer();
      
      // Expose functions to global scope for event handlers
        window._schreibenState = state;
        window.schreibenApp = {
        updateWritingAnswer
      };
    }

    // ===== ERGEBNISSE PAGE FUNCTIONALITY =====
    function initErgebnissePage() {
      // ===== ÿßŸÑÿ•ÿ¨ÿßÿ®ÿßÿ™ ÿßŸÑÿµÿ≠Ÿäÿ≠ÿ© ÿßŸÑŸÖÿ±ŸÉÿ≤Ÿäÿ© =====
      const CORRECT_ANSWERS = {
        lesen: {
          // ÿßŸÑÿ¨ÿ≤ÿ° ÿßŸÑÿ£ŸàŸÑ: √úberschriften zuordnen (ÿßŸÑŸÜÿµŸàÿµ 1-5)
          "text1": "i",
          "text2": "b", 
          "text3": "c",
          "text4": "d",
          "text5": "e",
          
          // ÿßŸÑÿ¨ÿ≤ÿ° ÿßŸÑÿ´ÿßŸÜŸä: Fragen zum Text (ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ© s2q1-s2q5)
          "s2q1": "s2q1o1",
          "s2q2": "s2q2o3", 
          "s2q3": "s2q3o2",
          "s2q4": "s2q4o2",
          "s2q5": "s2q5o1",
          
          // ÿßŸÑÿ¨ÿ≤ÿ° ÿßŸÑÿ´ÿßŸÑÿ´: Texte zuordnen (ÿßŸÑŸÖŸàÿßŸÇŸÅ 11-20)
          "11": "J",
          "12": "K",
          "13": "A",
          "14": "E",
          "15": "L",
          "16": "I",
          "17": "C",
          "18": "X", // ŸÑÿß ŸäŸàÿ¨ÿØ ŸÜÿµ ŸÖŸÜÿßÿ≥ÿ®
          "19": "G",
          "20": "F",
          
          // Sprachbausteine Teil 1 (ÿßŸÑŸÅÿ±ÿßÿ∫ÿßÿ™ 21-30)
          "21": "davon",
          "22": "denen",
          "23": "an",
          "24": "Mittwochs",
          "25": "jedes Kurses",
          "26": "dessen",
          "27": "wenn",
          "28": "Ihnen",
          "29": "ist",
          "30": "eine Di√§t halten m√ºssen",
          
          // Sprachbausteine Teil 2 (ÿßŸÑŸÅÿ±ÿßÿ∫ÿßÿ™ 31-40)
          "31": "WAS",
          "32": "JETZT",
          "33": "AN",
          "34": "AUS",
          "35": "DARAUF",
          "36": "SO DASS",
          "37": "NICHT NUR",
          "38": "DENEN",
          "39": "DASS",
          "40": "KEINE"
        },
        
        hoeren: {
          // H√∂ren Teil 1 (ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ© 41-45)
          "41": "richtig",
          "42": "falsch",
          "43": "falsch",
          "44": "richtig",
          "45": "falsch",
          
          // H√∂ren Teil 2 (ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ© 46-55)
          "46": "falsch",
          "47": "richtig",
          "48": "richtig",
          "49": "falsch",
          "50": "richtig",
          "51": "richtig",
          "52": "falsch",
          "53": "richtig",
          "54": "falsch",
          "55": "richtig",
          
          // H√∂ren Teil 3 (ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ© 56-60)
          "56": "richtig",
          "57": "falsch",
          "58": "falsch",
          "59": "falsch",
          "60": "richtig"
        }
      };

      const CONFIG = {
        totals: { 
          lesen: 105, 
          hoeren: 75, 
          schreiben: 45, 
          gesamt: 225 
        },
        counts: { 
          lesen: 40, 
          hoeren: 20 
        },
        hoerenCorrect: CORRECT_ANSWERS.hoeren,
        lesenCorrect: CORRECT_ANSWERS.lesen
      };

      // ===== ÿßŸÑÿØŸàÿßŸÑ ÿßŸÑŸÖÿ≥ÿßÿπÿØÿ© =====
      function normalizeAnswer(a) {
        if (a === null || a === undefined || a === '') return '-';
        let s = String(a).trim();
        if (s === '') return '-';
        const low = s.toLowerCase();
        if (["richtig", "true", "yes", "ja"].includes(low)) return 'richtig';
        if (["falsch", "false", "no", "nein"].includes(low)) return 'falsch';
        return s;
      }

      function getHeadingText(headingId) {
        if (!headingId || headingId === '-' || headingId === 'X') return '-';
        const headings = {
          "a": "Benzingeld sparen: Tipp vom Tankwart",
          "b": "Die wichtigsten Erste-Hilfe-Ratschl√§ge",
          "c": "Einmal die Welt als Ganzes sehen",
          "d": "Einmal um die Welt ohne einen Tropfen Benzin",
          "e": "Fliegen statt fahren",
          "f": "Innerdeutsche Reisen besonders beliebt",
          "g": "Frau im All",
          "h": "Schweizer nutzen Solartaxis",
          "i": "Steigende Spritpreise: die Tricks der Autofahrer",
          "j": "Die richtige Unfallversicherung"
        };
        return headings[headingId] || headingId;
      }

      function getOptionText(questionId, optionId) {
        if (!optionId || optionId === '-') return '-';
        const options = {
          "s2q1o1": "bilden die deutsche Nationalmannschaft.",
          "s2q1o2": "spielen schon als Achtj√§hrige in der deutschen Nationalmannschaft mit.",
          "s2q1o3": "unterst√ºtzen die deutsche Nationalmannschaft.",
          "s2q2o1": "h√§ngen wie beim normalen Basketball.",
          "s2q2o2": "sind mit dem Netz nach oben aufgeh√§ngt.",
          "s2q2o3": "sind so gedreht, dass ihre √ñffnungen nach der Seite zeigen.",
          "s2q3o1": "braucht ein eigenes Pferd.",
          "s2q3o2": "kann sein eigenes Pferd einsetzen.",
          "s2q3o3": "muss sein Pferd jedes Mal mitbringen.",
          "s2q4o1": "wird ein Fu√üball verwendet.",
          "s2q4o2": "darf der Ball in die Hand genommen werden.",
          "s2q4o3": "darf der Ball nicht auf den Boden fallen.",
          "s2q5o1": "die Reiter often mehr Stress zu empfinden scheinen als die Tiere.",
          "s2q5o2": "die Tiere ihre naturgegebenen Anlagen nicht ausleben k√∂nnen.",
          "s2q5o3": "es Pferden und Reitern often kein Vergn√ºgen macht."
        };
        return options[optionId] || optionId;
      }

      function getSituationText(id) {
        if (!id || id === '-') return '-';
        const situations = {
          "11": "Ein Kollege hat seit ein paar Tagen Hautprobleme und wei√ü nicht, was die Ursache sein k√∂nnte.",
          "12": "Sie m√∂chten etwas mit ihrer 7-j√§hrigen Tochter Unternehmen.",
          "13": "Ihre Bekannte hat Fieber, m√∂chte aber keine Tabletton nehmen.",
          "14": "Das Ehepaar, das under Ihnen wohnt, m√∂chte etwas √ºber Computer lernen.",
          "15": "Sie wollen Informationen √ºber eine Zahnversicherung, ohne telefonieren zu m√ºssen.",
          "16": "Ihre Nachbarin ist seit einer Woche erk√§ltet. Nat√ºrliche Heilmittel haben nicht geholfen.",
          "17": "Sie bekommen Besuch und m√∂chten am Sonntagvormittag etwas Interessantes Unternehmen.",
          "18": "Ihre Freundin interessiert sich f√ºr japanische Medizin. Sie suchen als Geburtstagsgeschenk ein Buch zu diesem Thema.",
          "19": "Sie haben ein Haustier, das im letzten Jahr viel Geld f√ºr den Tierarzt gekostet hat. Sie suchen eine M√∂glichkeit, Kosten zu sparen.",
          "20": "Sie m√∂chten eine Versicherung f√ºr Ihren Neuwagen abschlie√üen und sofort wissen, was es kostet."
        };
        return situations[id] || id;
      }

      function getTextLetter(id) {
        if (!id || id === '-' || id === 'X') return '-';
        const texts = {
          "A": "Ratgeber 'Was bei Erk√§ltung hilft'",
          "B": "Wir zeigen den kosten die Z√§hne!",
          "C": "Kochen und waschen um 1900",
          "D": "Lesen, was gesund macht",
          "E": "Nachhilfe",
          "F": "Vienna CONEKT",
          "G": "Nachhilfe & Sofort-Versicherung",
          "H": "Kindertheater: warum teilen schwer und betteln grausam ist",
          "I": "Omnitamol 500 Tabletton",
          "J": "Neue Kleidung kann krank machen",
          "K": "Erk√§ltungszeit = Theaterzeit",
          "L": "Zusatz-Versicherung"
        };
        return texts[id] || id;
      }

      function escapeHtml(s) {
        if (s === null || s === undefined) return '-';
        return String(s)
          .replace(/&/g, '&amp;')
          .replace(/</g, '&lt;')
          .replace(/>/g, '&gt;')
          .replace(/"/g, '&quot;')
          .replace(/'/g, '&#039;');
      }

      // ===== ÿØŸàÿßŸÑ ÿßŸÑÿπÿ±ÿ∂ ÿßŸÑŸÖÿ≠ÿ≥ŸÜÿ© =====
      function buildTable(title, dets, total, max) {
        let html = `<div class="result-item">
                      <h3>${title} - ${total.toFixed(2)}/${max} Punkte</h3>
                      <div class="section-table">
                        <table class="true-false-table">
                          <thead>
                            <tr>
                              <th style="width: 10%">Frage</th>
                              <th style="width: 40%">Ihre Antwort</th>
                              <th style="width: 40%">Richtige Antwort</th>
                              <th style="width: 10%">Ergebnis</th>
                            </tr>
                          </thead>
                          <tbody>`;
        
        dets.forEach(x => {
          const isCorrect = x.richtig;
          const rowClass = isCorrect ? 'correct-answer' : 'incorrect-answer';
          const resultIcon = isCorrect ? '‚úÖ Richtig' : '‚ùå Falsch';
          
          html += `<tr class="${rowClass}">
                    <td><strong>${x.frage}</strong></td>
                    <td>${escapeHtml(x.user)}</td>
                    <td>${escapeHtml(x.correct)}</td>
                    <td><strong>${resultIcon}</strong></td>
                  </tr>`;
        });
        
        html += `</tbody>
                </table>
                <div style="margin-top: 15px; padding: 15px; background: #e3f2fd; border-radius: 6px;">
                  <strong>Erreichte Punkte: ${total.toFixed(2)}/${max} (${((total/max)*100).toFixed(1)}%)</strong>
                </div>
              </div></div>`;
        return html;
      }

      function renderLesenDetails(answers) {
        let html = `<div class="result-item">
                    <h3>üìñ Leseverstehen - Detaillierte Auswertung</h3>`;
        
        // 1. √úberschriften zuordnen
        html += `<h4>Teil 1: √úberschriften zuordnen</h4>
                 <table class="true-false-table">
                   <thead>
                     <tr>
                       <th style="width: 15%">Text</th>
                       <th style="width: 35%">Ihre Antwort</th>
                       <th style="width: 35%">Richtige Antwort</th>
                       <th style="width: 15%">Ergebnis</th>
                     </tr>
                   </thead>
                   <tbody>`;
        
        for (let i = 1; i <= 5; i++) {
          const id = `text${i}`;
          const userAnswer = normalizeAnswer(answers[id] || '');
          const correctAnswer = CORRECT_ANSWERS.lesen[id];
          const isCorrect = userAnswer === correctAnswer;
          const rowClass = isCorrect ? 'correct-answer' : 'incorrect-answer';
          const resultIcon = isCorrect ? '‚úÖ' : '‚ùå';
          
          html += `<tr class="${rowClass}">
                    <td><strong>Text ${i}</strong></td>
                    <td>${getHeadingText(userAnswer)}</td>
                    <td>${getHeadingText(correctAnswer)}</td>
                    <td><strong>${resultIcon}</strong></td>
                  </tr>`;
        }
        
        html += `</tbody></table>`;
        
        // 2. Fragen zum Text
        html += `<h4 style="margin-top: 20px;">Teil 2: Fragen zum Text</h4>
                 <table class="true-false-table">
                   <thead>
                     <tr>
                       <th style="width: 15%">Frage</th>
                       <th style="width: 35%">Ihre Antwort</th>
                       <th style="width: 35%">Richtige Antwort</th>
                       <th style="width: 15%">Ergebnis</th>
                     </tr>
                   </thead>
                   <tbody>`;
        
        for (let i = 1; i <= 5; i++) {
          const id = `s2q${i}`;
          const userAnswer = normalizeAnswer(answers[id] || '');
          const correctAnswer = CORRECT_ANSWERS.lesen[id];
          const isCorrect = userAnswer === correctAnswer;
          const rowClass = isCorrect ? 'correct-answer' : 'incorrect-answer';
          const resultIcon = isCorrect ? '‚úÖ' : '‚ùå';
          
          html += `<tr class="${rowClass}">
                    <td><strong>Frage ${i}</strong></td>
                    <td>${getOptionText(id, userAnswer)}</td>
                    <td>${getOptionText(id, correctAnswer)}</td>
                    <td><strong>${resultIcon}</strong></td>
                  </tr>`;
        }
        
        html += `</tbody></table>`;
        
        // 3. Texte zuordnen
        html += `<h4 style="margin-top: 20px;">Teil 3: Texte zuordnen</h4>
                 <table class="true-false-table">
                   <thead>
                     <tr>
                       <th style="width: 15%">Situation</th>
                       <th style="width: 35%">Ihre Antwort</th>
                       <th style="width: 35%">Richtige Antwort</th>
                       <th style="width: 15%">Ergebnis</th>
                     </tr>
                   </thead>
                   <tbody>`;
        
        for (let i = 11; i <= 20; i++) {
          const id = i.toString();
          let userAnswer = normalizeAnswer(answers[id] || '');
          const correctAnswer = CORRECT_ANSWERS.lesen[id];
          const isCorrect = userAnswer === correctAnswer;
          const rowClass = isCorrect ? 'correct-answer' : 'incorrect-answer';
          const resultIcon = isCorrect ? '‚úÖ' : '‚ùå';
          
          // ÿ™ÿ≠ŸàŸäŸÑ ÿßŸÑÿ•ÿ¨ÿßÿ®ÿ© ÿ•ŸÑŸâ ŸÜÿµ
          if (userAnswer === 'X') {
            userAnswer = 'X - Kein passender Text';
          } else if (userAnswer !== '-') {
            userAnswer = getTextLetter(userAnswer);
          }
          
          let correctAnswerText = getTextLetter(correctAnswer);
          if (correctAnswer === 'X') {
            correctAnswerText = 'X - Kein passender Text';
          }
          
          html += `<tr class="${rowClass}">
                    <td><strong>${id}</strong></td>
                    <td>${userAnswer}</td>
                    <td>${correctAnswerText}</td>
                    <td><strong>${resultIcon}</strong></td>
                  </tr>`;
        }
        
        html += `</tbody></table>`;
        
        // 4. Sprachbausteine Teil 1
        html += `<h4 style="margin-top: 20px;">Sprachbausteine Teil 1</h4>
                 <table class="true-false-table">
                   <thead>
                     <tr>
                       <th style="width: 15%">L√ºcke</th>
                       <th style="width: 35%">Ihre Antwort</th>
                       <th style="width: 35%">Richtige Antwort</th>
                       <th style="width: 15%">Ergebnis</th>
                     </tr>
                   </thead>
                   <tbody>`;
        
        for (let i = 21; i <= 30; i++) {
          const id = i.toString();
          const userAnswer = normalizeAnswer(answers[id] || '');
          const correctAnswer = CORRECT_ANSWERS.lesen[id];
          const isCorrect = userAnswer === correctAnswer;
          const rowClass = isCorrect ? 'correct-answer' : 'incorrect-answer';
          const resultIcon = isCorrect ? '‚úÖ' : '‚ùå';
          
          html += `<tr class="${rowClass}">
                    <td><strong>${id}</strong></td>
                    <td>${userAnswer}</td>
                    <td>${correctAnswer}</td>
                    <td><strong>${resultIcon}</strong></td>
                  </tr>`;
        }
        
        html += `</tbody></table>`;
        
        // 5. Sprachbausteine Teil 2
        html += `<h4 style="margin-top: 20px;">Sprachbausteine Teil 2</h4>
                 <table class="true-false-table">
                   <thead>
                     <tr>
                       <th style="width: 15%">L√ºcke</th>
                       <th style="width: 35%">Ihre Antwort</th>
                       <th style="width: 35%">Richtige Antwort</th>
                       <th style="width: 15%">Ergebnis</th>
                     </tr>
                   </thead>
                   <tbody>`;
        
        for (let i = 31; i <= 40; i++) {
          const id = i.toString();
          const userAnswer = normalizeAnswer(answers[id] || '');
          const correctAnswer = CORRECT_ANSWERS.lesen[id];
          const isCorrect = userAnswer === correctAnswer;
          const rowClass = isCorrect ? 'correct-answer' : 'incorrect-answer';
          const resultIcon = isCorrect ? '‚úÖ' : '‚ùå';
          
          html += `<tr class="${rowClass}">
                    <td><strong>${id}</strong></td>
                    <td>${userAnswer}</td>
                    <td>${correctAnswer}</td>
                    <td><strong>${resultIcon}</strong></td>
                  </tr>`;
        }
        
        html += `</tbody></table></div>`;
        return html;
      }

      function buildHoerenDetails(answers) {
        let html = `<table class="true-false-table">
                      <thead>
                        <tr>
                          <th style="width: 10%">Frage</th>
                          <th style="width: 40%">Ihre Antwort</th>
                          <th style="width: 40%">Richtige Antwort</th>
                          <th style="width: 10%">Ergebnis</th>
                        </tr>
                      </thead>
                      <tbody>`;
        
        for (let i = 41; i <= 60; i++) {
          const id = i.toString();
          const userAnswer = normalizeAnswer(answers[id] || '');
          const correctAnswer = CORRECT_ANSWERS.hoeren[id];
          const isCorrect = userAnswer === correctAnswer;
          const rowClass = isCorrect ? 'correct-answer' : 'incorrect-answer';
          const resultIcon = isCorrect ? '‚úÖ' : '‚ùå';
          
          html += `<tr class="${rowClass}">
                    <td><strong>${id}</strong></td>
                    <td>${userAnswer}</td>
                    <td>${correctAnswer}</td>
                    <td><strong>${resultIcon}</strong></td>
                  </tr>`;
        }
        
        html += `</tbody></table>`;
        return html;
      }

      // ===== ÿßŸÑÿØŸàÿßŸÑ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ© =====
      function readExamResults() {
        try {
          const lesen = {};
          const hoeren = {};
          const schreiben = { content: '', wordCount: 0 };

          // 1) Try to read from in-memory states exposed by pages
          try {
            if (window._lesenState && window._lesenState.answers) {
              Object.keys(window._lesenState.answers).forEach(k => {
                lesen[k] = window._lesenState.answers[k];
              });
            }
          } catch (e) {}

          try {
            if (window._hoerenState && window._hoerenState.answers) {
              Object.keys(window._hoerenState.answers).forEach(sectionId => {
                const sec = window._hoerenState.answers[sectionId] || {};
                Object.keys(sec).forEach(q => {
                  hoeren[q] = sec[q];
                });
              });
            }
          } catch (e) {}

          try {
            if (window._schreibenState && window._schreibenState.answers) {
              const answers = window._schreibenState.answers;
              if (answers['s1']) {
                schreiben.content = answers['s1'];
              } else {
                const keys = Object.keys(answers);
                if (keys.length > 0) schreiben.content = answers[keys[0]] || '';
              }
              schreiben.wordCount = (schreiben.content && schreiben.content.trim()) ? String(schreiben.content).trim().split(/\s+/).filter(Boolean).length : 0;
            }
          } catch (e) {}

          // 2) Fallback to localStorage if any part is still empty
          try {
            if (Object.keys(lesen).length === 0) {
              const storedL = localStorage.getItem('lesenAnswers');
              if (storedL) Object.assign(lesen, JSON.parse(storedL));
            }
          } catch (e) {}

          try {
            if (Object.keys(hoeren).length === 0) {
              const storedH = localStorage.getItem('hoerenAnswers');
              if (storedH) Object.assign(hoeren, JSON.parse(storedH));
            }
          } catch (e) {}

          try {
            if (!schreiben.content) {
              const storedS = localStorage.getItem('schreibenAnswers');
              if (storedS) {
                const obj = JSON.parse(storedS);
                schreiben.content = obj.content || '';
                schreiben.wordCount = obj.wordCount || (schreiben.content.trim() ? String(schreiben.content).trim().split(/\s+/).filter(Boolean).length : 0);
              }
            }
          } catch (e) {}

          // final safe return
          return { hoeren, lesen, schreiben };
        } catch (e) {
          return { hoeren: {}, lesen: {}, schreiben: {} };
        }
      }

      function gradeHoeren(u) {
        const c = CORRECT_ANSWERS.hoeren;
        let okCount = 0;
        const d = [];
        
        for (let q = 41; q <= 60; q++) {
          const k = String(q);
          const uA = normalizeAnswer(u[k] || '');
          const exp = normalizeAnswer(c[k] || '');
          const ok = (uA !== '-' && uA.toLowerCase() === exp.toLowerCase());
          if (ok) okCount++;
          const ptsPer = CONFIG.totals.hoeren / CONFIG.counts.hoeren;
          d.push({
            frage: k,
            user: uA || '-',
            correct: exp || '-',
            richtig: ok,
            punkte: ok ? ptsPer.toFixed(2) : '0'
          });
        }
        
        const total = Number((okCount * (CONFIG.totals.hoeren / CONFIG.counts.hoeren)).toFixed(2));
        return { okCount, total, details: d };
      }

      function gradeLesen(u) {
        const c = CORRECT_ANSWERS.lesen;
        let okCount = 0;
        const d = [];
        
        Object.keys(c).forEach(k => {
          const exp = normalizeAnswer(c[k]);
          const uA = normalizeAnswer(u[k] || '');
          const ok = (uA !== '-' && uA.toLowerCase() === exp.toLowerCase());
          if (ok) okCount++;
          const ptsPer = CONFIG.totals.lesen / CONFIG.counts.lesen;
          d.push({
            frage: k,
            user: uA || '-',
            correct: exp || '-',
            richtig: ok,
            punkte: ok ? ptsPer.toFixed(2) : '0'
          });
        });
        
        const total = Number((okCount * (CONFIG.totals.lesen / CONFIG.counts.lesen)).toFixed(2));
        return { okCount, total, details: d };
      }

      function renderResults() {
        const st = readExamResults() || { hoeren: {}, lesen: {}, schreiben: {} };
        const h = gradeHoeren(st.hoeren || {});
        const l = gradeLesen(st.lesen || {});
        const details = document.getElementById('details-ergebnisse');
        const tiles = document.getElementById('topTiles-ergebnisse');
        const sScoreRaw = localStorage.getItem('schreibenScore');
        const sScore = sScoreRaw ? Number(sScoreRaw) : 0;

        details.innerHTML = '';
        tiles.innerHTML = '';

        // ÿπÿ±ÿ∂ ÿßŸÑÿ®ŸÑÿßÿ∑ÿßÿ™ ÿßŸÑÿπŸÑŸàŸäÿ©
        const tL = `<div class="results-tile">
                      <h3>Lesen</h3>
                      <div class="score">${l.total.toFixed(2)} / ${CONFIG.totals.lesen} Punkte</div>
                      <div class="small-muted">(${(l.total / CONFIG.totals.lesen * 100).toFixed(2)} %)</div>
                    </div>`;
                    
        const tH = `<div class="results-tile">
                      <h3>H√∂ren</h3>
                      <div class="score">${h.total.toFixed(2)} / ${CONFIG.totals.hoeren} Punkte</div>
                      <div class="small-muted">(${(h.total / CONFIG.totals.hoeren * 100).toFixed(2)} %)</div>
                    </div>`;
                    
        const tS = `<div class="results-tile">
                      <h3>Schreiben</h3>
                      <div class="score" id="schreibenScoreDisplay">${sScore.toFixed(2)} / ${CONFIG.totals.schreiben} Punkte</div>
                      <div class="small-muted">Manuelle Eingabe</div>
                    </div>`;
                    
        tiles.innerHTML = tL + tH + tS;

        // ÿπÿ±ÿ∂ ÿßŸÑÿ™ŸÅÿßÿµŸäŸÑ
        details.innerHTML = `
          <h2>üìä Detaillierte Ergebnisse</h2>
          <div class="instructions">Hier sehen Sie eine detaillierte Auswertung Ihrer Pr√ºfung. Rote Zeilen zeigen falsche Antworten, gr√ºne Zeilen zeigen richtige Antworten.</div>
        `;

        // ŸÇÿ≥ŸÖ ÿßŸÑŸÇÿ±ÿßÿ°ÿ©
        details.innerHTML += renderLesenDetails(st.lesen);

        // ŸÇÿ≥ŸÖ ÿßŸÑÿßÿ≥ÿ™ŸÖÿßÿπ
        details.innerHTML += `
          <div class="result-item">
            <h3>üëÇ H√∂rverstehen - Detaillierte Auswertung</h3>
            ${buildHoerenDetails(st.hoeren)}
          </div>
        `;

        // ŸÇÿ≥ŸÖ ÿßŸÑŸÉÿ™ÿßÿ®ÿ©
        let sHtml = '<div class="result-item"><h3>‚úçÔ∏è Schreiben - Ihre Antwort</h3>';
        const txt = st.schreiben.content ? escapeHtml(st.schreiben.content) : '<span class="small-muted">Kein Text gefunden.</span>';
        const wc = st.schreiben.wordCount || '0';
        
        sHtml += `<div class="small-muted">W√∂rter: ${wc}</div>
                  <div style="margin-top:10px;padding:12px;background:#fff;border-radius:8px;border:1px solid #eef6ff;min-height:80px;max-height:300px;overflow-y:auto">${txt}</div>
                  <div style="margin-top:15px;display:flex;gap:10px;align-items:center">
                    <strong>Punkte (0‚Äì45):</strong> 
                    <input id="sInput" type="number" min="0" max="45" step="0.5" value="${sScore}" style="width:100px;padding:8px;"> 
                    <button id="saveS" class="results-btn">üíæ Speichern</button>
                  </div>`;
                  
        details.innerHTML += sHtml + '</div>';

        // ÿ≠ÿ≥ÿßÿ® ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸä
        const total = (l.total + h.total + sScore).toFixed(2);
        const percent = ((total / CONFIG.totals.gesamt) * 100).toFixed(2);
        
        document.getElementById('finalSummary-ergebnisse').innerHTML = `
          <div class="left">
            <strong>Gesamtpunktzahl:</strong> ${total} / ${CONFIG.totals.gesamt} Punkte<br>
            <span class="small-muted">Lesen + H√∂ren + Schreiben</span>
          </div>
          <div class="right">
            <strong>Prozentsatz:</strong> ${percent} %<br>
            <span class="small-muted">Bestehensgrenze: 60% (135 Punkte)</span>
          </div>`;

        // ÿ•ÿ∂ÿßŸÅÿ© ÿ≤ÿ± ŸÑÿ≠ŸÅÿ∏ ÿØÿ±ÿ¨ÿ© ÿßŸÑŸÉÿ™ÿßÿ®ÿ©
        document.getElementById('saveS').onclick = () => {
          const v = Number(document.getElementById('sInput').value) || 0;
          localStorage.setItem('schreibenScore', v);
          document.getElementById('schreibenScoreDisplay').textContent = `${v.toFixed(2)} / ${CONFIG.totals.schreiben} Punkte`;
          
          const newTotal = (l.total + h.total + v).toFixed(2);
          const newPercent = ((newTotal / CONFIG.totals.gesamt) * 100).toFixed(2);
          
          document.getElementById('finalSummary-ergebnisse').innerHTML = `
            <div class="left">
              <strong>Gesamtpunktzahl:</strong> ${newTotal} / ${CONFIG.totals.gesamt} Punkte<br>
              <span class="small-muted">Lesen + H√∂ren + Schreiben</span>
            </div>
            <div class="right">
              <strong>Prozentsatz:</strong> ${newPercent} %<br>
              <span class="small-muted">Bestehensgrenze: 60% (135 Punkte)</span>
            </div>`;
        };
      }

      // ===== ÿ™ŸáŸäÿ¶ÿ© ÿßŸÑÿµŸÅÿ≠ÿ© =====
      document.getElementById('calcBtn-ergebnisse').onclick = () => renderResults();
      document.getElementById('backBtn-ergebnisse').onclick = (e) => {
        e.preventDefault();
        showPage('start-page');
      };
      
      // Initialize results on page load
      renderResults();
    }

    // ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑÿ≥ÿ≠ÿ® ŸàÿßŸÑÿ•ŸÅŸÑÿßÿ™ ŸÑŸÑÿ¥ÿßÿ¥ÿßÿ™ ÿßŸÑÿ™Ÿä ÿ™ÿπŸÖŸÑ ÿ®ÿßŸÑŸÑŸÖÿ≥
    function setupTouchDragAndDrop() {
      if ('ontouchstart' in window) {
        // ÿ™ÿ∫ŸäŸäÿ± ÿ≥ŸÑŸàŸÉ ÿßŸÑÿπŸÜÿßÿµÿ± ÿßŸÑŸÇÿßÿ®ŸÑÿ© ŸÑŸÑÿ≥ÿ≠ÿ®
        document.querySelectorAll('[draggable="true"]').forEach(item => {
          item.addEventListener('touchstart', handleTouchStart);
          item.addEventListener('touchend', handleTouchEnd);
        });
        
        document.querySelectorAll('.title-slot, .blank-slot').forEach(slot => {
          slot.addEventListener('touchmove', handleTouchMove);
          slot.addEventListener('touchend', handleTouchDrop);
        });
      }
    }

    function handleTouchStart(e) {
      // ÿ™ŸÜŸÅŸäÿ∞ ÿßŸÑÿ≥ÿ≠ÿ® ÿπŸÜÿØ ÿßŸÑŸÑŸÖÿ≥
    }

    // ÿßÿ≥ÿ™ÿØÿπÿßÿ° ÿßŸÑÿØÿßŸÑÿ© ÿπŸÜÿØ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿµŸÅÿ≠ÿ©
    document.addEventListener('DOMContentLoaded', setupTouchDragAndDrop);
  </script>
</body>
</html>