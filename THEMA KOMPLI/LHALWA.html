<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Deutsch B2 Pr√ºfung - Komplett</title>
  <style>
    /* ===== GLOBAL STYLES ===== */
    :root {
      --primary-color: #1e3a5f;
      --secondary-color: #2c5282;
      --accent-color: #4da6ff;
      --light-color: #ebf8ff;
      --text-color: #2d3748;
      --white: #ffffff;
      --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      --transition: all 0.3s ease;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      margin: 0;
      min-height: 100vh;
      background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
      color: var(--white);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    button {
      cursor: pointer;
    }
    
    /* ===== START PAGE STYLES ===== */
    .start-container {
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      padding: 20px;
      min-height: 100vh;
    }
    
    .start-content {
      max-width: 600px;
      width: 100%;
      background-color: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      padding: 40px;
      box-shadow: var(--shadow);
      text-align: center;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .logo {
      margin-bottom: 20px;
    }
    
    .logo-icon {
      font-size: 48px;
      margin-bottom: 10px;
    }
    
    h1 {
      font-size: 32px;
      margin-bottom: 10px;
      font-weight: 700;
    }
    
    .subtitle {
      font-size: 18px;
      margin-bottom: 30px;
      opacity: 0.9;
    }
    
    .card {
      background-color: var(--white);
      border-radius: 12px;
      padding: 25px;
      margin-bottom: 30px;
      box-shadow: var(--shadow);
      color: var(--text-color);
    }
    
    .card h2 {
      font-size: 20px;
      margin-bottom: 15px;
      color: var(--primary-color);
    }
    
    .card p {
      margin-bottom: 20px;
      line-height: 1.5;
    }
    
    select {
      width: 100%;
      padding: 12px 16px;
      font-size: 16px;
      border-radius: 8px;
      border: 2px solid var(--accent-color);
      outline: none;
      background-color: var(--white);
      color: var(--text-color);
      cursor: pointer;
      transition: var(--transition);
    }
    
    select:focus {
      border-color: var(--secondary-color);
      box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.3);
    }
    
    .timer-container {
      margin: 25px 0;
    }
    
    .timer-label {
      font-size: 16px;
      margin-bottom: 10px;
    }
    
    .timer {
      font-size: 48px;
      font-weight: 700;
      color: var(--accent-color);
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }
    
    .progress-bar {
      height: 8px;
      width: 100%;
      background-color: rgba(255, 255, 255, 0.2);
      border-radius: 4px;
      overflow: hidden;
      margin-top: 10px;
    }
    
    .progress {
      height: 100%;
      width: 100%;
      background-color: var(--accent-color);
      border-radius: 4px;
      transform: scaleX(1);
      transform-origin: left;
      transition: transform 1s linear;
    }
    
    .info-text {
      font-size: 14px;
      margin-top: 20px;
      opacity: 0.8;
    }
    
    .button-container {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }
    
    .btn {
      flex: 1;
      padding: 12px 20px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      background-color: var(--accent-color);
      color: white;
      text-decoration: none;
      display: inline-block;
      text-align: center;
    }
    
    .btn:hover {
      background-color: #3399ff;
    }
    
    /* ===== EXAM PAGE STYLES ===== */
    .exam-body {
      background: #f5f5f5;
      color: #333;
      line-height: 1.45;
      -webkit-font-smoothing: antialiased;
    }
    
    /* Header Styles */
    header.topbar {
      background: #1e3a5f;
      color: #fff;
      padding: 12px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      min-height: 80px;
    }

    .brand {
      display: flex;
      gap: 15px;
      align-items: center;
    }

    .brand .logo {
      width: 80px;
      height: 40px;
      background: #e74c3c;
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      color: white;
      font-size: 18px;
    }

    .meta .main-title {
      font-weight: 800;
      font-size: 18px;
    }

    .meta .sub-title {
      font-size: 13px;
      opacity: 0.9;
    }

    .timer {
      font-weight: 700;
      font-size: 18px;
      color: #fff;
      margin: 0 20px;
    }

    .buttons-grid {
      display: grid;
      grid-template-columns: repeat(2, auto);
      gap: 10px 20px;
    }

    .exam-btn {
      padding: 12px 20px;
      border-radius: 6px;
      border: none;
      background: #4da6ff;
      color: white;
      font-weight: 700;
      font-size: 15px;
      cursor: pointer;
      transition: background 0.2s ease-in-out;
      min-width: 150px;
      text-align: center;
    }

    .exam-btn:hover {
      background: #336fbf;
    }
    
    .exam-btn.save {
      background: #4da6ff;
      color: #000;
    }
    
    .exam-btn.save:hover {
      background: #3399ff;
    }
    
    .exam-btn.submit {
      background: #4da6ff;
    }
    
    .exam-btn.submit:hover {
      background: #3399ff;
    }
    
    .exam-btn.result {
      background: #4da6ff;
    }
    
    .exam-btn.result:hover {
      background: #3399ff;
    }
    
    .exam-btn.next {
      background: #4da6ff;
      color: #fff;
    }
    
    .exam-btn.next:hover {
      background: #3399ff;
    }
    
    .exam-btn.reset {
      background: #4da6ff;
    }
    
    .exam-btn.reset:hover {
      background: #3399ff;
    }
    
    .exam-btn.reset-section {
      background: #d35400;
      font-size: 12px;
      padding: 6px 10px;
      min-width: auto;
    }
    
    .exam-btn.reset-section:hover {
      background: #e67e22;
    }
    
    .exam-btn.no-match {
      background: #95a5a6;
      font-size: 12px;
      padding: 6px 10px;
      min-width: auto;
      margin-top: 5px;
    }
    
    .exam-btn.no-match:hover {
      background: #7f8c8d;
    }
    
    .exam-btn.no-match.selected {
      background: #e74c3c;
    }
    
    /* Top Tiles */
    .top-tiles {
      display: flex;
      justify-content: center;
      gap: 8px;
      padding: 8px 12px;
      background: #1e3a5f;
      border-bottom: 1px solid #0f223a;
    }
    
    .tile {
      flex: 1;
      max-width: 180px;
      text-align: center;
      padding: 12px;
      border-radius: 6px;
      border: 1px solid #ccc;
      background: #3b4a63;
      color: #fff;
      font-weight: 600;
      font-size: 13px;
      cursor: pointer;
      transition: all 0.2s ease-in-out;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 60px;
    }
    
    .tile:hover {
      background: #4a5b78;
    }
    
    .tile.active {
      background: #ffffff;
      color: #000;
      border-color: #bbb;
    }
    
    .tile.done {
      background: #2ecc71;
      color: #fff;
      border-color: #27ae60;
    }
    
    .tile.done::after {
      content: " ‚úÖ";
      margin-left: 5px;
    }
    
    .tile .points {
      background: rgba(255,255,255,0.2);
      padding: 4px 8px;
      border-radius: 12px;
      font-weight: 700;
      font-size: 11px;
      margin-top: 4px;
    }
    
    .tile.active .points {
      background: #e9eefc;
      color: #2c3e50;
    }
    
    /* Container Styles */
    .container {
      display: grid;
      grid-template-columns: 1fr 420px;
      gap: 16px;
      padding: 16px;
      max-width: 1200px;
      margin: 12px auto;
    }
    
    .container-full {
      display: grid;
      grid-template-columns: 1fr;
      gap: 16px;
      padding: 16px;
      max-width: 1200px;
      margin: 12px auto;
    }
    
    .container-split {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
      padding: 16px;
      max-width: 1200px;
      margin: 12px auto;
    }
    
    .left-panel {
      background: white;
      border-radius: 8px;
      padding: 18px;
      box-shadow: 0 1px 6px rgba(0,0,0,0.06);
      max-height: 76vh;
      overflow: auto;
    }
    
    .left-panel .passage {
      font-size: 14px;
      color: #2c3e50;
      line-height: 1.8;
    }
    
    .left-panel h2 {
      font-size: 16px;
      margin-bottom: 10px;
    }
    
    .right-panel {
      background: white;
      border-radius: 8px;
      padding: 12px;
      box-shadow: 0 1px 6px rgba(0,0,0,0.06);
      display: flex;
      flex-direction: column;
      gap: 12px;
      max-height: 76vh;
      overflow: auto;
    }
    
    .main-panel {
      background: white;
      border-radius: 8px;
      padding: 25px;
      box-shadow: 0 1px 6px rgba(0,0,0,0.06);
      max-height: 76vh;
      overflow: auto;
    }
    
    .panel-title {
      font-size: 18px;
      margin-bottom: 15px;
      color: #1e3a5f;
      font-weight: 700;
    }
    
    /* Question Styles */
    .question-head {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }
    
    .question-body {
      margin-top: 8px;
    }
    
    .options {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    .option {
      background: #fbfdff;
      border: 1px solid #e1e8f6;
      padding: 10px;
      border-radius: 8px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .option:hover {
      background: #f0f6ff;
    }
    
    .option.selected {
      background: #e8fbe9;
      border-color: #2ecc71;
    }
    
    .option .radio {
      width: 18px;
      height: 18px;
      border-radius: 50%;
      border: 2px solid #cfdff6;
      background: #fff;
      display: inline-block;
      flex-shrink: 0;
    }
    
    .option.selected .radio {
      background: #3498db;
      border-color: #3498db;
      box-shadow: inset 0 -3px 0 rgba(0,0,0,0.05);
    }
    
    .text-container {
      margin-bottom: 20px;
      padding: 15px;
      border: 1px solid #e1e8f6;
      border-radius: 8px;
      background: #fbfdff;
      position: relative;
      min-height: 120px;
    }
    
    .text-container:hover {
      background: #f0f6ff;
    }
    
    .text-title {
      font-weight: 700;
      margin-bottom: 8px;
      color: #2c3e50;
    }
    
    .text-content {
      font-size: 14px;
      color: #2c3e50;
      line-height: 1.6;
    }
    
    .title-slot {
      min-height: 40px;
      margin-top: 10px;
      padding: 8px;
      border: 2px dashed #c8d9f6;
      border-radius: 6px;
      background: #f8fbff;
    }
    
    .title-slot.has-title {
      background: #e8fbe9;
      border-color: #2ecc71;
    }
    
    .title-slot.has-x {
      background: #f8d7da;
      border-color: #e74c3c;
      color: #c0392b;
      font-weight: bold;
    }
    
    .headings-bank {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-top: 0;
    }
    
    .heading-item {
      padding: 10px;
      border: 1px solid #dbe7fb;
      border-radius: 8px;
      background: #f8fbff;
      cursor: grab;
    }
    
    .heading-item:hover {
      background: #e9f0ff;
    }
    
    .heading-item.used {
      opacity: 0.5;
      cursor: not-allowed;
      background: #f8d7da;
      border-color: #f5c6cb;
    }
    
    .result-correct {
      color: #27ae60;
      font-weight: bold;
    }
    
    .result-incorrect {
      color: #c0392b;
      font-weight: bold;
    }
    
    .result-item {
      margin: 10px 0;
      padding: 10px;
      border-radius: 6px;
      background: #f8f9fa;
      border: 1px solid #e1e8f6;
    }
    
    .instructions {
      color: #7f8c8d;
      font-size: 14px;
      line-height: 1.6;
      margin-bottom: 15px;
    }
    
    .question-text {
      font-weight: 600;
      margin-bottom: 15px;
      font-size: 15px;
      color: #2c3e50;
    }
    
    .all-questions {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    
    .question-block {
      margin-bottom: 20px;
      padding: 15px;
      border: 1px solid #e1e8f6;
      border-radius: 8px;
      background: #fbfdff;
    }
    
    .texts-list, .situations-list {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    
    .text-item, .situation-item {
      padding: 15px;
      border: 1px solid #e1e8f6;
      border-radius: 8px;
      background: #fbfdff;
    }
    
    .text-letter {
      font-weight: bold;
      color: #2c3e50;
      margin-bottom: 8px;
    }
    
    .situation-number {
      font-weight: bold;
      color: #2c3e50;
      margin-bottom: 8px;
    }
    
    .fill-blank-container {
      margin: 20px 0;
    }
    
    .blank-word {
      display: inline-block;
      min-width: 120px;
      padding: 4px 8px;
      margin: 0 6px;
      background: #fff;
      cursor: pointer;
      position: relative;
      border: 1px solid #dbe7fb;
      border-radius: 4px;
    }
    
    .blank-word.has-answer {
      background: #e8fbe9;
      border-color: #2ecc71;
    }
    
    .options-popup {
      position: absolute;
      top: 100%;
      left: 0;
      background: white;
      border: 1px solid #dbe7fb;
      border-radius: 6px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      z-index: 100;
      min-width: 150px;
    }
    
    .option-item {
      padding: 8px 12px;
      cursor: pointer;
      border-bottom: 1px solid #f0f4fb;
    }
    
    .option-item:hover {
      background: #f0f6ff;
    }
    
    .option-item:last-child {
      border-bottom: none;
    }
    
    .horizontal-options {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    
    .option-row {
      display: flex;
      align-items: center;
      gap: 15px;
      padding: 10px;
      border: 1px solid #e1e8f6;
      border-radius: 8px;
      background: #fbfdff;
    }
    
    .option-number {
      font-weight: bold;
      color: #2c3e50;
      min-width: 30px;
    }
    
    .option-buttons {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    
    .option-btn {
      padding: 8px 16px;
      border: 1px solid #dbe7fb;
      border-radius: 6px;
      background: #f8fbff;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .option-btn:hover {
      background: #e9f0ff;
    }
    
    .option-btn.selected {
      background: #3498db;
      color: white;
      border-color: #3498db;
    }
    
    .word-bank-vertical {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    .bank-word-vertical {
      padding: 10px;
      border: 1px solid #dbe7fb;
      border-radius: 6px;
      background: #f8fbff;
      text-align: center;
      cursor: grab;
    }
    
    .bank-word-vertical.used {
      opacity: 0.5;
      cursor: not-allowed;
      background: #f8d7da;
      border-color: #f5c6cb;
    }
    
    .blank-slot {
      display: inline-block;
      min-width: 100px;
      padding: 4px 8px;
      margin: 0 6px;
      background: #fff;
      min-height: 30px;
      vertical-align: middle;
      border: 1px solid #dbe7fb;
      border-radius: 4px;
      cursor: pointer;
    }
    
    .blank-slot.has-answer {
      background: #e8fbe9;
      border-color: #2ecc71;
    }
    
    .footer-buttons {
      display: flex;
      gap: 10px;
    }
    
    .situation-item.used {
      opacity: 0.7;
      cursor: not-allowed;
      background: #f8d7da;
      border-color: #f5c6cb;
      color: #333;
    }
    
    /* Listening Section Styles */
    .listening-task {
      margin-bottom: 10px;
    }
    
    .true-false-table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
      font-size: 14px;
    }
    
    .true-false-table th {
      background: #3498db;
      color: white;
      padding: 15px;
      text-align: left;
      font-weight: 600;
      font-size: 14px;
    }
    
    .true-false-table td {
      padding: 15px;
      border-bottom: 1px solid #e1e8f6;
      vertical-align: top;
    }
    
    .true-false-table tr:nth-child(even) {
      background: #f8f9fa;
    }
    
    .true-false-table tr:hover {
      background: #e3f2fd;
    }
    
    .answer-options {
      display: flex;
      gap: 25px;
    }
    
    .answer-option {
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      padding: 10px 15px;
      border-radius: 4px;
      transition: background 0.2s;
      font-weight: 500;
    }
    
    .answer-option:hover {
      background: #e3f2fd;
    }
    
    .answer-option input {
      margin: 0;
      transform: scale(1.2);
    }

    .correct-answer {
      background: #d4edda !important;
      border-left: 4px solid #28a745;
    }
    
    .incorrect-answer {
      background: #f8d7da !important;
      border-left: 4px solid #dc3545;
    }
    
    /* Writing Section Styles */
    .writing-task {
      margin-bottom: 20px;
      padding: 15px;
      border: 1px solid #e1e8f6;
      border-radius: 8px;
      background: #fbfdff;
    }
    
    .writing-prompt {
      font-size: 14px;
      color: #2c3e50;
      line-height: 1.6;
      margin-bottom: 15px;
    }
    
    .writing-requirements {
      background: #f8f9fa;
      padding: 12px;
      border-radius: 6px;
      border-left: 4px solid #3498db;
      margin-bottom: 15px;
    }
    
    .writing-requirements h4 {
      margin: 0 0 8px 0;
      color: #2c3e50;
    }
    
    .writing-requirements ul {
      margin: 0;
      padding-left: 20px;
    }
    
    .writing-requirements li {
      margin-bottom: 5px;
      color: #2c3e50;
    }
    
    .writing-area {
      flex: 1;
      display: flex;
      flex-direction: column;
    }
    
    .writing-textarea {
      flex: 1;
      min-height: 500px;
      padding: 15px;
      border: 2px solid #e1e8f6;
      border-radius: 8px;
      font-size: 14px;
      line-height: 1.6;
      resize: vertical;
      font-family: Arial, sans-serif;
    }
    
    .writing-textarea:focus {
      outline: none;
      border-color: #3498db;
    }
    
    .word-counter {
      margin-top: 10px;
      text-align: right;
      font-size: 13px;
      color: #7f8c8d;
      padding: 8px 0;
    }
    
    .word-counter .count {
      font-weight: bold;
      color: #2c3e50;
    }
    
    /* Results Page Styles */
    .results-body {
      background: #f7fafc;
      color: #0f1724;
      line-height: 1.6;
    }
    
    .results-header {
      background: #1e3a5f;
      color: #fff;
      padding: 18px 20px;
      display: flex;
      align-items: center;
      gap: 16px;
    }
    
    .results-logo {
      background: #fff;
      color: #1e3a5f;
      padding: 8px 12px;
      border-radius: 6px;
      font-weight: 800;
    }
    
    .results-title {
      font-size: 18px;
      font-weight: 700;
    }
    
    .results-container {
      max-width: 1100px;
      margin: 22px auto;
      padding: 20px;
    }
    
    .results-tiles {
      display: flex;
      gap: 12px;
      margin: 18px 0;
    }
    
    .results-tile {
      flex: 1;
      background: #fff;
      border-radius: 10px;
      padding: 16px;
      box-shadow: 0 6px 18px rgba(2, 6, 23, 0.06);
      border-left: 6px solid #1e3a5f;
    }
    
    .results-tile h3 {
      margin: 0;
      font-size: 16px;
      color: #1e3a5f;
    }
    
    .results-tile .score {
      font-size: 20px;
      font-weight: 800;
      margin-top: 8px;
    }
    
    .section-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 12px;
    }
    
    .section-table th,
    .section-table td {
      padding: 8px;
      border-bottom: 1px solid #e6eef8;
      text-align: left;
      font-size: 14px;
    }
    
    .summary {
      background: #fff;
      padding: 16px;
      border-radius: 10px;
      margin-top: 18px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .summary .left {
      font-weight: 700;
    }
    
    .summary .right {
      text-align: right;
    }
    
    .controls {
      display: flex;
      gap: 10px;
      margin-top: 18px;
    }
    
    .results-btn {
      background: #4da6ff;
      border: none;
      color: #fff;
      padding: 10px 14px;
      border-radius: 8px;
      font-weight: 700;
      cursor: pointer;
      transition: background 0.3s;
    }
    
    .results-btn:hover {
      background: #3a8ce0;
    }
    
    .button-like {
      text-decoration: none;
    }
    
    .small-muted {
      color: #6b7280;
      font-size: 13px;
    }
    
    input[type="number"] {
      width: 90px;
      padding: 8px;
      border: 1px solid #d7e6fb;
      border-radius: 6px;
    }
    
    .note {
      font-size: 13px;
      color: #6b7280;
      margin-top: 8px;
    }
    
    /* Footer */
    footer.controls {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 20px;
      background: white;
      border-top: 1px solid #e1e8f6;
      margin-top: 20px;
    }
    
    .status {
      font-size: 14px;
      color: #7f8c8d;
    }
    
    .ghost {
      background: transparent;
      border: 2px solid #2c3e50;
      color: #2c3e50;
    }
    
    .ghost:hover {
      background: #2c3e50;
      color: white;
    }

    /* Responsive Styles */
    @media (max-width: 980px) {
      .container {
        grid-template-columns: 1fr;
        padding: 12px;
      }
      
      .container-split {
        grid-template-columns: 1fr;
      }
      
      .right-panel {
        order: 2;
      }
      
      .top-tiles {
        padding-left: 8px;
        padding-right: 8px;
      }
      
      header.topbar {
        flex-direction: column;
        gap: 15px;
        text-align: center;
      }
      
      .buttons-grid {
        grid-template-columns: 1fr;
      }
      
      .answer-options {
        flex-direction: column;
        gap: 10px;
      }
      
      footer.controls {
        flex-direction: column;
        gap: 15px;
      }
      
      .results-tiles {
        flex-direction: column;
      }
      
      .summary {
        flex-direction: column;
        gap: 10px;
        text-align: center;
      }
      
      .controls {
        flex-direction: column;
      }
    }
    
    @media (max-width: 600px) {
      .start-content {
        padding: 25px 20px;
      }
      
      h1 {
        font-size: 28px;
      }
      
      .card {
        padding: 20px 15px;
      }
    }

    /* === ÿ™ÿ≠ÿ≥ŸäŸÜÿßÿ™ ÿÆÿßÿµÿ© ŸÑŸÑŸáŸàÿßÿ™ŸÅ ÿßŸÑÿµÿ∫Ÿäÿ±ÿ© ÿ¨ÿØÿß === */
    @media (max-width: 480px) {
      /* 1. ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑÿ≠ÿßŸàŸäÿßÿ™ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ© */
      .container, .container-split, .container-full {
        grid-template-columns: 1fr !important;
        padding: 8px !important;
        gap: 10px !important;
      }
      
      /* 2. ÿ¨ÿπŸÑ ÿßŸÑŸÑŸàÿ≠ÿßÿ™ (panels) ÿ™ÿ£ÿÆÿ∞ ÿπÿ±ÿ∂ ŸÉÿßŸÖŸÑ */
      .left-panel, .right-panel, .main-panel {
        max-height: none !important;
        height: auto !important;
        overflow: visible !important;
        margin-bottom: 10px;
      }
      
      /* 3. ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑŸáŸäÿØÿ± */
      .topbar {
        flex-direction: column !important;
        align-items: stretch !important;
        padding: 10px !important;
      }
      
      .brand {
        justify-content: center;
        margin-bottom: 10px;
      }
      
      /* 4. ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑÿ£ÿ≤ÿ±ÿßÿ± ŸÅŸä ÿßŸÑŸáŸäÿØÿ± */
      .buttons-grid {
        grid-template-columns: 1fr !important;
        width: 100%;
      }
      
      .exam-btn {
        width: 100% !important;
        margin: 2px 0 !important;
        font-size: 14px !important;
        padding: 12px 8px !important;
      }
      
      /* 5. ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑÿ™ÿßŸäŸÑÿßÿ™ */
      .top-tiles {
        flex-wrap: wrap;
        justify-content: center;
      }
      
      .tile {
        flex: 0 0 calc(33% - 5px) !important;
        max-width: calc(33% - 5px) !important;
        margin: 2px;
        font-size: 11px !important;
        padding: 8px 4px !important;
      }
      
      /* 6. ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑŸÜÿµŸàÿµ */
      .passage, .text-content, .question-text {
        font-size: 15px !important;
        line-height: 1.5 !important;
      }
      
      /* 7. ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑÿÆŸäÿßÿ±ÿßÿ™ */
      .option {
        padding: 12px 10px !important;
        margin: 4px 0 !important;
      }
      
      /* 8. ÿ™ÿ≠ÿ≥ŸäŸÜ ÿ¨ÿØÿßŸàŸÑ True/False */
      .true-false-table {
        display: block;
        overflow-x: auto;
        white-space: nowrap;
      }
      
      /* 9. ÿ™ÿ≠ÿ≥ŸäŸÜ ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑŸÉÿ™ÿßÿ®ÿ© */
      .writing-textarea {
        min-height: 300px !important;
        font-size: 16px !important;
      }
      
      /* 10. ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑŸÅŸàÿ™ÿ± */
      footer.controls {
        flex-direction: column !important;
        gap: 10px !important;
      }
      
      .footer-buttons {
        width: 100%;
        display: flex;
        gap: 5px;
      }
      
      .footer-buttons .exam-btn {
        flex: 1;
      }
      
      /* 11. ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨ */
      .results-tiles {
        flex-direction: column !important;
      }
      
      .results-tile {
        margin-bottom: 10px;
      }
    }

    /* === ÿ™ÿ≠ÿ≥ŸäŸÜÿßÿ™ ŸÑŸÑŸáŸàÿßÿ™ŸÅ ÿßŸÑŸÖÿ™Ÿàÿ≥ÿ∑ÿ© === */
    @media (min-width: 481px) and (max-width: 768px) {
      .container, .container-split {
        grid-template-columns: 1fr !important;
      }
      
      .tile {
        max-width: 180px !important;
      }
    }
  </style>
</head>
<body id="body">
  <!-- Start Page -->
  <div id="start-page" class="start-container">
    <div class="start-content">
      <div class="logo">
        <div class="logo-icon">üìù</div>
        <h1>Deutsch B2 Pr√ºfung</h1>
        <div class="subtitle">Bereiten Sie sich auf Ihre Pr√ºfung vor</div>
      </div>
      <div class="card">
        <h2>Pr√ºfungsbereich ausw√§hlen</h2>
        <p>W√§hlen Sie bitte den Bereich aus, den Sie √ºben m√∂chten. Die Pr√ºfung startet automatisch in <span id="time-display">30</span> Sekunden.</p>
        <select id="sectionSelect">
          <option value="lesen">Lesen</option>
          <option value="hoeren">H√∂ren</option>
          <option value="schreiben">Schreiben</option>
        </select>
        <div class="button-container">
          <button id="cancelBtn" class="btn">Abbrechen</button>
          <button id="startBtn" class="btn">Jetzt starten</button>
        </div>
      </div>
      <div class="timer-container">
        <div class="timer-label">Die Pr√ºfung startet in:</div>
        <div class="timer" id="countdown">30</div>
        <div class="progress-bar">
          <div class="progress" id="progress"></div>
        </div>
      </div>
      <div class="info-text">Stellen Sie sicher, dass Sie in einer ruhigen Umgebung sind und gen√ºgend Zeit haben.</div>
    </div>
  </div>

  <!-- Lesen Page -->
  <div id="lesen-page" class="exam-page" style="display: none;">
    <header class="topbar" role="banner">
      <div class="brand">
        <div class="logo">test</div>
        <div class="meta">
          <div class="main-title">Deutsch - B2 (√úbung)</div>
          <div class="sub-title">Lesen ‚Äî Testbeispiel</div>
        </div>
      </div>

      <div id="timer-lesen" class="timer" aria-live="polite">Verbleibende Zeit: 90:00</div>

      <div class="buttons-grid">
        <button id="resetBtn-lesen" class="exam-btn reset">üîÑ Von neu beginnen</button>
        <button id="saveBtn-lesen" class="exam-btn save">üìã Speichern</button>
        <button id="resultBtn-lesen" class="exam-btn result">üìä Ergebnis</button>
        <button id="submitBtn-lesen" class="exam-btn submit">üèÅ Abgabe</button>
        <button class="exam-btn next" id="nextBtn-lesen">‚û°Ô∏è N√§chste Pr√ºfung</button>
      </div>
    </header>

    <div class="top-tiles" id="topTiles-lesen" role="navigation" aria-label="Sections overview"></div>

    <div class="container">
      <main class="left-panel" id="leftPanel-lesen">
        <div class="passage" id="passage-lesen">
          <h2 id="passageTitle-lesen">Aufgabe</h2>
          <div id="passageContent-lesen"></div>
        </div>
      </main>

      <aside class="right-panel" id="rightPanel-lesen" aria-labelledby="questionTitle-lesen">
        <div class="question-head">
          <div>
            <div id="sectionName-lesen" style="font-weight:800"></div>
            <div id="questionTitle-lesen" style="font-size:13px;color:#55607a">Frage</div>
          </div>
          <button id="resetSectionBtn-lesen" class="exam-btn reset-section" style="display:none;">Teil zur√ºcksetzen</button>
        </div>
        <div class="question-body" id="questionBody-lesen"></div>
        <div id="headingsBankContainer-lesen"></div>
      </aside>
    </div>

    <footer class="controls">
      <div class="footer-buttons">
        <button id="prevBtn-lesen" class="exam-btn ghost">Zur√ºck</button>
        <button id="nextBtn-lesen" class="exam-btn ghost">Weiter</button>
      </div>
      <div class="status"><span id="statusText-lesen">Nicht gespeichert</span></div>
    </footer>
  </div>

  <!-- H√∂ren Page -->
  <div id="hoeren-page" class="exam-page" style="display: none;">
    <header class="topbar" role="banner">
      <div class="brand">
        <div class="logo">test</div>
        <div class="meta">
          <div class="main-title">Deutsch - B2 (√úbung)</div>
          <div class="sub-title">H√∂rverstehen ‚Äî Testbeispiel</div>
        </div>
      </div>

      <div id="timer-hoeren" class="timer" aria-live="polite">Verbleibende Zeit: 17:00</div>

      <div class="buttons-grid">
        <button id="resetBtn-hoeren" class="exam-btn reset">üîÑ Von neu beginnen</button>
        <button id="saveBtn-hoeren" class="exam-btn save">üìã Speichern</button>
        <button id="resultBtn-hoeren" class="exam-btn result">üìä Ergebnis</button>
        <button id="submitBtn-hoeren" class="exam-btn submit">üèÅ Abgabe</button>
        <button class="exam-btn next" id="nextBtn-hoeren">‚û°Ô∏è N√§chste Pr√ºfung</button>
      </div>
    </header>

    <div class="top-tiles" id="topTiles-hoeren" role="navigation" aria-label="Sections overview"></div>

    <div class="container-full">
      <main class="main-panel" id="mainPanel-hoeren">
        <div id="contentContainer-hoeren"></div>
      </main>
    </div>

    <footer class="controls">
      <div class="footer-buttons">
        <button id="prevBtn-hoeren" class="exam-btn ghost">Zur√ºck</button>
        <button id="nextBtn-hoeren" class="exam-btn ghost">Weiter</button>
      </div>
      <div class="status"><span id="statusText-hoeren">Nicht gespeichert</span></div>
    </footer>
  </div>

  <!-- Schreiben Page -->
  <div id="schreiben-page" class="exam-page" style="display: none;">
    <header class="topbar" role="banner">
      <div class="brand">
        <div class="logo">test</div>
        <div class="meta">
          <div class="main-title">Deutsch - B2 (√úbung)</div>
          <div class="sub-title">Schreiben ‚Äî Testbeispiel</div>
        </div>
      </div>

      <div id="timer-schreiben" class="timer" aria-live="polite">Verbleibende Zeit: 30:00</div>

      <div class="buttons-grid">
        <button id="resetBtn-schreiben" class="exam-btn reset">üîÑ Von neu beginnen</button>
        <button id="saveBtn-schreiben" class="exam-btn save">üìã Speichern</button>
        <button id="resultBtn-schreiben" class="exam-btn result">üìä Ergebnis</button>
        <button id="submitBtn-schreiben" class="exam-btn submit">üèÅ Abgabe</button>
        <button class="exam-btn next" id="nextBtn-schreiben">‚û°Ô∏è N√§chste Pr√ºfung</button>
      </div>
    </header>

    <div class="top-tiles" id="topTiles-schreiben" role="navigation" aria-label="Sections overview"></div>

    <div class="container-split">
      <main class="left-panel" id="leftPanel-schreiben">
        <div class="passage" id="passage-schreiben">
          <h2 id="passageTitle-schreiben">Aufgabe</h2>
          <div id="passageContent-schreiben"></div>
        </div>
      </main>

      <aside class="right-panel" id="rightPanel-schreiben">
        <div id="writingContainer-schreiben"></div>
      </aside>
    </div>

    <footer class="controls">
      <div class="footer-buttons">
        <button id="prevBtn-schreiben" class="exam-btn ghost">Zur√ºck</button>
        <button id="nextBtn-schreiben" class="exam-btn ghost">Weiter</button>
      </div>
      <div class="status"><span id="statusText-schreiben">Nicht gespeichert</span></div>
    </footer>
  </div>

  <!-- Ergebnisse Page -->
  <div id="ergebnisse-page" class="results-page" style="display: none;">
    <header class="results-header">
      <div class="results-logo">test</div>
      <div class="results-title">Gesamtergebnis ‚Äî Deutsch B2</div>
    </header>

    <div class="results-container">
      <div class="results-tiles" id="topTiles-ergebnisse"></div>
      <div id="details-ergebnisse"></div>
      <div class="summary" id="finalSummary-ergebnisse"></div>
      <div class="controls">
        <a class="button-like" href="#" id="backBtn-ergebnisse">
          <button class="results-btn">üîÅ Zur√ºck zur Startseite</button>
        </a>
        <button id="calcBtn-ergebnisse" class="results-btn">‚úÖ Ergebnisse anzeigen</button>
      </div>
      <div class="note">Hinweis: Schreiben (45 Punkte) wird manuell eingegeben, falls nicht automatisch vorhanden.</div>
    </div>
  </div>

  <script>
    // ===== PAGE NAVIGATION =====
    function showPage(pageId) {
      // Hide all pages
      document.getElementById('start-page').style.display = 'none';
      document.getElementById('lesen-page').style.display = 'none';
      document.getElementById('hoeren-page').style.display = 'none';
      document.getElementById('schreiben-page').style.display = 'none';
      document.getElementById('ergebnisse-page').style.display = 'none';
      
      // Change body class based on page
      document.getElementById('body').className = '';
      if (pageId === 'ergebnisse-page') {
        document.getElementById('body').className = 'results-body';
      } else if (pageId !== 'start-page') {
        document.getElementById('body').className = 'exam-body';
      }
      
      // Show selected page
      document.getElementById(pageId).style.display = 'block';
      
      // Initialize the page if needed
      if (pageId === 'lesen-page' && typeof initLesenPage === 'function') {
        initLesenPage();
      } else if (pageId === 'hoeren-page' && typeof initHoerenPage === 'function') {
        initHoerenPage();
      } else if (pageId === 'schreiben-page' && typeof initSchreibenPage === 'function') {
        initSchreibenPage();
      } else if (pageId === 'ergebnisse-page' && typeof initErgebnissePage === 'function') {
        initErgebnissePage();
      }
    }

    // ===== START PAGE FUNCTIONALITY =====
    let initialCounter = 30;
    let counter = initialCounter;
    let countdownInterval;
    let countdownRunning = false;
    let examStarted = false;
    const timerEl = document.getElementById("countdown");
    const timeDisplayEl = document.getElementById("time-display");
    const progressEl = document.getElementById("progress");
    const selectEl = document.getElementById("sectionSelect");
    const startBtn = document.getElementById("startBtn");
    const cancelBtn = document.getElementById("cancelBtn");

    function startCountdown() {
      // prevent double-starts or starting after exam already began
      if (countdownRunning || examStarted) return;
      countdownRunning = true;
      // disable start button while counting
      try { startBtn.disabled = true; startBtn.setAttribute('aria-disabled','true'); } catch(e){}
      // reset counter & UI
      counter = initialCounter;
      timerEl.textContent = counter;
      timeDisplayEl.textContent = counter;
      progressEl.style.transform = "scaleX(0)";
      timerEl.style.color = "";

      countdownInterval = setInterval(() => {
        counter--;
        timerEl.textContent = counter;
        timeDisplayEl.textContent = counter;
        const progressValue = (initialCounter - counter) / initialCounter;
        progressEl.style.transform = `scaleX(${progressValue})`;
        if (counter <= 0) {
          clearInterval(countdownInterval);
          countdownInterval = null;
          countdownRunning = false;
          progressEl.style.transform = "scaleX(1)";
          // ensure exam starts only once
          if (!examStarted) {
            examStarted = true;
            startExam();
          }
          // safety: re-enable start button (page usually navigates away)
          try { startBtn.disabled = false; startBtn.removeAttribute('aria-disabled'); } catch(e){}
        }
      }, 1000);
    }

    function stopCountdown(reset = true) {
      if (countdownInterval) {
        clearInterval(countdownInterval);
        countdownInterval = null;
      }
      countdownRunning = false;
      try { startBtn.disabled = false; startBtn.removeAttribute('aria-disabled'); } catch(e){}
      progressEl.style.transform = "scaleX(0)";
      if (reset) {
        counter = initialCounter;
        timerEl.textContent = counter;
        timeDisplayEl.textContent = counter;
      } else {
        timerEl.textContent = "Gestoppt";
      }
    }

    function startExam() {
      // guard to ensure startExam is triggered once
      if (!examStarted) examStarted = true;
      const selectedSection = selectEl.value;
      if (selectedSection === 'lesen') {
        showPage('lesen-page');
      } else if (selectedSection === 'hoeren') {
        showPage('hoeren-page');
      } else if (selectedSection === 'schreiben') {
        showPage('schreiben-page');
      }
    }

    // wire buttons: start will now start the countdown (not the exam directly)
    startBtn.addEventListener('click', startCountdown);

    cancelBtn.addEventListener('click', () => {
      stopCountdown(true);
      timerEl.textContent = "Abgebrochen";
      timerEl.style.color = "#e53e3e";
    });

    // NOTE: removed automatic startCountdown() on page load to prevent the timer starting twice

    // ===== ERGEBNISSE PAGE FUNCTIONALITY =====
    function initErgebnissePage() {
      // ŸÉÿßÿ¶ŸÜ ÿßŸÑÿ•ÿ¨ÿßÿ®ÿßÿ™ ÿßŸÑÿµÿ≠Ÿäÿ≠ÿ© ÿßŸÑŸÖÿ±ŸÉÿ≤Ÿäÿ© (Ÿäÿ¨ÿ® ÿ™ÿπÿ®ÿ¶ÿ™Ÿá ŸÖŸÜ ÿßŸÑŸÖŸÑŸÅ ÿßŸÑÿ£ÿµŸÑŸä ŸÑŸÑÿßŸÖÿ™ÿ≠ÿßŸÜ ÿßŸÑÿ¨ÿØŸäÿØ)
      const CORRECT_ANSWERS = {
        lesen: {
          // ÿßŸÑÿ¨ÿ≤ÿ° ÿßŸÑÿ£ŸàŸÑ: √úberschriften zuordnen (ÿßŸÑŸÜÿµŸàÿµ 1-5)
          "text1": "h",
          "text2": "e", 
          "text3": "i",
          "text4": "c",
          "text5": "b",
          
          // ÿßŸÑÿ¨ÿ≤ÿ° ÿßŸÑÿ´ÿßŸÜŸä: Fragen zum Text (ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ© s2q1-s2q5)
          "s2q1": "s2q1o1",
          "s2q2": "s2q2o3",
          "s2q3": "s2q3o1",
          "s2q4": "s2q4o3",
          "s2q5": "s2q5o2",
          
          // ÿßŸÑÿ¨ÿ≤ÿ° ÿßŸÑÿ´ÿßŸÑÿ´: Texte zuordnen (ÿßŸÑŸÖŸàÿßŸÇŸÅ 11-20)
          "11": "D",
          "12": "H",
          "13": "J",
          "14": "X",
          "15": "f",
          "16": "B",
          "17": "E",
          "18": "G",
          "19": "A",
          "20": "C",
          
          // Sprachbausteine Teil 1 (ÿßŸÑŸÅÿ±ÿßÿ∫ÿßÿ™ 21-30)
          "21": "um",
          "22": "dass",
          "23": "aber",
          "24": "unbedingt",
          "25": "mich",
          "26": "als",
          "27": "kommenden",
          "28": "dazu",
          "29": "sondern",
          "30": "f√ºr",
          
          // Sprachbausteine Teil 2 (ÿßŸÑŸÅÿ±ÿßÿ∫ÿßÿ™ 31-40)
          "31": "KAUM",
          "32": "AUF",
          "33": "VORBEI",
          "34": "STATT",
          "35": "INNERHALB",
          "36": "M√úSSEN",
          "37": "AN",
          "38": "SOLLEN",
          "39": "DANN",
          "40": "DENN"
        },
        
        hoeren: {
          // H√∂ren Teil 1 (ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ© 41-45)
          "41": "falsch",
          "42": "richtig",
          "43": "richtig",
          "44": "falsch",
          "45": "falsch",
          
          // H√∂ren Teil 2 (ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ© 46-53)
          "46": "richtig",
          "47": "falsch",
          "48": "richtig",
          "49": "richtig",
          "50": "falsch",
          "51": "richtig",
          "52": "richtig",
          "53": "richtig",
          
          // H√∂ren Teil 3 (ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ© 54-58)
          "54": "richtig",
          "55": "falsch",
          "56": "falsch",
          "57": "richtig",
          "58": "falsch"
        }
      };

      const CONFIG = {
        totals: { 
          lesen: 105, 
          hoeren: 75, 
          schreiben: 45, 
          gesamt: 225 
        },
        counts: { 
          lesen: 40, 
          hoeren: 20 
        },
        hoerenCorrect: CORRECT_ANSWERS.hoeren,
        lesenCorrect: CORRECT_ANSWERS.lesen
      };

      // ===== ÿßŸÑÿØŸàÿßŸÑ ÿßŸÑŸÖÿ≥ÿßÿπÿØÿ© =====
      function normalizeAnswer(a) {
        if (a === null || a === undefined || a === '') return '-';
        let s = String(a).trim();
        if (s === '') return '-';
        const low = s.toLowerCase();
        if (["richtig", "true", "yes", "ja", "r"].includes(low)) return 'richtig';
        if (["falsch", "false", "no", "nein", "f"].includes(low)) return 'falsch';
        return s;
      }

      function getHeadingText(headingId) {
        if (!headingId || headingId === '-' || headingId === 'X') return '-';
        const headings = {
          "a": "F√ºr unterwegs: Leckereien im Zugrestaurant",
          "b": "In der Stadt der warmen Quellen",
          "c": "Irrtum: S√º√ües macht doch nicht gl√ºcklich",
          "d": "Mitmach-Museum: Bonbons selbst herstellen",
          "e": "Naschen statt wegwerfen",
          "f": "Neues Thermalbad in Rom",
          "g": "Reisen: Die beliebtesten Thermalb√§der",
          "h": "S√º√üwaren mit langer Tradition",
          "i": "Wasser, W√§rme, Wellness - antike Badefreuden",
          "j": "Zucker sorgt f√ºr Stimmungshoch"
        };
        return headings[headingId] || headingId;
      }

      function getOptionText(questionId, optionId) {
        if (!optionId || optionId === '-') return '-';
        const options = {
          "s2q1o1": "erhielt kurz vor Eintritt in den Ruhestand einen Preis.",
          "s2q1o2": "wechselte in ihrer beruflichen Laufbahn mehrmals die Schule.",
          "s2q1o3": "wurde schon mehrfach f√ºr Auszeichnungen vorgeschlagen.",
          "s2q2o1": "am liebsten direkt nach dem Studium heiraten wolle.",
          "s2q2o2": "mit ihrem Studium gute Perspektiven haben werde.",
          "s2q2o3": "wom√∂glich nicht genug f√ºr ihren Lebensunterhalt verdienen k√∂nne.",
          "s2q3o1": "die Sch√ºler sich im Unterricht schlecht benehmen w√ºrden.",
          "s2q3o2": "die Sch√ºler wenig Interesse an ihren F√§chern h√§tten.",
          "s2q3o3": "sie kein Talent f√ºr das Unterrichten h√§tte.",
          "s2q4o1": "haben erst nach dem Abitur von dem Wettbewerb erfahren.",
          "s2q4o2": "reichten f√ºr den Wettbewerb verschiedene Einzelbeitr√§ge ein.",
          "s2q4o3": "wollten ihr f√ºr die gelungene Pr√ºfungsvorbereitung Anerkennung zeigen.",
          "s2q5o1": "bald Zeit f√ºr ausgedehnte Reisen zu haben.",
          "s2q5o2": "mit ehemaligen Sch√ºlern ein Projekt zu planen.",
          "s2q5o3": "nun endlich in Pension gehen zu k√∂nnen."
        };
        return options[optionId] || optionId;
      }

      function getSituationText(id) {
        const situations = {
          "11": "Die Tochter einer Bekannten wird vier Jahre alt. Sie m√∂chten ihr etwas zum Geburtstag mitbringen.",
          "12": "Ein Bekannter hat sich einen Fotoapparat gekauft und m√∂chte die Grundlagen der Fotografie erlernen.",
          "13": "Ein Bekannter m√∂chte eine mehrt√§gige Reise unternehmen und dabei einen Fotokurs machen.",
          "14": "Eine Bekannte kann gut fotografieren und hat bereits einige Kurse gemacht. Sie w√ºrde gerne neue kreative Techniken kennenlernen.",
          "15": "Ein Freund w√ºrde gerne im Winter verreisen. Er m√∂chte viel Zeit an der frischen Luft verbringen und sich bewegen.",
          "16": "Eine Freundin hat viele Kleidungsst√ºcke, die sie nicht mehr tr√§gt. Sie sucht Anregungen, was sie damit machen k√∂nnte.",
          "17": "Sie besuchen einen Freund, der sich f√ºr Malerei interessiert. Sie m√∂chten ihm ein passendes Geschenk mitbringen.",
          "18": "Sie fahren gerne Ski und m√∂chten mit Ihrer Familie Wintersport machen.",
          "19": "Sie m√∂chten mit Ihrem zw√∂lfj√§hrigen Sohn eine Ausstellung besuchen. Er interessiert sich f√ºr Tiere.",
          "20": "Sie treffen sich an einem Sonntagnachmittag mit einer Freundin, die sich gerne mit Mode und ihrer Geschichte besch√§ftigt. Sie m√∂chten mit ihr etwas unternehmen."
        };
        return situations[id] || id;
      }

      function escapeHtml(s) {
        if (s === '-') return '-';
        return String(s)
          .replace(/&/g, '&amp;')
          .replace(/</g, '&lt;')
          .replace(/>/g, '&gt;')
          .replace(/"/g, '&quot;')
          .replace(/'/g, '&#039;');
      }

      function buildTable(title, dets, total, max) {
        let html = `<div class="result-item">
                      <h3>${title} - ${total.toFixed(2)}/${max} Punkte</h3>
                      <div class="section-table">
                        <table class="true-false-table">
                          <thead>
                            <tr>
                              <th style="width: 10%">Frage</th>
                              <th style="width: 40%">Ihre Antwort</th>
                              <th style="width: 40%">Richtige Antwort</th>
                              <th style="width: 10%">Ergebnis</th>
                            </tr>
                          </thead>
                          <tbody>`;
        
        dets.forEach(x => {
          const isCorrect = x.richtig;
          const rowClass = isCorrect ? 'correct-answer' : 'incorrect-answer';
          const resultIcon = isCorrect ? '‚úÖ Richtig' : '‚ùå Falsch';
          
          html += `<tr class="${rowClass}">
                    <td><strong>${x.frage}</strong></td>
                    <td>${escapeHtml(x.user)}</td>
                    <td>${escapeHtml(x.correct)}</td>
                    <td><strong>${resultIcon}</strong></td>
                  </tr>`;
        });
        
        html += `</tbody>
                </table>
                <div style="margin-top: 15px; padding: 15px; background: #e3f2fd; border-radius: 6px;">
                  <strong>Erreichte Punkte: ${total.toFixed(2)}/${max} (${((total/max)*100).toFixed(1)}%)</strong>
                </div>
              </div></div>`;
        return html;
      }

      function readExamResults() {
        try {
          const lesen = {};
          const hoeren = {};
          const schreiben = { content: '', wordCount: 0 };

          // 1) Try to read from in-memory states exposed by pages
          try {
            if (window._lesenState && window._lesenState.answers) {
              Object.keys(window._lesenState.answers).forEach(k => {
                lesen[k] = window._lesenState.answers[k];
              });
            }
          } catch (e) {}

          try {
            if (window._hoerenState && window._hoerenState.answers) {
              Object.keys(window._hoerenState.answers).forEach(sectionId => {
                const sec = window._hoerenState.answers[sectionId] || {};
                Object.keys(sec).forEach(q => {
                  hoeren[q] = sec[q];
                });
              });
            }
          } catch (e) {}

          try {
            if (window._schreibenState && window._schreibenState.answers) {
              const answers = window._schreibenState.answers;
              if (answers['s1']) {
                schreiben.content = answers['s1'];
              } else {
                const keys = Object.keys(answers);
                if (keys.length > 0) schreiben.content = answers[keys[0]] || '';
              }
              schreiben.wordCount = (schreiben.content && schreiben.content.trim()) ? String(schreiben.content).trim().split(/\s+/).filter(Boolean).length : 0;
            }
          } catch (e) {}

          // 2) Fallback to localStorage if any part is still empty
          try {
            if (Object.keys(lesen).length === 0) {
              const storedL = localStorage.getItem('lesenAnswers');
              if (storedL) Object.assign(lesen, JSON.parse(storedL));
            }
          } catch (e) {}

          try {
            if (Object.keys(hoeren).length === 0) {
              const storedH = localStorage.getItem('hoerenAnswers');
              if (storedH) Object.assign(hoeren, JSON.parse(storedH));
            }
          } catch (e) {}

          try {
            if (!schreiben.content) {
              const storedS = localStorage.getItem('schreibenAnswers');
              if (storedS) {
                const obj = JSON.parse(storedS);
                schreiben.content = obj.content || '';
                schreiben.wordCount = obj.wordCount || (schreiben.content.trim() ? String(schreiben.content).trim().split(/\s+/).filter(Boolean).length : 0);
              }
            }
          } catch (e) {}

          // final safe return
          return { hoeren, lesen, schreiben };
        } catch (e) {
          return { hoeren: {}, lesen: {}, schreiben: {} };
        }
      }

      function gradeHoeren(u) {
        const c = CORRECT_ANSWERS.hoeren;
        let okCount = 0;
        const d = [];
        
        for (let q = 41; q <= 58; q++) {
          const k = String(q);
          const uA = normalizeAnswer(u[k] || '');
          const exp = normalizeAnswer(c[k] || '');
          const ok = (uA !== '-' && uA.toLowerCase() === exp.toLowerCase());
          if (ok) okCount++;
          const ptsPer = CONFIG.totals.hoeren / CONFIG.counts.hoeren;
          d.push({
            frage: k,
            user: uA,
            correct: exp,
            richtig: ok,
            punkte: ok ? ptsPer.toFixed(2) : '0'
          });
        }
        
        const total = Number((okCount * (CONFIG.totals.hoeren / CONFIG.counts.hoeren)).toFixed(2));
        return { okCount, total, details: d };
      }

      function gradeLesen(u) {
        const c = CORRECT_ANSWERS.lesen;
        let okCount = 0;
        const d = [];
        
        // ÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ŸÉŸÑ ÿ≥ÿ§ÿßŸÑ ŸÅŸä ÿßŸÑŸÇÿ±ÿßÿ°ÿ©
        const allQuestions = [
          // ÿßŸÑŸÜÿµŸàÿµ 1-5
          "text1", "text2", "text3", "text4", "text5",
          // ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ© s2q1-s2q5
          "s2q1", "s2q2", "s2q3", "s2q4", "s2q5",
          // ÿßŸÑŸÖŸàÿßŸÇŸÅ 11-20
          "11", "12", "13", "14", "15", "16", "17", "18", "19", "20",
          // ÿßŸÑŸÅÿ±ÿßÿ∫ÿßÿ™ 21-30
          "21", "22", "23", "24", "25", "26", "27", "28", "29", "30",
          // ÿßŸÑŸÅÿ±ÿßÿ∫ÿßÿ™ 31-40
          "31", "32", "33", "34", "35", "36", "37", "38", "39", "40"
        ];
        
        allQuestions.forEach(k => {
          const exp = normalizeAnswer(c[k] || '');
          const uA = normalizeAnswer(u[k] || '');
          const ok = (uA !== '-' && uA.toLowerCase() === exp.toLowerCase());
          if (ok) okCount++;
          const ptsPer = CONFIG.totals.lesen / CONFIG.counts.lesen;
          
          let displayUser = uA;
          let displayCorrect = exp;
          
          // ÿ™ÿ≠ŸàŸäŸÑ ÿßŸÑŸÖÿπÿ±ŸÅÿßÿ™ ÿ•ŸÑŸâ ŸÜÿµŸàÿµ ŸÖŸÇÿ±Ÿàÿ°ÿ©
          if (k.startsWith('text')) {
            displayUser = getHeadingText(uA);
            displayCorrect = getHeadingText(exp);
          } else if (k.startsWith('s2q')) {
            displayUser = getOptionText(k, uA);
            displayCorrect = getOptionText(k, exp);
          } else if (['11','12','13','14','15','16','17','18','19','20'].includes(k)) {
            if (uA === 'X') {
              displayUser = 'X - Kein passender Text';
            } else {
              displayUser = uA;
            }
            if (exp === 'X') {
              displayCorrect = 'X - Kein passender Text';
            } else {
              displayCorrect = exp;
            }
          }
          
          d.push({
            frage: k,
            user: displayUser,
            correct: displayCorrect,
            richtig: ok,
            punkte: ok ? ptsPer.toFixed(2) : '0'
          });
        });
        
        const total = Number((okCount * (CONFIG.totals.lesen / CONFIG.counts.lesen)).toFixed(2));
        return { okCount, total, details: d };
      }

      function renderLesenDetails(answers) {
        let html = `<div class="result-item">
                    <h3>üìñ Leseverstehen - Detaillierte Auswertung</h3>`;
        
        // 1. √úberschriften zuordnen
        html += `<h4>Teil 1: √úberschriften zuordnen</h4>
                 <table class="true-false-table">
                   <thead>
                     <tr>
                       <th style="width: 10%">Text</th>
                       <th style="width: 40%">Ihre Antwort</th>
                       <th style="width: 40%">Richtige Antwort</th>
                       <th style="width: 10%">Ergebnis</th>
                     </tr>
                   </thead>
                   <tbody>`;
        
        for (let i = 1; i <= 5; i++) {
          const k = `text${i}`;
          const uA = normalizeAnswer(answers[k] || '');
          const exp = normalizeAnswer(CORRECT_ANSWERS.lesen[k] || '');
          const ok = (uA !== '-' && uA.toLowerCase() === exp.toLowerCase());
          const rowClass = ok ? 'correct-answer' : 'incorrect-answer';
          const resultIcon = ok ? '‚úÖ' : '‚ùå';
          
          html += `<tr class="${rowClass}">
                    <td><strong>Text ${String.fromCharCode(64+i)}</strong></td>
                    <td>${escapeHtml(getHeadingText(uA))}</td>
                    <td>${escapeHtml(getHeadingText(exp))}</td>
                    <td><strong>${resultIcon}</strong></td>
                  </tr>`;
        }
        
        html += `</tbody></table>`;
        
        // 2. Fragen zum Text
        html += `<h4 style="margin-top: 20px;">Teil 2: Fragen zum Text</h4>
                 <table class="true-false-table">
                   <thead>
                     <tr>
                       <th style="width: 10%">Frage</th>
                       <th style="width: 40%">Ihre Antwort</th>
                       <th style="width: 40%">Richtige Antwort</th>
                       <th style="width: 10%">Ergebnis</th>
                     </tr>
                   </thead>
                   <tbody>`;
        
        for (let i = 1; i <= 5; i++) {
          const k = `s2q${i}`;
          const uA = normalizeAnswer(answers[k] || '');
          const exp = normalizeAnswer(CORRECT_ANSWERS.lesen[k] || '');
          const ok = (uA !== '-' && uA.toLowerCase() === exp.toLowerCase());
          const rowClass = ok ? 'correct-answer' : 'incorrect-answer';
          const resultIcon = ok ? '‚úÖ' : '‚ùå';
          
          html += `<tr class="${rowClass}">
                    <td><strong>${i}</strong></td>
                    <td>${escapeHtml(getOptionText(k, uA))}</td>
                    <td>${escapeHtml(getOptionText(k, exp))}</td>
                    <td><strong>${resultIcon}</strong></td>
                  </tr>`;
        }
        
        html += `</tbody></table>`;
        
        // 3. Texte zuordnen
        html += `<h4 style="margin-top: 20px;">Teil 3: Texte zuordnen</h4>
                 <table class="true-false-table">
                   <thead>
                     <tr>
                       <th style="width: 10%">Situation</th>
                       <th style="width: 40%">Ihre Antwort</th>
                       <th style="width: 40%">Richtige Antwort</th>
                       <th style="width: 10%">Ergebnis</th>
                     </tr>
                   </thead>
                   <tbody>`;
        
        for (let i = 11; i <= 20; i++) {
          const k = i.toString();
          const uA = normalizeAnswer(answers[k] || '');
          const exp = normalizeAnswer(CORRECT_ANSWERS.lesen[k] || '');
          const ok = (uA !== '-' && uA.toLowerCase() === exp.toLowerCase());
          const rowClass = ok ? 'correct-answer' : 'incorrect-answer';
          const resultIcon = ok ? '‚úÖ' : '‚ùå';
          
          let displayUser = uA;
          let displayCorrect = exp;
          if (uA === 'X') displayUser = 'X - Kein passender Text';
          if (exp === 'X') displayCorrect = 'X - Kein passender Text';
          
          html += `<tr class="${rowClass}">
                    <td><strong>${k}</strong></td>
                    <td>${escapeHtml(displayUser)}</td>
                    <td>${escapeHtml(displayCorrect)}</td>
                    <td><strong>${resultIcon}</strong></td>
                  </tr>`;
        }
        
        html += `</tbody></table>`;
        
        // 4. Sprachbausteine Teil 1
        html += `<h4 style="margin-top: 20px;">Sprachbausteine Teil 1</h4>
                 <table class="true-false-table">
                   <thead>
                     <tr>
                       <th style="width: 10%">L√ºcke</th>
                       <th style="width: 40%">Ihre Antwort</th>
                       <th style="width: 40%">Richtige Antwort</th>
                       <th style="width: 10%">Ergebnis</th>
                     </tr>
                   </thead>
                   <tbody>`;
        
        for (let i = 21; i <= 30; i++) {
          const k = i.toString();
          const uA = normalizeAnswer(answers[k] || '');
          const exp = normalizeAnswer(CORRECT_ANSWERS.lesen[k] || '');
          const ok = (uA !== '-' && uA.toLowerCase() === exp.toLowerCase());
          const rowClass = ok ? 'correct-answer' : 'incorrect-answer';
          const resultIcon = ok ? '‚úÖ' : '‚ùå';
          
          html += `<tr class="${rowClass}">
                    <td><strong>${k}</strong></td>
                    <td>${escapeHtml(uA)}</td>
                    <td>${escapeHtml(exp)}</td>
                    <td><strong>${resultIcon}</strong></td>
                  </tr>`;
        }
        
        html += `</tbody></table>`;
        
        // 5. Sprachbausteine Teil 2
        html += `<h4 style="margin-top: 20px;">Sprachbausteine Teil 2</h4>
                 <table class="true-false-table">
                   <thead>
                     <tr>
                       <th style="width: 10%">L√ºcke</th>
                       <th style="width: 40%">Ihre Antwort</th>
                       <th style="width: 40%">Richtige Antwort</th>
                       <th style="width: 10%">Ergebnis</th>
                     </tr>
                   </thead>
                   <tbody>`;
        
        for (let i = 31; i <= 40; i++) {
          const k = i.toString();
          const uA = normalizeAnswer(answers[k] || '');
          const exp = normalizeAnswer(CORRECT_ANSWERS.lesen[k] || '');
          const ok = (uA !== '-' && uA.toLowerCase() === exp.toLowerCase());
          const rowClass = ok ? 'correct-answer' : 'incorrect-answer';
          const resultIcon = ok ? '‚úÖ' : '‚ùå';
          
          html += `<tr class="${rowClass}">
                    <td><strong>${k}</strong></td>
                    <td>${escapeHtml(uA)}</td>
                    <td>${escapeHtml(exp)}</td>
                    <td><strong>${resultIcon}</strong></td>
                  </tr>`;
        }
        
        html += `</tbody></table></div>`;
        return html;
      }

      function buildHoerenDetails(answers) {
        let html = `<table class="true-false-table">
                      <thead>
                        <tr>
                          <th>Frage</th>
                          <th>Ihre Antwort</th>
                          <th>Richtige Antwort</th>
                          <th>Ergebnis</th>
                        </tr>
                      </thead>
                      <tbody>`;
        
        for (let i = 41; i <= 58; i++) {
          const id = i.toString();
          const userAnswer = normalizeAnswer(answers[id] || '');
          const correctAnswer = CORRECT_ANSWERS.hoeren[id];
          const isCorrect = (userAnswer !== '-' && userAnswer.toLowerCase() === correctAnswer.toLowerCase());
          const rowClass = isCorrect ? 'correct-answer' : 'incorrect-answer';
          const resultIcon = isCorrect ? '‚úÖ' : '‚ùå';
          
          html += `<tr class="${rowClass}">
                    <td><strong>${id}</strong></td>
                    <td>${userAnswer}</td>
                    <td>${correctAnswer}</td>
                    <td><strong>${resultIcon}</strong></td>
                  </tr>`;
        }
        
        html += `</tbody></table>`;
        return html;
      }

      function renderResults() {
        const st = readExamResults() || { hoeren: {}, lesen: {}, schreiben: {} };
        const h = gradeHoeren(st.hoeren || {});
        const l = gradeLesen(st.lesen || {});
        const details = document.getElementById('details-ergebnisse');
        const tiles = document.getElementById('topTiles-ergebnisse');
        const sScoreRaw = localStorage.getItem('schreibenScore');
        const sScore = sScoreRaw ? Number(sScoreRaw) : 0;

        details.innerHTML = '';
        tiles.innerHTML = '';

        const tL = `<div class="results-tile">
                      <h3>Lesen</h3>
                      <div class="score">${l.total.toFixed(2)} / ${CONFIG.totals.lesen} Punkte</div>
                      <div class="small-muted">(${(l.total / CONFIG.totals.lesen * 100).toFixed(2)} %)</div>
                    </div>`;
                    
        const tH = `<div class="results-tile">
                      <h3>H√∂ren</h3>
                      <div class="score">${h.total.toFixed(2)} / ${CONFIG.totals.hoeren} Punkte</div>
                      <div class="small-muted">(${(h.total / CONFIG.totals.hoeren * 100).toFixed(2)} %)</div>
                    </div>`;
                    
        const tS = `<div class="results-tile">
                      <h3>Schreiben</h3>
                      <div class="score" id="schreibenScoreDisplay">${sScore.toFixed(2)} / ${CONFIG.totals.schreiben} Punkte</div>
                      <div class="small-muted">Manuelle Eingabe</div>
                    </div>`;
                    
        tiles.innerHTML = tL + tH + tS;

        details.innerHTML += `<h2>üìä Detaillierte Ergebnisse</h2>
                             <div class="instructions">Unten sehen Sie eine detaillierte Auswertung Ihrer Pr√ºfungsergebnisse.</div>`;
        
        // ÿ•ÿ∂ÿßŸÅÿ© ŸÇÿ≥ŸÖ ÿßŸÑŸÇÿ±ÿßÿ°ÿ©
        details.innerHTML += renderLesenDetails(st.lesen);
        
        // ÿ•ÿ∂ÿßŸÅÿ© ŸÇÿ≥ŸÖ ÿßŸÑÿßÿ≥ÿ™ŸÖÿßÿπ
        details.innerHTML += `<div class="result-item">
                                <h3>üëÇ H√∂rverstehen - Detaillierte Auswertung</h3>
                                ${buildHoerenDetails(st.hoeren)}
                                <div style="margin-top: 15px; padding: 15px; background: #e3f2fd; border-radius: 6px;">
                                  <strong>Erreichte Punkte: ${h.total.toFixed(2)}/${CONFIG.totals.hoeren} (${((h.total/CONFIG.totals.hoeren)*100).toFixed(1)}%)</strong>
                                </div>
                              </div>`;
        
        // ÿ•ÿ∂ÿßŸÅÿ© ŸÇÿ≥ŸÖ ÿßŸÑŸÉÿ™ÿßÿ®ÿ©
        let sHtml = '<div class="result-item"><h3>‚úçÔ∏è Schreiben - Ihre Antwort</h3>';
        const txt = st.schreiben.content ? escapeHtml(st.schreiben.content) : '<span class="small-muted">Kein Text gefunden.</span>';
        const wc = st.schreiben.wordCount || '-';
        
        sHtml += `<div class="small-muted">W√∂rter: ${wc}</div>
                  <div style="margin-top:10px;padding:12px;background:#fff;border-radius:8px;border:1px solid #eef6ff;min-height:80px; white-space: pre-wrap;">${txt}</div>
                  <div style="margin-top:10px;display:flex;gap:10px;align-items:center">
                    Punkte (0‚Äì45): 
                    <input id="sInput" type="number" min="0" max="45" step="0.5" value="${sScore}"> 
                    <button id="saveS" class="results-btn">Speichern</button>
                  </div></div>`;
                  
        details.innerHTML += sHtml;

        const total = (l.total + h.total + sScore).toFixed(2);
        const percent = ((total / CONFIG.totals.gesamt) * 100).toFixed(2);
        
        document.getElementById('finalSummary-ergebnisse').innerHTML = `
          <div class="left">
            Gesamtpunktzahl: <strong>${total}</strong> / ${CONFIG.totals.gesamt} Punkte<br>
            <span class="small-muted">Lesen + H√∂ren + Schreiben</span>
          </div>
          <div class="right">
            Prozentsatz: <strong>${percent} %</strong>
          </div>`;

        document.getElementById('saveS').onclick = () => {
          const v = Number(document.getElementById('sInput').value) || 0;
          localStorage.setItem('schreibenScore', v);
          document.getElementById('schreibenScoreDisplay').textContent = `${v.toFixed(2)} / ${CONFIG.totals.schreiben} Punkte`;
          
          const newTotal = (l.total + h.total + v).toFixed(2);
          const newPercent = ((newTotal / CONFIG.totals.gesamt) * 100).toFixed(2);
          
          document.getElementById('finalSummary-ergebnisse').innerHTML = `
            <div class="left">
              Gesamtpunktzahl: <strong>${newTotal}</strong> / ${CONFIG.totals.gesamt} Punkte<br>
              <span class="small-muted">Lesen + H√∂ren + Schreiben</span>
            </div>
            <div class="right">
              Prozentsatz: <strong>${newPercent} %</strong>
            </div>`;
        };
      }

      document.getElementById('calcBtn-ergebnisse').onclick = () => renderResults();
      document.getElementById('backBtn-ergebnisse').onclick = (e) => {
        e.preventDefault();
        showPage('start-page');
      };
      
      // Initialize results on page load
      renderResults();
    }

    // ===== LESEN PAGE FUNCTIONALITY =====
    function initLesenPage() {
      /* ===== Self-contained exam (embedded) ===== */
      const exam = {
        id: "exam-001",
        durationSec: 90 * 60,
        sections: [
          { 
            id: "s1", 
            title: "Leseverstehen, Teil 1", 
            points: 25,
            passageTitle: "Aufgabe: Ziehen Sie die passenden √úberschriften auf die Texte.",
            passage: "",
            questions: [],
            texts: [
              {
                id: "text1",
                content: "Bonbons machen Kinder gl√ºcklich, und ihre Geschichte reicht weit zur√ºck. Bereits vor √ºber 1.000 Jahren gab es in China, Griechenland und im R√∂mischen Reich S√º√üigkeiten aus Honig, Bl√ºten und Fr√ºchten. Wer mehr √ºber Bonbons erfahren m√∂chte, sollte das Bonbon-Museum in Vaihingen an der Enz besuchen. Dort befindet sich die seit 1828 bestehende Bonbonfabrik Jung und das einzige Bonbon-Museum Deutschlands. Auf 300 Quadratmetern werden Fragen zur Herkunft und Herstellung von Bonbons beantwortet, einschlie√ülich ihrer Wirkung gegen Husten. Das Museum zeigt Bonbondosen, Maschinen und Werbemittel und f√ºhrt Besucher durch die Geschichte der Bonbonproduktion.",
                correctAnswer: "h"
              },
              {
                id: "text2", 
                content: "Am Frankfurter Hauptbahnhof k√∂nnen Reisende einen besonderen Snack genie√üen: Ein 'Ret-Tomat', ein Automat mit abgelaufenen oder bald ablaufenden Schokoriegeln, Chips und anderen Leckereien, steht bereit. Diese Produkte, deren Mindesthaltbarkeitsdatum meist fast abgelaufen ist, werden g√ºnstiger angeboten. Sie sind dennoch genie√übar, wie ein Sprecher der Deutsche Bahn betont, da sie sorgf√§ltig gepr√ºft werden. Mit diesem Service will die Bahn den Bahnhof attraktiver machen, Ressourcen sch√ºtzen und auf Lebensmittelverschwendung aufmerksam machen. Reisende k√∂nnen S√º√üigkeiten kaufen und gleichzeitig einen Beitrag zur Nachhaltigkeit leisten.",
                correctAnswer: "e"
              },
              {
                id: "text3",
                content: "Die r√∂mischen Thermen galten als besondere Prestigebauten, da sie mehrere Badebecken sowie Schwitz- und Dampfb√§der boten. Doch sie waren nicht nur Orte der Entspannung, sondern auch wichtige Treffpunkte des gesellschaftlichen Lebens. Menschen trafen sich dort, tauschten sich aus oder schlossen Gesch√§fte ab. Der Besuch in einer Therme war eine der beliebtesten Freizeitaktivit√§ten im alten Rom. Mit der Zeit entwickelte sich die r√∂mische Badekultur weiter und verbreitete sich √ºber die Grenzen des Reiches hinaus. R√∂mische Badeh√§user waren bekannt f√ºr ihren Luxus, mit Mosaikb√∂den und Marmordekorationen. Sie boten Erholung gegen Alltagsstress, Verspannungen und schlechte Laune. Gegen eine geringe Geb√ºhr konnten B√ºrger diese riesigen Thermenanlagen besuchen, die bis zu 1.000 Menschen Platz boten. Die Bauwerke wurden von spezialisierten Architekten entworfen und beeindruckten durch ihre Pracht und den Komfort.",
                correctAnswer: "i"
              },
              {
                id: "text4",
                content: "Nicht nur in Hollywoodfilmen tr√∂stet man sich bei Liebeskummer mit Pralinen. Der Griff zu S√º√üigkeiten ist weltweit verbreitet, da viele glauben, sie k√∂nnten die Stimmung aufhellen, die Konzentration verbessern oder gegen M√ºdigkeit im B√ºro helfen. Doch eine Studie zeigt, dass Zucker kaum einen positiven Einfluss auf die Laune hat. Im Gegenteil: Laut Konstantin Georgiou von der Humboldt-Universit√§t sorgt Zucker eher daf√ºr, dass wir uns schlechter f√ºhlen. Die Studie ergab, dass Probanden nach Zuckerkonsum m√ºder und weniger aufmerksam waren als jene, die ein Placebo erhielten.",
                correctAnswer: "c"
              },
              {
                id: "text5",
                content: "Wellness und der Besuch von Kurorten und Thermalb√§dern haben in Ungarn eine lange Tradition. Obwohl das land keinen direkten Zugang zum Meer hat, ist es reich an Thermalquellen, aus denen warmes Grundwasser √ºber 20 Grad austritt. Dieses Wasser enth√§lt Mineralstoffe, die eine positive Wirkung auf den K√∂rper haben sollen. Besonders bekannt ist Budapest, das mit 123 Thermalquellen die gr√∂√üte Kurstadt Europas ist und zugleich als einzige Hauptstadt eines Landes auch ein ber√ºhmtes Kurbad beherbergt. In Budapest gibt es mehr als 20 B√§der, von denen viele historisch und architektonisch von gro√üer Bedeutung sind. Die B√§der sind nicht nur f√ºr Touristen ein Anziehungspunkt, sondern auch f√ºr die Stadtbewohner, die sich oft mit Freunden dort treffen.",
                correctAnswer: "b"
              }
            ],
            headings: [
              {id: "a", text: "F√ºr unterwegs: Leckereien im Zugrestaurant"},
              {id: "b", text: "In der Stadt der warmen Quellen"},
              {id: "c", text: "Irrtum: S√º√ües macht doch nicht gl√ºcklich"},
              {id: "d", text: "Mitmach-Museum: Bonbons selbst herstellen"},
              {id: "e", text: "Naschen statt wegwerfen"},
              {id: "f", text: "Neues Thermalbad in Rom"},
              {id: "g", text: "Reisen: Die beliebtesten Thermalb√§der"},
              {id: "h", text: "S√º√üwaren mit langer Tradition"},
              {id: "i", text: "Wasser, W√§rme, Wellness - antike Badefreuden"},
              {id: "j", text: "Zucker sorgt f√ºr Stimmungshoch"}
            ]
          },
          { 
            id: "s2", 
            title: "Leseverstehen, Teil 2", 
            points: 25,
            passageTitle: "Lehrkr√§ftepreis: Lehrerin aus Frankfurt ausgezeichnet",
            passage: `Fast 3000 Jahre sind vergangen, seit der griechische Dichter Homer eines der ber√ºhmtesten Werke der Weltliteratur, die _Ilias,_ niedergeschrieben haben soll. Bei Schulen daf√ºr heutzutage noch Interesse zu wecken, ist gewiss f√ºr jeden Lehrer eine Herausforderung. Doch Brigitte Vollmer gelingt es, ihre Sch√ºler f√ºr die alten Texte zu begeistern ‚Äì so spannend und plastisch sind ihre Schilderungen, mit denen sie die Heldensagen der Antike zum Leben erweckt.

Mehreren Generationen von Sch√ºlern hat die 66-J√§hrige diese Werke nahegebracht. Seit 33 Jahren unterrichtet sie Griechisch, Latein und Philosophie am Heinrich-von-Gagern-Gymnasium in Frankfurt ‚Äì dort hat sie direkt nach ihrem Referendariat angefangen und ist geblieben. Seit 22 Jahren fungiert sie au√üerdem als Fachbereichsleiterin. Vor Kurzem, wenige Monate vor Ende ihres Berufslebens, hat sie f√ºr ihr p√§dagogisches Wirken **den Deutschen Lehrkr√§ftepreis** erhalten, f√ºr den sie von ihren Sch√ºlerinnen und Sch√ºlern nominiert worden war. Es war ihre erste Nominierung bei einem Wettbewerb, und diese hatte gleich durchschlagenden Erfolg, obwohl √ºber 6000 Bewerbungen eingegangen waren.

Ihre Liebe zu alten Sprachen wurde schon w√§hrend ihrer Schulzeit in Marburg geweckt: ‚ÄûIch hatte einen wunderbaren Griechischlehrer und einen fantastischen Lateinlehrer\", erz√§hlt sie mit gl√§nzenden Augen. \"Bald war mir klar: Wenn ich irgendwas studiere, dann diese F√§cher.\" [‚Ä¶] Obwohl ihre Eltern von diesen Pl√§nen zun√§chst alles andere als begeistert waren\", erinnert sie sich lachend. Sie m√ºsse wohl irgendwann einen reichen Mann heiraten, um finanziell √ºber die Runden zu kommen, hie√ü es in der Familie. Schlie√ülich sahen schon damals die Berufsaussichten f√ºr Geisteswissenschaftler nicht immer rosig aus.

Dabei wussten ihre Eltern genau, dass das Heiraten ihr damals noch gar nicht in den Sinn kam; \"Meinen Mann habe ich erst kennengelernt, als ich 35 Jahre alt war ‚Äì und die Hauptverdienerin in unserer Familie war dann immer ich\", schmunzelt sie.

Die Sorge ihrer Eltern, dass sie in eine finanziell prek√§re Situation geraten k√∂nnte, war also unbegr√ºndet. Denn nachdem sie sich im Studium neben Griechisch und Latein auch noch der Philosophie, der Arch√§ologie und der Kunstgeschichte gewidmet hatte, entschied sie sich f√ºr eine Schullaufbahn. Allerdings erst nach einigem Z√∂gern und eigentlich nur aus Vernunftgr√ºnden. Vor Beginn ihres Referendariats in Darmstadt habe sie n√§mlich etliche Zweifel geplagt, erz√§hlt sie: \"Klar, Wissen vermitteln, anderen etwas erkl√§ren ‚Äì das konnte ich. **Aber ich habe mich daran erinnert, wie trocken wir fr√ºher manchmal zu unseren Lehrern waren. Und ich dachte: Jetzt kriegst du das zur√ºck** .\" Doch was fehlte: Begeistert seien die Eifkl√§ssler gewesen, die sie damals unterrichtete. Wohl auch deshalb, weil sie beeindruckt waren von ihrem Wissen ‚Äì und vor allem von ihrer Leidenschaft f√ºr die F√§cher, die sie unterrichtete.

Der Deutsche Lehrkr√§ftepreis wird j√§hrlich vergeben. Dank dieser Initiative k√∂nnen Sch√ºler besondere Anerkennung und Dankbarkeit f√ºr einen Lehrer oder eine Lehrerin ihrer Wahl zum Ausdruck bringen. Die Lehrer werden von Sch√ºlern aus dem laufenden oder vorherigen Abschlussjahr vorgeschlagen und in Texten, Fotos oder Videos pr√§sentiert. Die Sch√ºler arbeiten dabei entweder allein oder in einem Team. Sechs Abiturienten meldeten Brigitte Vollmer gemeinsam bei dem Wettbewerb an. \"Kurz vor der Abiturpr√ºfung haben wir von dem Preis erfahren und dachten sofort, dass Frau Vollmer die Richtige daf√ºr ist\", erz√§hlt der 19-j√§hrige Leon Walter. \"Kein Lehrer hat uns so gut auf das Abitur vorbereitet wie sie, daf√ºr sind wir ihr wirklich dankbar.\" Um die Jury mit ihrem Beitrag zu √ºberzeugen, drehten die Sch√ºler zusammen ein Video, in dem sie Frau Vollmer vorstellten.

√úber den Lehrkr√§ftepreis habe sie sich riesig gefreut, sagt sie. \"Es ist f√ºr mich nicht leicht, dass ich mich nun in den Ruhestand verabschieden muss, aber das ist ein gelungener Abschluss meiner beruflichen Laufbahn.\" Auch wenn sie ihre Arbeit vermissen wird, blickt sie optimistisch in die Zukunft: Denn sie m√∂chte nicht ganz mit dem Unterrichten aufh√∂ren, sondern unter anderem an der Volkshochschule Kurse geben. Ob sie nicht erstmal Urlaub machen wolle? \"Danach steht mir jetzt eigentlich nicht der Sinn. Ich mache vielleicht ein paar kleine Wochenendausfl√ºge, aber ich habe eigentlich ganz andere Pl√§ne.\"

Denn einige ihrer Abiturienten m√∂chten mit ihr eine Reise nach Griechenland organisieren ‚Äì eine Idee, die sie begeistert. Die Werke der antiken Dichter werden sie also weiterhin begleiten.`,
            questions: [
              {
                id: "s2q1",
                type: "single",
                text: "Brigitte Vollmer",
                options: [
                  {id: "s2q1o1", text: "erhielt kurz vor Eintritt in den Ruhestand einen Preis."},
                  {id: "s2q1o2", text: "wechselte in ihrer beruflichen Laufbahn mehrmals die Schule."},
                  {id: "s2q1o3", text: "wurde schon mehrfach f√ºr Auszeichnungen vorgeschlagen."}
                ],
                correctAnswer: "s2q1o1"
              },
              {
                id: "s2q2",
                type: "single", 
                text: "Frau Vollmers Eltern vermuteten, dass ihre Tochter",
                options: [
                  {id: "s2q2o1", text: "am liebsten direkt nach dem Studium heiraten wolle."},
                  {id: "s2q2o2", text: "mit ihrem Studium gute Perspektiven haben werde."},
                  {id: "s2q2o3", text: "wom√∂glich nicht genug f√ºr ihren Lebensunterhalt verdienen k√∂nne."}
                ],
                correctAnswer: "s2q2o3"
              },
              {
                id: "s2q3",
                type: "single",
                text: "Frau Vollmer bef√ºrchtete, dass",
                options: [
                  {id: "s2q3o1", text: "die Sch√ºler sich im Unterricht schlecht benehmen w√ºrden."},
                  {id: "s2q3o2", text: "die Sch√ºler wenig Interesse an ihren F√§chern h√§tten."},
                  {id: "s2q3o3", text: "sie kein Talent f√ºr das Unterrichten h√§tte."}
                ],
                correctAnswer: "s2q3o1"
              },
              {
                id: "s2q4",
                type: "single",
                text: "Frau Vollmers Sch√ºler",
                options: [
                  {id: "s2q4o1", text: "haben erst nach dem Abitur von dem Wettbewerb erfahren."},
                  {id: "s2q4o2", text: "reichten f√ºr den Wettbewerb verschiedene Einzelbeitr√§ge ein."},
                  {id: "s2q4o3", text: "wollten ihr f√ºr die gelungene Pr√ºfungsvorbereitung Anerkennung zeigen."}
                ],
                correctAnswer: "s2q4o3"
              },
              {
                id: "s2q5", 
                type: "single",
                text: "Brigitte Vollmer freut sich darauf,",
                options: [
                  {id: "s2q5o1", text: "bald Zeit f√ºr ausgedehnte Reisen zu haben."},
                  {id: "s2q5o2", text: "mit ehemaligen Sch√ºlern ein Projekt zu planen."},
                  {id: "s2q5o3", text: "nun endlich in Pension gehen zu k√∂nnen."}
                ],
                correctAnswer: "s2q5o2"
              }
            ]
          },
          { 
            id: "s3", 
            title: "Leseverstehen, Teil 3", 
            points: 25,
            passageTitle: "Aufgabe: Lesen Sie die zehn Situationen (11-20) und die zw√∂lf Texte (A-L). Welcher Text passt zu welcher Situation? Sie k√∂nnen jeden Text nur einmal verwenden. ManchŸÖÿß passt kein Text. W√§hlen Sie dann 'x'.",
            passage: "",
            questions: [],
            texts: [
              {id: "A", text: "Expedition ins Reich der Schneeleoparden. Schneeleoparden z√§hlen zu den seltensten Gro√ükatzen der Erde. Weltweit leben nur noch 4000 bis 6400 dieser Tiere in freier Wildbahn. Welchen Gefahren sind sie ausgesetzt? Und wie k√∂nnen wir sie sch√ºtzen? Die interaktive Ausstellung ‚ÄûExpedition Schneeleopard\" nimmt die Besucher mit auf eine Reise in das Reich der seltenen Gro√ükatzen. Mitmach-Ausstellung: wird zu einem Erlebnis f√ºr Gro√ü und Klein. Die Ausstellung: ist bis zum 23. Januar im Zoologischen Forschungsmuseum Bonn, Di bis So von 10 bis 18 Uhr zu sehen.", correctAnswer: "19"},
              {id: "B", text: "Alte Jeans, Blusen oder Kleider hat jeder bei sich im Schrank. Ob das gute St√ºck zu eng ist, aus der Mode gekommen ist ‚Äì werfen muss man es nicht. Aus alten Sachen l√§sst sich wunderbar Neues kreieren: vom Stuhlbzug bis zur trendigen Weste. Mit diesem Ratgeber n√§hen Anf√§nger Schritt f√ºr Schritt ihre neuen Accessoires aus alten Jeans ganz schnell zu einem neuen Schmuckst√ºck. Autorin Am√©lie Betker widmet sich seit √ºber f√ºnfzehn Jahren Mode-Accessoires und teilt ihr Wissen und ihre Begeisterung f√ºrs N√§hen weiterzugeben. Am√©lie Betker: Aus alt mach neu ‚Äì N√§hen mit Jeansstoff, 96 Seiten, 16,99 Euro.", correctAnswer: "16"},
              {id: "C", text: "Blauer Sto mit Historie Am 20. Mai 1873 meldete der Amerikaner Levi Strauss das Patent auf die Blue Jeans an. Die Ausstellung ‚ÄûBlue Jeans ‚Äì von der Arbeiterkleidung zum Laufsteg‚Äú zeigt, wie sich die weltber√ºhmte Hose im Laufe der Zeit entwickelte. Pr√§sentiert werden Fotos, Filme und Zeitschriften, alte Jeans-Originale und neue Designerst√ºcke. Modemuseum D√ºsseldorf 24. November bis 10. M√§rz Dienstag bis Sonntag von 10 bis 19 Uhr Eintritt: Erwachsene: 9 Euro Kinder und Jugendliche: 5 Euro.", correctAnswer: "20"},
              {id: "D", text: "Es ist ein sonniger Herbsttag, doch pl√∂tzlich f√§llt im Zauberland unerwartet Schnee. W√§hrend sich ihre Freunde in das Schneeget√ºmmel st√ºrzen, wundert sich Prinzessin Mina: Woher kommt der viele Schnee blo√ü? Und was hat es mit einem kleinen Schneefuchs, der sie am Waldrand gesehen hat? Kurz entschlossen macht sich Prinzessin Mina auf die Suche nach dem kleinen Fuchs. Eine warmherzige und stimmungsvoll illustrierte Wintergeschichte f√ºr kleine und gro√üe Prinzessinnen und Prinzen! Elisabeth Heller: Schnee im Zauberland. F√ºr Kinder ab drei Jahren, gebundenes Buch, 52 Seiten, 17,90 ‚Ç¨.", correctAnswer: "11"},
              {id: "E", text: "Schnee in der Kunst  Ein Muss f√ºr alle Schneeliebhaber: Der Band zeigt, wie sich K√ºnstler von 1800 bis heute vom Schnee inspirieren lie√üen. K√ºnstlerischen Ausdruck findet der Schnee in Gem√§lden der Romantik, des Impressionismus, Symbolismus, Impressionismus und der Neuen Sachlichkeit. Schneemotive von der Fr√ºhzeit der Fotografie bis heute sowie ausgew√§hlte Texte zur zeitgen√∂ssischen Kunst spannen den Bogen bis in die Gegenwart. Schnee in der Kunst, von Nadja Schwenzer, 312 Seiten, 200 Abbildungen gebunden mit Schutzumschlag, 39,80 ‚Ç¨ ", correctAnswer: ""},
              {id: "f", text: "M√§rchenlandschaft aus Schnee und Eis Der beliebte Kurort Oberstdorf liegt am Fu√üe der Allg√§uer Hochalpen. Winterwanderer kommen hier auf ihre Kosten: Auf den Wanderwegen gelangt man schnell in stille, verschneite Landschaft. Wir bieten ein Wanderurlaub in der Gruppe mit f√ºnf leichten bis moderaten Winterwanderungen rund um Oberstdorf. √úbernachtung in einem komfortablen Vier-Sterne-Hotel mit Wellnessbereich und Innenpool, 8 Tage mit Halbpension ab 988 ‚Ç¨ Infos unter: www.winterwanderwoche-oberstdorf.net ", correctAnswer: "15"},
              {id: "G", text: "Wintersport im Wandel der Zeit Ob auf Skiern, Schlittschuhen oder Skiern, vor der Haust√ºr oder im Winterurlaub in den Alpen: Sport und Spiel im Schnee sind f√ºr viele der InbegriÙè∞Ü eines gro√üen Wintervergn√ºgens. Dazu geh√∂ren auch private Fotos, die zeigen, wie sich Wintersport im letzten Jahrhundert entwickelt hat: vom einfachen Ausr√ºstungsst√ºck und Kleidung bis zum Hightech-Ski. Die Ausstellung zeigt, wie die kalte Jahreszeit in der Mittepunkt ger√ºckt ist. Erlebnis-Ausstellung f√ºr die ganze Familie. Termin: von 27.11. bis 27.02., Dienstag bis Sonntag, von 11 bis 17 Uhr Historisches Museum Prenzlau ", correctAnswer: "18"},
              {id: "H", text: "Atemberaubende Fotos leicht gemacht Sie m√∂chten Fotos machen, die einzigartig sind? Melden Sie sich f√ºr unser Seminar an. Dort lernen Sie die besten Techniken f√ºr Landschaftsfotografie. Teilnahme nur nach vorheriger Zahlung. Begrenzter Zugang nur f√ºr f√ºnf Personen. Kontaktieren Sie uns f√ºr weitere Informationen. Jetzt anmelden: www.nt-pictures.net ", correctAnswer: "12"},
              {id: "I", text: "N√§hen statt Einkaufsstress Die Suche nach einer perfekt sitzenden Jeans kann manchmal zum Albtraum werden: Stundenlang zieht man durch die Gesch√§fte, probiert eine Hose nach der anderen an. Warum also nicht einfach Jeans selbst n√§hen? Das ist einfacher, als es klingt. Buchen Sie unseren Online-N√§hkurs f√ºr alle. Sie werden √ºberrascht sein, wie viel Freude das N√§hen macht und wie schnell Sie Ihre neue Hose in der Hand halten. ", correctAnswer: ""},
              {id: "J", text: "Tolle Aufnahmen in einer spektakul√§ren Landschaft Smaragdgr√ºnes Wasser, majest√§tische Felsw√§nde und mit ein wenig Gl√ºck ‚Äì ein hellblauer Himmel. Diesen Traum findet man an der s√ºdlichsten Spitze Deutschlands: Die Rede ist vom K√∂nigssee in Bayern ‚Äì der ideale Ort f√ºr unseren Workshop Landschaftsfotografie. Programmpunkte:  Einf√ºhrung zur Landschaftsfotografie Arbeit mit nat√ºrlichem Licht Bildkomposition Pers√∂nliches Feedback zu den Fotos Kurs f√ºr Fortgeschrittene, maximal 5 Teilnehmer Leitung: Jenny Holzhausen, Landschaftsfotografin und Buchautorin Termin: Samstag, 04.06.2022, von 9 Uhr bis 17 Uhr Preis: 99 ‚Ç¨Trepunkt: Seestra√üe 3, 83471 Sch√∂nau am K√∂nigssee ", correctAnswer: "13"},
              {id: "K", text: "Die Schneek√∂nigin Es ist ein kalter, verschneiter Wintertag. Da bekommt der junge Kai Besuch von der Schneek√∂nigin ‚Äì und sie nimmt ihn mit in ihr eisiges Reich. Die mutige Gerda versucht alles, um Kai zu retten. Das Familien-Musical ‚ÄûDie Schneek√∂nigin\" basiert auf dem bekannten M√§rchen von Hans-Christian Andersen. Unter der Regie von Bastian N√ºchtermeier ist eine aufwendige B√ºhnenshow entstanden, Kinder ab 5 Jahren und Erwachsene sind eingeladen, in eine magische Welt einzutauchen. Und sogar Eis zum Schmelzen bringt. Die Schneek√∂nigin, das Musical Konzertsaal Jena Sonntag, 4.12., 15 Uhr Tickets ab 19,95 ‚Ç¨ ", correctAnswer: ""},
              {id: "L", text: "Lieblingsorte Der EiÙè∞Üelturm in Paris, Urlaubsorte der Kindheit, der Wald hinter dem Haus oder das Sofa daheim: An Lieblingsorten f√ºhlt man sich wohl und man besucht diese gerne. Sie inspirieren aber auch Maler, Schriftsteller und Fotografen. Und vielleicht auch Sie? Bei diesem Fotowettbewerb suchen wir Ihre Aufnahmen von besonderen Orten. Belohnt werden die besten Fotos mit tollen Preisen und einer Ver√∂Ùè∞Üentlichung in unserem Magazin. Einsendeschluss: am 30. Juni. Mehr Infos: www.fotomagazin-linse.net.", correctAnswer: ""}
            ],
            situations: [
              {id: "11", text: "Die Tochter einer Bekannten wird vier Jahre alt. Sie m√∂chten ihr etwas zum Geburtstag mitbringen."},
              {id: "12", text: " Ein Bekannter hat sich einen Fotoapparat gekauft und m√∂chte die Grundlagen der Fotografie erlernen."},
              {id: "13", text: "Ein Bekannter m√∂chte eine mehrt√§gige Reise unternehmen und dabei einen Fotokurs machen."},
              {id: "14", text: "Eine Bekannte kann gut fotografieren und hat bereits einige Kurse gemacht. Sie w√ºrde gerne neue kreative Techniken kennenlernen."},
              {id: "15", text: "Ein Freund w√ºrde gerne im Winter verreisen. Er m√∂chte viel Zeit an der frischen Luft verbringen und sich bewegen"},
              {id: "16", text: "Eine Freundin hat viele Kleidungsst√ºcke, die sie nicht mehr tr√§gt. Sie sucht Anregungen, was sie damit machen k√∂nnte."},
              {id: "17", text: "Sie besuchen einen Freund, der sich f√ºr Malerei interessiert. Sie m√∂chten ihm ein passendes Geschenk mitbringen."},
              {id: "18", text: "Sie fahren gerne Ski und m√∂chten mit Ihrer Familie Wintersport machen."},
              {id: "19", text: "Sie m√∂chten mit Ihrem zw√∂lfj√§hrigen Sohn eine Ausstellung besuchen. Er interessiert sich f√ºr Tiere."},
              {id: "20", text: "Sie treffen sich an einem Sonntagnachmittag mit einer Freundin, die sich gerne mit Mode und ihrer Geschichte besch√§ftigt. Sie m√∂chten mit ihr etwas unternehmen"}
            ]
          },
          { 
            id: "s4", 
            title: "Sprachbausteine, Teil 1", 
            points: 15,
            passageTitle: "Aufgabe: Erg√§nzen Sie den Text. W√§hlen Sie f√ºr jede L√ºcke das passende Wort.",
            passage: "",
            questions: [],
            fillBlanks: [
              {
                id: "21",
                options: ["anstatt", "ohne", "um"],
                correctAnswer: "um"
              },
              {
                id: "22",
                options: ["dass", "ob", "w√§hrend"],
                correctAnswer: "dass"
              },
              {
                id: "23",
                options: ["aber", "denn", "und"],
                correctAnswer: "aber"
              },
              {
                id: "24",
                options: ["bestimmt", "unbedingt", "v√∂llig"],
                correctAnswer: "unbedingt"
              },
              {
                id: "25",
                options: ["dich", "mich", "sich"],
                correctAnswer: "mich"
              },
              {
                id: "26",
                options: ["als", "wenn", "wie"],
                correctAnswer: "als"
              },
              {
                id: "27",
                options: ["baldigen", "kommenden", "vergangenen"],
                correctAnswer: "kommenden"
              },
              {
                id: "28",
                options: ["danach", "dar√ºber", "dazu"],
                correctAnswer: "dazu"
              },
              {
                id: "29",
                options: ["aber", "oder", "sondern"],
                correctAnswer: "sondern"
              },
              {
                id: "30",
                options: ["f√ºr", "gegen", "ohne"],
                correctAnswer: "f√ºr"
              }
            ],
            fillText: `Hallo Ferdinand,

nun habe ich mich schon so lange nicht bei dir gemeldet - das tut mir wirklich leid! Ich hatte in den vergangenen Monaten viel Stress, weil ich ja nun studiere und nebenbei noch arbeiten muss, ________ meine Miete und alles andere bezahlen zu k√∂nnen. Zum Gl√ºck macht mir mein Nebenjob wenigstens Spa√ü. Ich wei√ü nicht, ________ ich das sonst durchhalten w√ºrde. Vielleicht habe ich dir schon erz√§hlt, dass ich abends und am Wochenende in einer Kneipe in der K√ºche helfe. Das ist zwar oft sehr anstrengend, ________ anderseits ist dauernd was los, es wird nicht langweilig, und meine Kollegen sind total nett. Erinnerst du dich noch an unsere Zeit in der Grundschule? Mit acht Jahren wollte ich ja ________ Kellnerin werden, weil man da Trinkgeld bekommt. Naja, jetzt bin ich in der K√ºche gelandet, knapp daneben ist auch vorbei ;)

Was macht denn deine Ausbildung? Wenn ich ________ nicht t√§usche, bist du ja in einem halben Jahr schon fertig, oder? Das ist ja nicht more lang!

Neulich habe ich √ºbrigens Tina und Kevin hier in der N√§he der Uni getroffen - die waren ja schon ein Paar, ________ wir noch in der Schule gegangen sind, und jetzt will sie tats√§chlich verheiratet!

Wie sehen denn deine Pl√§ne f√ºr die ________ Wochenenden aus? Wir k√∂nnten uns ja vielleicht mal wieder treffen und in Ruhe quatschen - h√§ttest du Lust ________ ?

In meiner Stra√üe hat vor einem Monat ein nettes kleines Caf√© aufgemacht, die haben nicht nur sehr leckere Kuchen, ________ auch einige kleine Gerichte zu wirklich g√ºnstigen Preisen. W√§re das was ________ dich? Mail wir doch einfach, wenn du magst, ich w√ºrde mich freuen.

Viele Gr√º√üe,

Nadine`
          },
          { 
            id: "s5", 
            title: "Sprachbausteine, Teil 2", 
            points: 15,
            passageTitle: "Aufgabe: Lesen Sie den Text und entscheiden Sie, welches Wort in welche L√ºcke passt. Sie k√∂nnen jedes Wort ŸÅŸÇÿ∑ einmal verwenden. Nicht alle W√∂rter passen in den Text.",
            passage: "",
            questions: [],
            fillBlanks2: [
              {
                id: "31",
                options: ["AN", "AUF", "BEINAHE", "DAF√úR", "DANN", "DENN", "D√úRFEN", "FAST", "INNERHALB", "KAUM", "M√úSSEN", "SOLLEN", "STATT", "VOR", "VORBEI"],
                correctAnswer: "KAUM"
              },
              {
                id: "32", 
                options: ["AN", "AUF", "BEINAHE", "DAF√úR", "DANN", "DENN", "D√úRFEN", "FAST", "INNERHALB", "KAUM", "M√úSSEN", "SOLLEN", "STATT", "VOR", "VORBEI"],
                correctAnswer: "AUF"
              },
              {
                id: "33",
                options: ["AN", "AUF", "BEINAHE", "DAF√úR", "DANN", "DENN", "D√úRFEN", "FAST", "INNERHALB", "KAUM", "M√úSSEN", "SOLLEN", "STATT", "VOR", "VORBEI"],
                correctAnswer: "VORBEI"
              },
              {
                id: "34",
                options: ["AN", "AUF", "BEINAHE", "DAF√úR", "DANN", "DENN", "D√úRFEN", "FAST", "INNERHALB", "KAUM", "M√úSSEN", "SOLLEN", "STATT", "VOR", "VORBEI"],
                correctAnswer: "STATT"
              },
              {
                id: "35",
                options: ["AN", "AUF", "BEINAHE", "DAF√úR", "DANN", "DENN", "D√úRFEN", "FAST", "INNERHALB", "KAUM", "M√úSSEN", "SOLLEN", "STATT", "VOR", "VORBEI"],
                correctAnswer: "INNERHALB"
              },
              {
                id: "36",
                options: ["AN", "AUF", "BEINAHE", "DAF√úR", "DANN", "DENN", "D√úRFEN", "FAST", "INNERHALB", "KAUM", "M√úSSEN", "SOLLEN", "STATT", "VOR", "VORBEI"],
                correctAnswer: "M√úSSEN"
              },
              {
                id: "37",
                options: ["AN", "AUF", "BEINAHE", "DAF√úR", "DANN", "DENN", "D√úRFEN", "FAST", "INNERHALB", "KAUM", "M√úSSEN", "SOLLEN", "STATT", "VOR", "VORBEI"],
                correctAnswer: "AN"
              },
              {
                id: "38",
                options: ["AN", "AUF", "BEINAHE", "DAF√úR", "DANN", "DENN", "D√úRFEN", "FAST", "INNERHALB", "KAUM", "M√úSSEN", "SOLLEN", "STATT", "VOR", "VORBEI"],
                correctAnswer: "SOLLEN"
              },
              {
                id: "39",
                options: ["AN", "AUF", "BEINAHE", "DAF√úR", "DANN", "DENN", "D√úRFEN", "FAST", "INNERHALB", "KAUM", "M√úSSEN", "SOLLEN", "STATT", "VOR", "VORBEI"],
                correctAnswer: "DANN"
              },
              {
                id: "40",
                options: ["AN", "AUF", "BEINAHE", "DAF√úR", "DANN", "DENN", "D√úRFEN", "FAST", "INNERHALB", "KAUM", "M√úSSEN", "SOLLEN", "STATT", "VOR", "VORBEI"],
                correctAnswer: "DENN"
              }
            ],
            wordBank: ["AN", "AUF", "BEINAHE", "DAF√úR", "DANN", "DENN", "D√úRFEN", "FAST", "INNERHALB", "KAUM", "M√úSSEN", "SOLLEN", "STATT", "VOR", "VORBEI"],
            fillText2: `Das Fahrrad: ernsthafte Konkurrenz f√ºrs Auto?

Welches Fortbewegungsmittel, denken Sie, wird in Deutschland am h√§ufigsten benutzt? Nat√ºrlich das Automobil. Volkswagen, Porsche, Mercedes Benz, BMW, Audi: In ________ einem anderen Land gibt es so viele Automobilfabriken wie in Deutschland, spielt die Automobilindustrie eine so gro√üe Rolle. Nahezu jeder Haushalt verf√ºgt √ºber mindestens ein Auto, das Auto spielt im Leben der Deutschen eine gro√üe Rolle, sowohl als Fortbewegungsmittel zum Arbeitsplatz oder in den Urlaub als auch als Statussymbol: Zeig mir dein Auto und ich wei√ü, wer du bist.

Doch hat das Autofahren auch Schattenseiten. Mangelnde Bewegungsm√∂glichkeiten, gesundheitliche Probleme und Stress bringen zumindest in den Gro√üst√§dten immer more Autofahrer dazu, sich vom Automobil freizumachen und ________ ein anderes Verkehrsmittel umzusteigen, das in dem Ruf steht, ges√ºnder zu sein als das Auto: das Fahrrad. Nicht nur in der Freizeit, sondern auch auf dem Weg zum Arbeitsplatz wird das Rad benutzt. "Ich habe keine Lust, Morgen f√ºr Morgen im Stau zu stehen und Zeit zu verlieren", sagt Bettina Meier (25): "Da ist es viel entspannender, auf den zumeist gut ausgebauten Fahrradwegen an den im Stau wartenden Fahrzeugen ________ und ausgeruht am Arbeitsplatz anzukommen."

Dass Fahrradfahren um einiges ges√ºnder ist, als hinter dem Lenkrad zu sitzen, best√§tigen auch die Mediziner. Wer Fahrrad f√§hrt ________ zu sitzen, bringt seinen Blutkreislauf in Schwung, st√§rkt die Abwehrkr√§fte des K√∂rpers und trainiert seinen K√∂rper. Auch die Bewegung an der frischen Luft tut Menschen gut, die sich sonst die meiste Zeit ________ geschlossener R√§ume in B√ºros, Schulen oder Fabriken aufhalten ________.

Auch die Gesch√§ftswelt hat die Fahrradfahrer als Kunden entdeckt. Ein breites Angebot ________ Zubeh√∂r f√ºr Fahrr√§der von schicken Radfelgen √ºber sportliche Mehrganggetriebe, mit denen Berge kein Problem mehr darstellen, bis zur Designer-Trinkflasche machen aus dem einfachen Fahrrad ein exlusives Fahrzeug. Und nat√ºrlich darf bei keinem Fahrradfahrer eine aufw√§ndige Sicherheitsausstattung more fehlen: Schutzhelme, Ellenbogen- und Kniesch√ºtzer, die das Fahrrad im Falle eines Unfalls fast so sicher wie einen Panzer machen ________.

Nur wenn es regnet und das passiert in Deutschland leider nicht so selten -, ________ sind die Autoschlangen wieder l√§nger. ________ einen praktischen Wetterschutz f√ºr Radfahrer haben die Gesch√§fte noch nicht im Angebot.`
          }
        ]
      };

      /* ===== State & DOM refs ===== */
      let state = { 
        sectionIndex: 0, 
        questionIndex: 0, 
        answers: {}, 
        marked: {}, 
        remaining: exam.durationSec,
        showResults: false,
        timerStarted: false,
        timerInterval: null
      };
      const topTiles = document.getElementById('topTiles-lesen');
      const passageTitleEl = document.getElementById('passageTitle-lesen');
      const passageContentEl = document.getElementById('passageContent-lesen');
      const sectionNameEl = document.getElementById('sectionName-lesen');
      const questionTitleEl = document.getElementById('questionTitle-lesen');
      const questionBodyEl = document.getElementById('questionBody-lesen');
      const headingsBankContainer = document.getElementById('headingsBankContainer-lesen');
      const timerEl = document.getElementById('timer-lesen');
      const statusText = document.getElementById('statusText-lesen');
      const resultBtn = document.getElementById('resultBtn-lesen');
      const resetBtn = document.getElementById('resetBtn-lesen');
      const resetSectionBtn = document.getElementById('resetSectionBtn-lesen');

      /* ===== Timer Functions ===== */
      function startTimer(){
        if(state.timerInterval) {
          clearInterval(state.timerInterval);
        }
        
        state.timerStarted = true;
        state.timerInterval = setInterval(()=>{
          if(state.remaining <= 0){
            clearInterval(state.timerInterval);
            timerEl.textContent = 'Zeit abgelaufen';
            return;
          }
          state.remaining--;
          updateTimerDisplay();
        }, 1000);
      }

      function resetTimer(){
        if(state.timerInterval) {
          clearInterval(state.timerInterval);
        }
        state.remaining = exam.durationSec;
        state.timerStarted = false;
        updateTimerDisplay();
        startTimer();
      }

      function updateTimerDisplay(){
        const min = Math.floor(state.remaining / 60);
        const sec = state.remaining % 60;
        timerEl.textContent = `Verbleibende Zeit: ${min.toString().padStart(2, '0')}:${sec.toString().padStart(2, '0')}`;
      }

      /* ===== Reset Section Function ===== */
      function resetCurrentSection() {
        const currentSection = exam.sections[state.sectionIndex];
        
        if (confirm(`M√∂chten Sie wirklich den Teil "${currentSection.title}" zur√ºcksetzen? Alle Antworten in diesem Teil werden gel√∂scht.`)) {
          if (currentSection.id === 's1') {
            currentSection.texts.forEach(text => {
              delete state.answers[text.id];
            });
          } else if (currentSection.id === 's2') {
            currentSection.questions.forEach(question => {
              delete state.answers[question.id];
            });
          } else if (currentSection.id === 's3') {
            currentSection.situations.forEach(situation => {
              delete state.answers[situation.id];
            });
          } else if (currentSection.id === 's4') {
            currentSection.fillBlanks.forEach(blank => {
              delete state.answers[blank.id];
            });
          } else if (currentSection.id === 's5') {
            currentSection.fillBlanks2.forEach(blank => {
              delete state.answers[blank.id];
            });
          }
          
          renderAll();
        }
      }

      /* ===== Render ===== */
      function renderTopTiles(){ 
        topTiles.innerHTML=''; 
        exam.sections.forEach((sec,idx)=>{ 
          const div=document.createElement('div'); 
          div.className='tile'+(idx===state.sectionIndex?' active':'')+(isSectionDone(sec)?' done':''); 
          div.innerHTML=`<div>${sec.title}</div><div class="points">${sec.points} P</div>`; 
          div.onclick=()=>{state.sectionIndex=idx; state.questionIndex=0; state.showResults=false; renderAll();}; 
          topTiles.appendChild(div); 
        }); 
      }

      function isSectionDone(section){
        if(section.id==='s1') return section.texts.every(t=>state.answers[t.id]);
        if(section.id==='s2') return section.questions.every(q=>state.answers[q.id]);
        if(section.id==='s3') return section.situations.every(h=>state.answers[h.id] || state.answers[h.id] === 'X');
        if(section.id==='s4') return section.fillBlanks.every(b=>state.answers[b.id]);
        if(section.id==='s5') return section.fillBlanks2.every(b=>state.answers[b.id]);
        return false;
      }

      function renderAll(){
        renderTopTiles();
        const section = exam.sections[state.sectionIndex];
        sectionNameEl.textContent = section.title;
        passageTitleEl.textContent = section.passageTitle;
        
        resetSectionBtn.style.display = 'block';
        
        if(state.showResults){
          renderResults();
          return;
        }
        
        if(section.id === 's1'){
          renderPart1();
        } else if(section.id === 's2'){
          renderPart2();
        } else if(section.id === 's3'){
          renderPart3();
        } else if(section.id === 's4'){
          renderSprachbausteine1();
        } else if(section.id === 's5'){
          renderSprachbausteine2();
        }
      }

      function renderPart1(){
        const section = exam.sections[state.sectionIndex];
        
        let textsHTML = `<div class="instructions">Ziehen Sie die passenden √úberschriften auf die Texte. Sie k√∂nnen jede √úberschrift nur einmal verwenden.</div>`;
        
        section.texts.forEach((text, idx) => {
          const letter = String.fromCharCode(97 + idx);
          const selectedHeading = state.answers[text.id];
          
          textsHTML += `
            <div class="text-container">
              <div class="text-title">Text ${letter.toUpperCase()}</div>
              <div class="text-content">${text.content}</div>
              <div class="title-slot ${selectedHeading ? 'has-title' : ''}" data-text-id="${text.id}">
                ${selectedHeading ? getHeadingTextById(selectedHeading) : 'Ziehen Sie hier eine √úberschrift hin'}
              </div>
            </div>
          `;
        });
        
        passageContentEl.innerHTML = textsHTML;
        
        let headingsHTML = `<div class="headings-bank">`;
        section.headings.forEach(heading => {
          const isUsed = section.texts.some(text => state.answers[text.id] === heading.id);
          
          headingsHTML += `
            <div class="heading-item ${isUsed ? 'used' : ''}" draggable="${!isUsed}" data-heading-id="${heading.id}">
              ${heading.id}) ${heading.text}
            </div>
          `;
        });
        
        headingsHTML += `</div>`;
        
        headingsBankContainer.innerHTML = headingsHTML;
        
        setupDragAndDrop();
        
        questionBodyEl.innerHTML = '';
        questionTitleEl.textContent = '';
      }

      function getHeadingTextById(id){
        const section = exam.sections[state.sectionIndex];
        const heading = section.headings.find(h => h.id === id);
        return heading ? `${heading.id}) ${heading.text}` : '';
      }

      function setupDragAndDrop(){
        const headingItems = document.querySelectorAll('.heading-item:not(.used)');
        const titleSlots = document.querySelectorAll('.title-slot');
        
        headingItems.forEach(item => {
          item.addEventListener('dragstart', (e) => {
            e.dataTransfer.setData('text/plain', e.target.dataset.headingId);
          });
        });
        
        titleSlots.forEach(slot => {
          slot.addEventListener('dragover', (e) => {
            e.preventDefault();
            slot.style.background = '#e8f4ff';
          });
          
          slot.addEventListener('dragleave', (e) => {
            slot.style.background = slot.classList.contains('has-title') ? '#e8fbe9' : '#f8fbff';
          });
          
          slot.addEventListener('drop', (e) => {
            e.preventDefault();
            const headingId = e.dataTransfer.getData('text/plain');
            const textId = slot.dataset.textId;
            
            Object.keys(state.answers).forEach(key => {
              if(state.answers[key] === headingId) {
                delete state.answers[key];
              }
            });
            
            state.answers[textId] = headingId;
            renderAll();
          });
        });
      }

      function renderPart2(){
        const section = exam.sections[state.sectionIndex];
        
        passageContentEl.innerHTML = `<div class="passage">${section.passage}</div>`;
        
        let questionsHTML = `<div class="all-questions">`;
        
        section.questions.forEach((question, idx) => {
          const questionNumber = idx + 1;
          const userAnswer = state.answers[question.id];
          
          questionsHTML += `
            <div class="question-block">
              <div class="question-text">${questionNumber}. ${question.text}</div>
              <div class="options">
                ${question.options.map(opt => `
                  <div class="option ${userAnswer === opt.id ? 'selected' : ''}" 
                       onclick="window.lesenApp.selectOption('${question.id}', '${opt.id}')">
                    <div class="radio"></div>
                    <div>${opt.text}</div>
                  </div>
                `).join('')}
              </div>
            </div>
          `;
        });
        
        questionsHTML += `</div>`;
        
        questionBodyEl.innerHTML = questionsHTML;
        questionTitleEl.textContent = '';
        headingsBankContainer.innerHTML = '';
      }

      function renderPart3(){
        const section = exam.sections[state.sectionIndex];
        
        let textsHTML = `
          <div class="instructions">Ziehen Sie die passenden Situationen auf die Texte. Sie k√∂nnen jede Situation nur einmal verwenden. Manchmal passt keine Situation.</div>
          <div class="texts-list">
            <h3>Texte (A-L)</h3>
        `;
        
        section.texts.forEach(text => {
          const userAnswer = Object.keys(state.answers).find(key => state.answers[key] === text.id);
          const selectedSituation = userAnswer ? section.situations.find(h => h.id === userAnswer) : null;
          
          textsHTML += `
            <div class="text-item" data-text-id="${text.id}">
              <div class="text-letter">${text.id})</div>
              <div class="text-content">${text.text}</div>
              <div class="title-slot ${userAnswer ? 'has-title' : ''} ${userAnswer === 'X' ? 'has-x' : ''}" data-text-id="${text.id}">
                ${selectedSituation ? selectedSituation.text : (userAnswer === 'X' ? 'X - Keine passende Situation' : 'Ziehen Sie hier eine Situation hin')}
              </div>
            </div>
          `;
        });
        
        textsHTML += `</div>`;
        
        passageContentEl.innerHTML = textsHTML;
        
        let situationsHTML = `
          <div class="situations-list">
            <h3>Situationen (11-20)</h3>
        `;
        
        section.situations.forEach((situation, idx) => {
          const situationNumber = parseInt(situation.id);
          const isUsed = state.answers[situation.id];
          const isX = state.answers[situation.id] === 'X';
          
          situationsHTML += `
            <div class="situation-item ${isUsed ? 'used' : ''}" draggable="${!isUsed}" data-situation-id="${situation.id}">
              <div class="situation-number">${situationNumber}.</div>
              <div class="situation-text">${situation.text}</div>
              ${!isUsed ? `<button class="exam-btn no-match ${isX ? 'selected' : ''}" onclick="window.lesenApp.markNoMatch('${situation.id}')">X - Kein passender Text</button>` : ''}
            </div>
          `;
        });
        
        situationsHTML += `</div>`;
        
        questionBodyEl.innerHTML = situationsHTML;
        questionTitleEl.textContent = '';
        headingsBankContainer.innerHTML = '';
        
        setupPart3DragAndDrop();
      }

      function markNoMatch(situationId) {
        Object.keys(state.answers).forEach(key => {
          if(state.answers[key] === situationId) {
            delete state.answers[key];
          }
        });
        
        state.answers[situationId] = 'X';
        try{ localStorage.setItem('lesenAnswers', JSON.stringify(state.answers)); }catch(e){}
        
        renderAll();
      }

      function setupPart3DragAndDrop(){
        const situationItems = document.querySelectorAll('.situation-item:not(.used)');
        const textSlots = document.querySelectorAll('.text-item .title-slot');
        
        situationItems.forEach(item => {
          item.addEventListener('dragstart', (e) => {
            e.dataTransfer.setData('text/plain', e.target.dataset.situationId);
          });
        });
        
        textSlots.forEach(slot => {
          slot.addEventListener('dragover', (e) => {
            e.preventDefault();
            slot.style.background = '#e8f4ff';
          });
          
          slot.addEventListener('dragleave', (e) => {
            const hasTitle = slot.classList.contains('has-title');
            const hasX = slot.classList.contains('has-x');
            slot.style.background = hasTitle ? '#e8fbe9' : (hasX ? '#f8d7da' : '#f8fbff');
          });
          
          slot.addEventListener('drop', (e) => {
            e.preventDefault();
            const situationId = e.dataTransfer.getData('text/plain');
            const textId = slot.dataset.textId;
            
            Object.keys(state.answers).forEach(key => {
              if(state.answers[key] === situationId) {
                delete state.answers[key];
              }
            });
            
            state.answers[situationId] = textId;
            renderAll();
          });
        });
      }

      function renderSprachbausteine1(){
        const section = exam.sections[state.sectionIndex];
        
        let textWithBlanks = section.fillText;
        
        const blankPlaceholders = [];
        section.fillBlanks.forEach(blank => {
          blankPlaceholders.push(`BLANK_${blank.id}`);
        });
        
        let tempText = textWithBlanks;
        blankPlaceholders.forEach((placeholder, index) => {
          tempText = tempText.replace('________', placeholder);
        });
        
        section.fillBlanks.forEach(blank => {
          const userAnswer = state.answers[blank.id];
          const displayText = userAnswer ? userAnswer : '________';
          tempText = tempText.replace(`BLANK_${blank.id}`, `<span class="blank-word ${userAnswer ? 'has-answer' : ''}" data-blank-id="${blank.id}">${displayText}</span>`);
        });
        
        passageContentEl.innerHTML = `
          <div class="instructions">Klicken Sie auf jede L√ºcke und w√§hlen Sie das passende Wort aus. Sie k√∂nnen die L√ºcken in beliebiger Reihenfolge ausf√ºllen.</div>
          <div class="fill-blank-container">${tempText}</div>
        `;
        
        document.querySelectorAll('.blank-word').forEach(blank => {
          blank.addEventListener('click', (e) => {
            showOptionsPopup(e.target);
          });
        });
        
        let optionsHTML = `<div class="horizontal-options" style="gap: 8px;">`;
        
        section.fillBlanks.forEach(blank => {
          const userAnswer = state.answers[blank.id];
          
          optionsHTML += `
            <div class="option-row" style="padding: 8px; margin-bottom: 5px;">
              <div class="option-number">${blank.id}</div>
              <div class="option-buttons">
                ${blank.options.map(opt => `
                  <div class="option-btn ${userAnswer === opt ? 'selected' : ''}" 
                       onclick="window.lesenApp.selectSprachbausteine1('${blank.id}', '${opt}')" 
                       style="padding: 6px 12px; font-size: 12px;">
                    ${opt}
                  </div>
                `).join('')}
              </div>
            </div>
          `;
        });
        
        optionsHTML += `</div>`;
        
        questionBodyEl.innerHTML = optionsHTML;
        questionTitleEl.textContent = '';
        headingsBankContainer.innerHTML = '';
      }

      function showOptionsPopup(blankElement){
        const existingPopup = document.querySelector('.options-popup');
        if(existingPopup) {
          existingPopup.remove();
        }
        
        const blankId = blankElement.getAttribute('data-blank-id');
        const section = exam.sections.find(s => s.id === 's4');
        const blank = section.fillBlanks.find(b => b.id === blankId);
        
        if(!blank) return;
        
        const popup = document.createElement('div');
        popup.className = 'options-popup';
        
        blank.options.forEach(opt => {
          const optionItem = document.createElement('div');
          optionItem.className = 'option-item';
          optionItem.textContent = opt;
          optionItem.onclick = () => {
            selectSprachbausteine1(blankId, opt);
            popup.remove();
          };
          popup.appendChild(optionItem);
        });
        
        blankElement.appendChild(popup);
      }

      function selectSprachbausteine1(blankId, answer){
        state.answers[blankId] = answer;
        renderAll();
      }

      function renderSprachbausteine2(){
        const section = exam.sections[state.sectionIndex];
        // Build text but replace blanks with unique placeholders first (prevents ambiguous replacements)
        let textWithPlaceholders = section.fillText2;
        const placeholders = [];
        section.fillBlanks2.forEach(blank => {
          const ph = `BLANK_${blank.id}`;
          placeholders.push({id: blank.id, ph});
          // replace first occurrence of the visual underline with placeholder
          textWithPlaceholders = textWithPlaceholders.replace('________', ph);
        });

        // Now replace placeholders with actual span elements showing current answer (or underscore)
        placeholders.forEach(item => {
          const userAnswer = state.answers[item.id];
          const displayText = userAnswer ? userAnswer : '________';
          const span = `<span class="blank-slot ${userAnswer ? 'has-answer' : ''}" data-blank-id="${item.id}">${displayText}</span>`;
          textWithPlaceholders = textWithPlaceholders.replace(item.ph, span);
        });

        passageContentEl.innerHTML = `
          <div class="instructions">Klicken Sie auf jede L√ºcke und w√§hlen Sie das passende Wort aus. Sie k√∂nnen jedes Wort nur einmal verwenden.</div>
          <div class="fill-blank-container">${textWithPlaceholders}</div>
        `;

        // attach click handlers to slots
        document.querySelectorAll('.blank-slot').forEach(slot => {
          slot.addEventListener('click', (e) => {
            // use the element itself to open popup
            showSprachbausteine2Options(slot);
          });
        });

        // Build word bank on the right
        let wordBankHTML = `<div class="word-bank-vertical" style="gap: 8px;">`;
        const usedWords = Object.values(state.answers);
        // Use section.wordBank if present, otherwise derive from fillBlanks2 options
        const bank = section.wordBank && section.wordBank.length ? section.wordBank : (section.fillBlanks2[0] ? section.fillBlanks2[0].options : []);
        bank.forEach(word => {
          const isUsed = usedWords.includes(word);
          wordBankHTML += `
            <div class="bank-word-vertical ${isUsed ? 'used' : ''}" 
                 draggable="${!isUsed}" 
                 data-word="${word}"
                 ${!isUsed ? `onclick="window.lesenApp.selectSprachbausteine2FromBank('${word}')"` : ''}>
              ${word}
            </div>
          `;
        });
        wordBankHTML += `</div>`;
        questionBodyEl.innerHTML = wordBankHTML;
        questionTitleEl.textContent = '';
        headingsBankContainer.innerHTML = '';

        setupSprachbausteine2DragAndDrop();
      }

      // --- Added functions to handle drag/drop and clicks for Sprachbausteine Teil 2 ---
      let lastClickedSprachSlot = null;

      function setupSprachbausteine2DragAndDrop(){
        // bank words: make draggable if not used, attach dragstart
        const bankWords = Array.from(document.querySelectorAll('.bank-word-vertical'));
        bankWords.forEach(el => {
          const word = el.dataset.word;
          if(!el.classList.contains('used')){
            el.setAttribute('draggable','true');
          } else {
            el.setAttribute('draggable','false');
          }
          // ensure single attached listener
          el.removeEventListener('dragstart', el._dstart);
          el._dstart = (e) => {
            e.dataTransfer.setData('text/plain', word);
            // also set an indicator
            e.dataTransfer.setData('source', 'bank');
          };
          el.addEventListener('dragstart', el._dstart);

          // keep onclick behavior (select into clicked slot)
          el.removeEventListener('click', el._onclick);
          el._onclick = () => {
            if(el.classList.contains('used')) return;
            selectSprachbausteine2FromBank(word);
          };
          el.addEventListener('click', el._onclick);
        });

        // blank slots: allow drop
        const slots = Array.from(document.querySelectorAll('.blank-slot'));
        slots.forEach(slot => {
          slot.addEventListener('dragover', (e) => {
            e.preventDefault();
            slot.classList.add('drag-over');
          });
          slot.addEventListener('dragleave', (e) => {
            slot.classList.remove('drag-over');
          });
          slot.addEventListener('drop', (e) => {
            e.preventDefault();
            slot.classList.remove('drag-over');
            const word = e.dataTransfer.getData('text/plain') || e.dataTransfer.getData('text/html');
            if(!word) return;
            // Determine blank id
            const blankId = slot.dataset.blankId;
            if(!blankId) return;
            // If this word is already used in another slot, free it
            Object.keys(state.answers).forEach(k => {
              if(state.answers[k] === word){
                delete state.answers[k];
              }
            });
            // If slot had a previous answer, free that bank word
            const prev = state.answers[blankId];
            if(prev){
              const prevEl = Array.from(document.querySelectorAll('.bank-word-vertical')).find(b=>b.dataset.word === prev);
              if(prevEl){
                prevEl.classList.remove('used');
                prevEl.setAttribute('draggable','true');
                prevEl.addEventListener('click', prevEl._onclick);
              }
            }
            // mark bank word used
            const bankEl = Array.from(document.querySelectorAll('.bank-word-vertical')).find(b=>b.dataset.word === word);
            if(bankEl){
              bankEl.classList.add('used');
              bankEl.setAttribute('draggable','false');
              // remove click to prevent double-placing
              bankEl.removeEventListener('click', bankEl._onclick);
            }
            // assign to state and re-render
            state.answers[blankId] = word;
            renderAll();
          });
        });
      }

      function showSprachbausteine2Options(slot){
        // highlight selected slot so click from bank knows target
        document.querySelectorAll('.blank-slot').forEach(s => s.classList.remove('selected-sprach'));
        slot.classList.add('selected-sprach');
        lastClickedSprachSlot = slot;
      }

      function selectSprachbausteine2FromBank(word){
        // choose target slot: prefer lastClicked, otherwise first empty
        let slot = lastClickedSprachSlot;
        if(!slot){
          slot = Array.from(document.querySelectorAll('.blank-slot')).find(s => {
            const id = s.dataset.blankId;
            return !state.answers[id];
          });
        }
        if(!slot) {
          // if none available, do nothing
          return;
        }
        const blankId = slot.dataset.blankId;
        // free previous occurrence of word
        Object.keys(state.answers).forEach(k => {
          if(state.answers[k] === word){
            delete state.answers[k];
          }
        });
        // free previous word in target slot
        const prev = state.answers[blankId];
        if(prev){
          const prevEl = Array.from(document.querySelectorAll('.bank-word-vertical')).find(b=>b.dataset.word === prev);
          if(prevEl){
            prevEl.classList.remove('used');
            prevEl.setAttribute('draggable','true');
            if(prevEl._onclick) prevEl.addEventListener('click', prevEl._onclick);
          }
        }
        // mark selected bank word as used
        const bankEl = Array.from(document.querySelectorAll('.bank-word-vertical')).find(b=>b.dataset.word === word);
        if(bankEl){
          bankEl.classList.add('used');
          bankEl.setAttribute('draggable','false');
          if(bankEl._onclick) try{ bankEl.removeEventListener('click', bankEl._onclick); }catch(e){}
        }
        // assign value
        state.answers[blankId] = word;
        try{ localStorage.setItem('lesenAnswers', JSON.stringify(state.answers)); }catch(e){}
        
        lastClickedSprachSlot = null;
        renderAll();
      }

      function selectOption(questionId, optionId){
        state.answers[questionId] = optionId;
        try{ localStorage.setItem('lesenAnswers', JSON.stringify(state.answers)); }catch(e){}
        
        renderAll();
      }

      function renderResults(){
        let resultsHTML = `<h2>Ergebnisse</h2>`;
        let totalCorrect = 0;
        let totalQuestions = 0;
        
        exam.sections.forEach(section => {
          resultsHTML += `<div class="result-item"><h3>${section.title}</h3>`;
          
          if(section.id === 's1'){
            section.texts.forEach(text => {
              totalQuestions++;
              const userAnswer = state.answers[text.id];
              const isCorrect = userAnswer === text.correctAnswer;
              if(isCorrect) totalCorrect++;
              
              resultsHTML += `
                <div>Text ${text.id}: ${userAnswer || '-'} 
                ${userAnswer ? `<span class="${isCorrect ? 'result-correct' : 'result-incorrect'}">${isCorrect ? '‚úì' : '‚úó'}</span>` : ''}
                </div>
              `;
            });
          } else if(section.id === 's2'){
            section.questions.forEach(question => {
              totalQuestions++;
              const userAnswer = state.answers[question.id];
              const isCorrect = userAnswer === question.correctAnswer;
              if(isCorrect) totalCorrect++;
              
              resultsHTML += `
                <div>${question.text}: ${userAnswer || '-'} 
                ${userAnswer ? `<span class="${isCorrect ? 'result-correct' : 'result-incorrect'}">${isCorrect ? '‚úì' : '‚úó'}</span>` : ''}
                </div>
              `;
            });
          } else if(section.id === 's3'){
            section.situations.forEach(situation => {
              totalQuestions++;
              const userAnswer = state.answers[situation.id];
              const correctText = section.texts.find(t => t.correctAnswer === situation.id);
              const isCorrect = userAnswer === (correctText ? correctText.id : null);
              if(isCorrect) totalCorrect++;
              
              resultsHTML += `
                <div>Situation ${situation.id}: ${userAnswer || '-'} 
                ${userAnswer ? `<span class="${isCorrect ? 'result-correct' : 'result-incorrect'}">${isCorrect ? '‚úì' : '‚úó'}</span>` : ''}
                </div>
              `;
            });
          } else if(section.id === 's4'){
            section.fillBlanks.forEach(blank => {
              totalQuestions++;
              const userAnswer = state.answers[blank.id];
              const isCorrect = userAnswer === blank.correctAnswer;
              if(isCorrect) totalCorrect++;
              
              resultsHTML += `
                <div>L√ºcke ${blank.id}: ${userAnswer || '-'} 
                ${userAnswer ? `<span class="${isCorrect ? 'result-correct' : 'result-incorrect'}">${isCorrect ? '‚úì' : '‚úó'}</span>` : ''}
                </div>
              `;
            });
          } else if(section.id === 's5'){
            section.fillBlanks2.forEach(blank => {
              totalQuestions++;
              const userAnswer = state.answers[blank.id];
              const isCorrect = userAnswer === blank.correctAnswer;
              if(isCorrect) totalCorrect++;
              
              resultsHTML += `
                <div>L√ºcke ${blank.id}: ${userAnswer || '-'} 
                ${userAnswer ? `<span class="${isCorrect ? 'result-correct' : 'result-incorrect'}">${isCorrect ? '‚úì' : '‚úó'}</span>` : ''}
                </div>
              `;
            });
          }
          
          resultsHTML += `</div>`;
        });
        
        const percentage = totalQuestions > 0 ? Math.round((totalCorrect / totalQuestions) * 100) : 0;
        resultsHTML += `<div class="result-item"><h3>Gesamtergebnis: ${totalCorrect}/${totalQuestions} (${percentage}%)</h3></div>`;
        
        passageContentEl.innerHTML = resultsHTML;
        questionBodyEl.innerHTML = '';
        sectionNameEl.textContent = 'Ergebnisse';
        questionTitleEl.textContent = '';
      }

      /* ===== Event Listeners ===== */
      document.getElementById('prevBtn-lesen').addEventListener('click', ()=>{
        if(state.sectionIndex > 0){
          state.sectionIndex--;
          state.questionIndex = 0;
          renderAll();
        }
      });

      document.getElementById('nextBtn-lesen').addEventListener('click', ()=>{
        if(state.sectionIndex < exam.sections.length - 1){
          state.sectionIndex++;
          state.questionIndex = 0;
          renderAll();
        }
      });

      resultBtn.addEventListener('click', ()=>{
        state.showResults = !state.showResults;
        renderAll();
      });

      resetBtn.addEventListener('click', ()=>{
        if(confirm('M√∂chten Sie wirklich von neu beginnen? Alle Antworten werden gel√∂scht.')){
          state.answers = {};
          state.marked = {};
          state.showResults = false;
          resetTimer();
          renderAll();
        }
      });

      resetSectionBtn.addEventListener('click', resetCurrentSection);

      document.getElementById('saveBtn-lesen').addEventListener('click', ()=>{
        statusText.textContent = 'Gespeichert';
        setTimeout(()=>{statusText.textContent = 'Nicht gespeichert'}, 2000);
      });

      document.getElementById('submitBtn-lesen').addEventListener('click', ()=>{
        if(confirm('M√∂chten Sie die Pr√ºfung wirklich abgeben?')){
          state.showResults = true;
          renderAll();
        }
      });

      document.getElementById('nextBtn-lesen').addEventListener('click', ()=>{
        showPage('hoeren-page');
      });

      /* ===== Initialize ===== */
      updateTimerDisplay();
      renderAll();
      startTimer();
      
      // Expose functions to global scope for event handlers
      window._lesenState = state;
      window.lesenApp = {
        selectOption,
        markNoMatch,
        selectSprachbausteine1,
        selectSprachbausteine2FromBank
      };
    }

    // ===== H√ñREN PAGE FUNCTIONALITY =====
    function initHoerenPage() {
      /* ===== Self-contained exam (embedded) ===== */
      const exam = {
        id: "exam-h√∂rverstehen",
        durationSec: 17 * 60, // 17 minutes in seconds
        sections: [
          { 
            id: "h√∂rverstehen1", 
            title: "H√∂rverstehen, Teil 1", 
            points: 25,
            correctAnswers: { "41": "falsch", "42": "richtig", "43": "richtig", "44": "falsch", "45": "falsch" },
            questions: [
              {
                id: "41",
                text: "Die Deutsche Lufthansa hat ihre F√ºhrungsposition verloren."
              },
              {
                id: "42", 
                text: "Ein Bonner Sportverein zeigt der √ñffentlichkeit sein Angebot."
              },
              {
                id: "43",
                text: "Die Rahmenbedingungen in deutschen Pflegeheimen bed√ºrfen dringend einer √Ñnderung."
              },
              {
                id: "44",
                text: "Durch moderne W√§rmed√§mmung k√∂nnten die Heizkosten deutlich reduziert werden."
              },
              {
                id: "45",
                text: "Das Nationale Olympische Komitee hat die Dopingsperre f√ºr Tom Sanders aufgehoben."
              }
            ]
          },
          { 
            id: "h√∂rverstehen2", 
            title: "H√∂rverstehen, Teil 2", 
            points: 25,
            correctAnswers: { "46": "richtig", "47": "falsch", "48": "richtig", "49": "richtig", "50": "richtig", "51": "falsch", "52": "falsch", "53": "richtig" },
            questions: [
              {
                id: "46",
                text: "Der Berufseinstieg ist in anderen L√§ndern nicht leicht."
              },
              {
                id: "47",
                text: "Carina ist ihr Beruf wichtiger als ihr Privatleben."
              },
              {
                id: "48",
                text: "Carina hat sich der Agentur mit einem Videofilm vorgestellt."
              },
              {
                id: "49",
                text: "Carina musste f√ºr einen Film ihr Gewicht stark ver√§ndern."
              },
              {
                id: "50", 
                text: "Carina macht lieber gef√ºhlvolle Filme als Action-Filme."
              },
              {
                id: "51",
                text: "Wegen der vielen Fehlstunden hatte Carina Probleme mit dem Direktor der Schule"
              },
              {
                id: "52",
                text: "Carinas Eltern haben ihre Tochter von Anfang an unterst√ºtzt."
              },
              {
                id: "53",
                text: "Carina finde den Wechsel zwischen Schule und Drehterminen Nicht leicht."
              },
              {
                id: "54",
                text: "Bei Dialogen darf man auch selbst etwas erfinden."
              },
              {
                id: "55",
                text: "Carina empfiehlt, sich andere Schauspieler im Theater und in Filmen anzusehen"
              }
            ]
          },
          { 
            id: "h√∂rverstehen3", 
            title: "H√∂rverstehen, Teil 3", 
            points: 25,
            correctAnswers: { "54": "richtig", "55": "falsch", "56": "falsch", "57": "richtig", "58": "falsch" },
            questions: [
              {
                id: "56",
                text: "Bei der Fahrschule kann man sich √ºber das Internet anmelden."
              },
              {
                id: "57",
                text: "Die Anruferin ist im Hinblick auf die Abfahrtszeit flexibel."
              },
              {
                id: "58",
                text: "F√ºr den Halb-Marathon kann man sich noch am Sonntag registrieren lassen."
              },
              {
                id: "59",
                text: "Bei dem Flug nach Mallorca √§ndert sich die Abflugzeit."
              },
              {
                id: "60",
                text: "In Halle D wird aus E-Books vorgelesen."
              }
            ]
          }
        ]
      };

      /* ===== State & DOM refs ===== */
      let state = { 
        sectionIndex: 0, 
        answers: {}, 
        remaining: exam.durationSec,
        showResults: false,
        timerStarted: false,
        timerInterval: null
      };
      
      const topTiles = document.getElementById('topTiles-hoeren');
      const contentContainer = document.getElementById('contentContainer-hoeren');
      const timerEl = document.getElementById('timer-hoeren');
      const statusText = document.getElementById('statusText-hoeren');

      /* ===== Timer Functions ===== */
      function startTimer() {
        if (state.timerInterval) {
          clearInterval(state.timerInterval);
        }
        
        state.timerStarted = true;
        state.timerInterval = setInterval(() => {
          if (state.remaining <= 0) {
            clearInterval(state.timerInterval);
            timerEl.textContent = 'Zeit abgelaufen';
            return;
          }
          state.remaining--;
          updateTimerDisplay();
        }, 1000);
      }

      function resetTimer() {
        if (state.timerInterval) {
          clearInterval(state.timerInterval);
        }
        state.remaining = exam.durationSec;
        state.timerStarted = false;
        updateTimerDisplay();
        startTimer();
      }

      function updateTimerDisplay() {
        const min = Math.floor(state.remaining / 60);
        const sec = state.remaining % 60;
        timerEl.textContent = `Verbleibende Zeit: ${min.toString().padStart(2, '0')}:${sec.toString().padStart(2, '0')}`;
      }

      /* ===== Render ===== */
      function renderTopTiles() { 
        topTiles.innerHTML = ''; 
        exam.sections.forEach((sec, idx) => { 
          const div = document.createElement('div'); 
          div.className = 'tile' + (idx === state.sectionIndex ? ' active' : '') + (isSectionDone(sec) ? ' done' : ''); 
          div.innerHTML = `<div>${sec.title}</div><div class="points">${sec.points} P</div>`; 
          div.onclick = () => { state.sectionIndex = idx; state.showResults = false; renderAll(); }; 
          topTiles.appendChild(div); 
        }); 
      }

      function isSectionDone(section) {
        const answers = state.answers[section.id];
        if (!answers) return false;
        
        // ÿ™ÿ≠ŸÇŸÇ ÿ•ÿ∞ÿß ÿ™ŸÖÿ™ ÿßŸÑÿ•ÿ¨ÿßÿ®ÿ© ÿπŸÑŸâ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ© ŸÅŸä Ÿáÿ∞ÿß ÿßŸÑŸÇÿ≥ŸÖ
        const answeredQuestions = Object.keys(answers).length;
        const totalQuestions = section.questions.length;
        
        return answeredQuestions === totalQuestions;
      }

      function renderAll() {
        renderTopTiles();
        
        if (state.showResults) {
          renderResults();
          return;
        }
        
        renderListeningSection();
      }

      function renderListeningSection() {
        const section = exam.sections[state.sectionIndex];
        const currentAnswers = state.answers[section.id] || {};
        
        let contentHTML = `
          <div class="panel-title">${section.title}</div>
          <div class="instructions">
            Sie h√∂ren die Nachrichten. Entscheiden Sie beim H√∂ren, ob die Aussagen richtig oder falsch sind. 
            Sie h√∂ren die Nachrichten nur einmal. Sie haben jetzt 30 Sekunden, um die Aussagen zu lesen.
          </div>
          
          <div class="listening-task">
            <table class="true-false-table">
              <thead>
                <tr>
                  <th style="width: 10%">Nr.</th>
                  <th style="width: 60%">Aussage</th>
                  <th style="width: 30%">Ihre Antwort</th>
                </tr>
              </thead>
              <tbody>
        `;
        
        section.questions.forEach((question, index) => {
          const currentAnswer = currentAnswers[question.id] || '';
          contentHTML += `
            <tr>
              <td><strong>${question.id}</strong></td>
              <td class="question-text">${question.text}</td>
              <td>
                <div class="answer-options">
                  <label class="answer-option">
                    <input 
                      type="radio" 
                      name="q${section.id}_${question.id}" 
                      value="richtig" 
                      ${currentAnswer === 'richtig' ? 'checked' : ''}
                      onchange="window.hoerenApp.updateListeningAnswer('${section.id}', '${question.id}', this.value)"
                    >
                    Richtig
                  </label>
                  <label class="answer-option">
                    <input 
                      type="radio" 
                      name="q${section.id}_${question.id}" 
                      value="falsch" 
                      ${currentAnswer === 'falsch' ? 'checked' : ''}
                      onchange="window.hoerenApp.updateListeningAnswer('${section.id}', '${question.id}', this.value)"
                    >
                    Falsch
                  </label>
                </div>
              </td>
            </tr>
          `;
        });
        
        contentHTML += `
              </tbody>
            </table>
          </div>
        `;
        
        contentContainer.innerHTML = contentHTML;
      }

      function updateListeningAnswer(sectionId, questionId, answer) {
        if (!state.answers[sectionId]) {
          state.answers[sectionId] = {};
        }
        state.answers[sectionId][questionId] = answer;
        try{ localStorage.setItem('hoerenAnswers', JSON.stringify(state.answers)); }catch(e){}
        
        
        // ÿ•ÿπÿßÿØÿ© ÿπÿ±ÿ∂ ÿßŸÑÿ®ŸÑÿßÿ∑ÿßÿ™ ŸÑÿ™ÿ≠ÿØŸäÿ´ ÿ≠ÿßŸÑÿ© "ÿ™ŸÖ"
        renderTopTiles();
      }

      function renderResults() {
        let resultsHTML = `<div class="panel-title">Ergebnisse - H√∂rverstehen</div>`;
        
        exam.sections.forEach(section => {
          const userAnswers = state.answers[section.id] || {};
          let correctCount = 0;
          
          resultsHTML += `
            <div class="listening-task">
              <h3>${section.title} (${section.points} Punkte)</h3>
              <table class="true-false-table">
                <thead>
                  <tr>
                    <th style="width: 10%">Nr.</th>
                    <th style="width: 50%">Aussage</th>
                    <th style="width: 15%">Ihre Antwort</th>
                    <th style="width: 15%">Richtige Antwort</th>
                    <th style="width: 10%">Punkte</th>
                  </tr>
                </thead>
                <tbody>
          `;
          
          section.questions.forEach((question) => {
            const userAnswer = userAnswers[question.id] || '-';
            const correctAnswer = section.correctAnswers[question.id];
            const gotCorrect = userAnswer === correctAnswer;
            const points = gotCorrect ? "1" : "0";
            
            if (gotCorrect) correctCount++;
            
            const rowClass = gotCorrect ? 'correct-answer' : 'incorrect-answer';
            
            resultsHTML += `
              <tr class="${rowClass}">
                <td><strong>${question.id}</strong></td>
                <td class="question-text">${question.text}</td>
                <td>${userAnswer}</td>
                <td>${correctAnswer}</td>
                <td><strong>${points}</strong></td>
              </tr>
            `;
          });
          
          const totalPoints = Math.round((correctCount / section.questions.length) * section.points);
          
          resultsHTML += `
                </tbody>
              </table>
              <div style="margin-top: 15px; padding: 15px; background: #e3f2fd; border-radius: 6px;">
                <strong>Erreichte Punkte: ${correctCount}/${section.questions.length} richtig = ${totalPoints}/${section.points} Punkten</strong>
              </div>
            </div>
          `;
        });
        
        contentContainer.innerHTML = resultsHTML;
      }

      /* ===== Event Listeners ===== */
      document.getElementById('prevBtn-hoeren').addEventListener('click', () => {
        if (state.sectionIndex > 0) {
          state.sectionIndex--;
          state.showResults = false;
          renderAll();
        }
      });

      document.getElementById('nextBtn-hoeren').addEventListener('click', () => {
        if (state.sectionIndex < exam.sections.length - 1) {
          state.sectionIndex++;
          state.showResults = false;
          renderAll();
        }
      });

      document.getElementById('resultBtn-hoeren').addEventListener('click', () => {
        state.showResults = !state.showResults;
        renderAll();
      });

      document.getElementById('resetBtn-hoeren').addEventListener('click', () => {
        if (confirm('M√∂chten Sie wirklich von neu beginnen? Alle Antworten werden gel√∂scht.')) {
          state.answers = {};
          state.showResults = false;
          resetTimer();
          renderAll();
        }
      });

      document.getElementById('saveBtn-hoeren').addEventListener('click', () => {
        statusText.textContent = 'Gespeichert';
        setTimeout(() => { statusText.textContent = 'Nicht gespeichert' }, 2000);
      });

      document.getElementById('submitBtn-hoeren').addEventListener('click', () => {
        if (confirm('M√∂chten Sie die Pr√ºfung wirklich abgeben?')) {
          state.showResults = true;
          renderAll();
        }
      });

      document.getElementById('nextBtn-hoeren').addEventListener('click', () => {
        showPage('schreiben-page');
      });

      /* ===== Initialize ===== */
      updateTimerDisplay();
      renderAll();
      startTimer();
      
      // Expose functions to global scope for event handlers
        window._hoerenState = state;
        window.hoerenApp = {
        updateListeningAnswer
      };
    }

    // ===== SCHREIBEN PAGE FUNCTIONALITY =====
    function initSchreibenPage() {
      /* ===== Self-contained exam (embedded) ===== */
      const exam = {
        id: "exam-002",
        durationSec: 30 * 60, // 30 minutes in seconds
        sections: [
          { 
            id: "s1", 
            title: "Schreiben, Teil 1", 
            points: 45,
            passageTitle: "Aufgabe: Schreiben Sie eine E-Mail",
            passage: "",
            writingTask: {
              prompt: `M√∂chten Sie in Ihrer Freizeit mehr erleben? Neue Leute aus Mainz kennenlernen? Am Wochenende nie mehr allein sein? 
      Dann werden Sie Mitglied im Freizeitverein!
      Wir organisieren verschiedene Aktivit√§ten in Mainz und Umgebung:
      Wanderungen, Fahrradtouren, Museums- und Theaterbesuche, Spiele- und Kinoabende, Restaurantbesuche und Ausfl√ºge.
      Jede Woche stehen mindestens zwei unterschiedliche Angebote auf dem Programm.
      Ob Sport oder Kultur ‚Äì bei uns kommt jeder auf seine Kosten. Sie k√∂nnen viel Neues ausprobieren und lernen dabei nette Leute kennen.
      Unsere Mitglieder sind zwischen 26 und 85 Jahre alt. Bei uns ist jeder willkommen, ob Student oder Senior. 
      Sie finden bei uns neue Freunde und Bekannte, mit denen Sie viel erleben k√∂nnen. Probieren Sie es doch einfach mal aus!
      Die Mitgliedschaft kostet 20 Euro pro Monat.`,
              requirements: [
                "Erkl√§ren Sie, was Sie nach dem Lesen der Anzeige erwartet hatten.",
                "Erkl√§ren Sie, warum Sie mit dem Angebot des Freizeitvereins nicht zufrieden sind.",
                "Machen Sie Verbesserungsvorschl√§ge zum Programm.",
                "Erkl√§ren Sie, was Sie tun werden, wenn sich nichts √§ndert."
              ],
              wordCount: 0
            }
          }
        ]
      };

      /* ===== State & DOM refs ===== */
      let state = { 
        sectionIndex: 0, 
        answers: {}, 
        remaining: exam.durationSec,
        showResults: false,
        timerStarted: false,
        timerInterval: null
      };
      
      const topTiles = document.getElementById('topTiles-schreiben');
      const passageTitleEl = document.getElementById('passageTitle-schreiben');
      const passageContentEl = document.getElementById('passageContent-schreiben');
      const writingContainer = document.getElementById('writingContainer-schreiben');
      const timerEl = document.getElementById('timer-schreiben');
      const statusText = document.getElementById('statusText-schreiben');

      /* ===== Timer Functions ===== */
      function startTimer() {
        if (state.timerInterval) {
          clearInterval(state.timerInterval);
        }
        
        state.timerStarted = true;
        state.timerInterval = setInterval(() => {
          if (state.remaining <= 0) {
            clearInterval(state.timerInterval);
            timerEl.textContent = 'Zeit abgelaufen';
            return;
          }
          state.remaining--;
          updateTimerDisplay();
        }, 1000);
      }

      function resetTimer() {
        if (state.timerInterval) {
          clearInterval(state.timerInterval);
        }
        state.remaining = exam.durationSec;
        state.timerStarted = false;
        updateTimerDisplay();
        startTimer();
      }

      function updateTimerDisplay() {
        const min = Math.floor(state.remaining / 60);
        const sec = state.remaining % 60;
        timerEl.textContent = `Verbleibende Zeit: ${min.toString().padStart(2, '0')}:${sec.toString().padStart(2, '0')}`;
      }

      /* ===== Render ===== */
      function renderTopTiles() { 
        topTiles.innerHTML = ''; 
        exam.sections.forEach((sec, idx) => { 
          const div = document.createElement('div'); 
          div.className = 'tile' + (idx === state.sectionIndex ? ' active' : '') + (isSectionDone(sec) ? ' done' : ''); 
          div.innerHTML = `<div>${sec.title}</div><div class="points">${sec.points} P</div>`; 
          div.onclick = () => { state.sectionIndex = idx; state.showResults = false; renderAll(); }; 
          topTiles.appendChild(div); 
        }); 
      }

      function isSectionDone(section) {
        return state.answers[section.id] && state.answers[section.id].length > 0;
      }

      function renderAll() {
        renderTopTiles();
        const section = exam.sections[state.sectionIndex];
        passageTitleEl.textContent = section.passageTitle;
        
        if (state.showResults) {
          renderResults();
          return;
        }
        
        renderWritingSection();
      }

      function renderWritingSection() {
        const section = exam.sections[state.sectionIndex];
        
        // Render the prompt in left panel
        passageContentEl.innerHTML = `
          <div class="writing-task">
            <div class="writing-prompt">${section.writingTask.prompt}</div>
            <div class="instructions" style="border:1px solid #e1e8f6; padding:10px; margin:10px 0; border-radius:6px; background:#ffffff;">Sie sind seit zwei Wochen Mitglied im Freizeitverein. Doch Sie sind nicht zufrieden. 
      Schreiben Sie eine Beschwerde.</div>
            <div class="writing-requirements">
              <h4>Schreiben Sie in Ihrer E-Mail:</h4>
              <ul>
                ${section.writingTask.requirements.map(req => `<li>${req}</li>`).join('')}
              </ul>
            </div>
            <div class="instructions">
              Schreiben Sie eine E-Mail (ca. 150-200 W√∂rter). Achten Sie auf den Textaufbau (Anrede, Einleitung, Hauptteil, Schluss) und eine angemessene Formulierung.
            </div>
          </div>
        `;
        
        // Render writing area in right panel
        const currentAnswer = state.answers[section.id] || '';
        const wordCount = countWords(currentAnswer);
        
        writingContainer.innerHTML = `
          <div class="writing-area">
            <textarea 
              class="writing-textarea" 
              placeholder="Schreiben Sie hier Ihre E-Mail..."
              oninput="window.schreibenApp.updateWritingAnswer('${section.id}', this.value)"
            >${currentAnswer}</textarea>
            <div class="word-counter">
              W√∂rter: <span class="count">${wordCount}</span>
            </div>
          </div>
        `;
      }

      function countWords(text) {
        return text.trim() === '' ? 0 : text.trim().split(/\s+/).length;
      }

      function updateWritingAnswer(sectionId, text) {
        state.answers[sectionId] = text;
        try{ localStorage.setItem('schreibenAnswers', JSON.stringify({content: state.answers[sectionId], wordCount: (state.answers[sectionId]||'').trim().split(/\s+/).filter(Boolean).length})); }catch(e){}
        
        const wordCount = countWords(text);
        document.querySelector('.word-counter .count').textContent = wordCount;
      }

      function renderResults() {
        let resultsHTML = `<h2>Ergebnisse</h2>`;
        
        exam.sections.forEach(section => {
          resultsHTML += `<div class="writing-task"><h3>${section.title}</h3>`;
          
          const userAnswer = state.answers[section.id];
          const wordCount = countWords(userAnswer);
          
          resultsHTML += `
            <div class="writing-requirements">
              <h4>Ihre Antwort (${wordCount} W√∂rter):</h4>
              <div style="white-space: pre-wrap; background: white; padding: 15px; border-radius: 6px; border: 1px solid #e1e8f6; margin-top: 10px;">${userAnswer || '-'}</div>
            </div>
          `;
          
          resultsHTML += `</div>`;
        });
        
        passageContentEl.innerHTML = resultsHTML;
        writingContainer.innerHTML = '';
      }

      /* ===== Event Listeners ===== */
      document.getElementById('prevBtn-schreiben').addEventListener('click', () => {
        if (state.sectionIndex > 0) {
          state.sectionIndex--;
          state.showResults = false;
          renderAll();
        }
      });

      document.getElementById('nextBtn-schreiben').addEventListener('click', () => {
        if (state.sectionIndex < exam.sections.length - 1) {
          state.sectionIndex++;
          state.showResults = false;
          renderAll();
        }
      });

      document.getElementById('resultBtn-schreiben').addEventListener('click', () => {
        state.showResults = !state.showResults;
        renderAll();
      });

      document.getElementById('resetBtn-schreiben').addEventListener('click', () => {
        if (confirm('M√∂chten Sie wirklich von neu beginnen? Alle Antworten werden gel√∂schÿ™.')) {
          state.answers = {};
          state.showResults = false;
          resetTimer();
          renderAll();
        }
      });

      document.getElementById('saveBtn-schreiben').addEventListener('click', () => {
        statusText.textContent = 'Gespeicherÿ™';
        setTimeout(() => { statusText.textContent = 'Nicht gespeicherÿ™' }, 2000);
      });

      document.getElementById('submitBtn-schreiben').addEventListener('click', () => {
        if (confirm('M√∂chten Sie die Pr√ºfung wirklich abgeben?')) {
          state.showResults = true;
          renderAll();
        }
      });

      document.getElementById('nextBtn-schreiben').addEventListener('click', () => {
        showPage('ergebnisse-page');
      });

      /* ===== Initialize ===== */
      updateTimerDisplay();
      renderAll();
      startTimer();
      
      // Expose functions to global scope for event handlers
        window._schreibenState = state;
        window.schreibenApp = {
        updateWritingAnswer
      };
    }

    // ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑÿ≥ÿ≠ÿ® ŸàÿßŸÑÿ•ŸÅŸÑÿßÿ™ ŸÑŸÑÿ¥ÿßÿ¥ÿßÿ™ ÿßŸÑÿ™Ÿä ÿ™ÿπŸÖŸÑ ÿ®ÿßŸÑŸÑŸÖÿ≥
    function setupTouchDragAndDrop() {
      if ('ontouchstart' in window) {
        // ÿ™ÿ∫ŸäŸäÿ± ÿ≥ŸÑŸàŸÉ ÿßŸÑÿπŸÜÿßÿµÿ± ÿßŸÑŸÇÿßÿ®ŸÑÿ© ŸÑŸÑÿ≥ÿ≠ÿ®
        document.querySelectorAll('[draggable="true"]').forEach(item => {
          item.addEventListener('touchstart', handleTouchStart);
          item.addEventListener('touchend', handleTouchEnd);
        });
        
        document.querySelectorAll('.title-slot, .blank-slot').forEach(slot => {
          slot.addEventListener('touchmove', handleTouchMove);
          slot.addEventListener('touchend', handleTouchDrop);
        });
      }
    }

    function handleTouchStart(e) {
      // ÿ™ŸÜŸÅŸäÿ∞ ÿßŸÑÿ≥ÿ≠ÿ® ÿπŸÜÿØ ÿßŸÑŸÑŸÖÿ≥
    }

    // ÿßÿ≥ÿ™ÿØÿπÿßÿ° ÿßŸÑÿØÿßŸÑÿ© ÿπŸÜÿØ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿµŸÅÿ≠ÿ©
    document.addEventListener('DOMContentLoaded', setupTouchDragAndDrop);
  </script>
</body>
</html>