<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Deutsch B2 Pr√ºfung - Komplett</title>
  <style>
    /* ===== GLOBAL STYLES ===== */
    :root {
      --primary-color: #1e3a5f;
      --secondary-color: #2c5282;
      --accent-color: #4da6ff;
      --light-color: #ebf8ff;
      --text-color: #2d3748;
      --white: #ffffff;
      --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      --transition: all 0.3s ease;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      margin: 0;
      min-height: 100vh;
      background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
      color: var(--white);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    button {
      cursor: pointer;
    }
    
    /* ===== START PAGE STYLES ===== */
    .start-container {
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      padding: 20px;
      min-height: 100vh;
    }
    
    .start-content {
      max-width: 600px;
      width: 100%;
      background-color: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      padding: 40px;
      box-shadow: var(--shadow);
      text-align: center;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .logo {
      margin-bottom: 20px;
    }
    
    .logo-icon {
      font-size: 48px;
      margin-bottom: 10px;
    }
    
    h1 {
      font-size: 32px;
      margin-bottom: 10px;
      font-weight: 700;
    }
    
    .subtitle {
      font-size: 18px;
      margin-bottom: 30px;
      opacity: 0.9;
    }
    
    .card {
      background-color: var(--white);
      border-radius: 12px;
      padding: 25px;
      margin-bottom: 30px;
      box-shadow: var(--shadow);
      color: var(--text-color);
    }
    
    .card h2 {
      font-size: 20px;
      margin-bottom: 15px;
      color: var(--primary-color);
    }
    
    .card p {
      margin-bottom: 20px;
      line-height: 1.5;
    }
    
    select {
      width: 100%;
      padding: 12px 16px;
      font-size: 16px;
      border-radius: 8px;
      border: 2px solid var(--accent-color);
      outline: none;
      background-color: var(--white);
      color: var(--text-color);
      cursor: pointer;
      transition: var(--transition);
    }
    
    select:focus {
      border-color: var(--secondary-color);
      box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.3);
    }
    
    .timer-container {
      margin: 25px 0;
    }
    
    .timer-label {
      font-size: 16px;
      margin-bottom: 10px;
    }
    
    .timer {
      font-size: 48px;
      font-weight: 700;
      color: var(--accent-color);
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }
    
    .progress-bar {
      height: 8px;
      width: 100%;
      background-color: rgba(255, 255, 255, 0.2);
      border-radius: 4px;
      overflow: hidden;
      margin-top: 10px;
    }
    
    .progress {
      height: 100%;
      width: 100%;
      background-color: var(--accent-color);
      border-radius: 4px;
      transform: scaleX(1);
      transform-origin: left;
      transition: transform 1s linear;
    }
    
    .info-text {
      font-size: 14px;
      margin-top: 20px;
      opacity: 0.8;
    }
    
    .button-container {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }
    
    .btn {
      flex: 1;
      padding: 12px 20px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      background-color: var(--accent-color);
      color: white;
      text-decoration: none;
      display: inline-block;
      text-align: center;
    }
    
    .btn:hover {
      background-color: #3399ff;
    }
    
    /* ===== EXAM PAGE STYLES ===== */
    .exam-body {
      background: #f5f5f5;
      color: #333;
      line-height: 1.45;
      -webkit-font-smoothing: antialiased;
    }
    
    /* Header Styles */
    header.topbar {
      background: #1e3a5f;
      color: #fff;
      padding: 12px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      min-height: 80px;
    }

    .brand {
      display: flex;
      gap: 15px;
      align-items: center;
    }

    .brand .logo {
      width: 80px;
      height: 40px;
      background: #e74c3c;
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      color: white;
      font-size: 18px;
    }

    .meta .main-title {
      font-weight: 800;
      font-size: 18px;
    }

    .meta .sub-title {
      font-size: 13px;
      opacity: 0.9;
    }

    .timer {
      font-weight: 700;
      font-size: 18px;
      color: #fff;
      margin: 0 20px;
    }

    .buttons-grid {
      display: grid;
      grid-template-columns: repeat(2, auto);
      gap: 10px 20px;
    }

    .exam-btn {
      padding: 12px 20px;
      border-radius: 6px;
      border: none;
      background: #4da6ff;
      color: white;
      font-weight: 700;
      font-size: 15px;
      cursor: pointer;
      transition: background 0.2s ease-in-out;
      min-width: 150px;
      text-align: center;
    }

    .exam-btn:hover {
      background: #336fbf;
    }
    
    .exam-btn.save {
      background: #4da6ff;
      color: #000;
    }
    
    .exam-btn.save:hover {
      background: #3399ff;
    }
    
    .exam-btn.submit {
      background: #4da6ff;
    }
    
    .exam-btn.submit:hover {
      background: #3399ff;
    }
    
    .exam-btn.result {
      background: #4da6ff;
    }
    
    .exam-btn.result:hover {
      background: #3399ff;
    }
    
    .exam-btn.next {
      background: #4da6ff;
      color: #fff;
    }
    
    .exam-btn.next:hover {
      background: #3399ff;
    }
    
    .exam-btn.reset {
      background: #4da6ff;
    }
    
    .exam-btn.reset:hover {
      background: #3399ff;
    }
    
    .exam-btn.reset-section {
      background: #d35400;
      font-size: 12px;
      padding: 6px 10px;
      min-width: auto;
    }
    
    .exam-btn.reset-section:hover {
      background: #e67e22;
    }
    
    .exam-btn.no-match {
      background: #95a5a6;
      font-size: 12px;
      padding: 6px 10px;
      min-width: auto;
      margin-top: 5px;
    }
    
    .exam-btn.no-match:hover {
      background: #7f8c8d;
    }
    
    .exam-btn.no-match.selected {
      background: #e74c3c;
    }
    
    /* Top Tiles */
    .top-tiles {
      display: flex;
      justify-content: center;
      gap: 8px;
      padding: 8px 12px;
      background: #1e3a5f;
      border-bottom: 1px solid #0f223a;
    }
    
    .tile {
      flex: 1;
      max-width: 180px;
      text-align: center;
      padding: 12px;
      border-radius: 6px;
      border: 1px solid #ccc;
      background: #3b4a63;
      color: #fff;
      font-weight: 600;
      font-size: 13px;
      cursor: pointer;
      transition: all 0.2s ease-in-out;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 60px;
    }
    
    .tile:hover {
      background: #4a5b78;
    }
    
    .tile.active {
      background: #ffffff;
      color: #000;
      border-color: #bbb;
    }
    
    .tile.done {
      background: #2ecc71;
      color: #fff;
      border-color: #27ae60;
    }
    
    .tile.done::after {
      content: " ‚úÖ";
      margin-left: 5px;
    }
    
    .tile .points {
      background: rgba(255,255,255,0.2);
      padding: 4px 8px;
      border-radius: 12px;
      font-weight: 700;
      font-size: 11px;
      margin-top: 4px;
    }
    
    .tile.active .points {
      background: #e9eefc;
      color: #2c3e50;
    }
    
    /* Container Styles */
    .container {
      display: grid;
      grid-template-columns: 1fr 420px;
      gap: 16px;
      padding: 16px;
      max-width: 1200px;
      margin: 12px auto;
    }
    
    .container-full {
      display: grid;
      grid-template-columns: 1fr;
      gap: 16px;
      padding: 16px;
      max-width: 1200px;
      margin: 12px auto;
    }
    
    .container-split {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
      padding: 16px;
      max-width: 1200px;
      margin: 12px auto;
    }
    
    .left-panel {
      background: white;
      border-radius: 8px;
      padding: 18px;
      box-shadow: 0 1px 6px rgba(0,0,0,0.06);
      max-height: 76vh;
      overflow: auto;
    }
    
    .left-panel .passage {
      font-size: 14px;
      color: #2c3e50;
      line-height: 1.8;
    }
    
    .left-panel h2 {
      font-size: 16px;
      margin-bottom: 10px;
    }
    
    .right-panel {
      background: white;
      border-radius: 8px;
      padding: 12px;
      box-shadow: 0 1px 6px rgba(0,0,0,0.06);
      display: flex;
      flex-direction: column;
      gap: 12px;
      max-height: 76vh;
      overflow: auto;
    }
    
    .main-panel {
      background: white;
      border-radius: 8px;
      padding: 25px;
      box-shadow: 0 1px 6px rgba(0,0,0,0.06);
      max-height: 76vh;
      overflow: auto;
    }
    
    .panel-title {
      font-size: 18px;
      margin-bottom: 15px;
      color: #1e3a5f;
      font-weight: 700;
    }
    
    /* Question Styles */
    .question-head {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }
    
    .question-body {
      margin-top: 8px;
    }
    
    .options {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    .option {
      background: #fbfdff;
      border: 1px solid #e1e8f6;
      padding: 10px;
      border-radius: 8px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .option:hover {
      background: #f0f6ff;
    }
    
    .option.selected {
      background: #e8fbe9;
      border-color: #2ecc71;
    }
    
    .option .radio {
      width: 18px;
      height: 18px;
      border-radius: 50%;
      border: 2px solid #cfdff6;
      background: #fff;
      display: inline-block;
      flex-shrink: 0;
    }
    
    .option.selected .radio {
      background: #3498db;
      border-color: #3498db;
      box-shadow: inset 0 -3px 0 rgba(0,0,0,0.05);
    }
    
    .text-container {
      margin-bottom: 20px;
      padding: 15px;
      border: 1px solid #e1e8f6;
      border-radius: 8px;
      background: #fbfdff;
      position: relative;
      min-height: 120px;
    }
    
    .text-container:hover {
      background: #f0f6ff;
    }
    
    .text-title {
      font-weight: 700;
      margin-bottom: 8px;
      color: #2c3e50;
    }
    
    .text-content {
      font-size: 14px;
      color: #2c3e50;
      line-height: 1.6;
    }
    
    .title-slot {
      min-height: 40px;
      margin-top: 10px;
      padding: 8px;
      border: 2px dashed #c8d9f6;
      border-radius: 6px;
      background: #f8fbff;
    }
    
    .title-slot.has-title {
      background: #e8fbe9;
      border-color: #2ecc71;
    }
    
    .title-slot.has-x {
      background: #f8d7da;
      border-color: #e74c3c;
      color: #c0392b;
      font-weight: bold;
    }
    
    .headings-bank {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-top: 0;
    }
    
    .heading-item {
      padding: 10px;
      border: 1px solid #dbe7fb;
      border-radius: 8px;
      background: #f8fbff;
      cursor: grab;
    }
    
    .heading-item:hover {
      background: #e9f0ff;
    }
    
    .heading-item.used {
      opacity: 0.5;
      cursor: not-allowed;
      background: #f8d7da;
      border-color: #f5c6cb;
    }
    
    .result-correct {
      color: #27ae60;
      font-weight: bold;
    }
    
    .result-incorrect {
      color: #c0392b;
      font-weight: bold;
    }
    
    .result-item {
      margin: 10px 0;
      padding: 10px;
      border-radius: 6px;
      background: #f8f9fa;
      border: 1px solid #e6eef8;
    }
    
    .instructions {
      color: #7f8c8d;
      font-size: 14px;
      line-height: 1.6;
      margin-bottom: 15px;
    }
    
    .question-text {
      font-weight: 600;
      margin-bottom: 15px;
      font-size: 15px;
      color: #2c3e50;
    }
    
    .all-questions {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    
    .question-block {
      margin-bottom: 20px;
      padding: 15px;
      border: 1px solid #e1e8f6;
      border-radius: 8px;
      background: #fbfdff;
    }
    
    .texts-list, .situations-list {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    
    .text-item, .situation-item {
      padding: 15px;
      border: 1px solid #e1e8f6;
      border-radius: 8px;
      background: #fbfdff;
    }
    
    .text-letter {
      font-weight: bold;
      color: #2c3e50;
      margin-bottom: 8px;
    }
    
    .situation-number {
      font-weight: bold;
      color: #2c3e50;
      margin-bottom: 8px;
    }
    
    .fill-blank-container {
      margin: 20px 0;
    }
    
    .blank-word {
      display: inline-block;
      min-width: 120px;
      padding: 4px 8px;
      margin: 0 6px;
      background: #fff;
      cursor: pointer;
      position: relative;
      border: 1px solid #dbe7fb;
      border-radius: 4px;
    }
    
    .blank-word.has-answer {
      background: #e8fbe9;
      border-color: #2ecc71;
    }
    
    .options-popup {
      position: absolute;
      top: 100%;
      left: 0;
      background: white;
      border: 1px solid #dbe7fb;
      border-radius: 6px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      z-index: 100;
      min-width: 150px;
    }
    
    .option-item {
      padding: 8px 12px;
      cursor: pointer;
      border-bottom: 1px solid #f0f4fb;
    }
    
    .option-item:hover {
      background: #f0f6ff;
    }
    
    .option-item:last-child {
      border-bottom: none;
    }
    
    .horizontal-options {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    
    .option-row {
      display: flex;
      align-items: center;
      gap: 15px;
      padding: 10px;
      border: 1px solid #e1e8f6;
      border-radius: 8px;
      background: #fbfdff;
    }
    
    .option-number {
      font-weight: bold;
      color: #2c3e50;
      min-width: 30px;
    }
    
    .option-buttons {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    
    .option-btn {
      padding: 8px 16px;
      border: 1px solid #dbe7fb;
      border-radius: 6px;
      background: #f8fbff;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .option-btn:hover {
      background: #e9f0ff;
    }
    
    .option-btn.selected {
      background: #3498db;
      color: white;
      border-color: #3498db;
    }
    
    .word-bank-vertical {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    .bank-word-vertical {
      padding: 10px;
      border: 1px solid #dbe7fb;
      border-radius: 6px;
      background: #f8fbff;
      text-align: center;
      cursor: grab;
    }
    
    .bank-word-vertical.used {
      opacity: 0.5;
      cursor: not-allowed;
      background: #f8d7da;
      border-color: #f5c6cb;
    }
    
    .blank-slot {
      display: inline-block;
      min-width: 100px;
      padding: 4px 8px;
      margin: 0 6px;
      background: #fff;
      min-height: 30px;
      vertical-align: middle;
      border: 1px solid #dbe7fb;
      border-radius: 4px;
      cursor: pointer;
    }
    
    .blank-slot.has-answer {
      background: #e8fbe9;
      border-color: #2ecc71;
    }
    
    .footer-buttons {
      display: flex;
      gap: 10px;
    }
    
    .situation-item.used {
      opacity: 0.7;
      cursor: not-allowed;
      background: #f8d7da;
      border-color: #f5c6cb;
      color: #333;
    }
    
    /* Listening Section Styles */
    .listening-task {
      margin-bottom: 10px;
    }
    
    .true-false-table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
      font-size: 14px;
    }
    
    .true-false-table th {
      background: #3498db;
      color: white;
      padding: 15px;
      text-align: left;
      font-weight: 600;
      font-size: 14px;
    }
    
    .true-false-table td {
      padding: 15px;
      border-bottom: 1px solid #e1e8f6;
      vertical-align: top;
    }
    
    .true-false-table tr:nth-child(even) {
      background: #f8f9fa;
    }
    
    .true-false-table tr:hover {
      background: #e3f2fd;
    }
    
    .answer-options {
      display: flex;
      gap: 25px;
    }
    
    .answer-option {
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      padding: 10px 15px;
      border-radius: 4px;
      transition: background 0.2s;
      font-weight: 500;
    }
    
    .answer-option:hover {
      background: #e3f2fd;
    }
    
    .answer-option input {
      margin: 0;
      transform: scale(1.2);
    }

    .correct-answer {
      background: #d4edda !important;
      border-left: 4px solid #28a745;
    }
    
    .incorrect-answer {
      background: #f8d7da !important;
      border-left: 4px solid #dc3545;
    }
    
    /* Writing Section Styles */
    .writing-task {
      margin-bottom: 20px;
      padding: 15px;
      border: 1px solid #e1e8f6;
      border-radius: 8px;
      background: #fbfdff;
    }
    
    .writing-prompt {
      font-size: 14px;
      color: #2c3e50;
      line-height: 1.6;
      margin-bottom: 15px;
    }
    
    .writing-requirements {
      background: #f8f9fa;
      padding: 12px;
      border-radius: 6px;
      border-left: 4px solid #3498db;
      margin-bottom: 15px;
    }
    
    .writing-requirements h4 {
      margin: 0 0 8px 0;
      color: #2c3e50;
    }
    
    .writing-requirements ul {
      margin: 0;
      padding-left: 20px;
    }
    
    .writing-requirements li {
      margin-bottom: 5px;
      color: #2c3e50;
    }
    
    .writing-area {
      flex: 1;
      display: flex;
      flex-direction: column;
    }
    
    .writing-textarea {
      flex: 1;
      min-height: 500px;
      padding: 15px;
      border: 2px solid #e1e8f6;
      border-radius: 8px;
      font-size: 14px;
      line-height: 1.6;
      resize: vertical;
      font-family: Arial, sans-serif;
    }
    
    .writing-textarea:focus {
      outline: none;
      border-color: #3498db;
    }
    
    .word-counter {
      margin-top: 10px;
      text-align: right;
      font-size: 13px;
      color: #7f8c8d;
      padding: 8px 0;
    }
    
    .word-counter .count {
      font-weight: bold;
      color: #2c3e50;
    }
    
    /* Results Page Styles */
    .results-body {
      background: #f7fafc;
      color: #0f1724;
      line-height: 1.6;
    }
    
    .results-header {
      background: #1e3a5f;
      color: #fff;
      padding: 18px 20px;
      display: flex;
      align-items: center;
      gap: 16px;
    }
    
    .results-logo {
      background: #fff;
      color: #1e3a5f;
      padding: 8px 12px;
      border-radius: 6px;
      font-weight: 800;
    }
    
    .results-title {
      font-size: 18px;
      font-weight: 700;
    }
    
    .results-container {
      max-width: 1100px;
      margin: 22px auto;
      padding: 20px;
    }
    
    .results-tiles {
      display: flex;
      gap: 12px;
      margin: 18px 0;
    }
    
    .results-tile {
      flex: 1;
      background: #fff;
      border-radius: 10px;
      padding: 16px;
      box-shadow: 0 6px 18px rgba(2, 6, 23, 0.06);
      border-left: 6px solid #1e3a5f;
    }
    
    .results-tile h3 {
      margin: 0;
      font-size: 16px;
      color: #1e3a5f;
    }
    
    .results-tile .score {
      font-size: 20px;
      font-weight: 800;
      margin-top: 8px;
    }
    
    .section-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 12px;
    }
    
    .section-table th,
    .section-table td {
      padding: 8px;
      border-bottom: 1px solid #e6eef8;
      text-align: left;
      font-size: 14px;
    }
    
    .summary {
      background: #fff;
      padding: 16px;
      border-radius: 10px;
      margin-top: 18px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .summary .left {
      font-weight: 700;
    }
    
    .summary .right {
      text-align: right;
    }
    
    .controls {
      display: flex;
      gap: 10px;
      margin-top: 18px;
    }
    
    .results-btn {
      background: #4da6ff;
      border: none;
      color: #fff;
      padding: 10px 14px;
      border-radius: 8px;
      font-weight: 700;
      cursor: pointer;
      transition: background 0.3s;
    }
    
    .results-btn:hover {
      background: #3a8ce0;
    }
    
    .button-like {
      text-decoration: none;
    }
    
    .small-muted {
      color: #6b7280;
      font-size: 13px;
    }
    
    input[type="number"] {
      width: 90px;
      padding: 8px;
      border: 1px solid #d7e6fb;
      border-radius: 6px;
    }
    
    .note {
      font-size: 13px;
      color: #6b7280;
      margin-top: 8px;
    }
    
    /* Footer */
    footer.controls {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 20px;
      background: white;
      border-top: 1px solid #e1e8f6;
      margin-top: 20px;
    }
    
    .status {
      font-size: 14px;
      color: #7f8c8d;
    }
    
    .ghost {
      background: transparent;
      border: 2px solid #2c3e50;
      color: #2c3e50;
    }
    
    .ghost:hover {
      background: #2c3e50;
      color: white;
    }

    /* Responsive Styles */
    @media (max-width: 980px) {
      .container {
        grid-template-columns: 1fr;
        padding: 12px;
      }
      
      .container-split {
        grid-template-columns: 1fr;
      }
      
      .right-panel {
        order: 2;
      }
      
      .top-tiles {
        padding-left: 8px;
        padding-right: 8px;
      }
      
      header.topbar {
        flex-direction: column;
        gap: 15px;
        text-align: center;
      }
      
      .buttons-grid {
        grid-template-columns: 1fr;
      }
      
      .answer-options {
        flex-direction: column;
        gap: 10px;
      }
      
      footer.controls {
        flex-direction: column;
        gap: 15px;
      }
      
      .results-tiles {
        flex-direction: column;
      }
      
      .summary {
        flex-direction: column;
        gap: 10px;
        text-align: center;
      }
      
      .controls {
        flex-direction: column;
      }
    }
    
    @media (max-width: 600px) {
      .start-content {
        padding: 25px 20px;
      }
      
      h1 {
        font-size: 28px;
      }
      
      .card {
        padding: 20px 15px;
      }
    }

    /* === ÿ™ÿ≠ÿ≥ŸäŸÜÿßÿ™ ÿÆÿßÿµÿ© ŸÑŸÑŸáŸàÿßÿ™ŸÅ ÿßŸÑÿµÿ∫Ÿäÿ±ÿ© ÿ¨ÿØÿß === */
    @media (max-width: 480px) {
      /* 1. ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑÿ≠ÿßŸàŸäÿßÿ™ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ© */
      .container, .container-split, .container-full {
        grid-template-columns: 1fr !important;
        padding: 8px !important;
        gap: 10px !important;
      }
      
      /* 2. ÿ¨ÿπŸÑ ÿßŸÑŸÑŸàÿ≠ÿßÿ™ (panels) ÿ™ÿ£ÿÆÿ∞ ÿπÿ±ÿ∂ ŸÉÿßŸÖŸÑ */
      .left-panel, .right-panel, .main-panel {
        max-height: none !important;
        height: auto !important;
        overflow: visible !important;
        margin-bottom: 10px;
      }
      
      /* 3. ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑŸáŸäÿØÿ± */
      .topbar {
        flex-direction: column !important;
        align-items: stretch !important;
        padding: 10px !important;
      }
      
      .brand {
        justify-content: center;
        margin-bottom: 10px;
      }
      
      /* 4. ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑÿ£ÿ≤ÿ±ÿßÿ± ŸÅŸä ÿßŸÑŸáŸäÿØÿ± */
      .buttons-grid {
        grid-template-columns: 1fr !important;
        width: 100%;
      }
      
      .exam-btn {
        width: 100% !important;
        margin: 2px 0 !important;
        font-size: 14px !important;
        padding: 12px 8px !important;
      }
      
      /* 5. ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑÿ™ÿßŸäŸÑÿßÿ™ */
      .top-tiles {
        flex-wrap: wrap;
        justify-content: center;
      }
      
      .tile {
        flex: 0 0 calc(33% - 5px) !important;
        max-width: calc(33% - 5px) !important;
        margin: 2px;
        font-size: 11px !important;
        padding: 8px 4px !important;
      }
      
      /* 6. ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑŸÜÿµŸàÿµ */
      .passage, .text-content, .question-text {
        font-size: 15px !important;
        line-height: 1.5 !important;
      }
      
      /* 7. ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑÿÆŸäÿßÿ±ÿßÿ™ */
      .option {
        padding: 12px 10px !important;
        margin: 4px 0 !important;
      }
      
      /* 8. ÿ™ÿ≠ÿ≥ŸäŸÜ ÿ¨ÿØÿßŸàŸÑ True/False */
      .true-false-table {
        display: block;
        overflow-x: auto;
        white-space: nowrap;
      }
      
      /* 9. ÿ™ÿ≠ÿ≥ŸäŸÜ ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑŸÉÿ™ÿßÿ®ÿ© */
      .writing-textarea {
        min-height: 300px !important;
        font-size: 16px !important;
      }
      
      /* 10. ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑŸÅŸàÿ™ÿ± */
      footer.controls {
        flex-direction: column !important;
        gap: 10px !important;
      }
      
      .footer-buttons {
        width: 100%;
        display: flex;
        gap: 5px;
      }
      
      .footer-buttons .exam-btn {
        flex: 1;
      }
      
      /* 11. ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨ */
      .results-tiles {
        flex-direction: column !important;
      }
      
      .results-tile {
        margin-bottom: 10px;
      }
    }

    /* === ÿ™ÿ≠ÿ≥ŸäŸÜÿßÿ™ ŸÑŸÑŸáŸàÿßÿ™ŸÅ ÿßŸÑŸÖÿ™Ÿàÿ≥ÿ∑ÿ© === */
    @media (min-width: 481px) and (max-width: 768px) {
      .container, .container-split {
        grid-template-columns: 1fr !important;
      }
      
      .tile {
        max-width: 180px !important;
      }
    }
  </style>
</head>
<body id="body">
  <!-- Start Page -->
  <div id="start-page" class="start-container">
    <div class="start-content">
      <div class="logo">
        <div class="logo-icon">üìù</div>
        <h1>Deutsch B2 Pr√ºfung</h1>
        <div class="subtitle">Bereiten Sie sich auf Ihre Pr√ºfung vor</div>
      </div>
      <div class="card">
        <h2>Pr√ºfungsbereich ausw√§hlen</h2>
        <p>W√§hlen Sie bitte den Bereich aus, den Sie √ºben m√∂chten. Die Pr√ºfung startet automatisch in <span id="time-display">30</span> Sekunden.</p>
        <select id="sectionSelect">
          <option value="lesen">Lesen</option>
          <option value="hoeren">H√∂ren</option>
          <option value="schreiben">Schreiben</option>
        </select>
        <div class="button-container">
          <button id="cancelBtn" class="btn">Abbrechen</button>
          <button id="startBtn" class="btn">Jetzt starten</button>
        </div>
      </div>
      <div class="timer-container">
        <div class="timer-label">Die Pr√ºfung startet in:</div>
        <div class="timer" id="countdown">30</div>
        <div class="progress-bar">
          <div class="progress" id="progress"></div>
        </div>
      </div>
      <div class="info-text">Stellen Sie sicher, dass Sie in einer ruhigen Umgebung sind und gen√ºgend Zeit haben.</div>
    </div>
  </div>

  <!-- Lesen Page -->
  <div id="lesen-page" class="exam-page" style="display: none;">
    <header class="topbar" role="banner">
      <div class="brand">
        <div class="logo">test</div>
        <div class="meta">
          <div class="main-title">Deutsch - B2 (√úbung)</div>
          <div class="sub-title">Lesen ‚Äî Testbeispiel</div>
        </div>
      </div>

      <div id="timer-lesen" class="timer" aria-live="polite">Verbleibende Zeit: 90:00</div>

      <div class="buttons-grid">
        <button id="resetBtn-lesen" class="exam-btn reset">üîÑ Von neu beginnen</button>
        <button id="saveBtn-lesen" class="exam-btn save">üìã Speichern</button>
        <button id="resultBtn-lesen" class="exam-btn result">üìä Ergebnis</button>
        <button id="submitBtn-lesen" class="exam-btn submit">üèÅ Abgabe</button>
        <button class="exam-btn next" id="nextBtn-lesen">‚û°Ô∏è N√§chste Pr√ºfung</button>
      </div>
    </header>

    <div class="top-tiles" id="topTiles-lesen" role="navigation" aria-label="Sections overview"></div>

    <div class="container">
      <main class="left-panel" id="leftPanel-lesen">
        <div class="passage" id="passage-lesen">
          <h2 id="passageTitle-lesen">Aufgabe</h2>
          <div id="passageContent-lesen"></div>
        </div>
      </main>

      <aside class="right-panel" id="rightPanel-lesen" aria-labelledby="questionTitle-lesen">
        <div class="question-head">
          <div>
            <div id="sectionName-lesen" style="font-weight:800"></div>
            <div id="questionTitle-lesen" style="font-size:13px;color:#55607a">Frage</div>
          </div>
          <button id="resetSectionBtn-lesen" class="exam-btn reset-section" style="display:none;">Teil zur√ºcksetzen</button>
        </div>
        <div class="question-body" id="questionBody-lesen"></div>
        <div id="headingsBankContainer-lesen"></div>
      </aside>
    </div>

    <footer class="controls">
      <div class="footer-buttons">
        <button id="prevBtn-lesen" class="exam-btn ghost">Zur√ºck</button>
        <button id="nextBtn-lesen" class="exam-btn ghost">Weiter</button>
      </div>
      <div class="status"><span id="statusText-lesen">Nicht gespeichert</span></div>
    </footer>
  </div>

  <!-- H√∂ren Page -->
  <div id="hoeren-page" class="exam-page" style="display: none;">
    <header class="topbar" role="banner">
      <div class="brand">
        <div class="logo">test</div>
        <div class="meta">
          <div class="main-title">Deutsch - B2 (√úbung)</div>
          <div class="sub-title">H√∂rverstehen ‚Äî Testbeispiel</div>
        </div>
      </div>

      <div id="timer-hoeren" class="timer" aria-live="polite">Verbleibende Zeit: 17:00</div>

      <div class="buttons-grid">
        <button id="resetBtn-hoeren" class="exam-btn reset">üîÑ Von neu beginnen</button>
        <button id="saveBtn-hoeren" class="exam-btn save">üìã Speichern</button>
        <button id="resultBtn-hoeren" class="exam-btn result">üìä Ergebnis</button>
        <button id="submitBtn-hoeren" class="exam-btn submit">üèÅ Abgabe</button>
        <button class="exam-btn next" id="nextBtn-hoeren">‚û°Ô∏è N√§chste Pr√ºfung</button>
      </div>
    </header>

    <div class="top-tiles" id="topTiles-hoeren" role="navigation" aria-label="Sections overview"></div>

    <div class="container-full">
      <main class="main-panel" id="mainPanel-hoeren">
        <div id="contentContainer-hoeren"></div>
      </main>
    </div>

    <footer class="controls">
      <div class="footer-buttons">
        <button id="prevBtn-hoeren" class="exam-btn ghost">Zur√ºck</button>
        <button id="nextBtn-hoeren" class="exam-btn ghost">Weiter</button>
      </div>
      <div class="status"><span id="statusText-hoeren">Nicht gespeichert</span></div>
    </footer>
  </div>

  <!-- Schreiben Page -->
  <div id="schreiben-page" class="exam-page" style="display: none;">
    <header class="topbar" role="banner">
      <div class="brand">
        <div class="logo">test</div>
        <div class="meta">
          <div class="main-title">Deutsch - B2 (√úbung)</div>
          <div class="sub-title">Schreiben ‚Äî Testbeispiel</div>
        </div>
      </div>

      <div id="timer-schreiben" class="timer" aria-live="polite">Verbleibende Zeit: 30:00</div>

      <div class="buttons-grid">
        <button id="resetBtn-schreiben" class="exam-btn reset">üîÑ Von neu beginnen</button>
        <button id="saveBtn-schreiben" class="exam-btn save">üìã Speichern</button>
        <button id="resultBtn-schreiben" class="exam-btn result">üìä Ergebnis</button>
        <button id="submitBtn-schreiben" class="exam-btn submit">üèÅ Abgabe</button>
        <button class="exam-btn next" id="nextBtn-schreiben">‚û°Ô∏è N√§chste Pr√ºfung</button>
      </div>
    </header>

    <div class="top-tiles" id="topTiles-schreiben" role="navigation" aria-label="Sections overview"></div>

    <div class="container-split">
      <main class="left-panel" id="leftPanel-schreiben">
        <div class="passage" id="passage-schreiben">
          <h2 id="passageTitle-schreiben">Aufgabe</h2>
          <div id="passageContent-schreiben"></div>
        </div>
      </main>

      <aside class="right-panel" id="rightPanel-schreiben">
        <div id="writingContainer-schreiben"></div>
      </aside>
    </div>

    <footer class="controls">
      <div class="footer-buttons">
        <button id="prevBtn-schreiben" class="exam-btn ghost">Zur√ºck</button>
        <button id="nextBtn-schreiben" class="exam-btn ghost">Weiter</button>
      </div>
      <div class="status"><span id="statusText-schreiben">Nicht gespeichert</span></div>
    </footer>
  </div>

  <!-- Ergebnisse Page -->
  <div id="ergebnisse-page" class="results-page" style="display: none;">
    <header class="results-header">
      <div class="results-logo">test</div>
      <div class="results-title">Gesamtergebnis ‚Äî Deutsch B2</div>
    </header>

    <div class="results-container">
      <div class="results-tiles" id="topTiles-ergebnisse"></div>
      <div id="details-ergebnisse"></div>
      <div class="summary" id="finalSummary-ergebnisse"></div>
      <div class="controls">
        <a class="button-like" href="#" id="backBtn-ergebnisse">
          <button class="results-btn">üîÅ Zur√ºck zur Startseite</button>
        </a>
        <button id="calcBtn-ergebnisse" class="results-btn">‚úÖ Ergebnisse anzeigen</button>
      </div>
      <div class="note">Hinweis: Schreiben (45 Punkte) wird manuell eingegeben, falls nicht automatisch vorhanden.</div>
    </div>
  </div>

  <script>
    // ===== PAGE NAVIGATION =====
    function showPage(pageId) {
      // Hide all pages
      document.getElementById('start-page').style.display = 'none';
      document.getElementById('lesen-page').style.display = 'none';
      document.getElementById('hoeren-page').style.display = 'none';
      document.getElementById('schreiben-page').style.display = 'none';
      document.getElementById('ergebnisse-page').style.display = 'none';
      
      // Change body class based on page
      document.getElementById('body').className = '';
      if (pageId === 'ergebnisse-page') {
        document.getElementById('body').className = 'results-body';
      } else if (pageId !== 'start-page') {
        document.getElementById('body').className = 'exam-body';
      }
      
      // Show selected page
      document.getElementById(pageId).style.display = 'block';
      
      // Initialize the page if needed
      if (pageId === 'lesen-page' && typeof initLesenPage === 'function') {
        initLesenPage();
      } else if (pageId === 'hoeren-page' && typeof initHoerenPage === 'function') {
        initHoerenPage();
      } else if (pageId === 'schreiben-page' && typeof initSchreibenPage === 'function') {
        initSchreibenPage();
      } else if (pageId === 'ergebnisse-page' && typeof initErgebnissePage === 'function') {
        initErgebnissePage();
      }
    }

    // ===== START PAGE FUNCTIONALITY =====
    let initialCounter = 30;
    let counter = initialCounter;
    let countdownInterval;
    let countdownRunning = false;
    let examStarted = false;
    const timerEl = document.getElementById("countdown");
    const timeDisplayEl = document.getElementById("time-display");
    const progressEl = document.getElementById("progress");
    const selectEl = document.getElementById("sectionSelect");
    const startBtn = document.getElementById("startBtn");
    const cancelBtn = document.getElementById("cancelBtn");

    function startCountdown() {
      // prevent double-starts or starting after exam already began
      if (countdownRunning || examStarted) return;
      countdownRunning = true;
      // disable start button while counting
      try { startBtn.disabled = true; startBtn.setAttribute('aria-disabled','true'); } catch(e){}
      // reset counter & UI
      counter = initialCounter;
      timerEl.textContent = counter;
      timeDisplayEl.textContent = counter;
      progressEl.style.transform = "scaleX(0)";
      timerEl.style.color = "";

      countdownInterval = setInterval(() => {
        counter--;
        timerEl.textContent = counter;
        timeDisplayEl.textContent = counter;
        const progressValue = (initialCounter - counter) / initialCounter;
        progressEl.style.transform = `scaleX(${progressValue})`;
        if (counter <= 0) {
          clearInterval(countdownInterval);
          countdownInterval = null;
          countdownRunning = false;
          progressEl.style.transform = "scaleX(1)";
          // ensure exam starts only once
          if (!examStarted) {
            examStarted = true;
            startExam();
          }
          // safety: re-enable start button (page usually navigates away)
          try { startBtn.disabled = false; startBtn.removeAttribute('aria-disabled'); } catch(e){}
        }
      }, 1000);
    }

    function stopCountdown(reset = true) {
      if (countdownInterval) {
        clearInterval(countdownInterval);
        countdownInterval = null;
      }
      countdownRunning = false;
      try { startBtn.disabled = false; startBtn.removeAttribute('aria-disabled'); } catch(e){}
      progressEl.style.transform = "scaleX(0)";
      if (reset) {
        counter = initialCounter;
        timerEl.textContent = counter;
        timeDisplayEl.textContent = counter;
      } else {
        timerEl.textContent = "Gestoppt";
      }
    }

    function startExam() {
      // guard to ensure startExam is triggered once
      if (!examStarted) examStarted = true;
      const selectedSection = selectEl.value;
      if (selectedSection === 'lesen') {
        showPage('lesen-page');
      } else if (selectedSection === 'hoeren') {
        showPage('hoeren-page');
      } else if (selectedSection === 'schreiben') {
        showPage('schreiben-page');
      }
    }

    // wire buttons: start will now start the countdown (not the exam directly)
    startBtn.addEventListener('click', startCountdown);

    cancelBtn.addEventListener('click', () => {
      stopCountdown(true);
      timerEl.textContent = "Abgebrochen";
      timerEl.style.color = "#e53e3e";
    });

    // ===== LESEN PAGE FUNCTIONALITY =====
    function initLesenPage() {
      /* ===== Self-contained exam (embedded) ===== */
      const exam = {
        id: "exam-001",
        durationSec: 90 * 60,
        sections: [
          { 
            id: "s1", 
            title: "Leseverstehen, Teil 1", 
            points: 10,
            passageTitle: "Aufgabe: Ziehen Sie die passenden √úberschriften auf die Texte.",
            passage: "",
            questions: [],
            texts: [
              {
                id: "text1",
                content: "Im Winter gehen Tiere in den Winterschlaf, um Energie zu sparen. W√§hrend des Winterschlafs verlangsamt sich ihr Stoffwechsel, und ihre K√∂rpertemperatur sinkt. Dies erm√∂glicht es ihnen, √ºber l√§ngere Zeitr√§ume ohne Nahrung auszukommen. Zu den Tieren, die Winterschlaf halten, geh√∂ren Igel, Flederm√§use und Murmeltiere.",
                correctAnswer: "i"
              },
              {
                id: "text2", 
                content: "Laut einer Studie der Universit√§t Leipzig verbessert nat√ºrliches Licht die Lernf√§higkeit von Sch√ºlern. Klassenzimmer mit viel Tageslicht tragen dazu bei, dass die Sch√ºler wacher und aufmerksamer sind.",
                correctAnswer: "j"
              },
              {
                id: "text3",
                content: "Ein regelm√§√üiger Schlafrhythmus ist entscheidend f√ºr die Gesundheit. Unser K√∂rper produziert w√§hrend des Schlafs das Hormon Melatonin, das f√ºr die Regulierung des Schlaf-Wach-Rhythmus verantwortlich ist. Melatonin hilft dem K√∂rper, sich zu entspannen und sorgt f√ºr eine erholsame Nacht. Ein gest√∂rter Schlafrhythmus kann zu Gesundheitsproblemen f√ºhren.",
                correctAnswer: "h"
              },
              {
                id: "text4",
                content: "In den letzten Jahren hat sich das n√§chtliche Wandern in der Natur zu einer beliebten Freizeitaktivit√§t entwickelt. Gesundheitsexperten raten davon ab, diese Praxis zu verbieten, da sie positive Auswirkungen auf die k√∂rperliche und geistige Gesundheit hat. Das Wandern bei Nacht hilft, Stress abzubauen, die Sinne zu sch√§rfen und die Verbindung zur Natur zu st√§rken. Dar√ºber hinaus f√∂rdert es die Produktion von Melatonin, einem Hormon, das den Schlaf-Wach-Rhythmus reguliert, und hilft somit bei Schlafproblemen. Experten betonen, dass diese Art von Bewegung besonders wohltuend ist, solange sie sicher und in geeigneten Gebieten durchgef√ºhrt wird.",
                correctAnswer: "c"
              },
              {
                id: "text5",
                content: "Professor Dr. Thomas M√ºnch von der Universit√§t Freiburg f√ºhrte eine Studie durch, die den Zusammenhang zwischen Arbeitszeiten, Tageslicht und der Gesundheit von Arbeitnehmern untersuchte. Die Studie zeigte, dass Menschen, die ihre Arbeitszeiten besser an den nat√ºrlichen Sonnenrhythmus anpassen, seltener an Schlafst√∂rungen und chronischer M√ºdigkeit leiden. Zudem f√∂rdert der t√§gliche Fu√üweg zur Arbeit, besonders bei Tageslicht, nicht nur die k√∂rperliche Gesundheit, sondern verbessert auch die psychische Verfassung. Der Kontakt mit nat√ºrlichem Licht reguliert den Hormonhaushalt, insbesondere die Produktion von Melatonin und Serotonin, was f√ºr das Wohlbefinden entscheidend ist.",
                correctAnswer: "d"
              }
            ],
            headings: [
              {id: "a", text: "F√ºr unterwegs: Leckereien im Zugrestaurant In der"},
              {id: "b", text: "Stadt der warmen Quellen"},
              {id: "c", text: "Eine Wanderung macht gute Laune"},
              {id: "d", text: "‚ÄûDie Arbeit von Forschern erfordert weniger Zeit\""},
              {id: "e", text: "Naschen statt wegwerfen"},
              {id: "f", text: "Neues Thermalbad in Rom"},
              {id: "g", text: "Reisen: Die beliebtesten Thermalb√§der"},
              {id: "h", text: "Klug durch Schlafen"},
              {id: "i", text: "Tiere Energiesparmodus"},
              {id: "j", text: "Licht aus dem Klassenzimmer"}
            ]
          },
          { 
            id: "s2", 
            title: "Leseverstehen, Teil 2", 
            points: 25,
            passageTitle: "Im Nachtzug durch Europa",
            passage: `Nachtz√ºge wecken heute oft nostalgische Vorstellungen. Man denkt etwa an den Luxus des Orient Express, der seine meist gut betuchte Kundschaft innerhalb weniger Tage von Paris nach Istanbul brachte, an Landschaften, die an den Zugfenstern vorbeirauschen, und das sanfte Rattern eines Zuges, das einen in den Schlaf wiegt. Doch h√§lt die Realit√§t, was solche Bilder versprechen? Teilweise', meint die Studentin Sofia Osterhasen. Sie ist schon im Nachtzug von M√ºnchen nach Florenz, von Oslo nach Bergen und von Stockholm nach Kiruna gereist. Bei ihrer ersten Fahrt habe sie vor Aufregung nicht geschlafen, erz√§hlt sie. Und auch sonst seien die N√§chte im Zug oft unruhig, daf√ºr sorgten etwa schnarchende Passagiere. Nat√ºrlich w√§re Fliegen schneller und auf vielen Strecken sogar g√ºnstiger. Doch die lange Anreise gebe ihre Zeit, sich mit Mitreisenden zu unterhalten. ‚ÄûDie Leute erz√§hlen w√§hrend einer Zugfahrt viel aus ihrem Leben, man erf√§hrt mehr als es bei Zufallsbekanntschaften oft der Fall ist. Das fasziniert mich", erkl√§rt sie. Zutun und kamen v√∂llig √ºberm√ºdet am Zielort an Doch als sein j√ºngster Sohn die Augen √∂ffnete, rief er: Das war meine beste Reise! Ein fahrendes Bett! Ich will jetzt immer nur noch Nachtzug fahren. Vor allem der Kinder wegen haben die Schneiders auch f√ºr den diesj√§hrigen Urlaub eine Fahrt im Nachtzug gebucht. Dass die Nachtz√ºge, die durch Europa fahren, nicht immer sonderlich bequem sind, dar√ºber wird h√§ufig geklagt. Fahrg√§ste bem√§ngeln, dass die Waggons teilweise sehr in die Jahre gekommen sind und nur wenige Annehmlichkeiten bieten. Ist vielleicht auch dies ein Grund, warum Gesch√§ftsreisende diese Transportm√∂glichkeit nur selten in Betracht ziehen? ‚ÄûDas w√ºrde f√ºr mich keine gro√üe Rolle spielen", meint Florian Kirsch, Vertriebsleiter eines mittelst√§ndischen Unternehmens. Viel wichtiger sei der Faktor Zeit: Wer will schon zwei N√§chte im Zug verbringen, blo√ü weil er einen Termin in einer anderen Stadt hat? Wenn Nachtz√ºge konkurrenzf√§hig sein wollen, m√ºssen sie mehr Schnelligkeit bieten, erkl√§rt Florian Kirsch. Er selbst nimmt f√ºr l√§ngere Gesch√§ftsreisen ausschlie√ülich das Flugzeug.`,
            questions: [
              {
                id: "s2q1",
                type: "single",
                text: "Sofia Osterhagen f√§hrt gerne mit dem Nachtzug, weil",
                options: [
                  {id: "s2q1o1", text: "dieser im Vergleich zu Flugreisen oft billiger ist."},
                  {id: "s2q1o2", text: "man dort leicht mit anderen Fahrg√§sten ins Gespr√§ch kommt."},
                  {id: "s2q1o3", text: "sie w√§hrend der Fahrt meist gut schlafen kann."}
                ],
                correctAnswer: "s2q1o2"
              },
              {
                id: "s2q2",
                type: "single", 
                text: "Die Deutsche Bahn",
                options: [
                  {id: "s2q2o1", text: "hat der √ñsterreichischen Bundesbahn einige Z√ºge abgekauft."},
                  {id: "s2q2o2", text: "m√∂chte mehr Fahrten √ºber Nacht anbieten."},
                  {id: "s2q2o3", text: "verzichtete aus √∂konomischen Gr√ºnden auf eigene Nachtz√ºge."}
                ],
                correctAnswer: "s2q2o3"
              },
              {
                id: "s2q3",
                type: "single",
                text: "Die Reise mit dem Nachtzug",
                options: [
                  {id: "s2q3o1", text: "empfand Tom Schneider insgesamt als erholsam."},
                  {id: "s2q3o2", text: "hat Tom Schneiders Sohn begeistert."},
                  {id: "s2q3o3", text: "m√∂chte Tom Schneider nicht wiederholen."}
                ],
                correctAnswer: "s2q3o2"
              },
              {
                id: "s2q4",
                type: "single",
                text: "Florian Kirsch verzichtet auf l√§ngere Zugreisen, weil",
                options: [
                  {id: "s2q4o1", text: "er im Zug ungern arbeitet."},
                  {id: "s2q4o2", text: "er mit dem Flugzeug Zeit spart."},
                  {id: "s2q4o3", text: "es ihm an Bequemlichkeit fehlt."}
                ],
                correctAnswer: "s2q4o2"
              },
              {
                id: "s2q5", 
                type: "single",
                text: "Die Z√ºge des franz√∂sischen Start-ups sollen",
                options: [
                  {id: "s2q5o1", text: "den Fahrg√§sten viel Privatsph√§re bieten."},
                  {id: "s2q5o2", text: "vor allem eine finanzkr√§ftige Zielgruppe ansprechen."},
                  {id: "s2q5o3", text: "zun√§chst Zielorte n√∂rdlich von Frankreich anfahren."}
                ],
                correctAnswer: "s2q5o1"
              }
            ]
          },
          { 
            id: "s3", 
            title: "Leseverstehen, Teil 3", 
            points: 20,
            passageTitle: "Aufgabe: Lesen Sie die zehn Situationen (11-20) und die zw√∂lf Texte (A-L). Welcher Text passt zu welcher Situation? Sie k√∂nnen jeden Text nur einmal verwenden. ManchŸÖÿß passt kein Text. W√§hlen Sie dann 'x'.",
            passage: "",
            questions: [],
            texts: [
              {id: "A", text: "Das Comedy Filmfest tourt auch dieses Jahr durch Deutschland. In Berlin startet es am 14. August mit der belgischen Produktion ‚ÄûSchokolade und Pommes frites\". In dieser romantischen Kom√∂die treffen zwei Charaktere aufeinander, die unterschiedlicher kaum sein k√∂nnten: Die zielstrebige, doch ein wenig sch√ºchterne Marie hat sich mit einem Schokoladengesch√§ft ihren gro√üen Traum verwirklicht. Alles l√§uft gut, bis auf der anderen Stra√üenseite der chaotische Lebensk√ºnstler Michel einen Schnellimbiss er√∂ffnet und Maries Leben reichlich durcheinanderwirbelt. ‚ÄûSchokolade und Pommes frites\": 14. August, 20 Uhr, Filmtheater Friedrichshain", correctAnswer: "18"},
              {id: "B", text: "Als die Bilder laufen lernten Dieser Band l√§dt Sie ein, eine bewegte Kinoepoche zu entdecken. In den Jahren von 1895 bis 1930 entwickelte sich das Kino in atemberaubendem Tempo zum Unterhaltungsmedium schlechthin. Autorin Greta Valentino geht zur√ºck bis zu den ersten Filmen der Br√ºder Lumi√®re und den Anf√§ngen des Westerns und taucht anschlie√üend ein in die schillernden 1920er Jahre, als der Stummfilm seine goldene √Ñra feierte und Filmpal√§ste wie Pilze aus dem Boden schossen. Die Autorin studierte Kunstgeschichte in Paris und Amsterdam. Sie ver√∂ffentlichte B√ºcher sowie zahlreiche Artikel √ºber Kunst und Kino.", correctAnswer: "11"},
              {id: "C", text: "Berlin erleben Unsere Reise f√ºhrt Sie in eine der abwechslungsreichsten St√§dte Deutschlands: Berlin. Mit historischen Bauwerken und Museen, breiten Prachtstra√üen und Einkaufsmeilen sowie weitl√§ufigen Parks und G√§rten hat die Hauptstadt f√ºr jeden etwas zu bieten. Reisen Sie bequem mit der Deutschen Bahn und verbringen Sie aufregende Tage in Berlin. √úbernachtung mit Fr√ºhst√ºck im Hotel. Dauer: ab 4 Tage (Verl√§ngerung m√∂glich) Preis: ab 437 Euro pro Person im Doppelzimmer inklusive An- und Abreise mit der Deutschen Bahn Mehr Infos unter: www.bergmann-reisen.info.", correctAnswer: "20"},
              {id: "D", text: "Berlin Gendarmenmarkt Im M√§rz beginnen die Dreharbeiten f√ºr den Film ‚ÄûBerlin Gendarmenmarkt\". Erz√§hlt wird die Geschichte der sechzehnj√§hrigen Ida, die Jugend und Erwachsenwerten im Berlin der Goldenen Zwanziger erlebt und von einer gro√üen Karriere auf der Theaterb√ºhne tr√§umt. Die Romanvorlage f√ºr den Film lieferte die Schriftstellerin Marie Franck. F√ºr kleinere Filmrollen oder als Komparsen werden noch Mitwirkende jeden Alters gesucht. Die Gage betr√§gt 75 ‚Ç¨ pro Drehtag. Bewerbungsschluss ist der 16. November. Infos und Bewerbung unter: www.film-gendarmenmarkt.info/casting", correctAnswer: "12"},
              {id: "E", text: "Berlin in den Zwanziger Jahren Dreigroschenoper, Bubikopf, Dada, Bauhausarchitektur. Dieser Bildband erweckt das Berlin in den 1920ern wieder zum Leben. In dieser Dekade war Berlin eine moderne, von Fortschritt und Freiheit berauschte Weltstadt, die f√ºr K√ºnstler und Intellektuelle zum Sehnsuchtsort wurde. Autor Gereon Kutscher nimmt Sie mit auf einen Streifzug durch eine Epoche der kulturellen Bl√ºte und der Lebenslust. Gereon Kutscher: Berlin in den Zwanziger Jahren, Hardcover, 126 Seiten, 28 ‚Ç¨", correctAnswer: null},
              {id: "F", text: "Eine Karte, 30 H√§user Ob Meisterwerke der Kunst, arch√§ologische Sch√§tze aus sechs Jahrtausenden oder technische Errungenschaften ‚Äì das alles finden Sie in den Berliner Museen. Mit dem Museumspass √∂ffnen sich Ihnen die T√ºren von √ºber 30 H√§usern, darunter die Alte Nationalgalerie, das Pergamonmuseum, das Museum f√ºr Naturkunde und die Neue Nationalgalerie. An drei aufeinanderfolgenden Tagen haben Sie damit freien Eintritt. Preis: 29 ‚Ç¨, erm√§√üigt 14,50 ‚Ç¨ Ticket hier online kaufen: https://shop.nmg.museum", correctAnswer: "11"},
              {id: "G", text: "Feiern wie in den Goldenen Zwanzigern Ein ausgelassenes Lebensgef√ºhl und rauschende N√§chte. So stellt man sich die 1920er Jahre vor, an die Filme wie ‚ÄûDer gro√üe Gatsby\" und Serien wie ‚ÄûBabylon Berlin\" immer wieder erinnern. Gehen Sie auf eine glamour√∂se Zeitreise und lassen Sie diese √Ñra wiederauferstehen. Wir haben daf√ºr die passende Kleidung f√ºr Sie. In unserem Online-Shop finden Sie alles, was Sie f√ºr einen gl√§nzenden Auftritt auf einer Motroparty brauchen. Paillettenkleider und Kopfschmuck f√ºr Damen, Westen und Anz√ºge f√ºr Herren und Accessoires sowie Dekoartikel. www.golden20.com", correctAnswer: "19"},
              {id: "H", text: "Das etwas gem√ºtlichere Berlin Der wenig bekannte Berliner Stadtteil Friedenau ist bis heute eher ein Geheimtipp. Das Viertel besticht durch pr√§chtig geschm√ºckte Wohnh√§user, kleine Villen und eine bunt gemischte Gastronomie. Kommen Sie mit auf eine kulinarisch-kulturelle F√ºhrung durch das charmante, ruhige Friedenau. Erfahren Sie mehr √ºber die ber√ºhmten Gesichter dieses Stadtviertels, entdecken Sie wundersch√∂ne Altbauten und lernen Sie die beeindruckenden Goerz-H√∂fe kennen. Unsere erfahrenen Stadtf√ºhrer zeigen Ihnen au√üerdem spannende Orte zum Genie√üen, zum Beispiel ein italienisches Caf√©, eine koreanische Snack-Bar und ein marokkanisches Bistro. 3 Stunden, ca. 3 km zu Fu√ü Preis: 39 ‚Ç¨, erm√§√üigt 20 ‚Ç¨ Anmeldung unter: www.friedenau-touren.net", correctAnswer: "17"},
              {id: "I", text: "Feiern wie in den Goldenen Zwanzigern Ein ausgelassenes Lebensgef√ºhl und rauschende N√§chte. So stellt man sich die 1920er Jahre vor, an die Filme wie ‚ÄûDer gro√üe Gatsby und Serien wie ‚ÄûBabylon Berlin immer wieder erinnern. Gehen Sie auf eine glamour√∂se Zeitreise und lassen Sie diese √Ñra wiederauferstehen. Wir haben daf√ºr die passende Kleidung f√ºr Sie. In unserem Online-Shop finden Sie alles, was Sie f√ºr einen gl√§nzenden Auftritt auf einer Mottoparty brauchen. Paillettenkleider und Kopfschmuck f√ºr Damen, Westen und Anz√ºge f√ºr Herren und Accessoires sowie Dekoartikel. www.golden20.com", correctAnswer: "13"},
              {id: "J", text: "Das etwas gem√ºtlichere Berlin Der wenig bekannte Berliner Stadtteil Friedenau ist bis heute eher ein Geheimtipp. Das Viertel besticht durch pr√§chtig geschm√ºckte Wohnh√§user, kleine Villen und eine bunt gemischte Gastronomie. Kommen Sie mit auf eine kulinarisch-kulturelle F√ºhrung durch das charmante, ruhige Friedenau. Erfahren Sie mehr √ºber die ber√ºhmten Gesichter dieses Stadtviertels, entdecken Sie wundersch√∂ne Altbauten und lernen Sie die beeindruckenden Goerz H√∂fe kennen. Unsere erfahrenen Stadtf√ºhrer zeigen Ihnen au√üerdem spannende Orte zum Genie√üen, zum Beispiel ein italienisches Caf√©, eine koreanische Snack-Bar und ein marokkanisches Bistro.  3 Stunden, ca. 3 km zu Fu√ü Preis: 39 ‚Ç¨, erm√§√üigt 20 ‚Ç¨ Anmeldung unter: www.friedenau-touren.net ", correctAnswer: "14"},
              {id: "K", text: "Sie lieben Filme? Dann machen Sie doch das Kino zu Ihrem Arbeitsplatz und werden Sie Teil unseres Teams! Das Metropolis Filmtheater Altenberg sucht eine Aushilfe als Urlaubsvertretung f√ºr die Monate Juli und August, 25 Stunden pro Woche. Zu Ihren Aufgaben geh√∂ren u. a. der Verkauf von Kinokarten, Popcorn und Getr√§nken sowie die Einlasskontrolle und die Vorbereitung der S√§le. Sie sind vollj√§hrig, zuverl√§ssig und bereit, auch am Abend oder Wochenende zu arbeiten? Dann freuen wir uns auf Ihre Bewerbung mit kurzem Anschreiben und Lebenslauf per E-Mail. Metropolis Kino Altenberg info@metropolis-altenberg.net ", correctAnswer: "15"},
              {id: "L", text: "Wer hat die Kokosnuss geklaut? Bei dieser Tour geht es ins Affenhaus! Beobachte Gorillas, Paviane und Co. bei der Futtersuche und finde heraus, was sie am liebsten fressen. Nat√ºrlich bleibt noch Zeit, bei anderen Zoo-Bewohnern vorbeizuschauen. Geh zusammen mit einem Guide auf eine besondere Entdeckungstour durch den Zoo Berlin. Spannende Tier- Fakten und exklusive Einblicke in den Zoo-Alltag warten auf dich! F√ºhrung f√ºr Kinder ab 8 Jahren. Zoologischer Garten Berlin Hardenbergplatz 8, 10787 Berlin Eintritt: Erwachsene 17,50 ‚Ç¨, Kinder 9 ‚Ç¨", correctAnswer: "16"}
            ],
            situations: [
              {id: "11", text: "Ein Bekannter ist ein paar Tage in Berlin und w√ºrde sich gerne verschiedene Kunstausstellungen ansehen."},
              {id: "12", text: "Eine Bekannte tr√§umt davon, selbst einmal bei einem Film mitzuspielen."},
              {id: "13", text: "Ein Freund w√ºrde sich gerne einen Dokumentarfilm √ºber Tiere ansehen."},
              {id: "14", text: "Eine Freundin sucht einen Nebenjob. Sie w√ºrde dabei gerne viel Zeit drau√üen verbringen."},
              {id: "15", text: "hr Cousin ist Student und sucht f√ºr die Sommermonate einen Nebenjob."},
              {id: "16", text: "Ihre achtj√§hrige Nichte interessiert sich f√ºr Tiere und Natur. Sie m√∂chten ihr zum Geburtstag ein Buch schenken."},
              {id: "17", text: "Sie m√∂chten eine besondere Stadtf√ºhrung in Berlin buchen."},
              {id: "18", text: "Sie m√∂chten mit Freunden einen unterhaltsamen Film anschauen."},
              {id: "19", text: "Sie sind zu einer Kost√ºm-Party eingeladen und brauchen daf√ºr etwas zum Anziehen."},
              {id: "20", text: "Sie w√ºrden gerne mit Freunden eine mehrt√§gige Stadttour machen und suchen ein Angebot."}
            ]
          },
          { 
            id: "s4", 
            title: "Sprachbausteine, Teil 1", 
            points: 15,
            passageTitle: "Aufgabe: Erg√§nzen Sie den Text. W√§hlen Sie f√ºr jede L√ºcke das passende Wort.",
            passage: "",
            questions: [],
            fillBlanks: [
              {
                id: "21",
                options: ["konntest", "musstest", "solltest"],
                correctAnswer: "konntest"
              },
              {
                id: "22",
                options: ["sollte", "w√ºrde", "wurde"],
                correctAnswer: "w√ºrde"
              },
              {
                id: "23",
                options: ["f√ºr", "nach", "um"],
                correctAnswer: "f√ºr"
              },
              {
                id: "24",
                options: ["lange", "vielen", "wenige"],
                correctAnswer: "vielen"
              },
              {
                id: "25",
                options: ["gef√§llt", "M√∂gen", "gefallen"],
                correctAnswer: "gef√§llt"
              },
              {
                id: "26",
                options: ["denn", "obwohl", "weil"],
                correctAnswer: "denn"
              },
              {
                id: "27",
                options: ["Als", "Dass", "Wenn"],
                correctAnswer: "Wenn"
              },
              {
                id: "28",
                options: ["Dann", "Wann", "W√§hrend"],
                correctAnswer: "Dann"
              },
              {
                id: "29",
                options: ["ausger√§umt", "geschlossen", "vergessen"],
                correctAnswer: "ausger√§umt"
              },
              {
                id: "30",
                options: ["aber", "denn", "weil"],
                correctAnswer: "weil"
              }
            ],
            fillText: `Lieber Julian,

wie geht es dir? Ich hoffe, du hattest eine sch√∂ne Reise und ________ dich gut erholen.

Ich ________ ja auch gerne mal wieder ans Meer fahren, aber im Moment habe ich leider keine Zeit ________ Urlaub. Wie du dir bestimmt vorstellen kannst, war ich in den letzten Wochen vor allem mit meinem Umzug besch√§ftigt. Du wei√üt ja, dass ich zuerst ziemlich skeptisch war. Nach so ________ Jahren in Berlin konnte ich mir gar nicht mehr vorstellen, mich in einer kleinen Stadt wie Bamberg niederzulassen. Bamberg hat nur rund 77.000 Einwohner, aber langweilig ist es hier trotzdem nicht, wie ich inzwischen festgestellt habe. Mittlerweile f√ºhle ich mich hier sogar richtig wohl. Die Stadt hat wirklich viel zu bieten. Es gibt jahrhundertealte Sehensw√ºrdigkeiten in H√ºlle und F√ºlle, und in der Altstadt ________ mir besonders die sch√∂nen Fachwerkh√§user, die √ºberwiegend aus dem Mittelalter stammen. Ich gehe oft durch die Fu√üg√§ngerzone, ________ dort gibt es viele kleine L√§den, Caf√©s und Restaurants mit typisch fr√§nkischen Spezialit√§ten. Ich glaube, dir w√ºrde es hier auch gefallen.

________ du willst, zeige ich dir gerne mal die Stadt. H√§ttest du vielleicht Lust, mich im n√§chsten Monat zu besuchen? ________ ist bei mir auch der Umzugsstress vorbei. Im Moment steht noch eine gro√üe Anzahl nicht ________ Kisten in meinem Wohnzimmer, die ausgepackt werden m√ºssen. Mit meiner neuen Wohnung habe ich √ºbrigens auch Gl√ºck gehabt, ________ sie ger√§umig und zentral gelegen ist. Wir k√∂nnen ja mal telefonieren, dann erz√§hle ich dir mehr.

Liebe Gr√º√üe,

Anna`
          },
          { 
            id: "s5", 
            title: "Sprachbausteine, Teil 2", 
            points: 15,
            passageTitle: "Aufgabe: Lesen Sie den Text und entscheiden Sie, welches Wort in welche L√ºcke passt. Sie k√∂nnen jedes Wort nur einmal verwenden. Nicht alle W√∂rter passen in den Text.",
            passage: "",
            questions: [],
            fillBlanks2: [
              {
                id: "31",
                options: ["doch", "Als", "SICHER", "Leitet", "Genau", "SONDERN", "Ankommt", "Erwerben", "MVON", "N√§mlich", "Sondern", "WIE", "Darf", "Abgeschlossen", "ZU"],
                correctAnswer: "doch"
              },
              {
                id: "32", 
                options: ["doch", "Als", "SICHER", "Leitet", "Genau", "SONDERN", "Ankommt", "Erwerben", "MVON", "N√§mlich", "Sondern", "WIE", "Darf", "Abgeschlossen", "ZU"],
                correctAnswer: "Leitet"
              },
              {
                id: "33",
                options: ["doch", "Als", "SICHER", "Leitet", "Genau", "SONDERN", "Ankommt", "Erwerben", "MVON", "N√§mlich", "Sondern", "WIE", "Darf", "Abgeschlossen", "ZU"],
                correctAnswer: "Ankommt"
              },
              {
                id: "34",
                options: ["doch", "Als", "SICHER", "Leitet", "Genau", "SONDERN", "Ankommt", "Erwerben", "MVON", "N√§mlich", "Sondern", "WIE", "Darf", "Abgeschlossen", "ZU"],
                correctAnswer: "N√§mlich"
              },
              {
                id: "35",
                options: ["doch", "Als", "SICHER", "Leitet", "Genau", "SONDERN", "Ankommt", "Erwerben", "MVON", "N√§mlich", "Sondern", "WIE", "Darf", "Abgeschlossen", "ZU"],
                correctAnswer: "Darf"
              },
              {
                id: "36",
                options: ["doch", "Als", "SICHER", "Leitet", "Genau", "SONDERN", "Ankommt", "Erwerben", "MVON", "N√§mlich", "Sondern", "WIE", "Darf", "Abgeschlossen", "ZU"],
                correctAnswer: "Als"
              },
              {
                id: "37",
                options: ["doch", "Als", "SICHER", "Leitet", "Genau", "SONDERN", "Ankommt", "Erwerben", "MVON", "N√§mlich", "Sondern", "WIE", "Darf", "Abgeschlossen", "ZU"],
                correctAnswer: "Genau"
              },
              {
                id: "38",
                options: ["doch", "Als", "SICHER", "Leitet", "Genau", "SONDERN", "Ankommt", "Erwerben", "MVON", "N√§mlich", "Sondern", "WIE", "Darf", "Abgeschlossen", "ZU"],
                correctAnswer: "Erwerben"
              },
              {
                id: "39",
                options: ["doch", "Als", "SICHER", "Leitet", "Genau", "SONDERN", "Ankommt", "Erwerben", "MVON", "N√§mlich", "Sondern", "WIE", "Darf", "Abgeschlossen", "ZU"],
                correctAnswer: "Sondern"
              },
              {
                id: "40",
                options: ["doch", "Als", "SICHER", "Leitet", "Genau", "SONDERN", "Ankommt", "Erwerben", "MVON", "N√§mlich", "Sondern", "WIE", "Darf", "Abgeschlossen", "ZU"],
                correctAnswer: "Abgeschlossen"
              }
            ],
            fillText2: `Es ist erst 6 Uhr morgens, und drau√üen herrscht noch Dunkelheit... ________ in der riesigen, hell erleuchteten Halle, in der sich Kisten mit Obst und Gem√ºse meterhoch stapeln, wird schon lange gearbeitet. Vor ein paar Stunden war hier noch viel mehr Betrieb ¬ª, sagt Jens Rogall. Er ________ einen Berliner Gro√ümarkt, auf dem Eink√§ufer von Superm√§rkten, Gesch√§ften oder Restaurants frisches Obst und Gem√ºse besorgen.

Die Ware hat oft schon eine lange Reise zur√ºckgelegt, bis sie auf dem Gro√ümarkt ________. Die meisten Fr√ºchte werden ________ auf dem Land-, Luft- oder Seeweg aus w√§rmeren L√§ndern nach Deutschland transportiert. Wenn die Ware per Schiff nach Europa gebracht wird, kommt sie in gro√üen Seeh√§fen wie Rotterdam oder Hamburg an. Von dort aus geht es mit dem Lastwagen weiter. Auf seinem Weg ________ das empfindliche Obst und Gem√ºse keinesfalls Schaden nehmen.,, Nichts ist schlimmer ________ verdorbene Ware >>>, sagt Rogall.

Auf dem Gro√ümarkt schauen sich die K√§ufer alles ________ an. F√ºr makellose Salatk√∂pfe, Beeren und Kr√§uter zahlen sie h√∂here Preise, krumme Gurken oder verwachsene Kartoffeln ________ sie dagegen g√ºnstiger. Diese werden sp√§ter nicht in Gesch√§ften zum Verkauf angeboten, ________ direkt verarbeitet. ‚ÄûEs ist egal, wie Gurken aussehen, die ohnehin im Fertigsalat landen ¬ª, erkl√§rt Rogall. Wenn die Preisverhandlungen erfolgreich ________ sind, werden die Paletten voller Obst und Gem√ºse hinaus zu den Lieferwagen gebracht. Die Fahrer m√ºssen dann z√ºgig zu den Gesch√§ften und Restaurants fahren, um die Ware abzuliefern.`
          }
        ]
      };

      /* ===== State & DOM refs ===== */
      let state = { 
        sectionIndex: 0, 
        questionIndex: 0, 
        answers: {}, 
        marked: {}, 
        remaining: exam.durationSec,
        showResults: false,
        timerStarted: false,
        timerInterval: null
      };
      const topTiles = document.getElementById('topTiles-lesen');
      const passageTitleEl = document.getElementById('passageTitle-lesen');
      const passageContentEl = document.getElementById('passageContent-lesen');
      const sectionNameEl = document.getElementById('sectionName-lesen');
      const questionTitleEl = document.getElementById('questionTitle-lesen');
      const questionBodyEl = document.getElementById('questionBody-lesen');
      const headingsBankContainer = document.getElementById('headingsBankContainer-lesen');
      const timerEl = document.getElementById('timer-lesen');
      const statusText = document.getElementById('statusText-lesen');
      const resultBtn = document.getElementById('resultBtn-lesen');
      const resetBtn = document.getElementById('resetBtn-lesen');
      const resetSectionBtn = document.getElementById('resetSectionBtn-lesen');

      /* ===== Timer Functions ===== */
      function startTimer(){
        if(state.timerInterval) {
          clearInterval(state.timerInterval);
        }
        
        state.timerStarted = true;
        state.timerInterval = setInterval(()=>{
          if(state.remaining <= 0){
            clearInterval(state.timerInterval);
            timerEl.textContent = 'Zeit abgelaufen';
            return;
          }
          state.remaining--;
          updateTimerDisplay();
        }, 1000);
      }

      function resetTimer(){
        if(state.timerInterval) {
          clearInterval(state.timerInterval);
        }
        state.remaining = exam.durationSec;
        state.timerStarted = false;
        updateTimerDisplay();
        startTimer();
      }

      function updateTimerDisplay(){
        const min = Math.floor(state.remaining / 60);
        const sec = state.remaining % 60;
        timerEl.textContent = `Verbleibende Zeit: ${min.toString().padStart(2, '0')}:${sec.toString().padStart(2, '0')}`;
      }

      /* ===== Reset Section Function ===== */
      function resetCurrentSection() {
        const currentSection = exam.sections[state.sectionIndex];
        
        if (confirm(`M√∂chten Sie wirklich den Teil "${currentSection.title}" zur√ºcksetzen? Alle Antworten in diesem Teil werden gel√∂scht.`)) {
          if (currentSection.id === 's1') {
            currentSection.texts.forEach(text => {
              delete state.answers[text.id];
            });
          } else if (currentSection.id === 's2') {
            currentSection.questions.forEach(question => {
              delete state.answers[question.id];
            });
          } else if (currentSection.id === 's3') {
            currentSection.situations.forEach(situation => {
              delete state.answers[situation.id];
            });
          } else if (currentSection.id === 's4') {
            currentSection.fillBlanks.forEach(blank => {
              delete state.answers[blank.id];
            });
          } else if (currentSection.id === 's5') {
            currentSection.fillBlanks2.forEach(blank => {
              delete state.answers[blank.id];
            });
          }
          
          renderAll();
        }
      }

      /* ===== Render ===== */
      function renderTopTiles(){ 
        topTiles.innerHTML=''; 
        exam.sections.forEach((sec,idx)=>{ 
          const div=document.createElement('div'); 
          div.className='tile'+(idx===state.sectionIndex?' active':'')+(isSectionDone(sec)?' done':''); 
          div.innerHTML=`<div>${sec.title}</div><div class="points">${sec.points} P</div>`; 
          div.onclick=()=>{state.sectionIndex=idx; state.questionIndex=0; state.showResults=false; renderAll();}; 
          topTiles.appendChild(div); 
        }); 
      }

      function isSectionDone(section){
        if(section.id==='s1') return section.texts.every(t=>state.answers[t.id]);
        if(section.id==='s2') return section.questions.every(q=>state.answers[q.id]);
        if(section.id==='s3') return section.situations.every(h=>state.answers[h.id] || state.answers[h.id] === 'X');
        if(section.id==='s4') return section.fillBlanks.every(b=>state.answers[b.id]);
        if(section.id==='s5') return section.fillBlanks2.every(b=>state.answers[b.id]);
        return false;
      }

      function renderAll(){
        renderTopTiles();
        const section = exam.sections[state.sectionIndex];
        sectionNameEl.textContent = section.title;
        passageTitleEl.textContent = section.passageTitle;
        
        resetSectionBtn.style.display = 'block';
        
        if(state.showResults){
          renderResults();
          return;
        }
        
        if(section.id === 's1'){
          renderPart1();
        } else if(section.id === 's2'){
          renderPart2();
        } else if(section.id === 's3'){
          renderPart3();
        } else if(section.id === 's4'){
          renderSprachbausteine1();
        } else if(section.id === 's5'){
          renderSprachbausteine2();
        }
      }

      function renderPart1(){
        const section = exam.sections[state.sectionIndex];
        
        let textsHTML = `<div class="instructions">Ziehen Sie die passenden √úberschriften auf die Texte. Sie k√∂nnen jede √úberschrift nur einmal verwenden.</div>`;
        
        section.texts.forEach((text, idx) => {
          const letter = String.fromCharCode(97 + idx);
          const selectedHeading = state.answers[text.id];
          
          textsHTML += `
            <div class="text-container">
              <div class="text-title">Text ${letter.toUpperCase()}</div>
              <div class="text-content">${text.content}</div>
              <div class="title-slot ${selectedHeading ? 'has-title' : ''}" data-text-id="${text.id}">
                ${selectedHeading ? getHeadingTextById(selectedHeading) : 'Ziehen Sie hier eine √úberschrift hin'}
              </div>
            </div>
          `;
        });
        
        passageContentEl.innerHTML = textsHTML;
        
        let headingsHTML = `<div class="headings-bank">`;
        section.headings.forEach(heading => {
          const isUsed = section.texts.some(text => state.answers[text.id] === heading.id);
          
          headingsHTML += `
            <div class="heading-item ${isUsed ? 'used' : ''}" draggable="${!isUsed}" data-heading-id="${heading.id}">
              ${heading.id}) ${heading.text}
            </div>
          `;
        });
        
        headingsHTML += `</div>`;
        
        headingsBankContainer.innerHTML = headingsHTML;
        
        setupDragAndDrop();
        
        questionBodyEl.innerHTML = '';
        questionTitleEl.textContent = '';
      }

      function getHeadingTextById(id){
        const section = exam.sections[state.sectionIndex];
        const heading = section.headings.find(h => h.id === id);
        return heading ? `${heading.id}) ${heading.text}` : '';
      }

      function setupDragAndDrop(){
        const headingItems = document.querySelectorAll('.heading-item:not(.used)');
        const titleSlots = document.querySelectorAll('.title-slot');
        
        headingItems.forEach(item => {
          item.addEventListener('dragstart', (e) => {
            e.dataTransfer.setData('text/plain', e.target.dataset.headingId);
          });
        });
        
        titleSlots.forEach(slot => {
          slot.addEventListener('dragover', (e) => {
            e.preventDefault();
            slot.style.background = '#e8f4ff';
          });
          
          slot.addEventListener('dragleave', (e) => {
            slot.style.background = slot.classList.contains('has-title') ? '#e8fbe9' : '#f8fbff';
          });
          
          slot.addEventListener('drop', (e) => {
            e.preventDefault();
            const headingId = e.dataTransfer.getData('text/plain');
            const textId = slot.dataset.textId;
            
            Object.keys(state.answers).forEach(key => {
              if(state.answers[key] === headingId) {
                delete state.answers[key];
              }
            });
            
            state.answers[textId] = headingId;
            renderAll();
          });
        });
      }

      function renderPart2(){
        const section = exam.sections[state.sectionIndex];
        
        passageContentEl.innerHTML = `<div class="passage">${section.passage}</div>`;
        
        let questionsHTML = `<div class="all-questions">`;
        
        section.questions.forEach((question, idx) => {
          const questionNumber = idx + 1;
          const userAnswer = state.answers[question.id];
          
          questionsHTML += `
            <div class="question-block">
              <div class="question-text">${questionNumber}. ${question.text}</div>
              <div class="options">
                ${question.options.map(opt => `
                  <div class="option ${userAnswer === opt.id ? 'selected' : ''}" 
                       onclick="window.lesenApp.selectOption('${question.id}', '${opt.id}')">
                    <div class="radio"></div>
                    <div>${opt.text}</div>
                  </div>
                `).join('')}
              </div>
            </div>
          `;
        });
        
        questionsHTML += `</div>`;
        
        questionBodyEl.innerHTML = questionsHTML;
        questionTitleEl.textContent = '';
        headingsBankContainer.innerHTML = '';
      }

      function renderPart3(){
        const section = exam.sections[state.sectionIndex];
        
        let textsHTML = `
          <div class="instructions">Ziehen Sie die passenden Situationen auf die Texte. Sie k√∂nnen jede Situation nur einmal verwenden. Manchmal passt keine Situation.</div>
          <div class="texts-list">
            <h3>Texte (A-L)</h3>
        `;
        
        section.texts.forEach(text => {
          const userAnswer = Object.keys(state.answers).find(key => state.answers[key] === text.id);
          const selectedSituation = userAnswer ? section.situations.find(h => h.id === userAnswer) : null;
          
          textsHTML += `
            <div class="text-item" data-text-id="${text.id}">
              <div class="text-letter">${text.id})</div>
              <div class="text-content">${text.text}</div>
              <div class="title-slot ${userAnswer ? 'has-title' : ''} ${userAnswer === 'X' ? 'has-x' : ''}" data-text-id="${text.id}">
                ${selectedSituation ? selectedSituation.text : (userAnswer === 'X' ? 'X - Keine passende Situation' : 'Ziehen Sie hier eine Situation hin')}
              </div>
            </div>
          `;
        });
        
        textsHTML += `</div>`;
        
        passageContentEl.innerHTML = textsHTML;
        
        let situationsHTML = `
          <div class="situations-list">
            <h3>Situationen (11-20)</h3>
        `;
        
        section.situations.forEach((situation, idx) => {
          const situationNumber = parseInt(situation.id);
          const isUsed = state.answers[situation.id];
          const isX = state.answers[situation.id] === 'X';
          
          situationsHTML += `
            <div class="situation-item ${isUsed ? 'used' : ''}" draggable="${!isUsed}" data-situation-id="${situation.id}">
              <div class="situation-number">${situationNumber}.</div>
              <div class="situation-text">${situation.text}</div>
              ${!isUsed ? `<button class="exam-btn no-match ${isX ? 'selected' : ''}" onclick="window.lesenApp.markNoMatch('${situation.id}')">X - Kein passender Text</button>` : ''}
            </div>
          `;
        });
        
        situationsHTML += `</div>`;
        
        questionBodyEl.innerHTML = situationsHTML;
        questionTitleEl.textContent = '';
        headingsBankContainer.innerHTML = '';
        
        setupPart3DragAndDrop();
      }

      function markNoMatch(situationId) {
        Object.keys(state.answers).forEach(key => {
          if(state.answers[key] === situationId) {
            delete state.answers[key];
          }
        });
        
        state.answers[situationId] = 'X';
        try{ localStorage.setItem('lesenAnswers', JSON.stringify(state.answers)); }catch(e){}
        
        renderAll();
      }

      function setupPart3DragAndDrop(){
        const situationItems = document.querySelectorAll('.situation-item:not(.used)');
        const textSlots = document.querySelectorAll('.text-item .title-slot');
        
        situationItems.forEach(item => {
          item.addEventListener('dragstart', (e) => {
            e.dataTransfer.setData('text/plain', e.target.dataset.situationId);
          });
        });
        
        textSlots.forEach(slot => {
          slot.addEventListener('dragover', (e) => {
            e.preventDefault();
            slot.style.background = '#e8f4ff';
          });
          
          slot.addEventListener('dragleave', (e) => {
            const hasTitle = slot.classList.contains('has-title');
            const hasX = slot.classList.contains('has-x');
            slot.style.background = hasTitle ? '#e8fbe9' : (hasX ? '#f8d7da' : '#f8fbff');
          });
          
          slot.addEventListener('drop', (e) => {
            e.preventDefault();
            const situationId = e.dataTransfer.getData('text/plain');
            const textId = slot.dataset.textId;
            
            Object.keys(state.answers).forEach(key => {
              if(state.answers[key] === situationId) {
                delete state.answers[key];
              }
            });
            
            state.answers[situationId] = textId;
            renderAll();
          });
        });
      }

      function renderSprachbausteine1(){
        const section = exam.sections[state.sectionIndex];
        
        let textWithBlanks = section.fillText;
        
        const blankPlaceholders = [];
        section.fillBlanks.forEach(blank => {
          blankPlaceholders.push(`BLANK_${blank.id}`);
        });
        
        let tempText = textWithBlanks;
        blankPlaceholders.forEach((placeholder, index) => {
          tempText = tempText.replace('________', placeholder);
        });
        
        section.fillBlanks.forEach(blank => {
          const userAnswer = state.answers[blank.id];
          const displayText = userAnswer ? userAnswer : '________';
          tempText = tempText.replace(`BLANK_${blank.id}`, `<span class="blank-word ${userAnswer ? 'has-answer' : ''}" data-blank-id="${blank.id}">${displayText}</span>`);
        });
        
        passageContentEl.innerHTML = `
          <div class="instructions">Klicken Sie auf jede L√ºcke und w√§hlen Sie das passende Wort aus. Sie k√∂nnen die L√ºcken ŸÅŸä beliebiger Reihenfolge ausf√ºllen.</div>
          <div class="fill-blank-container">${tempText}</div>
        `;
        
        document.querySelectorAll('.blank-word').forEach(blank => {
          blank.addEventListener('click', (e) => {
            showOptionsPopup(e.target);
          });
        });
        
        let optionsHTML = `<div class="horizontal-options" style="gap: 8px;">`;
        
        section.fillBlanks.forEach(blank => {
          const userAnswer = state.answers[blank.id];
          
          optionsHTML += `
            <div class="option-row" style="padding: 8px; margin-bottom: 5px;">
              <div class="option-number">${blank.id}</div>
              <div class="option-buttons">
                ${blank.options.map(opt => `
                  <div class="option-btn ${userAnswer === opt ? 'selected' : ''}" 
                       onclick="window.lesenApp.selectSprachbausteine1('${blank.id}', '${opt}')" 
                       style="padding: 6px 12px; font-size: 12px;">
                    ${opt}
                  </div>
                `).join('')}
              </div>
            </div>
          `;
        });
        
        optionsHTML += `</div>`;
        
        questionBodyEl.innerHTML = optionsHTML;
        questionTitleEl.textContent = '';
        headingsBankContainer.innerHTML = '';
      }

      function showOptionsPopup(blankElement){
        const existingPopup = document.querySelector('.options-popup');
        if(existingPopup) {
          existingPopup.remove();
        }
        
        const blankId = blankElement.getAttribute('data-blank-id');
        const section = exam.sections.find(s => s.id === 's4');
        const blank = section.fillBlanks.find(b => b.id === blankId);
        
        if(!blank) return;
        
        const popup = document.createElement('div');
        popup.className = 'options-popup';
        
        blank.options.forEach(opt => {
          const optionItem = document.createElement('div');
          optionItem.className = 'option-item';
          optionItem.textContent = opt;
          optionItem.onclick = () => {
            selectSprachbausteine1(blankId, opt);
            popup.remove();
          };
          popup.appendChild(optionItem);
        });
        
        blankElement.appendChild(popup);
      }

      function selectSprachbausteine1(blankId, answer){
        state.answers[blankId] = answer;
        renderAll();
      }

      function renderSprachbausteine2(){
        const section = exam.sections[state.sectionIndex];
        // Build text but replace blanks with unique placeholders first (prevents ambiguous replacements)
        let textWithPlaceholders = section.fillText2;
        const placeholders = [];
        section.fillBlanks2.forEach(blank => {
          const ph = `BLANK_${blank.id}`;
          placeholders.push({id: blank.id, ph});
          // replace first occurrence of the visual underline with placeholder
          textWithPlaceholders = textWithPlaceholders.replace('________', ph);
        });

        // Now replace placeholders with actual span elements showing current answer (or underscore)
        placeholders.forEach(item => {
          const userAnswer = state.answers[item.id];
          const displayText = userAnswer ? userAnswer : '________';
          const span = `<span class="blank-slot ${userAnswer ? 'has-answer' : ''}" data-blank-id="${item.id}">${displayText}</span>`;
          textWithPlaceholders = textWithPlaceholders.replace(item.ph, span);
        });

        passageContentEl.innerHTML = `
          <div class="instructions">Klicken Sie auf jede L√ºcke und w√§hlen Sie das passende Wort aus. Sie k√∂nnen jedes Wort nur einmal verwenden.</div>
          <div class="fill-blank-container">${textWithPlaceholders}</div>
        `;

        // attach click handlers to slots
        document.querySelectorAll('.blank-slot').forEach(slot => {
          slot.addEventListener('click', (e) => {
            // use the element itself to open popup
            showSprachbausteine2Options(slot);
          });
        });

        // Build word bank on the right
        let wordBankHTML = `<div class="word-bank-vertical" style="gap: 8px;">`;
        const usedWords = Object.values(state.answers);
        // Use section.wordBank if present, otherwise derive from fillBlanks2 options
        const bank = section.fillBlanks2[0] ? section.fillBlanks2[0].options : [];
        bank.forEach(word => {
          const isUsed = usedWords.includes(word);
          wordBankHTML += `
            <div class="bank-word-vertical ${isUsed ? 'used' : ''}" 
                 draggable="${!isUsed}" 
                 data-word="${word}"
                 ${!isUsed ? `onclick="window.lesenApp.selectSprachbausteine2FromBank('${word}')"` : ''}>
              ${word}
            </div>
          `;
        });
        wordBankHTML += `</div>`;
        questionBodyEl.innerHTML = wordBankHTML;
        questionTitleEl.textContent = '';
        headingsBankContainer.innerHTML = '';

        setupSprachbausteine2DragAndDrop();
      }

      // --- Added functions to handle drag/drop and clicks for Sprachbausteine Teil 2 ---
      let lastClickedSprachSlot = null;

      function setupSprachbausteine2DragAndDrop(){
        // bank words: make draggable if not used, attach dragstart
        const bankWords = Array.from(document.querySelectorAll('.bank-word-vertical'));
        bankWords.forEach(el => {
          const word = el.dataset.word;
          if(!el.classList.contains('used')){
            el.setAttribute('draggable','true');
          } else {
            el.setAttribute('draggable','false');
          }
          // ensure single attached listener
          el.removeEventListener('dragstart', el._dstart);
          el._dstart = (e) => {
            e.dataTransfer.setData('text/plain', word);
            // also set an indicator
            e.dataTransfer.setData('source', 'bank');
          };
          el.addEventListener('dragstart', el._dstart);

          // keep onclick behavior (select into clicked slot)
          el.removeEventListener('click', el._onclick);
          el._onclick = () => {
            if(el.classList.contains('used')) return;
            selectSprachbausteine2FromBank(word);
          };
          el.addEventListener('click', el._onclick);
        });

        // blank slots: allow drop
        const slots = Array.from(document.querySelectorAll('.blank-slot'));
        slots.forEach(slot => {
          slot.addEventListener('dragover', (e) => {
            e.preventDefault();
            slot.classList.add('drag-over');
          });
          slot.addEventListener('dragleave', (e) => {
            slot.classList.remove('drag-over');
          });
          slot.addEventListener('drop', (e) => {
            e.preventDefault();
            slot.classList.remove('drag-over');
            const word = e.dataTransfer.getData('text/plain') || e.dataTransfer.getData('text/html');
            if(!word) return;
            // Determine blank id
            const blankId = slot.dataset.blankId;
            if(!blankId) return;
            // If this word is already used in another slot, free it
            Object.keys(state.answers).forEach(k => {
              if(state.answers[k] === word){
                delete state.answers[k];
              }
            });
            // If slot had a previous answer, free that bank word
            const prev = state.answers[blankId];
            if(prev){
              const prevEl = Array.from(document.querySelectorAll('.bank-word-vertical')).find(b=>b.dataset.word === prev);
              if(prevEl){
                prevEl.classList.remove('used');
                prevEl.setAttribute('draggable','true');
                prevEl.addEventListener('click', prevEl._onclick);
              }
            }
            // mark bank word used
            const bankEl = Array.from(document.querySelectorAll('.bank-word-vertical')).find(b=>b.dataset.word === word);
            if(bankEl){
              bankEl.classList.add('used');
              bankEl.setAttribute('draggable','false');
              // remove click to prevent double-placing
              bankEl.removeEventListener('click', bankEl._onclick);
            }
            // assign to state and re-render
            state.answers[blankId] = word;
            renderAll();
          });
        });
      }

      function showSprachbausteine2Options(slot){
        // highlight selected slot so click from bank knows target
        document.querySelectorAll('.blank-slot').forEach(s => s.classList.remove('selected-sprach'));
        slot.classList.add('selected-sprach');
        lastClickedSprachSlot = slot;
      }

      function selectSprachbausteine2FromBank(word){
        // choose target slot: prefer lastClicked, otherwise first empty
        let slot = lastClickedSprachSlot;
        if(!slot){
          slot = Array.from(document.querySelectorAll('.blank-slot')).find(s => {
            const id = s.dataset.blankId;
            return !state.answers[id];
          });
        }
        if(!slot) {
          // if none available, do nothing
          return;
        }
        const blankId = slot.dataset.blankId;
        // free previous occurrence of word
        Object.keys(state.answers).forEach(k => {
          if(state.answers[k] === word){
            delete state.answers[k];
          }
        });
        // free previous word in target slot
        const prev = state.answers[blankId];
        if(prev){
          const prevEl = Array.from(document.querySelectorAll('.bank-word-vertical')).find(b=>b.dataset.word === prev);
          if(prevEl){
            prevEl.classList.remove('used');
            prevEl.setAttribute('draggable','true');
            if(prevEl._onclick) prevEl.addEventListener('click', prevEl._onclick);
          }
        }
        // mark selected bank word as used
        const bankEl = Array.from(document.querySelectorAll('.bank-word-vertical')).find(b=>b.dataset.word === word);
        if(bankEl){
          bankEl.classList.add('used');
          bankEl.setAttribute('draggable','false');
          if(bankEl._onclick) try{ bankEl.removeEventListener('click', bankEl._onclick); }catch(e){}
        }
        // assign value
        state.answers[blankId] = word;
        try{ localStorage.setItem('lesenAnswers', JSON.stringify(state.answers)); }catch(e){}
        
        lastClickedSprachSlot = null;
        renderAll();
      }

      function selectOption(questionId, optionId){
        state.answers[questionId] = optionId;
        try{ localStorage.setItem('lesenAnswers', JSON.stringify(state.answers)); }catch(e){}
        
        renderAll();
      }

      function renderResults(){
        let resultsHTML = `<h2>Ergebnisse</h2>`;
        let totalCorrect = 0;
        let totalQuestions = 0;
        
        exam.sections.forEach(section => {
          resultsHTML += `<div class="result-item"><h3>${section.title}</h3>`;
          
          if(section.id === 's1'){
            section.texts.forEach(text => {
              totalQuestions++;
              const userAnswer = state.answers[text.id];
              const isCorrect = userAnswer === text.correctAnswer;
              if(isCorrect) totalCorrect++;
              
              resultsHTML += `
                <div>Text ${text.id}: ${userAnswer || 'Nicht beantwortet'} 
                ${userAnswer ? `<span class="${isCorrect ? 'result-correct' : 'result-incorrect'}">${isCorrect ? '‚úì' : '‚úó'}</span>` : ''}
                </div>
              `;
            });
          } else if(section.id === 's2'){
            section.questions.forEach(question => {
              totalQuestions++;
              const userAnswer = state.answers[question.id];
              const isCorrect = userAnswer === question.correctAnswer;
              if(isCorrect) totalCorrect++;
              
              resultsHTML += `
                <div>${question.text}: ${userAnswer || 'Nicht beantwortet'} 
                ${userAnswer ? `<span class="${isCorrect ? 'result-correct' : 'result-incorrect'}">${isCorrect ? '‚úì' : '‚úó'}</span>` : ''}
                </div>
              `;
            });
          } else if(section.id === 's3'){
            section.situations.forEach(situation => {
              totalQuestions++;
              const userAnswer = state.answers[situation.id];
              const correctText = section.texts.find(t => t.correctAnswer === situation.id);
              const isCorrect = userAnswer === (correctText ? correctText.id : null);
              if(isCorrect) totalCorrect++;
              
              resultsHTML += `
                <div>Situation ${situation.id}: ${userAnswer || 'Nicht beantwortet'} 
                ${userAnswer ? `<span class="${isCorrect ? 'result-correct' : 'result-incorrect'}">${isCorrect ? '‚úì' : '‚úó'}</span>` : ''}
                </div>
              `;
            });
          } else if(section.id === 's4'){
            section.fillBlanks.forEach(blank => {
              totalQuestions++;
              const userAnswer = state.answers[blank.id];
              const isCorrect = userAnswer === blank.correctAnswer;
              if(isCorrect) totalCorrect++;
              
              resultsHTML += `
                <div>L√ºcke ${blank.id}: ${userAnswer || 'Nicht beantwortet'} 
                ${userAnswer ? `<span class="${isCorrect ? 'result-correct' : 'result-incorrect'}">${isCorrect ? '‚úì' : '‚úó'}</span>` : ''}
                </div>
              `;
            });
          } else if(section.id === 's5'){
            section.fillBlanks2.forEach(blank => {
              totalQuestions++;
              const userAnswer = state.answers[blank.id];
              const isCorrect = userAnswer === blank.correctAnswer;
              if(isCorrect) totalCorrect++;
              
              resultsHTML += `
                <div>L√ºcke ${blank.id}: ${userAnswer || 'Nicht beantwortet'} 
                ${userAnswer ? `<span class="${isCorrect ? 'result-correct' : 'result-incorrect'}">${isCorrect ? '‚úì' : '‚úó'}</span>` : ''}
                </div>
              `;
            });
          }
          
          resultsHTML += `</div>`;
        });
        
        const percentage = totalQuestions > 0 ? Math.round((totalCorrect / totalQuestions) * 100) : 0;
        resultsHTML += `<div class="result-item"><h3>Gesamtergebnis: ${totalCorrect}/${totalQuestions} (${percentage}%)</h3></div>`;
        
        passageContentEl.innerHTML = resultsHTML;
        questionBodyEl.innerHTML = '';
        sectionNameEl.textContent = 'Ergebnisse';
        questionTitleEl.textContent = '';
      }

      /* ===== Event Listeners ===== */
      document.getElementById('prevBtn-lesen').addEventListener('click', ()=>{
        if(state.sectionIndex > 0){
          state.sectionIndex--;
          state.questionIndex = 0;
          renderAll();
        }
      });

      document.getElementById('nextBtn-lesen').addEventListener('click', ()=>{
        if(state.sectionIndex < exam.sections.length - 1){
          state.sectionIndex++;
          state.questionIndex = 0;
          renderAll();
        }
      });

      resultBtn.addEventListener('click', ()=>{
        state.showResults = !state.showResults;
        renderAll();
      });

      resetBtn.addEventListener('click', ()=>{
        if(confirm('M√∂chten Sie wirklich von neu beginnen? Alle Antworten werden gel√∂scht.')){
          state.answers = {};
          state.marked = {};
          state.showResults = false;
          resetTimer();
          renderAll();
        }
      });

      resetSectionBtn.addEventListener('click', resetCurrentSection);

      document.getElementById('saveBtn-lesen').addEventListener('click', ()=>{
        statusText.textContent = 'Gespeichert';
        setTimeout(()=>{statusText.textContent = 'Nicht gespeichert'}, 2000);
      });

      document.getElementById('submitBtn-lesen').addEventListener('click', ()=>{
        if(confirm('M√∂chten Sie die Pr√ºfung wirklich abgeben?')){
          state.showResults = true;
          renderAll();
        }
      });

      document.getElementById('nextBtn-lesen').addEventListener('click', ()=>{
        showPage('hoeren-page');
      });

      /* ===== Initialize ===== */
      updateTimerDisplay();
      renderAll();
      startTimer();
      
      // Expose functions to global scope for event handlers
      window._lesenState = state;
      window.lesenApp = {
        selectOption,
        markNoMatch,
        selectSprachbausteine1,
        selectSprachbausteine2FromBank
      };
    }

    // ===== H√ñREN PAGE FUNCTIONALITY =====
    function initHoerenPage() {
      /* ===== Self-contained exam (embedded) ===== */
      const exam = {
        id: "exam-h√∂rverstehen",
        durationSec: 17 * 60, // 17 minutes in seconds
        sections: [
          { 
            id: "h√∂rverstehen1", 
            title: "H√∂rverstehen, Teil 1", 
            points: 25,
            correctAnswers: { "19": "falsch", "20": "richtig", "21": "richtig", "22": "falsch", "23": "falsch" },
            questions: [
              {
                id: "19",
                text: "Die Deutsche Lufthansa hat ihre F√ºhrungsposition verloren."
              },
              {
                id: "20", 
                text: "Ein Bonner Sportverein zeigt der √ñffentlichkeit sein Angebot."
              },
              {
                id: "21",
                text: "Die Situation im Pflegesektor hat sich noch nicht verbessert."
              },
              {
                id: "22",
                text: "Durch moderne W√§rmed√§mmung konnten die Heizkosten deutlich reduziert werden."
              },
              {
                id: "23",
                text: "Das Nationale Olympische Komitee hat die Dopingsperre f√ºr Tom Sanders aufgehoben."
              }
            ]
          },
          { 
            id: "h√∂rverstehen2", 
            title: "H√∂rverstehen, Teil 2", 
            points: 25,
            correctAnswers: { "24": "falsch", "25": "falsch", "26": "richtig", "27": "richtig", "28": "falsch", "29": "falsch", "30": "richtig", "31": "falsch", "32": "falsch", "33": "falsch" },
            questions: [
              {
                id: "24",
                text: "Die Zahl der deutschen Mallorca-Urlauber hat nur leicht abgenommen."
              },
              {
                id: "25",
                text: "Nach Professor Kirsch achten die Deutschen bei der Wahl ihrer Urlaubsreisen nicht besonders auf die Kosten."
              },
              {
                id: "26", 
                text: "Einige Einheimische in Mallorca haben begonnen, sich gegen das Vordringen der deutschen Sprache zu wehren."
              },
              {
                id: "27",
                text: "In Mallorca wird der Staat wegen der Umweltbelastungen zur Kasse bitten."
              },
              {
                id: "28",
                text: "Viele Deutsche haben jetzt Rum√§nien und Ungarn als Reiseziel entdeckt."
              },
              {
                id: "29",
                text: "Professor Kirsch weist auf g√ºnstige Angebote f√ºr Golfspieler am Plattensee hin."
              },
              {
                id: "30",
                text: "Bulgarien hat sich als Urlaubsland sehr positiv entwickelt."
              },
              {
                id: "31",
                text: "Viele Westdeutsche meiden Bulgarien, weil die Einreisemodalit√§ten abschreckend sind."
              },
              {
                id: "32",
                text: "Seit Ende der neunziger Jahre geben die Deutschen mehr Geld f√ºr den Urlaub aus."
              },
              {
                id: "33",
                text: "Durch die Vielzahl aktiver Senioren entsteht eine h√∂here Nachfrage nach Abenteuerreisen in ferne L√§nder."
              }
            ]
          },
          { 
            id: "h√∂rverstehen3", 
            title: "H√∂rverstehen, Teil 3", 
            points: 25,
            correctAnswers: { "34": "richtig", "35": "falsch", "36": "falsch", "37": "richtig", "38": "falsch" },
            questions: [
              {
                id: "34",
                text: "Bei der Fahrschule kann man sich √ºber das Internet anmelden."
              },
              {
                id: "35",
                text: "Die Anruferin ist im Hinblick auf die Abfahrtszeit flexibel."
              },
              {
                id: "36",
                text: "F√ºr den Halb-Marathon kann man sich noch am Sonntag registrieren lassen."
              },
              {
                id: "37",
                text: "Bei dem Flug nach Mallorca √§ndert sich die Abflugzeit."
              },
              {
                id: "38",
                text: "In Halle D wird aus E-Books vorgelesen."
              }
            ]
          }
        ]
      };

      /* ===== State & DOM refs ===== */
      let state = { 
        sectionIndex: 0, 
        answers: {}, 
        remaining: exam.durationSec,
        showResults: false,
        timerStarted: false,
        timerInterval: null
      };
      
      const topTiles = document.getElementById('topTiles-hoeren');
      const contentContainer = document.getElementById('contentContainer-hoeren');
      const timerEl = document.getElementById('timer-hoeren');
      const statusText = document.getElementById('statusText-hoeren');

      /* ===== Timer Functions ===== */
      function startTimer() {
        if (state.timerInterval) {
          clearInterval(state.timerInterval);
        }
        
        state.timerStarted = true;
        state.timerInterval = setInterval(() => {
          if (state.remaining <= 0) {
            clearInterval(state.timerInterval);
            timerEl.textContent = 'Zeit abgelaufen';
            return;
          }
          state.remaining--;
          updateTimerDisplay();
        }, 1000);
      }

      function resetTimer() {
        if (state.timerInterval) {
          clearInterval(state.timerInterval);
        }
        state.remaining = exam.durationSec;
        state.timerStarted = false;
        updateTimerDisplay();
        startTimer();
      }

      function updateTimerDisplay() {
        const min = Math.floor(state.remaining / 60);
        const sec = state.remaining % 60;
        timerEl.textContent = `Verbleibende Zeit: ${min.toString().padStart(2, '0')}:${sec.toString().padStart(2, '0')}`;
      }

      /* ===== Render ===== */
      function renderTopTiles() { 
        topTiles.innerHTML = ''; 
        exam.sections.forEach((sec, idx) => { 
          const div = document.createElement('div'); 
          div.className = 'tile' + (idx === state.sectionIndex ? ' active' : '') + (isSectionDone(sec) ? ' done' : ''); 
          div.innerHTML = `<div>${sec.title}</div><div class="points">${sec.points} P</div>`; 
          div.onclick = () => { state.sectionIndex = idx; state.showResults = false; renderAll(); }; 
          topTiles.appendChild(div); 
        }); 
      }

      function isSectionDone(section) {
        const answers = state.answers[section.id];
        if (!answers) return false;
        
        const answeredQuestions = Object.keys(answers).length;
        const totalQuestions = section.questions.length;
        
        return answeredQuestions === totalQuestions;
      }

      function renderAll() {
        renderTopTiles();
        
        if (state.showResults) {
          renderResults();
          return;
        }
        
        renderListeningSection();
      }

      function renderListeningSection() {
        const section = exam.sections[state.sectionIndex];
        const currentAnswers = state.answers[section.id] || {};
        
        let contentHTML = `
          <div class="panel-title">${section.title}</div>
          <div class="instructions">
            Sie h√∂ren die Nachrichten. Entscheiden Sie beim H√∂ren, ob die Aussagen richtig oder falsch sind. 
            Sie h√∂ren die Nachrichten nur einmal. Sie haben jetzt 30 Sekunden, um die Aussagen zu lesen.
          </div>
          
          <div class="listening-task">
            <table class="true-false-table">
              <thead>
                <tr>
                  <th style="width: 10%">Nr.</th>
                  <th style="width: 60%">Aussage</th>
                  <th style="width: 30%">Ihre Antwort</th>
                </tr>
              </thead>
              <tbody>
        `;
        
        section.questions.forEach((question, index) => {
          const currentAnswer = currentAnswers[question.id] || '';
          contentHTML += `
            <tr>
              <td><strong>${question.id}</strong></td>
              <td class="question-text">${question.text}</td>
              <td>
                <div class="answer-options">
                  <label class="answer-option">
                    <input 
                      type="radio" 
                      name="q${section.id}_${question.id}" 
                      value="richtig" 
                      ${currentAnswer === 'richtig' ? 'checked' : ''}
                      onchange="window.hoerenApp.updateListeningAnswer('${section.id}', '${question.id}', this.value)"
                    >
                    Richtig
                  </label>
                  <label class="answer-option">
                    <input 
                      type="radio" 
                      name="q${section.id}_${question.id}" 
                      value="falsch" 
                      ${currentAnswer === 'falsch' ? 'checked' : ''}
                      onchange="window.hoerenApp.updateListeningAnswer('${section.id}', '${question.id}', this.value)"
                    >
                    Falsch
                  </label>
                </div>
              </td>
            </tr>
          `;
        });
        
        contentHTML += `
              </tbody>
            </table>
          </div>
        `;
        
        contentContainer.innerHTML = contentHTML;
      }

      function updateListeningAnswer(sectionId, questionId, answer) {
        if (!state.answers[sectionId]) {
          state.answers[sectionId] = {};
        }
        state.answers[sectionId][questionId] = answer;
        try{ localStorage.setItem('hoerenAnswers', JSON.stringify(state.answers)); }catch(e){}
        
        renderTopTiles();
      }

      function renderResults() {
        let resultsHTML = `<div class="panel-title">Ergebnisse - H√∂rverstehen</div>`;
        
        exam.sections.forEach(section => {
          const userAnswers = state.answers[section.id] || {};
          let correctCount = 0;
          
          resultsHTML += `
            <div class="listening-task">
              <h3>${section.title} (${section.points} Punkte)</h3>
              <table class="true-false-table">
                <thead>
                  <tr>
                    <th style="width: 10%">Nr.</th>
                    <th style="width: 50%">Aussage</th>
                    <th style="width: 15%">Ihre Antwort</th>
                    <th style="width: 15%">Richtige Antwort</th>
                    <th style="width: 10%">Punkte</th>
                  </tr>
                </thead>
                <tbody>
          `;
          
          section.questions.forEach((question) => {
            const userAnswer = userAnswers[question.id] || '-';
            const correctAnswer = section.correctAnswers[question.id];
            const gotCorrect = userAnswer === correctAnswer;
            const points = gotCorrect ? "1" : "0";
            
            if (gotCorrect) correctCount++;
            
            const rowClass = gotCorrect ? 'correct-answer' : 'incorrect-answer';
            
            resultsHTML += `
              <tr class="${rowClass}">
                <td><strong>${question.id}</strong></td>
                <td class="question-text">${question.text}</td>
                <td>${userAnswer}</td>
                <td>${correctAnswer}</td>
                <td><strong>${points}</strong></td>
              </tr>
            `;
          });
          
          const totalPoints = Math.round((correctCount / section.questions.length) * section.points);
          
          resultsHTML += `
                </tbody>
              </table>
              <div style="margin-top: 15px; padding: 15px; background: #e3f2fd; border-radius: 6px;">
                <strong>Erreichte Punkte: ${correctCount}/${section.questions.length} richtig = ${totalPoints}/${section.points} Punkten</strong>
              </div>
            </div>
          `;
        });
        
        contentContainer.innerHTML = resultsHTML;
      }

      /* ===== Event Listeners ===== */
      document.getElementById('prevBtn-hoeren').addEventListener('click', () => {
        if (state.sectionIndex > 0) {
          state.sectionIndex--;
          state.showResults = false;
          renderAll();
        }
      });

      document.getElementById('nextBtn-hoeren').addEventListener('click', () => {
        if (state.sectionIndex < exam.sections.length - 1) {
          state.sectionIndex++;
          state.showResults = false;
          renderAll();
        }
      });

      document.getElementById('resultBtn-hoeren').addEventListener('click', () => {
        state.showResults = !state.showResults;
        renderAll();
      });

      document.getElementById('resetBtn-hoeren').addEventListener('click', () => {
        if (confirm('M√∂chten Sie wirklich von neu beginnen? Alle Antworten werden gel√∂scht.')) {
          state.answers = {};
          state.showResults = false;
          resetTimer();
          renderAll();
        }
      });

      document.getElementById('saveBtn-hoeren').addEventListener('click', () => {
        statusText.textContent = 'Gespeichert';
        setTimeout(() => { statusText.textContent = 'Nicht gespeichert' }, 2000);
      });

      document.getElementById('submitBtn-hoeren').addEventListener('click', () => {
        if (confirm('M√∂chten Sie die Pr√ºfung wirklich abgeben?')) {
          state.showResults = true;
          renderAll();
        }
      });

      document.getElementById('nextBtn-hoeren').addEventListener('click', () => {
        showPage('schreiben-page');
      });

      /* ===== Initialize ===== */
      updateTimerDisplay();
      renderAll();
      startTimer();
      
      window._hoerenState = state;
      window.hoerenApp = {
        updateListeningAnswer
      };
    }

    // ===== SCHREIBEN PAGE FUNCTIONALITY =====
    function initSchreibenPage() {
      /* ===== Self-contained exam (embedded) ===== */
      const exam = {
        id: "exam-002",
        durationSec: 30 * 60, // 30 minutes in seconds
        sections: [
          { 
            id: "s1", 
            title: "Schreiben, Teil 1", 
            points: 45,
            passageTitle: "Aufgabe: Schreiben Sie eine E-Mail",
            passage: "",
            writingTask: {
              prompt: `Engagement f√ºr Jugendliche

Wie soll es nach dem Schulabschluss weitergehen? 
Was w√§re der ideale Beruf? 
Wie findet man einen Ausbildungsplatz und wie bewirbt man sich? 

Wollen Sie Jugendlichen dabei helfen, die richtigen Antworten auf diese Fragen zu finden 
und so ihre Zukunftsperspektiven zu verbessern? 

Dann werden Sie Bildungspatin/Bildungspate! 

Wir suchen Bildungspatinnen und Bildungspaten, die Sch√ºlerinnen und Sch√ºler ab 14 Jahren 
unterst√ºtzen k√∂nnen: 
- bei Problemen mit dem Schulabschluss, 
- bei der Suche nach einem Ausbildungsplatz, 
- beim Bewerbungsprozess, 
- beim Berufseinstieg. 

Sie helfen einer Sch√ºlerin oder einem Sch√ºler dabei, den √úbergang zwischen Schule und Beruf 
zu meistern. 

In drei Wochenendseminaren bereiten wir Sie auf diese spannende und anspruchsvolle 
Aufgabe vor. 

Sie erhalten au√üerdem regelm√§√üig Beratung und Unterst√ºtzung durch unser erfahrenes Team. 

Setzen Sie Ihre Zeit, Ihr Wissen und Ihr Engagement ein, um das Leben eines Jugendlichen 
positiv zu beeinflussen! 

Mehr Informationen erhalten Sie unter: www.bildungspaten-f√ºr-jugendliche.net 

Adresse: 
Bildungspaten f√ºr Jugendliche e. V. 
Hamburger Str. 112 
60824 Frankfurt am Main`,
              requirements: [
                "Beschreiben Sie, welche Erfahrungen Sie bei Ihrem Engagement in dem Verein gemacht haben.",
                "Erkl√§ren Sie, warum Sie Jugendlichen helfen wollten.",
                "Beschreiben Sie, wie Sie sich die Mitarbeit im Verein vorgestellt haben.",
                "Machen Sie Verbesserungsvorschl√§ge."
              ],
              wordCount: 0
            }
          }
        ]
      };

      /* ===== State & DOM refs ===== */
      let state = { 
        sectionIndex: 0, 
        answers: {}, 
        remaining: exam.durationSec,
        showResults: false,
        timerStarted: false,
        timerInterval: null
      };
      
      const topTiles = document.getElementById('topTiles-schreiben');
      const passageTitleEl = document.getElementById('passageTitle-schreiben');
      const passageContentEl = document.getElementById('passageContent-schreiben');
      const writingContainer = document.getElementById('writingContainer-schreiben');
      const timerEl = document.getElementById('timer-schreiben');
      const statusText = document.getElementById('statusText-schreiben');

      /* ===== Timer Functions ===== */
      function startTimer() {
        if (state.timerInterval) {
          clearInterval(state.timerInterval);
        }
        
        state.timerStarted = true;
        state.timerInterval = setInterval(() => {
          if (state.remaining <= 0) {
            clearInterval(state.timerInterval);
            timerEl.textContent = 'Zeit abgelaufen';
            return;
          }
          state.remaining--;
          updateTimerDisplay();
        }, 1000);
      }

      function resetTimer() {
        if (state.timerInterval) {
          clearInterval(state.timerInterval);
        }
        state.remaining = exam.durationSec;
        state.timerStarted = false;
        updateTimerDisplay();
        startTimer();
      }

      function updateTimerDisplay() {
        const min = Math.floor(state.remaining / 60);
        const sec = state.remaining % 60;
        timerEl.textContent = `Verbleibende Zeit: ${min.toString().padStart(2, '0')}:${sec.toString().padStart(2, '0')}`;
      }

      /* ===== Render ===== */
      function renderTopTiles() { 
        topTiles.innerHTML = ''; 
        exam.sections.forEach((sec, idx) => { 
          const div = document.createElement('div'); 
          div.className = 'tile' + (idx === state.sectionIndex ? ' active' : '') + (isSectionDone(sec) ? ' done' : ''); 
          div.innerHTML = `<div>${sec.title}</div><div class="points">${sec.points} P</div>`; 
          div.onclick = () => { state.sectionIndex = idx; state.showResults = false; renderAll(); }; 
          topTiles.appendChild(div); 
        }); 
      }

      function isSectionDone(section) {
        return state.answers[section.id] && state.answers[section.id].length > 0;
      }

      function renderAll() {
        renderTopTiles();
        const section = exam.sections[state.sectionIndex];
        passageTitleEl.textContent = section.passageTitle;
        
        if (state.showResults) {
          renderResults();
          return;
        }
        
        renderWritingSection();
      }

      function renderWritingSection() {
        const section = exam.sections[state.sectionIndex];
        
        passageContentEl.innerHTML = `
          <div class="writing-task">
            <div class="writing-prompt">${section.writingTask.prompt}</div>
            <div class="instructions" style="border:1px solid #e1e8f6; padding:10px; margin:10px 0; border-radius:6px; background:#ffffff;">Sie wollten sich ehrenamtlich f√ºr Jugendliche engagieren, waren aber mit der Organisation unzufrieden. 
Schreiben Sie eine Beschwerde an den Verein.</div>
            <div class="writing-requirements">
              <h4>Schreiben Sie in Ihrer E-Mail:</h4>
              <ul>
                ${section.writingTask.requirements.map(req => `<li>${req}</li>`).join('')}
              </ul>
            </div>
            <div class="instructions">
              Schreiben Sie eine E-Mail (ca. 150-200 W√∂rter). Achten Sie auf den Textaufbau (Anrede, Einleitung, Hauptteil, Schluss) und eine angemessene Formulierung.
            </div>
          </div>
        `;
        
        const currentAnswer = state.answers[section.id] || '';
        const wordCount = countWords(currentAnswer);
        
        writingContainer.innerHTML = `
          <div class="writing-area">
            <textarea 
              class="writing-textarea" 
              placeholder="Schreiben Sie hier Ihre E-Mail..."
              oninput="window.schreibenApp.updateWritingAnswer('${section.id}', this.value)"
            >${currentAnswer}</textarea>
            <div class="word-counter">
              W√∂rter: <span class="count">${wordCount}</span>
            </div>
          </div>
        `;
      }

      function countWords(text) {
        return text.trim() === '' ? 0 : text.trim().split(/\s+/).length;
      }

      function updateWritingAnswer(sectionId, text) {
        state.answers[sectionId] = text;
        try{ localStorage.setItem('schreibenAnswers', JSON.stringify({content: state.answers[sectionId], wordCount: (state.answers[sectionId]||'').trim().split(/\s+/).filter(Boolean).length})); }catch(e){}
        
        const wordCount = countWords(text);
        document.querySelector('.word-counter .count').textContent = wordCount;
      }

      function renderResults() {
        let resultsHTML = `<h2>Ergebnisse</h2>`;
        
        exam.sections.forEach(section => {
          resultsHTML += `<div class="writing-task"><h3>${section.title}</h3>`;
          
          const userAnswer = state.answers[section.id];
          const wordCount = countWords(userAnswer);
          
          resultsHTML += `
            <div class="writing-requirements">
              <h4>Ihre Antwort (${wordCount} W√∂rter):</h4>
              <div style="white-space: pre-wrap; background: white; padding: 15px; border-radius: 6px; border: 1px solid #e1e8f6; margin-top: 10px;">${userAnswer || 'Keine Antwort'}</div>
            </div>
          `;
          
          resultsHTML += `</div>`;
        });
        
        passageContentEl.innerHTML = resultsHTML;
        writingContainer.innerHTML = '';
      }

      /* ===== Event Listeners ===== */
      document.getElementById('prevBtn-schreiben').addEventListener('click', () => {
        if (state.sectionIndex > 0) {
          state.sectionIndex--;
          state.showResults = false;
          renderAll();
        }
      });

      document.getElementById('nextBtn-schreiben').addEventListener('click', () => {
        if (state.sectionIndex < exam.sections.length - 1) {
          state.sectionIndex++;
          state.showResults = false;
          renderAll();
        }
      });

      document.getElementById('resultBtn-schreiben').addEventListener('click', () => {
        state.showResults = !state.showResults;
        renderAll();
      });

      document.getElementById('resetBtn-schreiben').addEventListener('click', () => {
        if (confirm('M√∂chten Sie wirklich von neu beginnen? Alle Antworten werden gel√∂schÿ™.')) {
          state.answers = {};
          state.showResults = false;
          resetTimer();
          renderAll();
        }
      });

      document.getElementById('saveBtn-schreiben').addEventListener('click', () => {
        statusText.textContent = 'Gespeichert';
        setTimeout(() => { statusText.textContent = 'Nicht gespeichert' }, 2000);
      });

      document.getElementById('submitBtn-schreiben').addEventListener('click', () => {
        if (confirm('M√∂chten Sie die Pr√ºfung wirklich abgeben?')) {
          state.showResults = true;
          renderAll();
        }
      });

      document.getElementById('nextBtn-schreiben').addEventListener('click', () => {
        showPage('ergebnisse-page');
      });

      /* ===== Initialize ===== */
      updateTimerDisplay();
      renderAll();
      startTimer();
      
      window._schreibenState = state;
      window.schreibenApp = {
        updateWritingAnswer
      };
    }

    // ===== ERGEBNISSE PAGE FUNCTIONALITY =====
    // ===== KORREKTE ANTWORTEN F√úR DIESE PR√úFUNG =====
    const CORRECT_ANSWERS = {
      lesen: {
        // Teil 1: √úberschriften zuordnen (text1-text5)
        "text1": "i",
        "text2": "j", 
        "text3": "h",
        "text4": "c",
        "text5": "d",
        
        // Teil 2: Fragen zum Text (s2q1-s2q5)
        "s2q1": "s2q1o2",
        "s2q2": "s2q2o3",
        "s2q3": "s2q3o2",
        "s2q4": "s2q4o2",
        "s2q5": "s2q5o1",
        
        // Teil 3: Texte zuordnen (11-20)
        "11": "F",
        "12": "D",
        "13": "X",
        "14": "X",
        "15": "K",
        "16": "L",
        "17": "J",
        "18": "A",
        "19": "I",
        "20": "C",
        
        // Sprachbausteine Teil 1 (21-30)
        "21": "konntest",
        "22": "w√ºrde",
        "23": "f√ºr",
        "24": "vielen",
        "25": "gefallen",
        "26": "denn",
        "27": "Wenn",
        "28": "Dann",
        "29": "ausger√§umt",
        "30": "weil",
        
        // Sprachbausteine Teil 2 (31-40)
        "31": "doch",
        "32": "Leitet",
        "33": "Ankommt",
        "34": "N√§mlich",
        "35": "Darf",
        "36": "Als",
        "37": "Genau",
        "38": "Erwerben",
        "39": "Sondern",
        "40": "Abgeschlossen"
      },
      
      hoeren: {
        // H√∂ren Teil 1 (19-23)
        "19": "falsch",
        "20": "richtig",
        "21": "richtig",
        "22": "falsch",
        "23": "falsch",
        
        // H√∂ren Teil 2 (24-33)
        "24": "falsch",
        "25": "falsch",
        "26": "richtig",
        "27": "richtig",
        "28": "falsch",
        "29": "falsch",
        "30": "richtig",
        "31": "falsch",
        "32": "falsch",
        "33": "falsch",
        
        // H√∂ren Teil 3 (34-38)
        "34": "richtig",
        "35": "falsch",
        "36": "falsch",
        "37": "richtig",
        "38": "falsch"
      }
    };

    function initErgebnissePage() {
      const CONFIG = {
        totals: { 
          lesen: 85, 
          hoeren: 75, 
          schreiben: 45, 
          gesamt: 205 
        },
        counts: { 
          lesen: 40, 
          hoeren: 15 
        },
        hoerenCorrect: CORRECT_ANSWERS.hoeren,
        lesenCorrect: CORRECT_ANSWERS.lesen
      };

      function normalizeAnswer(a) {
        if (a === null || a === undefined) return '';
        let s = String(a).trim();
        if (s === '') return '';
        const low = s.toLowerCase();
        if (["richtig", "true", "yes", "ja"].includes(low)) return 'richtig';
        if (["falsch", "false", "no", "nein"].includes(low)) return 'falsch';
        return s;
      }

      function getHeadingText(headingId) {
        if (!headingId || headingId === '-') return '-';
        const headings = {
          "a": "F√ºr unterwegs: Leckereien im Zugrestaurant In der",
          "b": "Stadt der warmen Quellen",
          "c": "Eine Wanderung macht gute Laune",
          "d": "‚ÄûDie Arbeit von Forschern erfordert weniger Zeit\"",
          "e": "Naschen statt wegwerfen",
          "f": "Neues Thermalbad in Rom",
          "g": "Reisen: Die beliebtesten Thermalb√§der",
          "h": "Klug durch Schlafen",
          "i": "Tiere Energiesparmodus",
          "j": "Licht aus dem Klassenzimmer"
        };
        return headings[headingId] || headingId;
      }

      function getOptionText(questionId, optionId) {
        if (!optionId || optionId === '-') return '-';
        const options = {
          "s2q1o1": "dieser im Vergleich zu Flugreisen oft billiger ist.",
          "s2q1o2": "man dort leicht mit anderen Fahrg√§sten ins Gespr√§ch kommt.",
          "s2q1o3": "sie w√§hrend der Fahrt meist gut schlafen kann.",
          "s2q2o1": "hat der √ñsterreichischen Bundesbahn einige Z√ºge abgekauft.",
          "s2q2o2": "m√∂chte mehr Fahrten √ºber Nacht anbieten.",
          "s2q2o3": "verzichtete aus √∂konomischen Gr√ºnden auf eigene Nachtz√ºge.",
          "s2q3o1": "empfand Tom Schneider insgesamt als erholsam.",
          "s2q3o2": "hat Tom Schneiders Sohn begeistert.",
          "s2q3o3": "m√∂chte Tom Schneider nicht wiederholen.",
          "s2q4o1": "er im Zug ungern arbeitet.",
          "s2q4o2": "er mit dem Flugzeug Zeit spart.",
          "s2q4o3": "es ihm an Bequemlichkeit fehlt.",
          "s2q5o1": "den Fahrg√§sten viel Privatsph√§re bieten.",
          "s2q5o2": "vor allem eine finanzkr√§ftige Zielgruppe ansprechen.",
          "s2q5o3": "zun√§chst Zielorte n√∂rdlich von Frankreich anfahren."
        };
        return options[optionId] || optionId;
      }

      function getSituationText(id) {
        const situations = {
          "11": "Ein Bekannter ist ein paar Tage in Berlin und w√ºrde sich gerne verschiedene Kunstausstellungen ansehen.",
          "12": "Eine Bekannte tr√§umt davon, selbst einmal bei einem Film mitzuspielen.",
          "13": "Ein Freund w√ºrde sich gerne einen Dokumentarfilm √ºber Tiere ansehen.",
          "14": "Eine Freundin sucht einen Nebenjob. Sie w√ºrde dabei gerne viel Zeit drau√üen verbringen.",
          "15": "hr Cousin ist Student und sucht f√ºr die Sommermonate einen Nebenjob.",
          "16": "Ihre achtj√§hrige Nichte interessiert sich f√ºr Tiere und Natur. Sie m√∂chten ihr zum Geburtstag ein Buch schenken.",
          "17": "Sie m√∂chten eine besondere Stadtf√ºhrung in Berlin buchen.",
          "18": "Sie m√∂chten mit Freunden einen unterhaltsamen Film anschauen.",
          "19": "Sie sind zu einer Kost√ºm-Party eingeladen und brauchen daf√ºr etwas zum Anziehen.",
          "20": "Sie w√ºrden gerne mit Freunden eine mehrt√§gige Stadttour machen und suchen ein Angebot."
        };
        return situations[id] || id;
      }

      function escapeHtml(s) {
        return String(s)
          .replace(/&/g, '&amp;')
          .replace(/</g, '&lt;')
          .replace(/>/g, '&gt;')
          .replace(/"/g, '&quot;')
          .replace(/'/g, '&#039;');
      }

      function readExamResults() {
        try {
          const lesen = {};
          const hoeren = {};
          const schreiben = { content: '', wordCount: 0 };

          try {
            if (window._lesenState && window._lesenState.answers) {
              Object.keys(window._lesenState.answers).forEach(k => {
                lesen[k] = window._lesenState.answers[k];
              });
            }
          } catch (e) {}

          try {
            if (window._hoerenState && window._hoerenState.answers) {
              Object.keys(window._hoerenState.answers).forEach(sectionId => {
                const sec = window._hoerenState.answers[sectionId] || {};
                Object.keys(sec).forEach(q => {
                  hoeren[q] = sec[q];
                });
              });
            }
          } catch (e) {}

          try {
            if (window._schreibenState && window._schreibenState.answers) {
              const answers = window._schreibenState.answers;
              if (answers['s1']) {
                schreiben.content = answers['s1'];
              } else {
                const keys = Object.keys(answers);
                if (keys.length > 0) schreiben.content = answers[keys[0]] || '';
              }
              schreiben.wordCount = (schreiben.content && schreiben.content.trim()) ? String(schreiben.content).trim().split(/\s+/).filter(Boolean).length : 0;
            }
          } catch (e) {}

          try {
            if (Object.keys(lesen).length === 0) {
              const storedL = localStorage.getItem('lesenAnswers');
              if (storedL) Object.assign(lesen, JSON.parse(storedL));
            }
          } catch (e) {}

          try {
            if (Object.keys(hoeren).length === 0) {
              const storedH = localStorage.getItem('hoerenAnswers');
              if (storedH) Object.assign(hoeren, JSON.parse(storedH));
            }
          } catch (e) {}

          try {
            if (!schreiben.content) {
              const storedS = localStorage.getItem('schreibenAnswers');
              if (storedS) {
                const obj = JSON.parse(storedS);
                schreiben.content = obj.content || '';
                schreiben.wordCount = obj.wordCount || (schreiben.content.trim() ? String(schreiben.content).trim().split(/\s+/).filter(Boolean).length : 0);
              }
            }
          } catch (e) {}

          return { hoeren, lesen, schreiben };
        } catch (e) {
          return { hoeren: {}, lesen: {}, schreiben: {} };
        }
      }

      function gradeHoeren(u) {
        const c = CONFIG.hoerenCorrect;
        let okCount = 0;
        const d = [];
        
        for (let q = 19; q <= 38; q++) {
          const k = String(q);
          const uA = normalizeAnswer(u[k] || '');
          const exp = normalizeAnswer(c[k] || '');
          const ok = (uA !== '' && uA.toLowerCase() === exp.toLowerCase());
          if (ok) okCount++;
          const ptsPer = CONFIG.totals.hoeren / CONFIG.counts.hoeren;
          d.push({
            frage: k,
            user: uA || '-',
            correct: exp || '-',
            richtig: ok,
            punkte: ok ? ptsPer.toFixed(2) : '0'
          });
        }
        
        const total = Number((okCount * (CONFIG.totals.hoeren / CONFIG.counts.hoeren)).toFixed(2));
        return { okCount, total, details: d };
      }

      function gradeLesen(u) {
        const c = CONFIG.lesenCorrect;
        let okCount = 0;
        const d = [];
        
        Object.keys(c).forEach(k => {
          const exp = normalizeAnswer(c[k]);
          const uA = normalizeAnswer(u[k] || '');
          const ok = (uA !== '' && uA.toLowerCase() === exp.toLowerCase());
          if (ok) okCount++;
          const ptsPer = CONFIG.totals.lesen / CONFIG.counts.lesen;
          d.push({
            frage: k,
            user: uA || '-',
            correct: exp || '-',
            richtig: ok,
            punkte: ok ? ptsPer.toFixed(2) : '0'
          });
        });
        
        const total = Number((okCount * (CONFIG.totals.lesen / CONFIG.counts.lesen)).toFixed(2));
        return { okCount, total, details: d };
      }

      function buildTable(title, dets, total, max) {
        let h = `<div class="result-item">
                <h3>${title} - ${total.toFixed(2)}/${max} Punkte</h3>
                <div class="section-table">
                  <table class="true-false-table">
                    <thead>
                      <tr>
                        <th style="width: 10%">Frage</th>
                        <th style="width: 40%">Ihre Antwort</th>
                        <th style="width: 40%">Richtige Antwort</th>
                        <th style="width: 10%">Ergebnis</th>
                      </tr>
                    </thead>
                    <tbody>`;
        
        dets.forEach(x => {
          const isCorrect = x.richtig;
          const rowClass = isCorrect ? 'correct-answer' : 'incorrect-answer';
          const resultIcon = isCorrect ? '‚úÖ Richtig' : '‚ùå Falsch';
          
          h += `<tr class="${rowClass}">
                <td><strong>${x.frage}</strong></td>
                <td>${escapeHtml(x.user)}</td>
                <td>${escapeHtml(x.correct)}</td>
                <td><strong>${resultIcon}</strong></td>
              </tr>`;
        });
        
        h += `</tbody>
            </table>
            <div style="margin-top: 15px; padding: 15px; background: #e3f2fd; border-radius: 6px;">
              <strong>Erreichte Punkte: ${total.toFixed(2)}/${max} (${((total/max)*100).toFixed(1)}%)</strong>
            </div>
          </div></div>`;
        return h;
      }

      function renderLesenDetails(answers) {
        const c = CORRECT_ANSWERS.lesen;
        let html = `<div class="result-item">
                  <h3>üìñ Leseverstehen - Detaillierte Auswertung</h3>`;
        
        html += `<h4>Teil 1: √úberschriften zuordnen</h4>
               <table class="true-false-table">
                 <thead>
                   <tr>
                     <th>Text</th>
                     <th>Ihre Antwort</th>
                     <th>Richtige Antwort</th>
                     <th>Ergebnis</th>
                   </tr>
                 </thead>
                 <tbody>`;
        
        for (let i = 1; i <= 5; i++) {
          const key = `text${i}`;
          const userAnswer = answers[key] || '-';
          const correctAnswer = c[key] || '-';
          const isCorrect = userAnswer === correctAnswer;
          const rowClass = isCorrect ? 'correct-answer' : 'incorrect-answer';
          const resultIcon = isCorrect ? '‚úÖ' : '‚ùå';
          
          html += `<tr class="${rowClass}">
                    <td><strong>Text ${i}</strong></td>
                    <td>${getHeadingText(userAnswer)}</td>
                    <td>${getHeadingText(correctAnswer)}</td>
                    <td><strong>${resultIcon}</strong></td>
                  </tr>`;
        }
        
        html += `</tbody></table>`;
        
        html += `<h4 style="margin-top: 20px;">Teil 2: Fragen zum Text</h4>
               <table class="true-false-table">
                 <thead>
                   <tr>
                     <th>Frage</th>
                     <th>Ihre Antwort</th>
                     <th>Richtige Antwort</th>
                     <th>Ergebnis</th>
                   </tr>
                 </thead>
                 <tbody>`;
        
        for (let i = 1; i <= 5; i++) {
          const key = `s2q${i}`;
          const userAnswer = answers[key] || '-';
          const correctAnswer = c[key] || '-';
          const isCorrect = userAnswer === correctAnswer;
          const rowClass = isCorrect ? 'correct-answer' : 'incorrect-answer';
          const resultIcon = isCorrect ? '‚úÖ' : '‚ùå';
          
          html += `<tr class="${rowClass}">
                    <td><strong>Frage ${i}</strong></td>
                    <td>${getOptionText(key, userAnswer)}</td>
                    <td>${getOptionText(key, correctAnswer)}</td>
                    <td><strong>${resultIcon}</strong></td>
                  </tr>`;
        }
        
        html += `</tbody></table>`;
        
        html += `<h4 style="margin-top: 20px;">Teil 3: Texte zuordnen</h4>
               <table class="true-false-table">
                 <thead>
                   <tr>
                     <th>Situation</th>
                     <th>Ihre Antwort</th>
                     <th>Richtige Antwort</th>
                     <th>Ergebnis</th>
                   </tr>
                 </thead>
                 <tbody>`;
        
        for (let i = 11; i <= 20; i++) {
          const key = `${i}`;
          const userAnswer = answers[key] || '-';
          const correctAnswer = c[key] || '-';
          const isCorrect = userAnswer === correctAnswer;
          const rowClass = isCorrect ? 'correct-answer' : 'incorrect-answer';
          const resultIcon = isCorrect ? '‚úÖ' : '‚ùå';
          
          html += `<tr class="${rowClass}">
                    <td><strong>${i}</strong></td>
                    <td>${userAnswer === 'X' ? 'X - Keine passende Situation' : userAnswer}</td>
                    <td>${correctAnswer === 'X' ? 'X - Keine passende Situation' : correctAnswer}</td>
                    <td><strong>${resultIcon}</strong></td>
                  </tr>`;
        }
        
        html += `</tbody></table>`;
        
        html += `<h4 style="margin-top: 20px;">Sprachbausteine Teil 1</h4>
               <table class="true-false-table">
                 <thead>
                   <tr>
                     <th>L√ºcke</th>
                     <th>Ihre Antwort</th>
                     <th>Richtige Antwort</th>
                     <th>Ergebnis</th>
                   </tr>
                 </thead>
                 <tbody>`;
        
        for (let i = 21; i <= 30; i++) {
          const key = `${i}`;
          const userAnswer = answers[key] || '-';
          const correctAnswer = c[key] || '-';
          const isCorrect = userAnswer === correctAnswer;
          const rowClass = isCorrect ? 'correct-answer' : 'incorrect-answer';
          const resultIcon = isCorrect ? '‚úÖ' : '‚ùå';
          
          html += `<tr class="${rowClass}">
                    <td><strong>${i}</strong></td>
                    <td>${userAnswer}</td>
                    <td>${correctAnswer}</td>
                    <td><strong>${resultIcon}</strong></td>
                  </tr>`;
        }
        
        html += `</tbody></table>`;
        
        html += `<h4 style="margin-top: 20px;">Sprachbausteine Teil 2</h4>
               <table class="true-false-table">
                 <thead>
                   <tr>
                     <th>L√ºcke</th>
                     <th>Ihre Antwort</th>
                     <th>Richtige Antwort</th>
                     <th>Ergebnis</th>
                   </tr>
                 </thead>
                 <tbody>`;
        
        for (let i = 31; i <= 40; i++) {
          const key = `${i}`;
          const userAnswer = answers[key] || '-';
          const correctAnswer = c[key] || '-';
          const isCorrect = userAnswer === correctAnswer;
          const rowClass = isCorrect ? 'correct-answer' : 'incorrect-answer';
          const resultIcon = isCorrect ? '‚úÖ' : '‚ùå';
          
          html += `<tr class="${rowClass}">
                    <td><strong>${i}</strong></td>
                    <td>${userAnswer}</td>
                    <td>${correctAnswer}</td>
                    <td><strong>${resultIcon}</strong></td>
                  </tr>`;
        }
        
        html += `</tbody></table></div>`;
        return html;
      }

      function buildHoerenDetails(answers) {
        let html = `<table class="true-false-table">
                  <thead>
                    <tr>
                      <th>Frage</th>
                      <th>Ihre Antwort</th>
                      <th>Richtige Antwort</th>
                      <th>Ergebnis</th>
                    </tr>
                  </thead>
                  <tbody>`;
        
        for (let i = 19; i <= 38; i++) {
          const id = i.toString();
          const userAnswer = normalizeAnswer(answers[id] || '');
          const correctAnswer = CORRECT_ANSWERS.hoeren[id];
          const isCorrect = userAnswer === correctAnswer;
          const rowClass = isCorrect ? 'correct-answer' : 'incorrect-answer';
          const resultIcon = isCorrect ? '‚úÖ' : '‚ùå';
          
          html += `<tr class="${rowClass}">
                    <td><strong>${id}</strong></td>
                    <td>${userAnswer}</td>
                    <td>${correctAnswer}</td>
                    <td><strong>${resultIcon}</strong></td>
                  </tr>`;
        }
        
        html += `</tbody></table>`;
        return html;
      }

      function renderResults() {
        const st = readExamResults() || { hoeren: {}, lesen: {}, schreiben: {} };
        const h = gradeHoeren(st.hoeren || {});
        const l = gradeLesen(st.lesen || {});
        const details = document.getElementById('details-ergebnisse');
        const tiles = document.getElementById('topTiles-ergebnisse');
        const sScoreRaw = localStorage.getItem('schreibenScore');
        const sScore = sScoreRaw ? Number(sScoreRaw) : 0;

        details.innerHTML = '';
        tiles.innerHTML = '';

        const tL = `<div class="results-tile">
                  <h3>Lesen</h3>
                  <div class="score">${l.total.toFixed(2)} / ${CONFIG.totals.lesen} Punkte</div>
                  <div class="small-muted">(${(l.total / CONFIG.totals.lesen * 100).toFixed(2)} %)</div>
                </div>`;
                
        const tH = `<div class="results-tile">
                  <h3>H√∂ren</h3>
                  <div class="score">${h.total.toFixed(2)} / ${CONFIG.totals.hoeren} Punkte</div>
                  <div class="small-muted">(${(h.total / CONFIG.totals.hoeren * 100).toFixed(2)} %)</div>
                </div>`;
                
        const tS = `<div class="results-tile">
                  <h3>Schreiben</h3>
                  <div class="score" id="schreibenScoreDisplay">${sScore.toFixed(2)} / ${CONFIG.totals.schreiben} Punkte</div>
                  <div class="small-muted">Manuelle Eingabe</div>
                </div>`;
                
        tiles.innerHTML = tL + tH + tS;

        details.innerHTML += `<div class="result-item">
                            <h2>üìä Detaillierte Ergebnisse</h2>
                            <div class="instructions">Hier sehen Sie eine detaillierte Auswertung Ihrer Pr√ºfung mit Vergleich Ihrer Antworten mit den korrekten L√∂sungen.</div>
                          </div>`;

        details.innerHTML += renderLesenDetails(st.lesen);
        
        details.innerHTML += `<div class="result-item">
                            <h3>üëÇ H√∂rverstehen - Detaillierte Auswertung</h3>
                            ${buildHoerenDetails(st.hoeren)}
                          </div>`;

        let sHtml = '<div class="result-item"><h3>‚úçÔ∏è Schreiben - Ihre Antwort</h3>';
        const txt = st.schreiben.content ? escapeHtml(st.schreiben.content) : '<span class="small-muted">Kein Text gefunden.</span>';
        const wc = st.schreiben.wordCount || '-';
        
        sHtml += `<div class="small-muted">W√∂rter: ${wc}</div>
                <div style="margin-top:10px;padding:12px;background:#fff;border-radius:8px;border:1px solid #eef6ff;min-height:80px">${txt}</div>
                <div style="margin-top:10px;display:flex;gap:10px;align-items:center">
                  Punkte (0‚Äì45): 
                  <input id="sInput" type="number" min="0" max="45" step="0.5" value="${sScore}"> 
                  <button id="saveS" class="results-btn">Speichern</button>
                </div></div>`;
                
        details.innerHTML += sHtml;

        const total = (l.total + h.total + sScore).toFixed(2);
        const percent = ((total / CONFIG.totals.gesamt) * 100).toFixed(2);
        
        document.getElementById('finalSummary-ergebnisse').innerHTML = `
          <div class="left">
            Gesamtpunktzahl: <strong>${total}</strong> / ${CONFIG.totals.gesamt} Punkte<br>
            <span class="small-muted">Lesen + H√∂ren + Schreiben</span>
          </div>
          <div class="right">
            Prozentsatz: <strong>${percent} %</strong>
          </div>`;

        document.getElementById('saveS').onclick = () => {
          const v = Number(document.getElementById('sInput').value) || 0;
          localStorage.setItem('schreibenScore', v);
          document.getElementById('schreibenScoreDisplay').textContent = `${v.toFixed(2)} / ${CONFIG.totals.schreiben} Punkte`;
          
          const newTotal = (l.total + h.total + v).toFixed(2);
          const newPercent = ((newTotal / CONFIG.totals.gesamt) * 100).toFixed(2);
          
          document.getElementById('finalSummary-ergebnisse').innerHTML = `
            <div class="left">
              Gesamtpunktzahl: <strong>${newTotal}</strong> / ${CONFIG.totals.gesamt} Punkte<br>
              <span class="small-muted">Lesen + H√∂ren + Schreiben</span>
            </div>
            <div class="right">
              Prozentsatz: <strong>${newPercent} %</strong>
            </div>`;
        };
      }

      document.getElementById('calcBtn-ergebnisse').onclick = () => renderResults();
      document.getElementById('backBtn-ergebnisse').onclick = (e) => {
        e.preventDefault();
        showPage('start-page');
      };
      
      renderResults();
    }
  </script>
</body>
</html>