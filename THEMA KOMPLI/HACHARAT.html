<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Deutsch B2 Pr√ºfung - Komplett</title>
  <style>
    /* ===== GLOBAL STYLES ===== */
    :root {
      --primary-color: #1e3a5f;
      --secondary-color: #2c5282;
      --accent-color: #4da6ff;
      --light-color: #ebf8ff;
      --text-color: #2d3748;
      --white: #ffffff;
      --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      --transition: all 0.3s ease;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      margin: 0;
      min-height: 100vh;
      background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
      color: var(--white);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    button {
      cursor: pointer;
    }
    
    /* ===== START PAGE STYLES ===== */
    .start-container {
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      padding: 20px;
      min-height: 100vh;
    }
    
    .start-content {
      max-width: 600px;
      width: 100%;
      background-color: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      padding: 40px;
      box-shadow: var(--shadow);
      text-align: center;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .logo {
      margin-bottom: 20px;
    }
    
    .logo-icon {
      font-size: 48px;
      margin-bottom: 10px;
    }
    
    h1 {
      font-size: 32px;
      margin-bottom: 10px;
      font-weight: 700;
    }
    
    .subtitle {
      font-size: 18px;
      margin-bottom: 30px;
      opacity: 0.9;
    }
    
    .card {
      background-color: var(--white);
      border-radius: 12px;
      padding: 25px;
      margin-bottom: 30px;
      box-shadow: var(--shadow);
      color: var(--text-color);
    }
    
    .card h2 {
      font-size: 20px;
      margin-bottom: 15px;
      color: var(--primary-color);
    }
    
    .card p {
      margin-bottom: 20px;
      line-height: 1.5;
    }
    
    select {
      width: 100%;
      padding: 12px 16px;
      font-size: 16px;
      border-radius: 8px;
      border: 2px solid var(--accent-color);
      outline: none;
      background-color: var(--white);
      color: var(--text-color);
      cursor: pointer;
      transition: var(--transition);
    }
    
    select:focus {
      border-color: var(--secondary-color);
      box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.3);
    }
    
    .timer-container {
      margin: 25px 0;
    }
    
    .timer-label {
      font-size: 16px;
      margin-bottom: 10px;
    }
    
    .timer {
      font-size: 48px;
      font-weight: 700;
      color: var(--accent-color);
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }
    
    .progress-bar {
      height: 8px;
      width: 100%;
      background-color: rgba(255, 255, 255, 0.2);
      border-radius: 4px;
      overflow: hidden;
      margin-top: 10px;
    }
    
    .progress {
      height: 100%;
      width: 100%;
      background-color: var(--accent-color);
      border-radius: 4px;
      transform: scaleX(1);
      transform-origin: left;
      transition: transform 1s linear;
    }
    
    .info-text {
      font-size: 14px;
      margin-top: 20px;
      opacity: 0.8;
    }
    
    .button-container {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }
    
    .btn {
      flex: 1;
      padding: 12px 20px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      background-color: var(--accent-color);
      color: white;
      text-decoration: none;
      display: inline-block;
      text-align: center;
    }
    
    .btn:hover {
      background-color: #3399ff;
    }
    
    /* ===== EXAM PAGE STYLES ===== */
    .exam-body {
      background: #f5f5f5;
      color: #333;
      line-height: 1.45;
      -webkit-font-smoothing: antialiased;
    }
    
    /* Header Styles */
    header.topbar {
      background: #1e3a5f;
      color: #fff;
      padding: 12px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      min-height: 80px;
    }

    .brand {
      display: flex;
      gap: 15px;
      align-items: center;
    }

    .brand .logo {
      width: 80px;
      height: 40px;
      background: #e74c3c;
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      color: white;
      font-size: 18px;
    }

    .meta .main-title {
      font-weight: 800;
      font-size: 18px;
    }

    .meta .sub-title {
      font-size: 13px;
      opacity: 0.9;
    }

    .timer {
      font-weight: 700;
      font-size: 18px;
      color: #fff;
      margin: 0 20px;
    }

    .buttons-grid {
      display: grid;
      grid-template-columns: repeat(2, auto);
      gap: 10px 20px;
    }

    .exam-btn {
      padding: 12px 20px;
      border-radius: 6px;
      border: none;
      background: #4da6ff;
      color: white;
      font-weight: 700;
      font-size: 15px;
      cursor: pointer;
      transition: background 0.2s ease-in-out;
      min-width: 150px;
      text-align: center;
    }

    .exam-btn:hover {
      background: #336fbf;
    }
    
    .exam-btn.save {
      background: #4da6ff;
      color: #000;
    }
    
    .exam-btn.save:hover {
      background: #3399ff;
    }
    
    .exam-btn.submit {
      background: #4da6ff;
    }
    
    .exam-btn.submit:hover {
      background: #3399ff;
    }
    
    .exam-btn.result {
      background: #4da6ff;
    }
    
    .exam-btn.result:hover {
      background: #3399ff;
    }
    
    .exam-btn.next {
      background: #4da6ff;
      color: #fff;
    }
    
    .exam-btn.next:hover {
      background: #3399ff;
    }
    
    .exam-btn.reset {
      background: #4da6ff;
    }
    
    .exam-btn.reset:hover {
      background: #3399ff;
    }
    
    .exam-btn.reset-section {
      background: #d35400;
      font-size: 12px;
      padding: 6px 10px;
      min-width: auto;
    }
    
    .exam-btn.reset-section:hover {
      background: #e67e22;
    }
    
    .exam-btn.no-match {
      background: #95a5a6;
      font-size: 12px;
      padding: 6px 10px;
      min-width: auto;
      margin-top: 5px;
    }
    
    .exam-btn.no-match:hover {
      background: #7f8c8d;
    }
    
    .exam-btn.no-match.selected {
      background: #e74c3c;
    }
    
    /* Top Tiles */
    .top-tiles {
      display: flex;
      justify-content: center;
      gap: 8px;
      padding: 8px 12px;
      background: #1e3a5f;
      border-bottom: 1px solid #0f223a;
    }
    
    .tile {
      flex: 1;
      max-width: 180px;
      text-align: center;
      padding: 12px;
      border-radius: 6px;
      border: 1px solid #ccc;
      background: #3b4a63;
      color: #fff;
      font-weight: 600;
      font-size: 13px;
      cursor: pointer;
      transition: all 0.2s ease-in-out;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 60px;
    }
    
    .tile:hover {
      background: #4a5b78;
    }
    
    .tile.active {
      background: #ffffff;
      color: #000;
      border-color: #bbb;
    }
    
    .tile.done {
      background: #2ecc71;
      color: #fff;
      border-color: #27ae60;
    }
    
    .tile.done::after {
      content: " ‚úÖ";
      margin-left: 5px;
    }
    
    .tile .points {
      background: rgba(255,255,255,0.2);
      padding: 4px 8px;
      border-radius: 12px;
      font-weight: 700;
      font-size: 11px;
      margin-top: 4px;
    }
    
    .tile.active .points {
      background: #e9eefc;
      color: #2c3e50;
    }
    
    /* Container Styles */
    .container {
      display: grid;
      grid-template-columns: 1fr 420px;
      gap: 16px;
      padding: 16px;
      max-width: 1200px;
      margin: 12px auto;
    }
    
    .container-full {
      display: grid;
      grid-template-columns: 1fr;
      gap: 16px;
      padding: 16px;
      max-width: 1200px;
      margin: 12px auto;
    }
    
    .container-split {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
      padding: 16px;
      max-width: 1200px;
      margin: 12px auto;
    }
    
    .left-panel {
      background: white;
      border-radius: 8px;
      padding: 18px;
      box-shadow: 0 1px 6px rgba(0,0,0,0.06);
      max-height: 76vh;
      overflow: auto;
    }
    
    .left-panel .passage {
      font-size: 14px;
      color: #2c3e50;
      line-height: 1.8;
    }
    
    .left-panel h2 {
      font-size: 16px;
      margin-bottom: 10px;
    }
    
    .right-panel {
      background: white;
      border-radius: 8px;
      padding: 12px;
      box-shadow: 0 1px 6px rgba(0,0,0,0.06);
      display: flex;
      flex-direction: column;
      gap: 12px;
      max-height: 76vh;
      overflow: auto;
    }
    
    .main-panel {
      background: white;
      border-radius: 8px;
      padding: 25px;
      box-shadow: 0 1px 6px rgba(0,0,0,0.06);
      max-height: 76vh;
      overflow: auto;
    }
    
    .panel-title {
      font-size: 18px;
      margin-bottom: 15px;
      color: #1e3a5f;
      font-weight: 700;
    }
    
    /* Question Styles */
    .question-head {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }
    
    .question-body {
      margin-top: 8px;
    }
    
    .options {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    .option {
      background: #fbfdff;
      border: 1px solid #e1e8f6;
      padding: 10px;
      border-radius: 8px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .option:hover {
      background: #f0f6ff;
    }
    
    .option.selected {
      background: #e8fbe9;
      border-color: #2ecc71;
    }
    
    .option .radio {
      width: 18px;
      height: 18px;
      border-radius: 50%;
      border: 2px solid #cfdff6;
      background: #fff;
      display: inline-block;
      flex-shrink: 0;
    }
    
    .option.selected .radio {
      background: #3498db;
      border-color: #3498db;
      box-shadow: inset 0 -3px 0 rgba(0,0,0,0.05);
    }
    
    .text-container {
      margin-bottom: 20px;
      padding: 15px;
      border: 1px solid #e1e8f6;
      border-radius: 8px;
      background: #fbfdff;
      position: relative;
      min-height: 120px;
    }
    
    .text-container:hover {
      background: #f0f6ff;
    }
    
    .text-title {
      font-weight: 700;
      margin-bottom: 8px;
      color: #2c3e50;
    }
    
    .text-content {
      font-size: 14px;
      color: #2c3e50;
      line-height: 1.6;
    }
    
    .title-slot {
      min-height: 40px;
      margin-top: 10px;
      padding: 8px;
      border: 2px dashed #c8d9f6;
      border-radius: 6px;
      background: #f8fbff;
    }
    
    .title-slot.has-title {
      background: #e8fbe9;
      border-color: #2ecc71;
    }
    
    .title-slot.has-x {
      background: #f8d7da;
      border-color: #e74c3c;
      color: #c0392b;
      font-weight: bold;
    }
    
    .headings-bank {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-top: 0;
    }
    
    .heading-item {
      padding: 10px;
      border: 1px solid #dbe7fb;
      border-radius: 8px;
      background: #f8fbff;
      cursor: grab;
    }
    
    .heading-item:hover {
      background: #e9f0ff;
    }
    
    .heading-item.used {
      opacity: 0.5;
      cursor: not-allowed;
      background: #f8d7da;
      border-color: #f5c6cb;
    }
    
    .result-correct {
      color: #27ae60;
      font-weight: bold;
    }
    
    .result-incorrect {
      color: #c0392b;
      font-weight: bold;
    }
    
    .result-item {
      margin: 10px 0;
      padding: 10px;
      border-radius: 6px;
      background: #f8f9fa;
    }
    
    .instructions {
      color: #7f8c8d;
      font-size: 14px;
      line-height: 1.6;
      margin-bottom: 15px;
    }
    
    .question-text {
      font-weight: 600;
      margin-bottom: 15px;
      font-size: 15px;
      color: #2c3e50;
    }
    
    .all-questions {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    
    .question-block {
      margin-bottom: 20px;
      padding: 15px;
      border: 1px solid #e1e8f6;
      border-radius: 8px;
      background: #fbfdff;
    }
    
    .texts-list, .situations-list {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    
    .text-item, .situation-item {
      padding: 15px;
      border: 1px solid #e1e8f6;
      border-radius: 8px;
      background: #fbfdff;
    }
    
    .text-letter {
      font-weight: bold;
      color: #2c3e50;
      margin-bottom: 8px;
    }
    
    .situation-number {
      font-weight: bold;
      color: #2c3e50;
      margin-bottom: 8px;
    }
    
    .fill-blank-container {
      margin: 20px 0;
    }
    
    .blank-word {
      display: inline-block;
      min-width: 120px;
      padding: 4px 8px;
      margin: 0 6px;
      background: #fff;
      cursor: pointer;
      position: relative;
      border: 1px solid #dbe7fb;
      border-radius: 4px;
    }
    
    .blank-word.has-answer {
      background: #e8fbe9;
      border-color: #2ecc71;
    }
    
    .options-popup {
      position: absolute;
      top: 100%;
      left: 0;
      background: white;
      border: 1px solid #dbe7fb;
      border-radius: 6px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      z-index: 100;
      min-width: 150px;
    }
    
    .option-item {
      padding: 8px 12px;
      cursor: pointer;
      border-bottom: 1px solid #f0f4fb;
    }
    
    .option-item:hover {
      background: #f0f6ff;
    }
    
    .option-item:last-child {
      border-bottom: none;
    }
    
    .horizontal-options {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    
    .option-row {
      display: flex;
      align-items: center;
      gap: 15px;
      padding: 10px;
      border: 1px solid #e1e8f6;
      border-radius: 8px;
      background: #fbfdff;
    }
    
    .option-number {
      font-weight: bold;
      color: #2c3e50;
      min-width: 30px;
    }
    
    .option-buttons {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    
    .option-btn {
      padding: 8px 16px;
      border: 1px solid #dbe7fb;
      border-radius: 6px;
      background: #f8fbff;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .option-btn:hover {
      background: #e9f0ff;
    }
    
    .option-btn.selected {
      background: #3498db;
      color: white;
      border-color: #3498db;
    }
    
    .word-bank-vertical {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    .bank-word-vertical {
      padding: 10px;
      border: 1px solid #dbe7fb;
      border-radius: 6px;
      background: #f8fbff;
      text-align: center;
      cursor: grab;
    }
    
    .bank-word-vertical.used {
      opacity: 0.5;
      cursor: not-allowed;
      background: #f8d7da;
      border-color: #f5c6cb;
    }
    
    .blank-slot {
      display: inline-block;
      min-width: 100px;
      padding: 4px 8px;
      margin: 0 6px;
      background: #fff;
      min-height: 30px;
      vertical-align: middle;
      border: 1px solid #dbe7fb;
      border-radius: 4px;
      cursor: pointer;
    }
    
    .blank-slot.has-answer {
      background: #e8fbe9;
      border-color: #2ecc71;
    }
    
    .footer-buttons {
      display: flex;
      gap: 10px;
    }
    
    .situation-item.used {
      opacity: 0.7;
      cursor: not-allowed;
      background: #f8d7da;
      border-color: #f5c6cb;
      color: #333;
    }
    
    /* Listening Section Styles */
    .listening-task {
      margin-bottom: 10px;
    }
    
    .true-false-table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
      font-size: 14px;
    }
    
    .true-false-table th {
      background: #3498db;
      color: white;
      padding: 15px;
      text-align: left;
      font-weight: 600;
      font-size: 14px;
    }
    
    .true-false-table td {
      padding: 15px;
      border-bottom: 1px solid #e1e8f6;
      vertical-align: top;
    }
    
    .true-false-table tr:nth-child(even) {
      background: #f8f9fa;
    }
    
    .true-false-table tr:hover {
      background: #e3f2fd;
    }
    
    .answer-options {
      display: flex;
      gap: 25px;
    }
    
    .answer-option {
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      padding: 10px 15px;
      border-radius: 4px;
      transition: background 0.2s;
      font-weight: 500;
    }
    
    .answer-option:hover {
      background: #e3f2fd;
    }
    
    .answer-option input {
      margin: 0;
      transform: scale(1.2);
    }

    .correct-answer {
      background: #d4edda !important;
      border-left: 4px solid #28a745;
    }
    
    .incorrect-answer {
      background: #f8d7da !important;
      border-left: 4px solid #dc3545;
    }
    
    /* Writing Section Styles */
    .writing-task {
      margin-bottom: 20px;
      padding: 15px;
      border: 1px solid #e1e8f6;
      border-radius: 8px;
      background: #fbfdff;
    }
    
    .writing-prompt {
      font-size: 14px;
      color: #2c3e50;
      line-height: 1.6;
      margin-bottom: 15px;
    }
    
    .writing-requirements {
      background: #f8f9fa;
      padding: 12px;
      border-radius: 6px;
      border-left: 4px solid #3498db;
      margin-bottom: 15px;
    }
    
    .writing-requirements h4 {
      margin: 0 0 8px 0;
      color: #2c3e50;
    }
    
    .writing-requirements ul {
      margin: 0;
      padding-left: 20px;
    }
    
    .writing-requirements li {
      margin-bottom: 5px;
      color: #2c3e50;
    }
    
    .writing-area {
      flex: 1;
      display: flex;
      flex-direction: column;
    }
    
    .writing-textarea {
      flex: 1;
      min-height: 500px;
      padding: 15px;
      border: 2px solid #e1e8f6;
      border-radius: 8px;
      font-size: 14px;
      line-height: 1.6;
      resize: vertical;
      font-family: Arial, sans-serif;
    }
    
    .writing-textarea:focus {
      outline: none;
      border-color: #3498db;
    }
    
    .word-counter {
      margin-top: 10px;
      text-align: right;
      font-size: 13px;
      color: #7f8c8d;
      padding: 8px 0;
    }
    
    .word-counter .count {
      font-weight: bold;
      color: #2c3e50;
    }
    
    /* Results Page Styles */
    .results-body {
      background: #f7fafc;
      color: #0f1724;
      line-height: 1.6;
    }
    
    .results-header {
      background: #1e3a5f;
      color: #fff;
      padding: 18px 20px;
      display: flex;
      align-items: center;
      gap: 16px;
    }
    
    .results-logo {
      background: #fff;
      color: #1e3a5f;
      padding: 8px 12px;
      border-radius: 6px;
      font-weight: 800;
    }
    
    .results-title {
      font-size: 18px;
      font-weight: 700;
    }
    
    .results-container {
      max-width: 1100px;
      margin: 22px auto;
      padding: 20px;
    }
    
    .results-tiles {
      display: flex;
      gap: 12px;
      margin: 18px 0;
    }
    
    .results-tile {
      flex: 1;
      background: #fff;
      border-radius: 10px;
      padding: 16px;
      box-shadow: 0 6px 18px rgba(2, 6, 23, 0.06);
      border-left: 6px solid #1e3a5f;
    }
    
    .results-tile h3 {
      margin: 0;
      font-size: 16px;
      color: #1e3a5f;
    }
    
    .results-tile .score {
      font-size: 20px;
      font-weight: 800;
      margin-top: 8px;
    }
    
    .section-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 12px;
    }
    
    .section-table th,
    .section-table td {
      padding: 8px;
      border-bottom: 1px solid #e6eef8;
      text-align: left;
      font-size: 14px;
    }
    
    .summary {
      background: #fff;
      padding: 16px;
      border-radius: 10px;
      margin-top: 18px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .summary .left {
      font-weight: 700;
    }
    
    .summary .right {
      text-align: right;
    }
    
    .controls {
      display: flex;
      gap: 10px;
      margin-top: 18px;
    }
    
    .results-btn {
      background: #4da6ff;
      border: none;
      color: #fff;
      padding: 10px 14px;
      border-radius: 8px;
      font-weight: 700;
      cursor: pointer;
      transition: background 0.3s;
    }
    
    .results-btn:hover {
      background: #3a8ce0;
    }
    
    .button-like {
      text-decoration: none;
    }
    
    .small-muted {
      color: #6b7280;
      font-size: 13px;
    }
    
    input[type="number"] {
      width: 90px;
      padding: 8px;
      border: 1px solid #d7e6fb;
      border-radius: 6px;
    }
    
    .note {
      font-size: 13px;
      color: #6b7280;
      margin-top: 8px;
    }
    
    /* Footer */
    footer.controls {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 20px;
      background: white;
      border-top: 1px solid #e1e8f6;
      margin-top: 20px;
    }
    
    .status {
      font-size: 14px;
      color: #7f8c8d;
    }
    
    .ghost {
      background: transparent;
      border: 2px solid #2c3e50;
      color: #2c3e50;
    }
    
    .ghost:hover {
      background: #2c3e50;
      color: white;
    }

    /* Responsive Styles */
    @media (max-width: 980px) {
      .container {
        grid-template-columns: 1fr;
        padding: 12px;
      }
      
      .container-split {
        grid-template-columns: 1fr;
      }
      
      .right-panel {
        order: 2;
      }
      
      .top-tiles {
        padding-left: 8px;
        padding-right: 8px;
      }
      
      header.topbar {
        flex-direction: column;
        gap: 15px;
        text-align: center;
      }
      
      .buttons-grid {
        grid-template-columns: 1fr;
      }
      
      .answer-options {
        flex-direction: column;
        gap: 10px;
      }
      
      footer.controls {
        flex-direction: column;
        gap: 15px;
      }
      
      .results-tiles {
        flex-direction: column;
      }
      
      .summary {
        flex-direction: column;
        gap: 10px;
        text-align: center;
      }
      
      .controls {
        flex-direction: column;
      }
    }
    
    @media (max-width: 600px) {
      .start-content {
        padding: 25px 20px;
      }
      
      h1 {
        font-size: 28px;
      }
      
      .card {
        padding: 20px 15px;
      }
    }

    /* === ÿ™ÿ≠ÿ≥ŸäŸÜÿßÿ™ ÿÆÿßÿµÿ© ŸÑŸÑŸáŸàÿßÿ™ŸÅ ÿßŸÑÿµÿ∫Ÿäÿ±ÿ© ÿ¨ÿØÿß === */
    @media (max-width: 480px) {
      /* 1. ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑÿ≠ÿßŸàŸäÿßÿ™ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ© */
      .container, .container-split, .container-full {
        grid-template-columns: 1fr !important;
        padding: 8px !important;
        gap: 10px !important;
      }
      
      /* 2. ÿ¨ÿπŸÑ ÿßŸÑŸÑŸàÿ≠ÿßÿ™ (panels) ÿ™ÿ£ÿÆÿ∞ ÿπÿ±ÿ∂ ŸÉÿßŸÖŸÑ */
      .left-panel, .right-panel, .main-panel {
        max-height: none !important;
        height: auto !important;
        overflow: visible !important;
        margin-bottom: 10px;
      }
      
      /* 3. ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑŸáŸäÿØÿ± */
      .topbar {
        flex-direction: column !important;
        align-items: stretch !important;
        padding: 10px !important;
      }
      
      .brand {
        justify-content: center;
        margin-bottom: 10px;
      }
      
      /* 4. ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑÿ£ÿ≤ÿ±ÿßÿ± ŸÅŸä ÿßŸÑŸáŸäÿØÿ± */
      .buttons-grid {
        grid-template-columns: 1fr !important;
        width: 100%;
      }
      
      .exam-btn {
        width: 100% !important;
        margin: 2px 0 !important;
        font-size: 14px !important;
        padding: 12px 8px !important;
      }
      
      /* 5. ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑÿ™ÿßŸäŸÑÿßÿ™ */
      .top-tiles {
        flex-wrap: wrap;
        justify-content: center;
      }
      
      .tile {
        flex: 0 0 calc(33% - 5px) !important;
        max-width: calc(33% - 5px) !important;
        margin: 2px;
        font-size: 11px !important;
        padding: 8px 4px !important;
      }
      
      /* 6. ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑŸÜÿµŸàÿµ */
      .passage, .text-content, .question-text {
        font-size: 15px !important;
        line-height: 1.5 !important;
      }
      
      /* 7. ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑÿÆŸäÿßÿ±ÿßÿ™ */
      .option {
        padding: 12px 10px !important;
        margin: 4px 0 !important;
      }
      
      /* 8. ÿ™ÿ≠ÿ≥ŸäŸÜ ÿ¨ÿØÿßŸàŸÑ True/False */
      .true-false-table {
        display: block;
        overflow-x: auto;
        white-space: nowrap;
      }
      
      /* 9. ÿ™ÿ≠ÿ≥ŸäŸÜ ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑŸÉÿ™ÿßÿ®ÿ© */
      .writing-textarea {
        min-height: 300px !important;
        font-size: 16px !important;
      }
      
      /* 10. ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑŸÅŸàÿ™ÿ± */
      footer.controls {
        flex-direction: column !important;
        gap: 10px !important;
      }
      
      .footer-buttons {
        width: 100%;
        display: flex;
        gap: 5px;
      }
      
      .footer-buttons .exam-btn {
        flex: 1;
      }
      
      /* 11. ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨ */
      .results-tiles {
        flex-direction: column !important;
      }
      
      .results-tile {
        margin-bottom: 10px;
      }
      
      /* 12. ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑÿ®ÿØÿ° ÿµŸÅÿ≠ÿ© */
      .start-content {
        padding: 20px 15px !important;
      }
      
      .logo-icon {
        font-size: 40px !important;
      }
      
      h1 {
        font-size: 24px !important;
      }
      
      .card {
        padding: 15px 12px !important;
      }
      
      .btn {
        padding: 10px 15px !important;
        font-size: 14px !important;
      }
      
      .timer {
        font-size: 36px !important;
      }
      
      /* 13. ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑÿ≥ÿ≠ÿ® ŸàÿßŸÑÿ•ŸÅŸÑÿßÿ™ ŸÑŸÑŸáÿßÿ™ŸÅ */
      .heading-item, .bank-word-vertical {
        padding: 12px 10px !important;
        font-size: 14px !important;
        touch-action: manipulation;
      }
      
      .title-slot {
        min-height: 50px !important;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 14px !important;
      }
      
      /* 14. ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑÿÆŸäÿßÿ±ÿßÿ™ ÿßŸÑÿµÿ∫Ÿäÿ±ÿ© */
      .option-btn {
        padding: 10px 12px !important;
        font-size: 13px !important;
      }
      
      /* 15. ÿ™ÿ≠ÿ≥ŸäŸÜ ÿ≠ŸÇŸàŸÑ ÿßŸÑÿ•ÿØÿÆÿßŸÑ */
      select, input[type="number"] {
        font-size: 16px !important;
        padding: 12px !important;
      }
    }

    /* === ÿ™ÿ≠ÿ≥ŸäŸÜÿßÿ™ ŸÑŸÑŸáŸàÿßÿ™ŸÅ ÿßŸÑŸÖÿ™Ÿàÿ≥ÿ∑ÿ© === */
    @media (min-width: 481px) and (max-width: 768px) {
      .container, .container-split {
        grid-template-columns: 1fr !important;
      }
      
      .tile {
        max-width: 180px !important;
      }
      
      .exam-btn {
        min-width: 130px !important;
        padding: 10px 15px !important;
      }
    }
  </style>
</head>
<body id="body">
  <!-- Start Page -->
  <div id="start-page" class="start-container">
    <div class="start-content">
      <div class="logo">
        <div class="logo-icon">üìù</div>
        <h1>Deutsch B2 Pr√ºfung</h1>
        <div class="subtitle">Bereiten Sie sich auf Ihre Pr√ºfung vor</div>
      </div>
      <div class="card">
        <h2>Pr√ºfungsbereich ausw√§hlen</h2>
        <p>W√§hlen Sie bitte den Bereich aus, den Sie √ºben m√∂chten. Die Pr√ºfung startet automatisch in <span id="time-display">30</span> Sekunden.</p>
        <select id="sectionSelect">
          <option value="lesen">Lesen</option>
          <option value="hoeren">H√∂ren</option>
          <option value="schreiben">Schreiben</option>
        </select>
        <div class="button-container">
          <button id="cancelBtn" class="btn">Abbrechen</button>
          <button id="startBtn" class="btn">Jetzt starten</button>
        </div>
      </div>
      <div class="timer-container">
        <div class="timer-label">Die Pr√ºfung startet in:</div>
        <div class="timer" id="countdown">30</div>
        <div class="progress-bar">
          <div class="progress" id="progress"></div>
        </div>
      </div>
      <div class="info-text">Stellen Sie sicher, dass Sie in einer ruhigen Umgebung sind und gen√ºgend Zeit haben.</div>
    </div>
  </div>

  <!-- Lesen Page -->
  <div id="lesen-page" class="exam-page" style="display: none;">
    <header class="topbar" role="banner">
      <div class="brand">
        <div class="logo">test</div>
        <div class="meta">
          <div class="main-title">Deutsch - B2 (√úbung)</div>
          <div class="sub-title">Lesen ‚Äî Testbeispiel</div>
        </div>
      </div>

      <div id="timer-lesen" class="timer" aria-live="polite">Verbleibende Zeit: 90:00</div>

      <div class="buttons-grid">
        <button id="resetBtn-lesen" class="exam-btn reset">üîÑ Von neu beginnen</button>
        <button id="saveBtn-lesen" class="exam-btn save">üìã Speichern</button>
        <button id="resultBtn-lesen" class="exam-btn result">üìä Ergebnis</button>
        <button id="submitBtn-lesen" class="exam-btn submit">üèÅ Abgabe</button>
        <button class="exam-btn next" id="nextBtn-lesen">‚û°Ô∏è N√§chste Pr√ºfung</button>
      </div>
    </header>

    <div class="top-tiles" id="topTiles-lesen" role="navigation" aria-label="Sections overview"></div>

    <div class="container">
      <main class="left-panel" id="leftPanel-lesen">
        <div class="passage" id="passage-lesen">
          <h2 id="passageTitle-lesen">Aufgabe</h2>
          <div id="passageContent-lesen"></div>
        </div>
      </main>

      <aside class="right-panel" id="rightPanel-lesen" aria-labelledby="questionTitle-lesen">
        <div class="question-head">
          <div>
            <div id="sectionName-lesen" style="font-weight:800"></div>
            <div id="questionTitle-lesen" style="font-size:13px;color:#55607a">Frage</div>
          </div>
          <button id="resetSectionBtn-lesen" class="exam-btn reset-section" style="display:none;">Teil zur√ºcksetzen</button>
        </div>
        <div class="question-body" id="questionBody-lesen"></div>
        <div id="headingsBankContainer-lesen"></div>
      </aside>
    </div>

    <footer class="controls">
      <div class="footer-buttons">
        <button id="prevBtn-lesen" class="exam-btn ghost">Zur√ºck</button>
        <button id="nextBtn-lesen" class="exam-btn ghost">Weiter</button>
      </div>
      <div class="status"><span id="statusText-lesen">Nicht gespeichert</span></div>
    </footer>
  </div>

  <!-- H√∂ren Page -->
  <div id="hoeren-page" class="exam-page" style="display: none;">
    <header class="topbar" role="banner">
      <div class="brand">
        <div class="logo">test</div>
        <div class="meta">
          <div class="main-title">Deutsch - B2 (√úbung)</div>
          <div class="sub-title">H√∂rverstehen ‚Äî Testbeispiel</div>
        </div>
      </div>

      <div id="timer-hoeren" class="timer" aria-live="polite">Verbleibende Zeit: 17:00</div>

      <div class="buttons-grid">
        <button id="resetBtn-hoeren" class="exam-btn reset">üîÑ Von neu beginnen</button>
        <button id="saveBtn-hoeren" class="exam-btn save">üìã Speichern</button>
        <button id="resultBtn-hoeren" class="exam-btn result">üìä Ergebnis</button>
        <button id="submitBtn-hoeren" class="exam-btn submit">üèÅ Abgabe</button>
        <button class="exam-btn next" id="nextBtn-hoeren">‚û°Ô∏è N√§chste Pr√ºfung</button>
      </div>
    </header>

    <div class="top-tiles" id="topTiles-hoeren" role="navigation" aria-label="Sections overview"></div>

    <div class="container-full">
      <main class="main-panel" id="mainPanel-hoeren">
        <div id="contentContainer-hoeren"></div>
      </main>
    </div>

    <footer class="controls">
      <div class="footer-buttons">
        <button id="prevBtn-hoeren" class="exam-btn ghost">Zur√ºck</button>
        <button id="nextBtn-hoeren" class="exam-btn ghost">Weiter</button>
      </div>
      <div class="status"><span id="statusText-hoeren">Nicht gespeichert</span></div>
    </footer>
  </div>

  <!-- Schreiben Page -->
  <div id="schreiben-page" class="exam-page" style="display: none;">
    <header class="topbar" role="banner">
      <div class="brand">
        <div class="logo">test</div>
        <div class="meta">
          <div class="main-title">Deutsch - B2 (√úbung)</div>
          <div class="sub-title">Schreiben ‚Äî Testbeispiel</div>
        </div>
      </div>

      <div id="timer-schreiben" class="timer" aria-live="polite">Verbleibende Zeit: 30:00</div>

      <div class="buttons-grid">
        <button id="resetBtn-schreiben" class="exam-btn reset">üîÑ Von neu beginnen</button>
        <button id="saveBtn-schreiben" class="exam-btn save">üìã Speichern</button>
        <button id="resultBtn-schreiben" class="exam-btn result">üìä Ergebnis</button>
        <button id="submitBtn-schreiben" class="exam-btn submit">üèÅ Abgabe</button>
        <button class="exam-btn next" id="nextBtn-schreiben">‚û°Ô∏è N√§chste Pr√ºfung</button>
      </div>
    </header>

    <div class="top-tiles" id="topTiles-schreiben" role="navigation" aria-label="Sections overview"></div>

    <div class="container-split">
      <main class="left-panel" id="leftPanel-schreiben">
        <div class="passage" id="passage-schreiben">
          <h2 id="passageTitle-schreiben">Aufgabe</h2>
          <div id="passageContent-schreiben"></div>
        </div>
      </main>

      <aside class="right-panel" id="rightPanel-schreiben">
        <div id="writingContainer-schreiben"></div>
      </aside>
    </div>

    <footer class="controls">
      <div class="footer-buttons">
        <button id="prevBtn-schreiben" class="exam-btn ghost">Zur√ºck</button>
        <button id="nextBtn-schreiben" class="exam-btn ghost">Weiter</button>
      </div>
      <div class="status"><span id="statusText-schreiben">Nicht gespeichert</span></div>
    </footer>
  </div>

  <!-- Ergebnisse Page -->
  <div id="ergebnisse-page" class="results-page" style="display: none;">
    <header class="results-header">
      <div class="results-logo">test</div>
      <div class="results-title">Gesamtergebnis ‚Äî Deutsch B2</div>
    </header>

    <div class="results-container">
      <div class="results-tiles" id="topTiles-ergebnisse"></div>
      <div id="details-ergebnisse"></div>
      <div class="summary" id="finalSummary-ergebnisse"></div>
      <div class="controls">
        <a class="button-like" href="#" id="backBtn-ergebnisse">
          <button class="results-btn">üîÅ Zur√ºck zur Startseite</button>
        </a>
        <button id="calcBtn-ergebnisse" class="results-btn">‚úÖ Ergebnisse anzeigen</button>
      </div>
      <div class="note">Hinweis: Schreiben (45 Punkte) wird manuell eingegeben, falls nicht automatisch vorhanden.</div>
    </div>
  </div>

  <script>
    // ===== ÿØŸàÿßŸÑ ŸÑÿ™ÿ≠ÿ≥ŸäŸÜ ÿ™ÿ¨ÿ±ÿ®ÿ© ÿßŸÑŸÑŸÖÿ≥ ŸÑŸÑŸáŸàÿßÿ™ŸÅ =====
    function setupTouchDragAndDrop() {
      if ('ontouchstart' in window) {
        console.log("Touch device detected, setting up touch interactions");
        
        let draggedElement = null;
        
        document.addEventListener('touchstart', function(e) {
          const target = e.target.closest('[draggable="true"]');
          if (target && !target.classList.contains('used')) {
            draggedElement = target;
            target.classList.add('dragging');
            e.preventDefault();
          }
        }, { passive: false });
        
        document.addEventListener('touchmove', function(e) {
          if (draggedElement) {
            e.preventDefault();
          }
        }, { passive: false });
        
        document.addEventListener('touchend', function(e) {
          if (draggedElement) {
            const dropTarget = document.elementFromPoint(
              e.changedTouches[0].clientX,
              e.changedTouches[0].clientY
            );
            
            if (dropTarget) {
              const slot = dropTarget.closest('.title-slot, .blank-slot');
              if (slot) {
                if (draggedElement.classList.contains('heading-item')) {
                  const headingId = draggedElement.dataset.headingId;
                  const textId = slot.dataset.textId;
                  if (headingId && textId) {
                    window.lesenApp.handleDrop(headingId, textId);
                  }
                } else if (draggedElement.classList.contains('situation-item')) {
                  const situationId = draggedElement.dataset.situationId;
                  const textId = slot.dataset.textId;
                  if (situationId && textId) {
                    window.lesenApp.handleDrop(situationId, textId);
                  }
                } else if (draggedElement.classList.contains('bank-word-vertical')) {
                  const word = draggedElement.dataset.word;
                  const blankId = slot.dataset.blankId;
                  if (word && blankId) {
                    window.lesenApp.selectSprachbausteine2FromBank(word, blankId);
                  }
                }
              }
            }
            
            draggedElement.classList.remove('dragging');
            draggedElement = null;
          }
        });
        
        // ÿ¨ÿπŸÑ ÿßŸÑÿπŸÜÿßÿµÿ± ÿßŸÑŸÇÿßÿ®ŸÑÿ© ŸÑŸÑÿ≥ÿ≠ÿ® ÿ£ŸÉÿ®ÿ± Ÿàÿ£ÿ≥ŸáŸÑ ŸÑŸÑŸÖÿ≥
        document.querySelectorAll('[draggable="true"]').forEach(el => {
          el.style.touchAction = 'none';
          el.style.userSelect = 'none';
          el.style.webkitUserSelect = 'none';
        });
      }
    }
    
    // ===== ŸÉÿßÿ¶ŸÜ ÿßŸÑÿ•ÿ¨ÿßÿ®ÿßÿ™ ÿßŸÑÿµÿ≠Ÿäÿ≠ÿ© =====
    const CORRECT_ANSWERS = {
      lesen: {
        // Leseverstehen Teil 1 (ÿßŸÑŸÜÿµŸàÿµ 1-5)
        "text1": "c",
        "text2": "h",
        "text3": "b",
        "text4": "e",
        "text5": "i",
        
        // Leseverstehen Teil 2 (ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ© s2q1-s2q5)
        "s2q1": "s2q1o1",
        "s2q2": "s2q2o2",
        "s2q3": "s2q3o1",
        "s2q4": "s2q4o3",
        "s2q5": "s2q5o1",
        
        // Leseverstehen Teil 3 (ÿßŸÑŸÖŸàÿßŸÇŸÅ 11-20)
        "11": "X",
        "12": "C",
        "13": "X",
        "14": "G",
        "15": "F",
        "16": "D",
        "17": "H",
        "18": "E",
        "19": "A",
        "20": "B",
        
        // Sprachbausteine Teil 1 (ÿßŸÑŸÅÿ±ÿßÿ∫ÿßÿ™ 21-30)
        "21": "√ºber",
        "22": "gar",
        "23": "besonders",
        "24": "schlie√ülich",
        "25": "entfernt",
        "26": "wechseln",
        "27": "gesagt",
        "28": "kommenden",
        "29": "je",
        "30": "w√§re",
        
        // Sprachbausteine Teil 2 (ÿßŸÑŸÅÿ±ÿßÿ∫ÿßÿ™ 31-40)
        "31": "GEH√ñREN",
        "32": "BLEIBT",
        "33": "MANCHER",
        "34": "ALS",
        "35": "FERTIG",
        "36": "WINK",
        "37": "MIT",
        "38": "TAKT",
        "39": "KLAR",
        "40": "WAS"
      },
      
      hoeren: {
        // H√∂ren Teil 1 (ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ© 41-45)
        "41": "falsch",
        "42": "falsch",
        "43": "falsch",
        "44": "richtig",
        "45": "richtig",
        
        // H√∂ren Teil 2 (ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ© 46-55)
        "46": "falsch",
        "47": "richtig",
        "48": "richtig",
        "49": "richtig",
        "50": "falsch",
        "51": "falsch",
        "52": "richtig",
        "53": "falsch",
        "54": "richtig",
        "55": "richtig",
        
        // H√∂ren Teil 3 (ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ© 56-60)
        "56": "richtig",
        "57": "falsch",
        "58": "falsch",
        "59": "falsch",
        "60": "richtig"
      }
    };

    // ===== ÿØŸàÿßŸÑ ŸÖÿ≥ÿßÿπÿØÿ© =====
    function getHeadingText(headingId) {
      if (!headingId || headingId === '-') return '-';
      const headings = {
        "a": "Neue Heuschreckenart in Frankreich entdeckt",
        "b": "Kleine Plagegeister k√∂nnen Krankheiten bringen",
        "c": "Landwirte wollen Gift gegen sch√§dliche Insekten einsetzen",
        "d": "Neue Mittel gegen M√ºcken",
        "e": "Neue Studie: Nicht nur Affen und Delfine erkennen sich selbst",
        "f": "Probleme beim Versuchsaufbau: Studie gescheitert",
        "g": "Rhein nach Chemieunfall noch immer tot",
        "h": "R√ºckblick: Fischsterben im Rhein",
        "i": "Um die Zukunft der Nordsee ist es schlecht bestellt",
        "j": "WWF zieht positive Bilanz f√ºr die Nordsee"
      };
      return headings[headingId] || headingId;
    }

    function getOptionText(questionId, optionId) {
      if (!optionId || optionId === '-') return '-';
      const options = {
        "s2q1o1": "belegt, dass die Mitarbeiter sich √ºber L√§rm im Gro√üraumb√ºro beklagen.",
        "s2q1o2": "brachte keine eindeutigen Ergebnisse zur Zufriedenheit mit unterschiedlichen B√ºroformen.",
        "s2q1o3": "zeigt, dass Mitarbeiter in Gro√üraumb√ºros seltener krank sind als andere.",
        "s2q2o1": "reduzieren den Krankenstand.",
        "s2q2o2": "sind kosteng√ºnstiger zu beheizen.",
        "s2q2o3": "werden immer seltener.",
        "s2q3o1": "bevorzugen Einzelb√ºros.",
        "s2q3o2": "genie√üen eine individuell ausgew√§hlte B√ºrom√∂blierung.",
        "s2q3o3": "leiden unter zu engen Einzelb√ºros.",
        "s2q4o1": "ist in Londoner Gro√üraumb√ºros f√ºr den Chef gr√∂√üer als f√ºr andere Mitarbeiter.",
        "s2q4o2": "schlie√üt die gemeinsam genutzten Fl√§chen aus.",
        "s2q4o3": "wird in London oft unter mehreren Mitarbeitern aufgeteilt.",
        "s2q5o1": "gibt es vor allem in Banken und Telekommunikationsunternehmen.",
        "s2q5o2": "werden bald in 40% der deutschen Firmen eingef√ºhrt.",
        "s2q5o3": "werden meist in Einzelzellen unterteilt."
      };
      return options[optionId] || optionId;
    }

    function getSituationText(id) {
      const situations = {
        "11": "Sie suchen ein Au-pair M√§dchen, das im Haushalt helfen und mit Ihren Kindern Englisch sprechen soll.",
        "12": "Ihre 14-j√§hrige Nichte m√∂chte sich √ºber einen Auslandsaufenthalt informieren.",
        "13": "Ihr Sohn m√∂chte als Koch im Ausland arbeiten. Er sucht nach einer passenden Stelle.",
        "14": "Eine franz√∂sische Bekannte ist √úbersetzerin und m√∂chte gelegentlich arbeiten.",
        "15": "Ihre kinderlose Nachbarsfamilie m√∂chte f√ºr einige Zeit einen jungen Menschen aufnehmen.",
        "16": "Sie sollen die neue Webseite Ihrer Firma ins Englische √ºbersetzen lassen.",
        "17": "Sie kochen gerne und suchen nach Rezepten aus anderen L√§ndern.",
        "18": "Im Herbst beginnt Ihre Tochter ein Studium, Sie m√∂chte ein Bankkonto er√∂ffnen.",
        "19": "Sie wollen Geld nach Kanada √ºberweisen, Sie m√∂chten wissen, wie viel Sie f√ºr die √úberweisung bezahlen m√ºssen.",
        "20": "Ein Freund aus Salzburg will sich in Frankreich bewerben. Er m√∂chte seine Zeugnisse √ºbersetzen lassen."
      };
      return situations[id] || id;
    }

    function getTextLetter(id) {
      const texts = {
        "A": "Infos zur Auslands√ºberweisung...",
        "B": "Franz√∂sische Muttersprachler bieten √úbersetzungen...",
        "C": "Als Austauschsch√ºler/in verbringst du einige Monate...",
        "D": "Als geb√ºrtige Engl√§nderin, mit einem Studienabschluss in Englisch...",
        "E": "Mit einem Konto bei der RUFA profitieren Sie...",
        "F": "Wir laden Sie dazu ein, internationale Sch√ºlerinnen und Sch√ºler...",
        "G": "Franz√∂sisch ist Ihre Muttersprache?...",
        "H": "Ein Tag im Zeichen der guten Nachbarschaft...",
        "I": "Konto-Neuheiten. Mit der neuen BaZa-App erledigen Sie...",
        "J": "Seit einigen Jahren bietet die Volkshochschule...",
        "K": "Spezialit√§ten aus der K√ºche. Viele klassische Gerichte...",
        "L": "Am Weltspartag zur Bank. Der Weltspartag wurde..."
      };
      return texts[id] || id;
    }

    function escapeHtml(s) {
      return String(s)
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#039;');
    }

    // ===== ÿØŸàÿßŸÑ ÿßŸÑÿπÿ±ÿ∂ ÿßŸÑŸÖÿ≠ÿ≥ŸÜÿ© =====
    function buildTable(title, dets, total, max) {
      let html = `<div class="result-item">
                    <h3>${title} - ${total.toFixed(2)}/${max} Punkte</h3>
                    <table class="true-false-table">
                      <thead>
                        <tr>
                          <th style="width: 10%">Frage</th>
                          <th style="width: 40%">Ihre Antwort</th>
                          <th style="width: 40%">Richtige Antwort</th>
                          <th style="width: 10%">Ergebnis</th>
                        </tr>
                      </thead>
                      <tbody>`;
      
      dets.forEach(x => {
        const isCorrect = x.richtig;
        const rowClass = isCorrect ? 'correct-answer' : 'incorrect-answer';
        const resultIcon = isCorrect ? '‚úÖ Richtig' : '‚ùå Falsch';
        
        html += `<tr class="${rowClass}">
                  <td><strong>${x.frage}</strong></td>
                  <td>${escapeHtml(x.user)}</td>
                  <td>${escapeHtml(x.correct)}</td>
                  <td><strong>${resultIcon}</strong></td>
                </tr>`;
      });
      
      html += `</tbody>
              </table>
              <div style="margin-top: 15px; padding: 15px; background: #e3f2fd; border-radius: 6px;">
                <strong>Erreichte Punkte: ${total.toFixed(2)}/${max} (${((total/max)*100).toFixed(1)}%)</strong>
              </div>
            </div>`;
      return html;
    }

    function renderLesenDetails(answers) {
      let html = `<div class="result-item">
                  <h3>üìñ Leseverstehen - Detaillierte Auswertung</h3>`;
      
      // Teil 1: √úberschriften zuordnen
      html += `<h4>Teil 1: √úberschriften zuordnen</h4>
               <table class="true-false-table">
                 <thead>
                   <tr>
                     <th>Text</th>
                     <th>Ihre Antwort</th>
                     <th>Richtige Antwort</th>
                     <th>Ergebnis</th>
                   </tr>
                 </thead>
                 <tbody>`;
      
      for (let i = 1; i <= 5; i++) {
        const id = `text${i}`;
        const userAnswer = answers[id] || '-';
        const correctAnswer = CORRECT_ANSWERS.lesen[id] || '-';
        const isCorrect = userAnswer === correctAnswer;
        const rowClass = isCorrect ? 'correct-answer' : 'incorrect-answer';
        const resultIcon = isCorrect ? '‚úÖ' : '‚ùå';
        
        html += `<tr class="${rowClass}">
                  <td><strong>Text ${i}</strong></td>
                  <td>${getHeadingText(userAnswer)}</td>
                  <td>${getHeadingText(correctAnswer)}</td>
                  <td><strong>${resultIcon}</strong></td>
                </tr>`;
      }
      
      html += `</tbody></table>`;
      
      // Teil 2: Fragen zum Text
      html += `<h4 style="margin-top: 20px;">Teil 2: Fragen zum Text</h4>
               <table class="true-false-table">
                 <thead>
                   <tr>
                     <th>Frage</th>
                     <th>Ihre Antwort</th>
                     <th>Richtige Antwort</th>
                     <th>Ergebnis</th>
                   </tr>
                 </thead>
                 <tbody>`;
      
      for (let i = 1; i <= 5; i++) {
        const id = `s2q${i}`;
        const userAnswer = answers[id] || '-';
        const correctAnswer = CORRECT_ANSWERS.lesen[id] || '-';
        const isCorrect = userAnswer === correctAnswer;
        const rowClass = isCorrect ? 'correct-answer' : 'incorrect-answer';
        const resultIcon = isCorrect ? '‚úÖ' : '‚ùå';
        
        html += `<tr class="${rowClass}">
                  <td><strong>Frage ${i}</strong></td>
                  <td>${getOptionText(id, userAnswer)}</td>
                  <td>${getOptionText(id, correctAnswer)}</td>
                  <td><strong>${resultIcon}</strong></td>
                </tr>`;
      }
      
      html += `</tbody></table>`;
      
      // Teil 3: Texte zuordnen
      html += `<h4 style="margin-top: 20px;">Teil 3: Texte zuordnen</h4>
               <table class="true-false-table">
                 <thead>
                   <tr>
                     <th>Situation</th>
                     <th>Ihre Antwort</th>
                     <th>Richtige Antwort</th>
                     <th>Ergebnis</th>
                   </tr>
                 </thead>
                 <tbody>`;
      
      for (let i = 11; i <= 20; i++) {
        const id = i.toString();
        const userAnswer = answers[id] || '-';
        const correctAnswer = CORRECT_ANSWERS.lesen[id] || '-';
        const isCorrect = userAnswer === correctAnswer;
        const rowClass = isCorrect ? 'correct-answer' : 'incorrect-answer';
        const resultIcon = isCorrect ? '‚úÖ' : '‚ùå';
        
        html += `<tr class="${rowClass}">
                  <td><strong>${id}. ${getSituationText(id)}</strong></td>
                  <td>${userAnswer === 'X' ? 'X - Kein passender Text' : userAnswer}</td>
                  <td>${correctAnswer === 'X' ? 'X - Kein passender Text' : correctAnswer}</td>
                  <td><strong>${resultIcon}</strong></td>
                </tr>`;
      }
      
      html += `</tbody></table>`;
      
      // Sprachbausteine Teil 1
      html += `<h4 style="margin-top: 20px;">Sprachbausteine Teil 1</h4>
               <table class="true-false-table">
                 <thead>
                   <tr>
                     <th>L√ºcke</th>
                     <th>Ihre Antwort</th>
                     <th>Richtige Antwort</th>
                     <th>Ergebnis</th>
                   </tr>
                 </thead>
                 <tbody>`;
      
      for (let i = 21; i <= 30; i++) {
        const id = i.toString();
        const userAnswer = answers[id] || '-';
        const correctAnswer = CORRECT_ANSWERS.lesen[id] || '-';
        const isCorrect = userAnswer === correctAnswer;
        const rowClass = isCorrect ? 'correct-answer' : 'incorrect-answer';
        const resultIcon = isCorrect ? '‚úÖ' : '‚ùå';
        
        html += `<tr class="${rowClass}">
                  <td><strong>${id}</strong></td>
                  <td>${userAnswer}</td>
                  <td>${correctAnswer}</td>
                  <td><strong>${resultIcon}</strong></td>
                </tr>`;
      }
      
      html += `</tbody></table>`;
      
      // Sprachbausteine Teil 2
      html += `<h4 style="margin-top: 20px;">Sprachbausteine Teil 2</h4>
               <table class="true-false-table">
                 <thead>
                   <tr>
                     <th>L√ºcke</th>
                     <th>Ihre Antwort</th>
                     <th>Richtige Antwort</th>
                     <th>Ergebnis</th>
                   </tr>
                 </thead>
                 <tbody>`;
      
      for (let i = 31; i <= 40; i++) {
        const id = i.toString();
        const userAnswer = answers[id] || '-';
        const correctAnswer = CORRECT_ANSWERS.lesen[id] || '-';
        const isCorrect = userAnswer === correctAnswer;
        const rowClass = isCorrect ? 'correct-answer' : 'incorrect-answer';
        const resultIcon = isCorrect ? '‚úÖ' : '‚ùå';
        
        html += `<tr class="${rowClass}">
                  <td><strong>${id}</strong></td>
                  <td>${userAnswer}</td>
                  <td>${correctAnswer}</td>
                  <td><strong>${resultIcon}</strong></td>
                </tr>`;
      }
      
      html += `</tbody></table></div>`;
      return html;
    }

    function buildHoerenDetails(answers) {
      let html = `<table class="true-false-table">
                    <thead>
                      <tr>
                        <th>Frage</th>
                        <th>Ihre Antwort</th>
                        <th>Richtige Antwort</th>
                        <th>Ergebnis</th>
                      </tr>
                    </thead>
                    <tbody>`;
      
      for (let i = 41; i <= 60; i++) {
        const id = i.toString();
        const userAnswer = answers[id] || '-';
        const correctAnswer = CORRECT_ANSWERS.hoeren[id] || '-';
        const isCorrect = userAnswer === correctAnswer;
        const rowClass = isCorrect ? 'correct-answer' : 'incorrect-answer';
        const resultIcon = isCorrect ? '‚úÖ' : '‚ùå';
        
        html += `<tr class="${rowClass}">
                  <td><strong>${id}</strong></td>
                  <td>${userAnswer}</td>
                  <td>${correctAnswer}</td>
                  <td><strong>${resultIcon}</strong></td>
                </tr>`;
      }
      
      html += `</tbody></table>`;
      return html;
    }

    // ===== PAGE NAVIGATION =====
    function showPage(pageId) {
      // Hide all pages
      document.getElementById('start-page').style.display = 'none';
      document.getElementById('lesen-page').style.display = 'none';
      document.getElementById('hoeren-page').style.display = 'none';
      document.getElementById('schreiben-page').style.display = 'none';
      document.getElementById('ergebnisse-page').style.display = 'none';
      
      // Change body class based on page
      document.getElementById('body').className = '';
      if (pageId === 'ergebnisse-page') {
        document.getElementById('body').className = 'results-body';
      } else if (pageId !== 'start-page') {
        document.getElementById('body').className = 'exam-body';
      }
      
      // Show selected page
      document.getElementById(pageId).style.display = 'block';
      
      // Initialize the page if needed
      if (pageId === 'lesen-page' && typeof initLesenPage === 'function') {
        initLesenPage();
      } else if (pageId === 'hoeren-page' && typeof initHoerenPage === 'function') {
        initHoerenPage();
      } else if (pageId === 'schreiben-page' && typeof initSchreibenPage === 'function') {
        initSchreibenPage();
      } else if (pageId === 'ergebnisse-page' && typeof initErgebnissePage === 'function') {
        initErgebnissePage();
      }
      
      // Setup touch interactions for mobile
      setTimeout(setupTouchDragAndDrop, 100);
    }

    // ===== START PAGE FUNCTIONALITY =====
    let initialCounter = 30;
    let counter = initialCounter;
    let countdownInterval;
    let countdownRunning = false;
    let examStarted = false;
    const timerEl = document.getElementById("countdown");
    const timeDisplayEl = document.getElementById("time-display");
    const progressEl = document.getElementById("progress");
    const selectEl = document.getElementById("sectionSelect");
    const startBtn = document.getElementById("startBtn");
    const cancelBtn = document.getElementById("cancelBtn");

    function startCountdown() {
      // prevent double-starts or starting after exam already began
      if (countdownRunning || examStarted) return;
      countdownRunning = true;
      // disable start button while counting
      try { startBtn.disabled = true; startBtn.setAttribute('aria-disabled','true'); } catch(e){}
      // reset counter & UI
      counter = initialCounter;
      timerEl.textContent = counter;
      timeDisplayEl.textContent = counter;
      progressEl.style.transform = "scaleX(0)";
      timerEl.style.color = "";

      countdownInterval = setInterval(() => {
        counter--;
        timerEl.textContent = counter;
        timeDisplayEl.textContent = counter;
        const progressValue = (initialCounter - counter) / initialCounter;
        progressEl.style.transform = `scaleX(${progressValue})`;
        if (counter <= 0) {
          clearInterval(countdownInterval);
          countdownInterval = null;
          countdownRunning = false;
          progressEl.style.transform = "scaleX(1)";
          // ensure exam starts only once
          if (!examStarted) {
            examStarted = true;
            startExam();
          }
          // safety: re-enable start button (page usually navigates away)
          try { startBtn.disabled = false; startBtn.removeAttribute('aria-disabled'); } catch(e){}
        }
      }, 1000);
    }

    function stopCountdown(reset = true) {
      if (countdownInterval) {
        clearInterval(countdownInterval);
        countdownInterval = null;
      }
      countdownRunning = false;
      try { startBtn.disabled = false; startBtn.removeAttribute('aria-disabled'); } catch(e){}
      progressEl.style.transform = "scaleX(0)";
      if (reset) {
        counter = initialCounter;
        timerEl.textContent = counter;
        timeDisplayEl.textContent = counter;
      } else {
        timerEl.textContent = "Gestoppt";
      }
    }

    function startExam() {
      // guard to ensure startExam is triggered once
      if (!examStarted) examStarted = true;
      const selectedSection = selectEl.value;
      if (selectedSection === 'lesen') {
        showPage('lesen-page');
      } else if (selectedSection === 'hoeren') {
        showPage('hoeren-page');
      } else if (selectedSection === 'schreiben') {
        showPage('schreiben-page');
      }
    }

    // wire buttons: start will now start the countdown (not the exam directly)
    startBtn.addEventListener('click', startCountdown);

    cancelBtn.addEventListener('click', () => {
      stopCountdown(true);
      timerEl.textContent = "Abgebrochen";
      timerEl.style.color = "#e53e3e";
    });

    // ===== LESEN PAGE FUNCTIONALITY =====
    function initLesenPage() {
      /* ===== Self-contained exam (embedded) ===== */
      const exam = {
        id: "exam-001",
        durationSec: 90 * 60,
        sections: [
          { 
            id: "s1", 
            title: "Leseverstehen, Teil 1", 
            points: 25,
            passageTitle: "Aufgabe: Ziehen Sie die passenden √úberschriften auf die Texte.",
            passage: "",
            questions: [],
            texts: [
              {
                id: "text1",
                content: "Die anhaltenden au√üergew√∂hnlich hohen Temperaturen haben im S√ºden Frankreichs eine Tierplage bisher unbekannten Ausma√ües ausgel√∂st. Bei den Plagegeistern handelt es sich um Unmengen von zwei bis dreieinhalb Zentimeter langen Heuschrecken, sogenannten Roten Schnarrschrecken. Die dunklen Insekten fressen Felder und Wiesen kahl und haben innerhalb von rund sechs Wochen die Landschaft in eine trostlose Steppe verwandelt. Die Landwirte der Region sind bereits verzweifelt, denn ihre gesamte Ernte hat sich buchst√§blich in Luft aufgel√∂st. Wenn man √ºber ein befallenes Feld geht, springt bei jedem Schritt ein Schnarrschreckenschwarm auf. Der Name dieser heimischen Tierart hat √ºbrigens einen ganz einfachen Ursprung: Die Heuschrecken machen ein lautes Ger√§usch beim Springen - sie schnarren also - und man sieht an ihnen leuchtend rote Hinterfl√ºgel. Daher also 'Rote Schnarrschrecke'. Manche Experten vermuten, die Heuschreckenplage werde durch einen drastischen Klimawandel ausgel√∂st. Die damit verbundene Aufheizung mache S√ºdeuropa immer 'afrikanischer'. Ein deutscher Wissenschaftsautor wies k√ºrzlich im Internet mehrfach darauf hin, dass es im Laufe der Erdgeschichte st√§ndig einen Wechsel von Warmzeiten und Kaltzeiten gegeben habe, der keineswegs abgeschlossen sei. Zeitweise habe das Gebiet von Europa nahe dem √Ñquator gelegen. Der Einsatz von Gift gegen die Heuschrecken ist sehr riskant. Denn dabei darf nur ein Mittel verwendet werden, das ausschlie√ülich f√ºr die Heuschrecken t√∂dlich ist, nicht aber f√ºr Bienen und andere Insekten. Auch das Vieh der Bauern darf nicht durch verseuchtes Futter gef√§hrdet werden. Die einzige gute Nachricht: f√ºr Menschen und andere Tiere sind die Heuschrecken v√∂llig ungef√§hrlich.",
                correctAnswer: "c"
              },
              {
                id: "text2", 
                content: "F√ºr immer wird eine der gr√∂√üten Umweltkatastrophen mit dem Namen des damals in Basel ans√§ssigen Chemiekonzerns Sandoz verbunden bleiben, der jetzt zu Novartis geh√∂rt. 1986 f√ºhrte ein Brand in einer Lagerhalle des Konzerns zu Verunreinigung des Rheins mit 20 Tonnen hochgiftiger Pestizide und Insektizide. Auf einer L√§nge von 450 Kilometern kam es zu einem gigantischen Fischsterben. Vor allem Aale waren betroffen. Trinkwasser konnte nicht mehr aus dem Fluss gewonnen werden. Der √∂ffentliche Druck, der als Reaktion auf die Umweltkatastrophe entstanden war, f√ºhrte zu gro√üen Investitionen f√ºr den Gew√§sserschutz. Im Rahmen des 'Aktionsprogramms Rhein' wurden rund 60 Milliarden Euro in den Ausbau von Kl√§ranlagen entlang des Rheinufters investiert. Viele Schwermetalle wie Kupfer, Cadmium, Blei und Quecksilber konnten reduziert und teilweise sogar ganz aus dem Rhein verbannt werden. Angesichts der getroffenen Ma√ünahmen spricht die Internationale Kommission zum Schutz des Rheins (IKSR) heute wieder von 'guter Wasserqualit√§t' des Rheins. 63 Fischarten sind wieder im Rhein vertreten, darunter auch Lachse. Die Aufgaben des Gew√§sserschutzes gehen aber noch weiter. Zink, Kupfer und Cadmium so wie Pestizide und Stickstoff bereiten weiterhin Sorgen. K√ºrzlich warnte das Verbraucherschutzministerium des Landes Nordrhein-Westfalen vor dem Verzehr von Rheinfischen unterhalb von Duisburg, weil Tenside durch die Nebenf√ºsse M√∂hne und Ruhr in den Rhein gelangt waren.",
                correctAnswer: "h"
              },
              {
                id: "text3",
                content: "Der Klimawandel bringt es in Verbindung mit der Globalisierung mit sich, dass auch in Deutschland Tiere heimisch werden, die hier zuvor nicht beobachtet wurden. Zu diesen Neuank√∂mmlingen geh√∂ren auch exotische Stechm√ºcken, beispielsweise der japanische Bushmosquito. Mit den exotischen Stechm√ºcken kommen auch neue Infektionserreger nach Deutschland, die m√∂glicherweise auch bisher unbekannte Krankheiten beim Menschen ausl√∂sen k√∂nnen. Eine Forschergruppe identifizierte jetzt einige bisher nur in Afrika und Asien vorkommende Erreger. Anfang 2011 wurde ein interdisziplin√§res Projekt ins Leben gerufen. Als ein erstes Ziel der Forschungsarbeit wird die Erstellung einer M√ºckenkarte f√ºr Deutschland angestrebt. 'Innerhalb weniger Jahre wollen wir einen √úberblick √ºber die Artenverteilung der M√ºcken haben und wissen was an Viren in ihnen steckt', so der Leiter des Bernhard-Nocht-Institut Professor Dr. Sven Klimpel. Das Bernhard-Nocht-Institut ist eine internationale anerkannte Forschungseinrichtung, die eine langj√§hrige Erfahrung in der Virendiagnostik in das Projekt einbringen kann. Es verf√ºgte √ºber Laboratorien der h√∂chsten Sicherheitsstufe, die erforderlich sind, um neue Viren mit unbekanntem Gef√§hrdungspotential zu untersuchen. Mit der neu entdeckten, aus Asien stammenden M√ºckenarten k√∂nnten in Deutschland bisher 48 Stechm√ºckenarten von den Entomologen nachgewiesen werden. Seit einigen Jahren breitete sich die Malaria-M√ºcke Anopheles plumbeus in S√ºdwestdeutschland aus. Auch die Asiatische Tigerm√ºcke, die unter anderem dagef√§hrliche Dengueieber verbreitet, schaffte es 2018 in die Schlagzeilen, weil sie am Rhein gefunden wurde.",
                correctAnswer: "b"
              },
              {
                id: "text4",
                content: "Forscher haben bei Versuchen im Bronx Zoo in New York eine neue Erkenntnis √ºber Elefanten erlangt: Sie k√∂nnen sich selbst im Spiegel erkennen. Zumindest eines von drei Versuchstieren versuchte, einen auf seinem Kopfe aufgemalten Fleck, der im Spiegelbild zu sehen war, zu entfernen. Bisher war unter anderem von Affen, Delfinen und Elstern ein √§hnliches Verhalten bekannt. Und auch bei diesen reagierte nicht immer alle Versuchstiere auf einen Spiegel. Es gab auch schon in der Vergangenheit solche Tests mit Elefanten, die aber auf keine Selbsterkenntnis schlie√üen lie√üen. Den Grund sieht ein Wissenschaftler im Versuchsaufbau: 'Das gro√üe Problem ist, einen Spiegel zu haben, der 'elefantenfest' ist.' Fr√ºhere Versuche h√§tten zu kleine und zu schwer zug√§ngliche Spiegeln verwendet. Die Elefanten aber wollten 'dagegen knallen, dahinter schauen, die Sache ausprobieren, bevor Sie verstehen, was vor sich geht'. Deshalb wurde diesmal mit ein 2,5 mal 2,5 Meter gro√üer Spiegel in einem Elefantengehege mit drei weiblichen asiatischen Elefanten montiert, der stabil genug f√ºr ausgiebige Untersuchungen durch die Tiere war. Bei √§hnlichen Tests mit Affen und Delfinen gibt es normalerweise vier Phasen der Erkenntnis im Spiegel: Zuerst der Versuch der Kommunikation mit dem vermeintlichen Artgenossen, dann eine physische Inspektion des Spiegels, ein Testen des Verhaltens des Spiegelbilds und schlie√ülich die Selbsterkenntnis. Die Elefanten √ºbersprangen die erste Phase und schauten in Phase zwei hinter den Spiegel und griffen auch mit dem R√ºssel dahinter. In Phase drei f√ºhrten sie verschiedene Bewegungen durch und verglichen sie mit denen des Spiegelbildes. Auch wenn sich dann nur eines der Tiere selbst erkannte, indem es den aufgemalten Fleck untersuchte und nach einiger Zeit dann auch das Interesse an dem Fleck verlor, sehen die Wissenschaftler das Ergebnis als eindeutigen Beweis f√ºr die F√§higkeit zur Selbsterkenntnis. Als N√§chstes wollen sie die F√§higkeiten von Elefanten auch in ihrer nat√ºrlichen Umgebung weiter erforschen.",
                correctAnswer: "e"
              },
              {
                id: "text5",
                content: "Heute und morgen tagt in G√∂teborg die Internationale Nordseekonferenz (INK), an der Regierungsvertreter der acht Nordsee-Anrainerstaaten teilnehmen. Der World Wide Fund For Nature (WWF) kritisierte in diesem Zusammenhang, dass dies das letzte Treffen dieser Art sei. K√ºnftig sollen Fragen der Nordsee auf europ√§ischer Ebene behandelt werden. Der WWF bef√ºrchtet, dass die Ber√ºcksichtigung √∂kologische Beilage der Nordsee k√ºnftig im europ√§ischen Rahmen vernachl√§ssigt werde: 'Es sieht nicht gut aus f√ºr die Nordsee'. So fasste WWF Meeressch√ºtzer Stefan Lutter diese Besorgnis in Worte. Der WWF ist der Ansicht, dass auf den Treffen der INK richtungsweisende Beschl√ºsse zum Nordseeschutz gefasst worden seien. Das Problem sei allerdings die Umsetzung dieser Beschl√ºsse in politisches Handeln in den Anrainerstaaten. Zu diesen Beschl√ºssen geh√∂rte beispielsweise das 2001 vereinbarte Abkommen zum Verbot giftiger Schiffsfarben sowie ein weiteres Abkommen, das die Verunreinigung der Nordsee durch von Schiffen abgelassenes Ballastwasser bek√§mpfen sollte. Diese Abkommen wurden erst zum Teil umgesetzt. Der WWF bef√ºrchtet nun, dass diese wichtigen INK- Initiativen unter den Tisch fallen k√∂nnten. Anl√§sslich des letzten Treffens der Anrainerstaaten erneuerte der WWF seine Kritik an der Fleischereipolitik. Das Ziel einer nachhaltigen Fischereipolitik stehe zwar auf der Tagesordnung der Konferenz, die allt√§gliche Praxis in der EU sei jedoch durch die 'Pl√ºnderung der Fischbest√§nde' gekennzeichnet. Die Kabeljaubest√§nde st√ºnden kurz vor dem Zusammenbruch, sagte der WWF-Fischereixperte. Ein notwendiger Fangstopp f√ºr diese Fischart sei jedoch nicht geplant. Ein weiteres ungel√∂stes Problem sei das Beifang-Problem. Der WWF-Sprecher brachte dazu folgendes Rechenbeispiel: Auf jedes Kilo Plattfisch, das auf den Tellern lande, gingen √ºber f√ºnf Kilo ungenutzter Beifang in die Netze der Fangflotten.",
                correctAnswer: "i"
              }
            ],
            headings: [
              {id: "a", text: "Neue Heuschreckenart in Frankreich entdeckt"},
              {id: "b", text: "Kleine Plagegeister k√∂nnen Krankheiten bringen"},
              {id: "c", text: "Landwirte wollen Gift gegen sch√§dliche Insekten einsetzen"},
              {id: "d", text: "Neue Mittel gegen M√ºcken"},
              {id: "e", text: "Neue Studie: Nicht nur Affen und Delfine erkennen sich selbst"},
              {id: "f", text: "Probleme beim Versuchsaufbau: Studie gescheitert"},
              {id: "g", text: "Rhein nach Chemieunfall noch immer tot"},
              {id: "h", text: "R√ºckblick: Fischsterben im Rhein"},
              {id: "i", text: "Um die Zukunft der Nordsee ist es schlecht bestellt"},
              {id: "j", text: "WWF zieht positive Bilanz f√ºr die Nordsee"}
            ]
          },
          { 
            id: "s2", 
            title: "Leseverstehen, Teil 2", 
            points: 25,
            passageTitle: "M√ºdigkeit und juckende Augen - Arbeit in Gro√üraumb√ºros",
            passage: `Die deutsche Sehnsucht nach dem Einzelb√ºro Dieser Artikel entsteht unter katastrophalen Bedingungen. Links vom Autor, keinen halben Meter entfernt, diskutieren die Onlineredakteure gerade √ºber portugiesische Bankgesch√§fte. Von rechts eilt nun der befreundete Kollege heran: "Sag mal, hast du eine Ahnung, ob das Bayern- Spiel heute Abend live im Fernsehen √ºbertragen wird?" Und da, die Chefin, ganz aufgeregt winkt sie her√ºber: "Wann wir denn die Geschichte endlich fertig? Die h√§tte vor einer halben Stunde ins Korrektorat gemusst. Beeil dich bitte!" Was wir Arbeitenden im Gro√üraumb√ºro immer schon ahaten, haben Schweizer Forscher nun erstmals auf breiter wissenschaftlicher Basis nachgewiesen: Gro√üraum ist schlecht. Zumindest f√ºr diejenigen, die im Gro√üraum arbeiten m√ºssen. Mag sein, dass die Chefs in ihren Einzelb√ºros da anderer Meinung sind. Gut 1200 Besch√§ftigte aus unterschiedlichsten Berufen hat die Hochschule in Luzern befragt. Die Ergebnisse der Erhebung sind eindeutig. Beispiel L√§rm: In B√ºros mit mehr als 16 Mitarbeitern f√ºhlen sich 80% der Befragten regelm√§√üig durch Gespr√§che oder Telefonate gest√∂rt in Zweierb√ºros sind es nicht mal 30%. Auch was die allt√§glichen B√ºro Probleme betrifft, ist der Gro√üraum von Nachteil. Einerlei, wonach die Forscher nun fragten, ob nach M√ºdigkeit, Schweregef√ºhl im Kopf, juckende Augen oder verstopfte Nase immer litten Mitarbeiter im Gro√üraumb√ºro am st√§rksten. Wundert da, dass vier von zehn Gro√üraumbesch√§ftigten mit ihrer B√ºrosituation im Allgemeinen" sehr oder gar au√üerordentlich unzufrieden sind? Zum Vergleich: Acht von zehn Arbeitnehmern mit Einzelb√ºro geben an, sie seien ziemlich, sehr oder fast 50% au√üerordentlich zufrieden." Einzelb√ºros f√ºr alle m√ºsste die L√∂sung lauten, doch der Trend geht in die andere Richtung: Offene Raumstrukturen nehmen zu. Kritiker dieser Entwicklung sehen dahinter vor allem einen Grund: Arbeitgeber wollen die Mieten und Heizkosten niedrig halten. Aber zumindest ein Argument d√ºrfte auch die Arbeitgeber interessieren: Der Schweizer Studie zufolge ist die Zahl der Krankheitstage bei Besch√§ftigten in Gro√üraumb√ºros deutlich h√∂her als bei anderen. deutsche Sehnsucht nach dem Einzelb√ºro Mein Schreibtisch. Mein Computer. Mein B√ºro. Das Einzelzimmer war fester Bestandteil der deutschen B√ºrokultur. Aber auch heute haben es noch viele und wer keines hat, tr√§umt zumindest davon. Diese Sehnsucht ist typisch deutsch. "Verglichen mit den Besch√§ftigten in anderen L√§ndern, sitzen wir sehr bequem. Auch wenn alle Mitarbeiter die gleiche M√∂blierung haben, sitzen wir alle doch an unseren eigenen Schreibtischen, benutzen unsere eigenen Aktienschr√§nke und m√∂chten am liebsten die T√ºr zumachen k√∂nnen", sagt Robert Menke von der Immobilienberatung Kuschmann & Wakefield. Die hat eine Studie ver√∂ffentlicht, wonach deutsche Angestellte im internationalen Vergleich den meisten Platz haben: durchschnittlich 30 Quadratmeter Mietfl√§che per Kopf. Damit ist nat√ºrlich nicht nur das Schreibtisch-Areal gemeint, auch der Flur oder K√ºchenzeilen sindfalls vorhanden - eingerechnet. Doch umso erstaunlicher sind die Quadratmeterzahlen am anderen Ende der Statistik: In einigen osteurop√§ischen L√§ndern, aber auch in Schottland kommt jeder Besch√§ftigte gerade mal auf 10 Quadratmeter, selbst in √ñsterreich sind es nur zw√∂lf. Im angels√§chsischen Raum gibt es viel mehr Gro√ü√üraumb√ºros als bei uns. In London, wo Baroraum weltweit mit am tewersten ist, ist etwa eine Zusammenarbeit auf eine Fl√§che von 600 Quadratmetern und mehr ganz normal, normal "H√§ufig teilen sich sogar mehrere Mitarbeiter einen Arbeitsplatz. Statt eines festen Schreibtisches verf√ºgt dann jeder √ºber einen Rollcontainer. Der wird immer dorthin mitgenommen, wo gerade ein Arbeitsplatz frei ist. Das geht in der Regel √ºber alle Hierarchiestufen", sagt Menke. Robert Menke erkennt auch in Deutschland "in einigen Bereichen eine Amerikanisierung des B√ºroraumes". Banken und Unternehmer im Telekommunikationssektor w√§ren da varne dabei. Doch das sind noch Ausnahmen. Nach wie vur arbeiten die meisten Angestellten entweder in kleinen Gruppen in etwas gr√∂√üeren B√ºros oder in "Einzelzellen" wie B√ºros f√ºr eine Person in der Sprache der Immobilienmakler hei√üen. Laut der Studie √ºberlegen zwar 40% der befragten Unternehmer, ihre Gro√üraumfl√§chen zu erweitern oder die Arbeitspl√§tze flexibel zu gestalten, aber "richtige Grof√üraumb√ºros gibt es eher selten", sagt Menke.`,
            questions: [
              {
                id: "s2q1",
                type: "single",
                text: "Eine Studie aus der Schweiz..",
                options: [
                  {id: "s2q1o1", text: "belegt, dass die Mitarbeiter sich √ºber L√§rm im Gro√üraumb√ºro beklagen."},
                  {id: "s2q1o2", text: "brachte keine eindeutigen Ergebnisse zur Zufriedenheit mit unterschiedlichen B√ºroformen."},
                  {id: "s2q1o3", text: "zeigt, dass Mitarbeiter in Gro√üraumb√ºros seltener krank sind als andere."}
                ],
                correctAnswer: "s2q1o1"
              },
              {
                id: "s2q2",
                type: "single", 
                text: "Gro√üraumb√ºros‚Ä¶",
                options: [
                  {id: "s2q2o1", text: "reduzieren den Krankenstand."},
                  {id: "s2q2o2", text: "sind kosteng√ºnstiger zu beheizen."},
                  {id: "s2q2o3", text: "werden immer seltener."}
                ],
                correctAnswer: "s2q2o2"
              },
              {
                id: "s2q3",
                type: "single",
                text: "Die deutschen Angestellten‚Ä¶",
                options: [
                  {id: "s2q3o1", text: "bevorzugen Einzelb√ºros."},
                  {id: "s2q3o2", text: "genie√üen eine individuell ausgew√§hlte B√ºrom√∂blierung."},
                  {id: "s2q3o3", text: "leiden unter zu engen Einzelb√ºros."}
                ],
                correctAnswer: "s2q3o1"
              },
              {
                id: "s2q4",
                type: "single",
                text: "Die Arbeitsplatzfl√§che‚Ä¶",
                options: [
                  {id: "s2q4o1", text: "ist in Londoner Gro√üraumb√ºros f√ºr den Chef gr√∂√üer als f√ºr andere Mitarbeiter."},
                  {id: "s2q4o2", text: "schlie√üt die gemeinsam genutzten Fl√§chen aus."},
                  {id: "s2q4o3", text: "wird in London oft unter mehreren Mitarbeitern aufgeteilt."}
                ],
                correctAnswer: "s2q4o1"
              },
              {
                id: "s2q5", 
                type: "single",
                text: "Gro√üraumb√ºros‚Ä¶",
                options: [
                  {id: "s2q5o1", text: "gibt es vor allem in Banken und Telekommunikationsunternehmen."},
                  {id: "s2q5o2", text: "werden bald in 40% der deutschen Firmen eingef√ºhrt."},
                  {id: "s2q5o3", text: "werden meist in Einzelzellen unterteilt."}
                ],
                correctAnswer: "s2q5o1"
              }
            ]
          },
          { 
            id: "s3", 
            title: "Leseverstehen, Teil 3", 
            points: 25,
            passageTitle:"Aufgabe: Lesen Sie die zehn Situationen (11-20) und die zw√∂lf Texte (A-L). Welcher Text passt zu welcher Situation? Sie k√∂nnen jeden Text nur einmal verwenden. Manchmal passt kein Text. W√§hlen Sie dann 'x'.",
            passage: "",
            questions:[],
            texts: [
              {id: "A", text: "Infos zur Auslands√ºberweisung Bitte verwenden Sie die Funktion Auslands√ºberweisung f√ºr Zahlungen in L√§nder, die nicht zum SEPA-Zahlungsraum geh√∂ren. Zum SEPA-Zahlungsraum geh√∂ren die Mitgliedsstaaten der Europ√§ischen Union sowie die L√§nder Island, Norwegen, Liechtenstein, die Schweiz und Monaco. In diesem Raum gilt die Inlands√ºberweisung. B√ºrgerinnen und B√ºrger k√∂nnen damit g√ºnstiger √ºberweisen. F√ºr alle anderen L√§nder gilt die Auslands√ºberweisung. Bitte beachten Sie, dass bei Auslands√ºberweisungen in der Regel Spesen zu zahlen sind. F√ºr n√§here Ausk√ºnfte √ºber deren H√∂he wenden Sie sich bitte direkt an die Kundenbetreuung.", correctAnswer: "14"},
              {id: "B", text: "Franz√∂sische Muttersprachler bieten √úbersetzungen Deutsch-Franz√∂sisch und Englisch-Franz√∂sisch von Schulzeugnissen, Lebensl√§ufen, Bewerbungen (Anschreiben & Motivationsschreiben), Arbeitszeugnissen usw., Arbeitsvertr√§gen, Versicherungsvertr√§gen. Auf Wunsch erstellen wir Ihre Jobanzeigen f√ºr den franz√∂sischsprachigen Raum, angepasst an die jeweils landes√ºbliche Anzeigengestaltung. Einwandfreie Qualit√§t; schnell, garantiert termingerecht und zu einem fairen Preis. Kostenvoranschlag innerhalb von zwei Tagen. Standort Wien. Lieferungen innerhalb der EU. Nutzen Sie zur Kontaktaufnahme bitte das Online-Formular am Ende dieser Seite.", correctAnswer: "19"},
              {id: "C", text: "Als Austauschsch√ºler/in verbringst du einige Monate oder ein ganzes Jahr im Ausland. Du kannst ein Land in Europa w√§hlen, aber auch L√§nder auf einem anderen Kontinent, wie zum Beispiel Amerika oder Australien. In dem Land deiner Wahl wohnst du bei einer Gastfamilie. Du besuchst die regul√§re Schule, gemeinsam mit Sch√ºlerinnen und Sch√ºlern aus dem Gastland. So lernst du die Lebensweise und die Traditionen anderer Menschen kennen. Nat√ºrlich lernst du auch die Sprache deines Gastlandes. Wir bieten Informationsveranstaltungen in allen Bundesl√§ndern an. Dort beantworten wir alle deine Fragen. Schau doch einfach bei uns vorbei! Wir freuen uns auf dich!", correctAnswer: "13"},
              {id: "D", text: "Als geb√ºrtige Engl√§nderin, mit einem Studienabschluss in Englisch, lebe ich seit vielen Jahren in √ñsterreich. Ich biete √úbersetzungen vom Deutschen ins Englische an: Lebensl√§ufe, Ausbildungsunterlagen, Pr√§sentationen, Websites, Produktbeschreibungen, Firmenflyer usw. Ich habe 20 Jahre Erfahrung mit √úbersetzungen. Zu meinen zufriedenen Kunden z√§hlen namhafte Unternehmen aus dem In- und Ausland. Auf Wunsch schicke ich Ihnen gerne eine Liste mit Referenzen zu. Wenn es einmal besonders schnell gehen muss, √ºbernehme ich Expressarbeiten auch an Wochenenden. Effizient und zu einem angemessenen Preis. susan@language.at www.susanlanguage.at", correctAnswer: "20"},
              {id: "E", text: "Mit einem Konto bei der RUFA profitieren Sie von attraktiven Angeboten und von pers√∂nlicher Beratung. Wir haben das passende Konto f√ºr Sie ‚Äì vom Girokonto bis zum Gratiskonto f√ºr Jugendliche. Jetzt aktuell: GRATIS Studentenkonto. Ihnen steht ein pers√∂nlicher Berater zur Seite, wenn Sie Auskunft oder Hilfe brauchen. Zus√§tzlich bietet Ihnen das Konto einige Vorteile, z. B. eine gratis Unfallversicherung bis 24 Jahre. Mit Ihrer RUFA-Clubkarte bekommen Sie au√üerdem Erm√§√üigungen in ausgew√§hlten Shops und bei bestimmten Veranstaltungen.", correctAnswer: "18"},
              {id: "F", text: "Wir laden Sie dazu ein, internationale Sch√ºlerinnen und Sch√ºler bei Ihnen zu Hause aufzunehmen. Dabei bieten Sie einem jungen Menschen mehr als nur einen Platz zum Schlafen und etwas zu essen, Sie helfen ihm, sich in einer fremden Umgebung zurechtzufinden, andere Sitten und Gebr√§uche und eine fremde Sprache kennenzulernen. Eine Gastsch√ºlerin oder einen Gastsch√ºler aufzunehmen ist eine wunderbare M√∂glichkeit, selbst eine andere Kultur kennenzulernen und gleichzeitig die eigene Kultur zu teilen. Im Alltag k√∂nnen Sie gemeinsam kulturelle Unterschiede entdecken und sch√§tzen lernen. Egal ob Sie selbst Kinder haben, allein oder in einem klassischen Familienhaushold leben: Wir freuen uns auf Ihre Bewerbung!", correctAnswer: "15"},
              {id: "G", text: "Franz√∂sisch ist Ihre Muttersprache? Wir suchen eine freie Mitarbeiterin oder einen Mitarbeiter f√ºr √úbersetzungen vom Deutschen ins Franz√∂sische. Sie arbeiten fallweise und von zuhause aus (keine feste Anstellung). Ihr Aufgabenbereich: √úbersetzung von einfachen kurzen Texten (Anfragen, Beantwortung von Anfragen, Reaktion auf Beschwerden usw.). Wenn n√∂tig f√ºhren Sie auch kurze Telefonate mit franz√∂sischen Kundinnen oder Kunden. Sie werden von uns eingearbeitet. Sie lernen unsere Produkte und das Fachvokabular anhand zweisprachiger Unterlagen kennen. Bei Fragen stehen Ihnen unsere Mitarbeiter gerne zur Verf√ºgung. Interessiert? Wir h√∂ren auf Ihre Online-Bewerbung.", correctAnswer: "14"},
              {id: "H", text: "Ein Tag im Zeichen der guten Nachbarschaft. Im Rahmen des europ√§ischen Nachbarschaftstages wurde auch heuer wieder in unserem Bezirk zu gemeinsamem Kochen und Genie√üen eingeladen. Solche Veranstaltungen dienen dazu, andere Menschen und Kulturen besser kennenzulernen. Wie auch in den vergangenen Jahren wurde das Fest wieder sehr gut aufgenommen. Die Veranstalter erhielten begeisterte Mails. Da viele Leute die zahlreichen Spezialit√§ten aus aller Welt nachkochen m√∂chten, finden Sie hier unser Online-Kochbuch.", correctAnswer: "17"},
              {id: "I", text: "Konto-Neuheiten. Mit der neuen BaZa-App erledigen Sie Ihre Bankgesch√§fte, wann und wo Sie wollen. F√ºr die schnelle √úberweisung unterwegs, mit ein paar Klicks: Geben Sie einfach den Namen Ihres Baza-Kontaktes an, alles andere erledigt die App f√ºr Sie. Oder per Smartphone-Kamera: Sie fotografieren einen Zahlschein, und die App erfasst die Daten automatisch. Mit der App k√∂nnen Sie auch direkt mit Ihrer Kundenbetreuerin oder Ihrem Kundenbetreuer Kontakt aufnehmen, eine Nachricht schicken, einen Termin vereinbaren oder um einen R√ºckruf bitten. F√ºr alle, die schon ein Baza-Konto haben: jetzt die neue App herunterladen. Zum Download.", correctAnswer: "16"},
              {id: "J", text: "Seit einigen Jahren bietet die Volkshochschule Laiendolmetscherinnen und Laiendolmetscher an, die fremdsprachigen Eltern den Kontakt mit der Schule erleichtern sollen. Das Angebot soll dazu beitragen, die Beziehungen zwischen Eltern, Lehrerinnen und Lehrern sowie der Schulleitung zu verbessern. Das Ziel ist ein besseres Miteinander und mehr Verst√§ndnis f√ºreinander. Die Laiendolmetscher werden von der VHS auf ihre Aufgabe vorbereitet. Momentan bietet die VHS Laiendolmetscher in den Sprachen Albanisch, Bosnisch, Kroatisch, Serbisch, Slowakisch, Rum√§nisch, T√ºrkisch, Spanisch, Italienisch und Franz√∂sisch an. In Zukunft soll das Angebot um weitere Sprachen erweitert werden.", correctAnswer: null},
              {id: "K", text: "Spezialit√§ten aus der K√ºche. Viele klassische Gerichte, die in √ñsterreich auf den Tisch kommen, stammen aus den ehemaligen Kronl√§ndern der Monarchie: das Schnitzel aus Italien, die Palatschinken aus Ungarn, Golatschen und Kn√∂del aus dem heutigen Tschechien. Dazu kommen zahlreiche regionale Spezialit√§ten wie Kasnudeln aus K√§rnten, Steirisches Wurzelfleisch oder Salzburger Nockerl. Dies und vieles mehr k√∂nnen Sie bei einem unserer Kochkurse kennenlernen. Besonders willkommen sind Menschen, die aus anderen L√§ndern zu uns gekommen sind. Die Liste der Veranstaltungen finden Sie weiter unten.", correctAnswer: "11"},
              {id: "L", text: "Am Weltspartag zur Bank. Der Weltspartag wurde am 1. Internationalen Sparkassenkongress in Mailand im Oktober 1924 ins Leben gerufen, um die Bev√∂lkerung zum Sparen zu bringen. Offiziell wird der Weltspartag am 31. Oktober gefeiert, in √ñsterreich manchmal auch am letzten Werktag vor dem 31. Oktober. Denn an diesem speziellen Tag sollen die Banken f√ºr Kunden ge√∂ffnet haben. Besonders bei Kindern ist der Weltspartag sehr beliebt. Sie erhalten n√§mlich kleine Geschenke, wenn sie an diesem Tag mit ihrem Sparschwein zur Bank kommen. Aber auch f√ºr Erwachsene gibt es am Weltspartag oft besondere Angebote.", correctAnswer: "12"}
            ],
            situations: [
              {id: "11", text: "Sie suchen ein Au-pair M√§dchen, das im Haushalt helfen und mit Ihren Kindern Englisch sprechen soll."},
              {id: "12", text: "Ihre 14-j√§hrige Nichte m√∂chte sich √ºber einen Auslandsaufenthalt informieren."},
              {id: "13", text: "Ihr Sohn m√∂chte als Koch im Ausland arbeiten. Er sucht nach einer passenden Stelle."},
              {id: "14", text: "Eine franz√∂sische Bekannte ist √úbersetzerin und m√∂chte gelegentlich arbeiten."},
              {id: "15", text: "Ihre kinderlose Nachbarsfamilie m√∂chte f√ºr einige Zeit einen jungen Menschen aufnehmen."},
              {id: "16", text: "Sie sollen die neue Webseite Ihrer Firma ins Englische √ºbersetzen lassen."},
              {id: "17", text: "Sie kochen gerne und suchen nach Rezepten aus anderen L√§ndern."},
              {id: "18", text: "Im Herbst beginnt Ihre Tochter ein Studium, Sie m√∂chte ein Bankkonto er√∂ffnen."},
              {id: "19", text: "Sie wollen Geld nach Kanada √ºberweisen, Sie m√∂chten wissen, wie viel Sie f√ºr die √úberweisung bezahlen m√ºssen."},
              {id: "20", text: "Ein Freund aus Salzburg will sich in Frankreich bewerben. Er m√∂chte seine Zeugnisse √ºbersetzen lassen."}
            ]
          },
          { 
            id: "s4", 
            title: "Sprachbausteine, Teil 1", 
            points: 15,
            passageTitle:"Aufgabe: Erg√§nzen Sie den Text. W√§hlen Sie f√ºr jede L√ºcke das passende Wort.",
            passage: "",
            questions:[],
            fillBlanks: [
              {
                id: "21",
                options: ["an", "f√ºr", "√ºber"],
                correctAnswer: "√ºber"
              },
              {
                id: "22",
                options: ["daher", "gar", "sicher"],
                correctAnswer: "gar"
              },
              {
                id: "23",
                options: ["besonders", "einfach", "kaum"],
                correctAnswer: "besonders"
              },
              {
                id: "24",
                options: ["allerdings", "au√üerdem", "schlie√ülich"],
                correctAnswer: "schlie√ülich"
              },
              {
                id: "25",
                options: ["abger√ºckt", "entfernt", "weggezogen"],
                correctAnswer: "entfernt"
              },
              {
                id: "26",
                options: ["√§ndern", "verwechseln", "wechseln"],
                correctAnswer: "wechseln"
              },
              {
                id: "27",
                options: ["gesagt", "sagend", "zu sagen"],
                correctAnswer: "gesagt"
              },
              {
                id: "28",
                options: ["kommende", "kommendem", "kommenden"],
                correctAnswer: "kommenden"
              },
              {
                id: "29",
                options: ["als", "je", "weil"],
                correctAnswer: "je"
              },
              {
                id: "30",
                options: ["ist", "war", "w√§re"],
                correctAnswer: "w√§re"
              }
            ],
            fillText: `Lieber Justus,

vielen Dank f√ºr deine Urlaubskarte, ________ die ich mich wirklich sehr gefreut habe! Ich wusste ________ nicht, dass ihr gerne wandern geht. Oder habt ihr das jetzt zum ersten Mal gemacht?

Als Kind war ich mit meinen Eltern mal wandern, aber mir hat das damals nicht ________ gefallen. Ich war auch noch klein und hatte keine Lust, so lange zu laufen.

Heute fahre ich lieber an den Strand und mache einen sch√∂nen Badeurlaub. Den ganzen Tag lesen, in der Sonne liegen, ab und zu mal ins Wasser gehen ________ habe ich schon im Alltag genug Stress.

Dabei f√§llt mir ein: Wie ist eigentlich deine neue Stelle? Du arbeitest doch jetzt in dieser internationalen Baufirma, oder? Bist du jetzt schneller im B√ºro als fr√ºher oder ist die Firma sogai noch weiter ________ als deine alte? Du musstest ja immer ziemlich lich lange fahren, fahr daran

erinnere ich mich noch gut!

Ich denke im Moment auch dar√ºber nach, die Stelle zu________ Mein Chef und meine Kollegen sind zwar total nett und die Bezahlung ist auch gut, aber ich mache fast jeden Tag das Gleiche - und das jetzt schon seit √ºber zehn Jahren. Ehrlich ________ langweile ich mich in den letzten Monaten immer h√§ufiger und w√ºrde gerne noch mal etwas Neues ausprobieren. Deshalb mache ich ab dem ________ Monat erst mal eine Weiterbildung, sonst h√§tte ich wohl nicht so gute Chancen, eine neue Stelle zu bekommen. Schlie√ülich wird es auch immer schwieriger, -________ √§lter man ist. Die meisten Arbeitgeber wollen doch lieber j√ºngere Angestellte.

Wie ________ es, wenn wir uns demn√§chst treffen w√ºrden? Wir k√∂nnten in diesem neuen Restaurant in der Innenstadt essen gehen. Melde dich doch einfach mal wieder!

Viele Gr√º√üe

Richard`
          },
          { 
            id: "s5", 
            title: "Sprachbausteine, Teil 2", 
            points: 15,
            passageTitle:"Aufgabe: Lesen Sie den Text und entscheiden Sie, welches Wort in welche L√ºcke passt. Sie k√∂nnen jedes Wort nur einmal verwenden. Nicht alle W√∂rter passen in den Text.",
            passage: "",
            questions:[],
            fillBlanks2: [
              {
                id: "31",
                options: ["ALS", "BEH√ÑLT", "DAGEGEN","BLEIBT", "FERTIG", "WINK", "GEH√ñREN", "JEDER", "MANCHER", "KLAR", "TAKT", "MIT", "TIPP", "WAS"],
                correctAnswer: "GEH√ñREN"
              },
              {
                id: "32", 
                options: ["ALS", "BEH√ÑLT", "DAGEGEN","BLEIBT", "FERTIG", "WINK", "GEH√ñREN", "JEDER", "MANCHER", "KLAR", "TAKT", "MIT", "TIPP", "WAS"],
                correctAnswer: "BLEIBT"
              },
              {
                id: "33",
                options: ["ALS", "BEH√ÑLT", "DAGEGEN","BLEIBT", "FERTIG", "WINK", "GEH√ñREN", "JEDER", "MANCHER", "KLAR", "TAKT", "MIT", "TIPP", "WAS"],
                correctAnswer: "MANCHER"
              },
              {
                id: "34",
                options: ["ALS", "BEH√ÑLT", "DAGEGEN","BLEIBT", "FERTIG", "WINK", "GEH√ñREN", "JEDER", "MANCHER", "KLAR", "TAKT", "MIT", "TIPP", "WAS"],
                correctAnswer: "ALS"
              },
              {
                id: "35",
                options: ["ALS", "BEH√ÑLT", "DAGEGEN","BLEIBT", "FERTIG", "WINK", "GEH√ñREN", "JEDER", "MANCHER", "KLAR", "TAKT", "MIT", "TIPP", "WAS"],
                correctAnswer: "FERTIG"
              },
              {
                id: "36",
                options: ["ALS", "BEH√ÑLT", "DAGEGEN","BLEIBT", "FERTIG", "WINK", "GEH√ñREN", "JEDER", "MANCHER", "KLAR", "TAKT", "MIT", "TIPP", "WAS"],
                correctAnswer: "WINK"
              },
              {
                id: "37",
                options: ["ALS", "BEH√ÑLT", "DAGEGEN","BLEIBT", "FERTig", "WINK", "GEH√ñREN", "JEDER", "MANCHER", "KLAR", "TAKT", "MIT", "TIPP", "WAS"],
                correctAnswer: "MIT"
              },
              {
                id: "38",
                options: ["ALS", "BEH√ÑLT", "DAGEGEN","BLEIBT", "FERTIG", "WINK", "GEH√ñREN", "JEDER", "MANCHER", "KLAR", "TAKT", "MIT", "TIPP", "WAS"],
                correctAnswer: "TAKT"
              },
              {
                id: "39",
                options: ["ALS", "BEH√ÑLT", "DAGEGEN","BLEIBT", "FERTIG", "WINK", "GEH√ñREN", "JEDER", "MANCHER", "KLAR", "TAKT", "MIT", "TIPP", "WAS"],
                correctAnswer: "KLAR"
              },
              {
                id: "40",
                options: ["ALS", "BEH√ÑLT", "DAGEGEN","BLEIBT", "FERTIG", "WINK", "GEH√ñREN", "JEDER", "MANCHER", "KLAR", "TAKT", "MIT", "TIPP", "WAS"],
                correctAnswer: "WAS"
              }
            ],
            fillText2: `Im Restaurant

Eine unterhaltsame, sch√∂ne und gesellige Zeit. Das stellt man sich unter einem guten Essen vor. St√∂rend wirkt da der anschauliche Erlebnisbericht der letzten Operation im Krankenhaus oder das Klingeln des Handys. Sowohl Gastgeber als Gast sollen alles daf√ºr tun, dass das gemeinsame Essen Freude macht. Das Handy stellt man selbstverst√§ndlich ab. Das Essen beginnt, wenn der Gastgeber zur Serviette greift oder zum Gru√ü sein Glas erhebt. Besonders bei Kindern ein unbeliebtes Thema: die richtige K√∂rperhaltung beim Essen. Die Arme ________ nicht auf den Tisch und die H√§nde nicht unter den Tisch. Mal sitzt gerade, ohne unruhig hin und her zu ricken. Die Beine werden nebeneinander gestellt, nicht √ºbereinander gelegt. Die Schuhe ________ in jedem Fall an. Nur keine Angst vor guten Restaurants mit ihrem Luxus! Denn je besser die K√ºche, umso aufmerksamer ist in der Regel das Personal. Doch schon bei der Anrede der Bedienung steht so ________ vor einem Problem. Die Bedienung ________ 'Fr√§ulein' an den Tisch zu rufen, ist in Zeiten dert Gleichberechtigung veraltet. 'Herr Ober' oder 'Bedienung' ist ________ noch m√∂glich, aber auch schon etwas ungew√∂hnlich. Am besten versucht man sich Blickkontakt zu verschaffen, um mit einem kleinen ________ mit der Hand den Kellner an den Tisch zu bitten. Zudem gibt es zwischen Gast und Service eine Zeichensprache. Schlie√üt der Gast die Speisekarte und legt sie auf den Tisch, ist dies f√ºr den Kellner dasSignal, die Bestellung aufzunehmen. Ist man mit dem Essen ________, legt man das Besteck parallel nebeneinander auf den rechten Tellerrand. Der Kellner wir dann abr√§umen. Macht man hingegen nur eine Pause, wird es gekreuzt oder offen auf den Teller gelegt. Beim Bezahlen ist ________ gefragt. √úbernimmt ein Gastgeber die Kosten, macht er dies dem Kellner ________. Ein 'Bringen Sie mir bitte die Rechnung' reicht da v√∂llig aus. M√∂chte man hingegen getrennt bezahlen, ________ durchaus √ºblich ist, teilt man dies ebenfalls rechtzeitig der Bedienung mit. In Deutschland gibt man, je nach Zufriedenheit mit dem Service und der H√∂he der Gesamtsumme zwischen drei und zehn Prozent Trinkgeld. Ist man mit dem Service unzufrieden gewesen, gibt man kein Trinkgeld.`
          }
        ]
      };

      /* ===== State & DOM refs ===== */
      let state = { 
        sectionIndex: 0, 
        questionIndex: 0, 
        answers: {}, 
        marked: {}, 
        remaining: exam.durationSec,
        showResults: false,
        timerStarted: false,
        timerInterval: null
      };
      const topTiles = document.getElementById('topTiles-lesen');
      const passageTitleEl = document.getElementById('passageTitle-lesen');
      const passageContentEl = document.getElementById('passageContent-lesen');
      const sectionNameEl = document.getElementById('sectionName-lesen');
      const questionTitleEl = document.getElementById('questionTitle-lesen');
      const questionBodyEl = document.getElementById('questionBody-lesen');
      const headingsBankContainer = document.getElementById('headingsBankContainer-lesen');
      const timerEl = document.getElementById('timer-lesen');
      const statusText = document.getElementById('statusText-lesen');
      const resultBtn = document.getElementById('resultBtn-lesen');
      const resetBtn = document.getElementById('resetBtn-lesen');
      const resetSectionBtn = document.getElementById('resetSectionBtn-lesen');

      /* ===== Timer Functions ===== */
      function startTimer(){
        if(state.timerInterval) {
          clearInterval(state.timerInterval);
        }
        
        state.timerStarted = true;
        state.timerInterval = setInterval(()=>{
          if(state.remaining <= 0){
            clearInterval(state.timerInterval);
            timerEl.textContent = 'Zeit abgelaufen';
            return;
          }
          state.remaining--;
          updateTimerDisplay();
        }, 1000);
      }

      function resetTimer(){
        if(state.timerInterval) {
          clearInterval(state.timerInterval);
        }
        state.remaining = exam.durationSec;
        state.timerStarted = false;
        updateTimerDisplay();
        startTimer();
      }

      function updateTimerDisplay(){
        const min = Math.floor(state.remaining / 60);
        const sec = state.remaining % 60;
        timerEl.textContent = `Verbleibende Zeit: ${min.toString().padStart(2, '0')}:${sec.toString().padStart(2, '0')}`;
      }

      /* ===== Reset Section Function ===== */
      function resetCurrentSection() {
        const currentSection = exam.sections[state.sectionIndex];
        
        if (confirm(`M√∂chten Sie wirklich den Teil "${currentSection.title}" zur√ºcksetzen? Alle Antworten in diesem Teil werden gel√∂scht.`)) {
          if (currentSection.id === 's1') {
            currentSection.texts.forEach(text => {
              delete state.answers[text.id];
            });
          } else if (currentSection.id === 's2') {
            currentSection.questions.forEach(question => {
              delete state.answers[question.id];
            });
          } else if (currentSection.id === 's3') {
            currentSection.situations.forEach(situation => {
              delete state.answers[situation.id];
            });
          } else if (currentSection.id === 's4') {
            currentSection.fillBlanks.forEach(blank => {
              delete state.answers[blank.id];
            });
          } else if (currentSection.id === 's5') {
            currentSection.fillBlanks2.forEach(blank => {
              delete state.answers[blank.id];
            });
          }
          
          renderAll();
        }
      }

      /* ===== Render ===== */
      function renderTopTiles(){ 
        topTiles.innerHTML=''; 
        exam.sections.forEach((sec,idx)=>{ 
          const div=document.createElement('div'); 
          div.className='tile'+(idx===state.sectionIndex?' active':'')+(isSectionDone(sec)?' done':''); 
          div.innerHTML=`<div>${sec.title}</div><div class="points">${sec.points} P</div>`; 
          div.onclick=()=>{state.sectionIndex=idx; state.questionIndex=0; state.showResults=false; renderAll();}; 
          topTiles.appendChild(div); 
        }); 
      }

      function isSectionDone(section){
        if(section.id==='s1') return section.texts.every(t=>state.answers[t.id]);
        if(section.id==='s2') return section.questions.every(q=>state.answers[q.id]);
        if(section.id==='s3') return section.situations.every(h=>state.answers[h.id] || state.answers[h.id] === 'X');
        if(section.id==='s4') return section.fillBlanks.every(b=>state.answers[b.id]);
        if(section.id==='s5') return section.fillBlanks2.every(b=>state.answers[b.id]);
        return false;
      }

      function renderAll(){
        renderTopTiles();
        const section = exam.sections[state.sectionIndex];
        sectionNameEl.textContent = section.title;
        passageTitleEl.textContent = section.passageTitle;
        
        resetSectionBtn.style.display = 'block';
        
        if(state.showResults){
          renderResults();
          return;
        }
        
        if(section.id === 's1'){
          renderPart1();
        } else if(section.id === 's2'){
          renderPart2();
        } else if(section.id === 's3'){
          renderPart3();
        } else if(section.id === 's4'){
          renderSprachbausteine1();
        } else if(section.id === 's5'){
          renderSprachbausteine2();
        }
      }

      function renderPart1(){
        const section = exam.sections[state.sectionIndex];
        
        let textsHTML = `<div class="instructions">Ziehen Sie die passenden √úberschriften auf die Texte. Sie k√∂nnen jede √úberschrift nur einmal verwenden.</div>`;
        
        section.texts.forEach((text, idx) => {
          const letter = String.fromCharCode(97 + idx);
          const selectedHeading = state.answers[text.id];
          
          textsHTML += `
            <div class="text-container">
              <div class="text-title">Text ${letter.toUpperCase()}</div>
              <div class="text-content">${text.content}</div>
              <div class="title-slot ${selectedHeading ? 'has-title' : ''}" data-text-id="${text.id}">
                ${selectedHeading ? getHeadingText(selectedHeading) : 'Ziehen Sie hier eine √úberschrift hin'}
              </div>
            </div>
          `;
        });
        
        passageContentEl.innerHTML = textsHTML;
        
        let headingsHTML = `<div class="headings-bank">`;
        section.headings.forEach(heading => {
          const isUsed = section.texts.some(text => state.answers[text.id] === heading.id);
          
          headingsHTML += `
            <div class="heading-item ${isUsed ? 'used' : ''}" draggable="${!isUsed}" data-heading-id="${heading.id}">
              ${heading.id}) ${heading.text}
            </div>
          `;
        });
        
        headingsHTML += `</div>`;
        
        headingsBankContainer.innerHTML = headingsHTML;
        
        setupDragAndDrop();
        
        questionBodyEl.innerHTML = '';
        questionTitleEl.textContent = '';
      }

      function setupDragAndDrop(){
        const headingItems = document.querySelectorAll('.heading-item:not(.used)');
        const titleSlots = document.querySelectorAll('.title-slot');
        
        headingItems.forEach(item => {
          item.addEventListener('dragstart', (e) => {
            e.dataTransfer.setData('text/plain', e.target.dataset.headingId);
          });
        });
        
        titleSlots.forEach(slot => {
          slot.addEventListener('dragover', (e) => {
            e.preventDefault();
            slot.style.background = '#e8f4ff';
          });
          
          slot.addEventListener('dragleave', (e) => {
            slot.style.background = slot.classList.contains('has-title') ? '#e8fbe9' : '#f8fbff';
          });
          
          slot.addEventListener('drop', (e) => {
            e.preventDefault();
            const headingId = e.dataTransfer.getData('text/plain');
            const textId = slot.dataset.textId;
            
            Object.keys(state.answers).forEach(key => {
              if(state.answers[key] === headingId) {
                delete state.answers[key];
              }
            });
            
            state.answers[textId] = headingId;
            renderAll();
          });
        });
      }

      function renderPart2(){
        const section = exam.sections[state.sectionIndex];
        
        passageContentEl.innerHTML = `<div class="passage">${section.passage}</div>`;
        
        let questionsHTML = `<div class="all-questions">`;
        
        section.questions.forEach((question, idx) => {
          const questionNumber = idx + 1;
          const userAnswer = state.answers[question.id];
          
          questionsHTML += `
            <div class="question-block">
              <div class="question-text">${questionNumber}. ${question.text}</div>
              <div class="options">
                ${question.options.map(opt => `
                  <div class="option ${userAnswer === opt.id ? 'selected' : ''}" 
                       onclick="window.lesenApp.selectOption('${question.id}', '${opt.id}')">
                    <div class="radio"></div>
                    <div>${opt.text}</div>
                  </div>
                `).join('')}
              </div>
            </div>
          `;
        });
        
        questionsHTML += `</div>`;
        
        questionBodyEl.innerHTML = questionsHTML;
        questionTitleEl.textContent = '';
        headingsBankContainer.innerHTML = '';
      }

      function renderPart3(){
        const section = exam.sections[state.sectionIndex];
        
        let textsHTML = `
          <div class="instructions">Ziehen Sie die passenden Situationen auf die Texte. Sie k√∂nnen jede Situation nur einmal verwenden. Manchmal passt keine Situation.</div>
          <div class="texts-list">
            <h3>Texte (A-L)</h3>
        `;
        
        section.texts.forEach(text => {
          const userAnswer = Object.keys(state.answers).find(key => state.answers[key] === text.id);
          const selectedSituation = userAnswer ? section.situations.find(h => h.id === userAnswer) : null;
          
          textsHTML += `
            <div class="text-item" data-text-id="${text.id}">
              <div class="text-letter">${text.id})</div>
              <div class="text-content">${text.text}</div>
              <div class="title-slot ${userAnswer ? 'has-title' : ''} ${userAnswer === 'X' ? 'has-x' : ''}" data-text-id="${text.id}">
                ${selectedSituation ? selectedSituation.text : (userAnswer === 'X' ? 'X - Keine passende Situation' : 'Ziehen Sie hier eine Situation hin')}
              </div>
            </div>
          `;
        });
        
        textsHTML += `</div>`;
        
        passageContentEl.innerHTML = textsHTML;
        
        let situationsHTML = `
          <div class="situations-list">
            <h3>Situationen (11-20)</h3>
        `;
        
        section.situations.forEach((situation, idx) => {
          const situationNumber = parseInt(situation.id);
          const isUsed = state.answers[situation.id];
          const isX = state.answers[situation.id] === 'X';
          
          situationsHTML += `
            <div class="situation-item ${isUsed ? 'used' : ''}" draggable="${!isUsed}" data-situation-id="${situation.id}">
              <div class="situation-number">${situationNumber}.</div>
              <div class="situation-text">${situation.text}</div>
              ${!isUsed ? `<button class="exam-btn no-match ${isX ? 'selected' : ''}" onclick="window.lesenApp.markNoMatch('${situation.id}')">X - Kein passender Text</button>` : ''}
            </div>
          `;
        });
        
        situationsHTML += `</div>`;
        
        questionBodyEl.innerHTML = situationsHTML;
        questionTitleEl.textContent = '';
        headingsBankContainer.innerHTML = '';
        
        setupPart3DragAndDrop();
      }

      function markNoMatch(situationId) {
        Object.keys(state.answers).forEach(key => {
          if(state.answers[key] === situationId) {
            delete state.answers[key];
          }
        });
        
        state.answers[situationId] = 'X';
        try{ localStorage.setItem('lesenAnswers', JSON.stringify(state.answers)); }catch(e){}
        
        renderAll();
      }

      function handleDrop(sourceId, targetId) {
        Object.keys(state.answers).forEach(key => {
          if(state.answers[key] === sourceId) {
            delete state.answers[key];
          }
        });
        
        state.answers[sourceId] = targetId;
        try{ localStorage.setItem('lesenAnswers', JSON.stringify(state.answers)); }catch(e){}
        
        renderAll();
      }

      function setupPart3DragAndDrop(){
        const situationItems = document.querySelectorAll('.situation-item:not(.used)');
        const textSlots = document.querySelectorAll('.text-item .title-slot');
        
        situationItems.forEach(item => {
          item.addEventListener('dragstart', (e) => {
            e.dataTransfer.setData('text/plain', e.target.dataset.situationId);
          });
        });
        
        textSlots.forEach(slot => {
          slot.addEventListener('dragover', (e) => {
            e.preventDefault();
            slot.style.background = '#e8f4ff';
          });
          
          slot.addEventListener('dragleave', (e) => {
            const hasTitle = slot.classList.contains('has-title');
            const hasX = slot.classList.contains('has-x');
            slot.style.background = hasTitle ? '#e8fbe9' : (hasX ? '#f8d7da' : '#f8fbff');
          });
          
          slot.addEventListener('drop', (e) => {
            e.preventDefault();
            const situationId = e.dataTransfer.getData('text/plain');
            const textId = slot.dataset.textId;
            
            Object.keys(state.answers).forEach(key => {
              if(state.answers[key] === situationId) {
                delete state.answers[key];
              }
            });
            
            state.answers[situationId] = textId;
            renderAll();
          });
        });
      }

      function renderSprachbausteine1(){
        const section = exam.sections[state.sectionIndex];
        
        let textWithBlanks = section.fillText;
        
        const blankPlaceholders = [];
        section.fillBlanks.forEach(blank => {
          blankPlaceholders.push(`BLANK_${blank.id}`);
        });
        
        let tempText = textWithBlanks;
        blankPlaceholders.forEach((placeholder, index) => {
          tempText = tempText.replace('________', placeholder);
        });
        
        section.fillBlanks.forEach(blank => {
          const userAnswer = state.answers[blank.id];
          const displayText = userAnswer ? userAnswer : '________';
          tempText = tempText.replace(`BLANK_${blank.id}`, `<span class="blank-word ${userAnswer ? 'has-answer' : ''}" data-blank-id="${blank.id}">${displayText}</span>`);
        });
        
        passageContentEl.innerHTML = `
          <div class="instructions">Klicken Sie auf jede L√ºcke und w√§hlen Sie das passende Wort aus. Sie k√∂nnen die L√ºcken in beliebiger Reihenfolge ausf√ºllen.</div>
          <div class="fill-blank-container">${tempText}</div>
        `;
        
        document.querySelectorAll('.blank-word').forEach(blank => {
          blank.addEventListener('click', (e) => {
            showOptionsPopup(e.target);
          });
        });
        
        let optionsHTML = `<div class="horizontal-options" style="gap: 8px;">`;
        
        section.fillBlanks.forEach(blank => {
          const userAnswer = state.answers[blank.id];
          
          optionsHTML += `
            <div class="option-row" style="padding: 8px; margin-bottom: 5px;">
              <div class="option-number">${blank.id}</div>
              <div class="option-buttons">
                ${blank.options.map(opt => `
                  <div class="option-btn ${userAnswer === opt ? 'selected' : ''}" 
                       onclick="window.lesenApp.selectSprachbausteine1('${blank.id}', '${opt}')" 
                       style="padding: 6px 12px; font-size: 12px;">
                    ${opt}
                  </div>
                `).join('')}
              </div>
            </div>
          `;
        });
        
        optionsHTML += `</div>`;
        
        questionBodyEl.innerHTML = optionsHTML;
        questionTitleEl.textContent = '';
        headingsBankContainer.innerHTML = '';
      }

      function showOptionsPopup(blankElement){
        const existingPopup = document.querySelector('.options-popup');
        if(existingPopup) {
          existingPopup.remove();
        }
        
        const blankId = blankElement.getAttribute('data-blank-id');
        const section = exam.sections.find(s => s.id === 's4');
        const blank = section.fillBlanks.find(b => b.id === blankId);
        
        if(!blank) return;
        
        const popup = document.createElement('div');
        popup.className = 'options-popup';
        
        blank.options.forEach(opt => {
          const optionItem = document.createElement('div');
          optionItem.className = 'option-item';
          optionItem.textContent = opt;
          optionItem.onclick = () => {
            selectSprachbausteine1(blankId, opt);
            popup.remove();
          };
          popup.appendChild(optionItem);
        });
        
        blankElement.appendChild(popup);
      }

      function selectSprachbausteine1(blankId, answer){
        state.answers[blankId] = answer;
        renderAll();
      }

      function renderSprachbausteine2(){
        const section = exam.sections[state.sectionIndex];
        let textWithPlaceholders = section.fillText2;
        const placeholders = [];
        section.fillBlanks2.forEach(blank => {
          const ph = `BLANK_${blank.id}`;
          placeholders.push({id: blank.id, ph});
          textWithPlaceholders = textWithPlaceholders.replace('________', ph);
        });

        placeholders.forEach(item => {
          const userAnswer = state.answers[item.id];
          const displayText = userAnswer ? userAnswer : '________';
          const span = `<span class="blank-slot ${userAnswer ? 'has-answer' : ''}" data-blank-id="${item.id}">${displayText}</span>`;
          textWithPlaceholders = textWithPlaceholders.replace(item.ph, span);
        });

        passageContentEl.innerHTML = `
          <div class="instructions">Klicken Sie ÿπŸÑŸâ ŸÉŸÑ ŸÅÿ±ÿßÿ∫ ŸàÿßÿÆÿ™ÿ± ÿßŸÑŸÉŸÑŸÖÿ© ÿßŸÑŸÖŸÜÿßÿ≥ÿ®ÿ©. ŸäŸÖŸÉŸÜŸÉ ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ŸÉŸÑ ŸÉŸÑŸÖÿ© ŸÖÿ±ÿ© Ÿàÿßÿ≠ÿØÿ© ŸÅŸÇÿ∑.</div>
          <div class="fill-blank-container">${textWithPlaceholders}</div>
        `;

        document.querySelectorAll('.blank-slot').forEach(slot => {
          slot.addEventListener('click', (e) => {
            showSprachbausteine2Options(slot);
          });
        });

        let wordBankHTML = `<div class="word-bank-vertical" style="gap: 8px;">`;
        const usedWords = Object.values(state.answers);
        const bank = section.fillBlanks2[0].options;
        bank.forEach(word => {
          const isUsed = usedWords.includes(word);
          wordBankHTML += `
            <div class="bank-word-vertical ${isUsed ? 'used' : ''}" 
                 draggable="${!isUsed}" 
                 data-word="${word}"
                 ${!isUsed ? `onclick="window.lesenApp.selectSprachbausteine2FromBank('${word}')"` : ''}>
              ${word}
            </div>
          `;
        });
        wordBankHTML += `</div>`;
        questionBodyEl.innerHTML = wordBankHTML;
        questionTitleEl.textContent = '';
        headingsBankContainer.innerHTML = '';

        setupSprachbausteine2DragAndDrop();
      }

      let lastClickedSprachSlot = null;

      function setupSprachbausteine2DragAndDrop(){
        const bankWords = Array.from(document.querySelectorAll('.bank-word-vertical'));
        bankWords.forEach(el => {
          const word = el.dataset.word;
          if(!el.classList.contains('used')){
            el.setAttribute('draggable','true');
          } else {
            el.setAttribute('draggable','false');
          }
          el.removeEventListener('dragstart', el._dstart);
          el._dstart = (e) => {
            e.dataTransfer.setData('text/plain', word);
            e.dataTransfer.setData('source', 'bank');
          };
          el.addEventListener('dragstart', el._dstart);

          el.removeEventListener('click', el._onclick);
          el._onclick = () => {
            if(el.classList.contains('used')) return;
            selectSprachbausteine2FromBank(word);
          };
          el.addEventListener('click', el._onclick);
        });

        const slots = Array.from(document.querySelectorAll('.blank-slot'));
        slots.forEach(slot => {
          slot.addEventListener('dragover', (e) => {
            e.preventDefault();
            slot.classList.add('drag-over');
          });
          slot.addEventListener('dragleave', (e) => {
            slot.classList.remove('drag-over');
          });
          slot.addEventListener('drop', (e) => {
            e.preventDefault();
            slot.classList.remove('drag-over');
            const word = e.dataTransfer.getData('text/plain') || e.dataTransfer.getData('text/html');
            if(!word) return;
            const blankId = slot.dataset.blankId;
            if(!blankId) return;
            Object.keys(state.answers).forEach(k => {
              if(state.answers[k] === word){
                delete state.answers[k];
              }
            });
            const prev = state.answers[blankId];
            if(prev){
              const prevEl = Array.from(document.querySelectorAll('.bank-word-vertical')).find(b=>b.dataset.word === prev);
              if(prevEl){
                prevEl.classList.remove('used');
                prevEl.setAttribute('draggable','true');
                prevEl.addEventListener('click', prevEl._onclick);
              }
            }
            const bankEl = Array.from(document.querySelectorAll('.bank-word-vertical')).find(b=>b.dataset.word === word);
            if(bankEl){
              bankEl.classList.add('used');
              bankEl.setAttribute('draggable','false');
              bankEl.removeEventListener('click', bankEl._onclick);
            }
            state.answers[blankId] = word;
            renderAll();
          });
        });
      }

      function showSprachbausteine2Options(slot){
        document.querySelectorAll('.blank-slot').forEach(s => s.classList.remove('selected-sprach'));
        slot.classList.add('selected-sprach');
        lastClickedSprachSlot = slot;
      }

      function selectSprachbausteine2FromBank(word, blankId = null){
        let slot = lastClickedSprachSlot;
        if(!slot && !blankId){
          slot = Array.from(document.querySelectorAll('.blank-slot')).find(s => {
            const id = s.dataset.blankId;
            return !state.answers[id];
          });
        }
        
        if(!slot && blankId) {
          slot = document.querySelector(`.blank-slot[data-blank-id="${blankId}"]`);
        }
        
        if(!slot) {
          return;
        }
        
        const targetBlankId = blankId || slot.dataset.blankId;
        Object.keys(state.answers).forEach(k => {
          if(state.answers[k] === word){
            delete state.answers[k];
          }
        });
        const prev = state.answers[targetBlankId];
        if(prev){
          const prevEl = Array.from(document.querySelectorAll('.bank-word-vertical')).find(b=>b.dataset.word === prev);
          if(prevEl){
            prevEl.classList.remove('used');
            prevEl.setAttribute('draggable','true');
            if(prevEl._onclick) prevEl.addEventListener('click', prevEl._onclick);
          }
        }
        const bankEl = Array.from(document.querySelectorAll('.bank-word-vertical')).find(b=>b.dataset.word === word);
        if(bankEl){
          bankEl.classList.add('used');
          bankEl.setAttribute('draggable','false');
          if(bankEl._onclick) try{ bankEl.removeEventListener('click', bankEl._onclick); }catch(e){}
        }
        state.answers[targetBlankId] = word;
        try{ localStorage.setItem('lesenAnswers', JSON.stringify(state.answers)); }catch(e){}
        
        lastClickedSprachSlot = null;
        renderAll();
      }

      function selectOption(questionId, optionId){
        state.answers[questionId] = optionId;
        try{ localStorage.setItem('lesenAnswers', JSON.stringify(state.answers)); }catch(e){}
        
        renderAll();
      }

      function renderResults(){
        let resultsHTML = `<h2>Ergebnisse</h2>`;
        let totalCorrect = 0;
        let totalQuestions = 0;
        
        exam.sections.forEach(section => {
          resultsHTML += `<div class="result-item"><h3>${section.title}</h3>`;
          
          if(section.id === 's1'){
            section.texts.forEach(text => {
              totalQuestions++;
              const userAnswer = state.answers[text.id] || '-';
              const correctAnswer = CORRECT_ANSWERS.lesen[text.id];
              const isCorrect = userAnswer === correctAnswer;
              if(isCorrect) totalCorrect++;
              
              resultsHTML += `
                <div>Text ${text.id}: ${userAnswer || '-'} 
                ${userAnswer !== '-' ? `<span class="${isCorrect ? 'result-correct' : 'result-incorrect'}">${isCorrect ? '‚úì' : '‚úó'}</span>` : ''}
                </div>
              `;
            });
          } else if(section.id === 's2'){
            section.questions.forEach(question => {
              totalQuestions++;
              const userAnswer = state.answers[question.id] || '-';
              const correctAnswer = CORRECT_ANSWERS.lesen[question.id];
              const isCorrect = userAnswer === correctAnswer;
              if(isCorrect) totalCorrect++;
              
              resultsHTML += `
                <div>${question.text}: ${userAnswer || '-'} 
                ${userAnswer !== '-' ? `<span class="${isCorrect ? 'result-correct' : 'result-incorrect'}">${isCorrect ? '‚úì' : '‚úó'}</span>` : ''}
                </div>
              `;
            });
          } else if(section.id === 's3'){
            section.situations.forEach(situation => {
              totalQuestions++;
              const userAnswer = state.answers[situation.id] || '-';
              const correctAnswer = CORRECT_ANSWERS.lesen[situation.id];
              const isCorrect = userAnswer === correctAnswer;
              if(isCorrect) totalCorrect++;
              
              resultsHTML += `
                <div>Situation ${situation.id}: ${userAnswer || '-'} 
                ${userAnswer !== '-' ? `<span class="${isCorrect ? 'result-correct' : 'result-incorrect'}">${isCorrect ? '‚úì' : '‚úó'}</span>` : ''}
                </div>
              `;
            });
          } else if(section.id === 's4'){
            section.fillBlanks.forEach(blank => {
              totalQuestions++;
              const userAnswer = state.answers[blank.id] || '-';
              const correctAnswer = CORRECT_ANSWERS.lesen[blank.id];
              const isCorrect = userAnswer === correctAnswer;
              if(isCorrect) totalCorrect++;
              
              resultsHTML += `
                <div>L√ºcke ${blank.id}: ${userAnswer || '-'} 
                ${userAnswer !== '-' ? `<span class="${isCorrect ? 'result-correct' : 'result-incorrect'}">${isCorrect ? '‚úì' : '‚úó'}</span>` : ''}
                </div>
              `;
            });
          } else if(section.id === 's5'){
            section.fillBlanks2.forEach(blank => {
              totalQuestions++;
              const userAnswer = state.answers[blank.id] || '-';
              const correctAnswer = CORRECT_ANSWERS.lesen[blank.id];
              const isCorrect = userAnswer === correctAnswer;
              if(isCorrect) totalCorrect++;
              
              resultsHTML += `
                <div>L√ºcke ${blank.id}: ${userAnswer || '-'} 
                ${userAnswer !== '-' ? `<span class="${isCorrect ? 'result-correct' : 'result-incorrect'}">${isCorrect ? '‚úì' : '‚úó'}</span>` : ''}
                </div>
              `;
            });
          }
          
          resultsHTML += `</div>`;
        });
        
        const percentage = totalQuestions > 0 ? Math.round((totalCorrect / totalQuestions) * 100) : 0;
        resultsHTML += `<div class="result-item"><h3>Gesamtergebnis: ${totalCorrect}/${totalQuestions} (${percentage}%)</h3></div>`;
        
        passageContentEl.innerHTML = resultsHTML;
        questionBodyEl.innerHTML = '';
        sectionNameEl.textContent = 'Ergebnisse';
        questionTitleEl.textContent = '';
      }

      /* ===== Event Listeners ===== */
      document.getElementById('prevBtn-lesen').addEventListener('click', ()=>{
        if(state.sectionIndex > 0){
          state.sectionIndex--;
          state.questionIndex = 0;
          renderAll();
        }
      });

      document.getElementById('nextBtn-lesen').addEventListener('click', ()=>{
        if(state.sectionIndex < exam.sections.length - 1){
          state.sectionIndex++;
          state.questionIndex = 0;
          renderAll();
        }
      });

      resultBtn.addEventListener('click', ()=>{
        state.showResults = !state.showResults;
        renderAll();
      });

      resetBtn.addEventListener('click', ()=>{
        if(confirm('M√∂chten Sie wirklich von neu beginnen? Alle Antworten werden gel√∂scht.')){
          state.answers = {};
          state.marked = {};
          state.showResults = false;
          resetTimer();
          renderAll();
        }
      });

      resetSectionBtn.addEventListener('click', resetCurrentSection);

      document.getElementById('saveBtn-lesen').addEventListener('click', ()=>{
        statusText.textContent = 'Gespeichert';
        setTimeout(()=>{statusText.textContent = 'Nicht gespeichert'}, 2000);
      });

      document.getElementById('submitBtn-lesen').addEventListener('click', ()=>{
        if(confirm('M√∂chten Sie die Pr√ºfung wirklich abgeben?')){
          state.showResults = true;
          renderAll();
        }
      });

      document.getElementById('nextBtn-lesen').addEventListener('click', ()=>{
        showPage('hoeren-page');
      });

      /* ===== Initialize ===== */
      updateTimerDisplay();
      renderAll();
      startTimer();
      
      window._lesenState = state;
      window.lesenApp = {
        selectOption,
        markNoMatch,
        selectSprachbausteine1,
        selectSprachbausteine2FromBank,
        handleDrop
      };
      
      // Setup touch interactions
      setTimeout(setupTouchDragAndDrop, 100);
    }

    // ===== H√ñREN PAGE FUNCTIONALITY =====
    function initHoerenPage() {
      const exam = {
        id: "exam-h√∂rverstehen",
        durationSec: 17 * 60,
        sections: [
          { 
            id: "h√∂rverstehen1", 
            title: "H√∂rverstehen, Teil 1", 
            points: 25,
            questions: [
              {
                id: "41",
                text: "Auf der Insel Bali wurden neue Ma√ünahmen zur M√ºllentsorgung beschlossen."
              },
              {
                id: "42", 
                text: "In Nordfrankreich wird nach einem entlaufenen Panther gesucht."
              },
              {
                id: "43",
                text: "Die Mietervereinigung r√§t Mieterinnen und Mietern, die Betriebskosten nicht zu bezahlen."
              },
              {
                id: "44",
                text: "Der Sekt-Hersteller hat die Pl√§ne f√ºr sein Bauvorhaben ge√§ndert."
              },
              {
                id: "45",
                text: "Die L√∂scharbeiten sind noch nicht abgeschlossen."
              }
            ]
          },
          { 
            id: "h√∂rverstehen2", 
            title: "H√∂rverstehen, Teil 2", 
            points: 25,
            questions: [
              {
                id: "46",
                text: "Roland W√ºnschmann arbeitet Vollzeit als Fu√üballtrainer bei Viktoria K√∂ln."
              },
              {
                id: "47",
                text: "Viktoria K√∂ln m√∂chte am Ende der Spielsaison aufsteigen."
              },
              {
                id: "48", 
                text: "Zu Beginn dieser Saison hat ein Spieler Viktoria K√∂ln verlassen."
              },
              {
                id: "49",
                text: "Neue Spieler kommen bei Viktoria K√∂ln immer aus der eigenen Jugendmannschaft."
              },
              {
                id: "50",
                text: "Die Mannschaft von Viktoria K√∂ln hat Schw√§chen in der Abwehr."
              },
              {
                id: "51",
                text: "Roland W√ºnschmann wagt die Prognose, dass diese Saison der 1. FC M√∂nchengladbach Meister wird."
              },
              {
                id: "52",
                text: "Roland W√ºnschmann kann seinen Beruf und sein Ehrenamt als Fu√üballtrainer miteinander vereinbaren."
              },
              {
                id: "53",
                text: "Auch die Frau von Roland W√ºnschmann engagiert sich im Fu√üball."
              },
              {
                id: "54",
                text: "Der Vereinsvorstand sch√§tzt Herrn W√ºnschmanns Arbeit."
              },
              {
                id: "55",
                text: "Roland W√ºnschmann ist mit der bisherigen Nachwuchsf√∂rderung des Vereins noch nicht voll zufrieden."
              }
            ]
          },
          { 
            id: "h√∂rverstehen3", 
            title: "H√∂rverstehen, Teil 3", 
            points: 25,
            questions: [
              {
                id: "56",
                text: "Sie k√∂nnen im Internet pr√ºfen, ob Ihre aktuelle Bestellung schon unterwegs ist."
              },
              {
                id: "57",
                text: "Man kann f√ºr die Nachtveranstaltung noch Karten im Internet kaufen."
              },
              {
                id: "58",
                text: "Die Teilnahme an der Party im Burghof kostet nichts."
              },
              {
                id: "59",
                text: "In Bamberg kann man in der n√§chsten Woche besonders g√ºnstig Mitglied in einem Sportverein werden."
              },
              {
                id: "60",
                text: "Wer ein wichtiges Anliegen hat, soll eine andere Nummer w√§hlen."
              }
            ]
          }
        ]
      };

      let state = { 
        sectionIndex: 0, 
        answers: {}, 
        remaining: exam.durationSec,
        showResults: false,
        timerStarted: false,
        timerInterval: null
      };
      
      const topTiles = document.getElementById('topTiles-hoeren');
      const contentContainer = document.getElementById('contentContainer-hoeren');
      const timerEl = document.getElementById('timer-hoeren');
      const statusText = document.getElementById('statusText-hoeren');

      function startTimer() {
        if (state.timerInterval) {
          clearInterval(state.timerInterval);
        }
        
        state.timerStarted = true;
        state.timerInterval = setInterval(() => {
          if (state.remaining <= 0) {
            clearInterval(state.timerInterval);
            timerEl.textContent = 'Zeit abgelaufen';
            return;
          }
          state.remaining--;
          updateTimerDisplay();
        }, 1000);
      }

      function resetTimer() {
        if (state.timerInterval) {
          clearInterval(state.timerInterval);
        }
        state.remaining = exam.durationSec;
        state.timerStarted = false;
        updateTimerDisplay();
        startTimer();
      }

      function updateTimerDisplay() {
        const min = Math.floor(state.remaining / 60);
        const sec = state.remaining % 60;
        timerEl.textContent = `Verbleibende Zeit: ${min.toString().padStart(2, '0')}:${sec.toString().padStart(2, '0')}`;
      }

      function renderTopTiles() { 
        topTiles.innerHTML = ''; 
        exam.sections.forEach((sec, idx) => { 
          const div = document.createElement('div'); 
          div.className = 'tile' + (idx === state.sectionIndex ? ' active' : '') + (isSectionDone(sec) ? ' done' : ''); 
          div.innerHTML = `<div>${sec.title}</div><div class="points">${sec.points} P</div>`; 
          div.onclick = () => { state.sectionIndex = idx; state.showResults = false; renderAll(); }; 
          topTiles.appendChild(div); 
        }); 
      }

      function isSectionDone(section) {
        const answers = state.answers[section.id];
        if (!answers) return false;
        
        const answeredQuestions = Object.keys(answers).length;
        const totalQuestions = section.questions.length;
        
        return answeredQuestions === totalQuestions;
      }

      function renderAll() {
        renderTopTiles();
        
        if (state.showResults) {
          renderResults();
          return;
        }
        
        renderListeningSection();
      }

      function renderListeningSection() {
        const section = exam.sections[state.sectionIndex];
        const currentAnswers = state.answers[section.id] || {};
        
        let contentHTML = `
          <div class="panel-title">${section.title}</div>
          <div class="instructions">
            Sie h√∂ren die Nachrichten. Entscheiden Sie beim H√∂ren, ob die Aussagen richtig oder falsch sind. 
            Sie h√∂ren die Nachrichten nur einmal. Sie haben jetzt 30 Sekunden, um die Aussagen zu lesen.
          </div>
          
          <div class="listening-task">
            <table class="true-false-table">
              <thead>
                <tr>
                  <th style="width: 10%">Nr.</th>
                  <th style="width: 60%">Aussage</th>
                  <th style="width: 30%">Ihre Antwort</th>
                </tr>
              </thead>
              <tbody>
        `;
        
        section.questions.forEach((question, index) => {
          const currentAnswer = currentAnswers[question.id] || '';
          contentHTML += `
            <tr>
              <td><strong>${question.id}</strong></td>
              <td class="question-text">${question.text}</td>
              <td>
                <div class="answer-options">
                  <label class="answer-option">
                    <input 
                      type="radio" 
                      name="q${section.id}_${question.id}" 
                      value="richtig" 
                      ${currentAnswer === 'richtig' ? 'checked' : ''}
                      onchange="window.hoerenApp.updateListeningAnswer('${section.id}', '${question.id}', this.value)"
                    >
                    Richtig
                  </label>
                  <label class="answer-option">
                    <input 
                      type="radio" 
                      name="q${section.id}_${question.id}" 
                      value="falsch" 
                      ${currentAnswer === 'falsch' ? 'checked' : ''}
                      onchange="window.hoerenApp.updateListeningAnswer('${section.id}', '${question.id}', this.value)"
                    >
                    Falsch
                  </label>
                </div>
              </td>
            </tr>
          `;
        });
        
        contentHTML += `
              </tbody>
            </table>
          </div>
        `;
        
        contentContainer.innerHTML = contentHTML;
      }

      function updateListeningAnswer(sectionId, questionId, answer) {
        if (!state.answers[sectionId]) {
          state.answers[sectionId] = {};
        }
        state.answers[sectionId][questionId] = answer;
        try{ localStorage.setItem('hoerenAnswers', JSON.stringify(state.answers)); }catch(e){}
        
        renderTopTiles();
      }

      function renderResults() {
        let resultsHTML = `<div class="panel-title">Ergebnisse - H√∂rverstehen</div>`;
        
        exam.sections.forEach(section => {
          const userAnswers = state.answers[section.id] || {};
          let correctCount = 0;
          
          resultsHTML += `
            <div class="listening-task">
              <h3>${section.title} (${section.points} Punkte)</h3>
              <table class="true-false-table">
                <thead>
                  <tr>
                    <th style="width: 10%">Nr.</th>
                    <th style="width: 50%">Aussage</th>
                    <th style="width: 15%">Ihre Antwort</th>
                    <th style="width: 15%">Richtige Antwort</th>
                    <th style="width: 10%">Ergebnis</th>
                  </tr>
                </thead>
                <tbody>
          `;
          
          section.questions.forEach((question) => {
            const userAnswer = userAnswers[question.id] || '-';
            const correctAnswer = CORRECT_ANSWERS.hoeren[question.id];
            const gotCorrect = userAnswer === correctAnswer;
            
            if (gotCorrect && userAnswer !== '-') correctCount++;
            
            const rowClass = gotCorrect && userAnswer !== '-' ? 'correct-answer' : (userAnswer === '-' ? '' : 'incorrect-answer');
            const resultIcon = userAnswer === '-' ? '' : (gotCorrect ? '‚úÖ' : '‚ùå');
            
            resultsHTML += `
              <tr class="${rowClass}">
                <td><strong>${question.id}</strong></td>
                <td class="question-text">${question.text}</td>
                <td>${userAnswer}</td>
                <td>${correctAnswer}</td>
                <td><strong>${resultIcon}</strong></td>
              </tr>
            `;
          });
          
          const totalPoints = Math.round((correctCount / section.questions.length) * section.points);
          
          resultsHTML += `
                </tbody>
              </table>
              <div style="margin-top: 15px; padding: 15px; background: #e3f2fd; border-radius: 6px;">
                <strong>Erreichte Punkte: ${correctCount}/${section.questions.length} richtig = ${totalPoints}/${section.points} Punkten</strong>
              </div>
            </div>
          `;
        });
        
        contentContainer.innerHTML = resultsHTML;
      }

      document.getElementById('prevBtn-hoeren').addEventListener('click', () => {
        if (state.sectionIndex > 0) {
          state.sectionIndex--;
          state.showResults = false;
          renderAll();
        }
      });

      document.getElementById('nextBtn-hoeren').addEventListener('click', () => {
        if (state.sectionIndex < exam.sections.length - 1) {
          state.sectionIndex++;
          state.showResults = false;
          renderAll();
        }
      });

      document.getElementById('resultBtn-hoeren').addEventListener('click', () => {
        state.showResults = !state.showResults;
        renderAll();
      });

      document.getElementById('resetBtn-hoeren').addEventListener('click', () => {
        if (confirm('M√∂chten Sie wirklich von neu beginnen? Alle Antworten werden gel√∂scht.')) {
          state.answers = {};
          state.showResults = false;
          resetTimer();
          renderAll();
        }
      });

      document.getElementById('saveBtn-hoeren').addEventListener('click', () => {
        statusText.textContent = 'Gespeichert';
        setTimeout(() => { statusText.textContent = 'Nicht gespeichert' }, 2000);
      });

      document.getElementById('submitBtn-hoeren').addEventListener('click', () => {
        if (confirm('M√∂chten Sie die Pr√ºfung wirklich abgeben?')) {
          state.showResults = true;
          renderAll();
        }
      });

      document.getElementById('nextBtn-hoeren').addEventListener('click', () => {
        showPage('schreiben-page');
      });

      updateTimerDisplay();
      renderAll();
      startTimer();
      
      window._hoerenState = state;
      window.hoerenApp = {
        updateListeningAnswer
      };
      
      // Setup touch interactions
      setTimeout(setupTouchDragAndDrop, 100);
    }

    // ===== SCHREIBEN PAGE FUNCTIONALITY =====
    function initSchreibenPage() {
      const exam = {
        id: "exam-002",
        durationSec: 30 * 60,
        sections: [
          { 
            id: "s1", 
            title: "Schreiben, Teil 1", 
            points: 45,
            passageTitle: "Aufgabe: Schreiben Sie eine E-Mail",
            passage: "",
            writingTask: {
              prompt: `Backstage-Musik

Sie haben Geld bezahlt, um hinter die Kulissen eines Theaterst√ºcks zu gehen. 
Dabei konnten Sie das Archiv der alten Theatermusik, die Masken und die Kost√ºme sehen.`,
              requirements: [
                "Warum waren Sie unzufrieden?",
                "Warum haben Sie sich f√ºr diese Vorstellung entschieden? Was hat Sie daran interessiert?",
                "Was erwarten Sie von den Veranstaltern, um den Service zu verbessern?"
              ],
              wordCount: 0
            }
          }
        ]
      };

      let state = { 
        sectionIndex: 0, 
        answers: {}, 
        remaining: exam.durationSec,
        showResults: false,
        timerStarted: false,
        timerInterval: null
      };
      
      const topTiles = document.getElementById('topTiles-schreiben');
      const passageTitleEl = document.getElementById('passageTitle-schreiben');
      const passageContentEl = document.getElementById('passageContent-schreiben');
      const writingContainer = document.getElementById('writingContainer-schreiben');
      const timerEl = document.getElementById('timer-schreiben');
      const statusText = document.getElementById('statusText-schreiben');

      function startTimer() {
        if (state.timerInterval) {
          clearInterval(state.timerInterval);
        }
        
        state.timerStarted = true;
        state.timerInterval = setInterval(() => {
          if (state.remaining <= 0) {
            clearInterval(state.timerInterval);
            timerEl.textContent = 'Zeit abgelaufen';
            return;
          }
          state.remaining--;
          updateTimerDisplay();
        }, 1000);
      }

      function resetTimer() {
        if (state.timerInterval) {
          clearInterval(state.timerInterval);
        }
        state.remaining = exam.durationSec;
        state.timerStarted = false;
        updateTimerDisplay();
        startTimer();
      }

      function updateTimerDisplay() {
        const min = Math.floor(state.remaining / 60);
        const sec = state.remaining % 60;
        timerEl.textContent = `Verbleibende Zeit: ${min.toString().padStart(2, '0')}:${sec.toString().padStart(2, '0')}`;
      }

      function renderTopTiles() { 
        topTiles.innerHTML = ''; 
        exam.sections.forEach((sec, idx) => { 
          const div = document.createElement('div'); 
          div.className = 'tile' + (idx === state.sectionIndex ? ' active' : '') + (isSectionDone(sec) ? ' done' : ''); 
          div.innerHTML = `<div>${sec.title}</div><div class="points">${sec.points} P</div>`; 
          div.onclick = () => { state.sectionIndex = idx; state.showResults = false; renderAll(); }; 
          topTiles.appendChild(div); 
        }); 
      }

      function isSectionDone(section) {
        return state.answers[section.id] && state.answers[section.id].length > 0;
      }

      function renderAll() {
        renderTopTiles();
        const section = exam.sections[state.sectionIndex];
        passageTitleEl.textContent = section.passageTitle;
        
        if (state.showResults) {
          renderResults();
          return;
        }
        
        renderWritingSection();
      }

      function renderWritingSection() {
        const section = exam.sections[state.sectionIndex];
        
        passageContentEl.innerHTML = `
          <div class="writing-task">
            <div class="writing-prompt">${section.writingTask.prompt}</div>
            <div class="instructions" style="border:1px solid #e1e8f6; padding:10px; margin:10px 0; border-radius:6px; background:#ffffff;">Sie haben hinter die Kulissen eines Theaterst√ºcks geschaut. Leider waren Sie nicht zufrieden. 
      Schreiben Sie eine Beschwerde an die Veranstalter.</div>
            <div class="writing-requirements">
              <h4>Schreiben Sie in Ihrer E-Mail:</h4>
              <ul>
                ${section.writingTask.requirements.map(req => `<li>${req}</li>`).join('')}
              </ul>
            </div>
            <div class="instructions">
              Schreiben Sie eine E-Mail (ca. 150-200 W√∂rter). Achten Sie auf den Textaufbau (Anrede, Einleitung, Hauptteil, Schluss) und eine angemessene Formulierung.
            </div>
          </div>
        `;
        
        const currentAnswer = state.answers[section.id] || '';
        const wordCount = countWords(currentAnswer);
        
        writingContainer.innerHTML = `
          <div class="writing-area">
            <textarea 
              class="writing-textarea" 
              placeholder="Schreiben Sie hier Ihre E-Mail..."
              oninput="window.schreibenApp.updateWritingAnswer('${section.id}', this.value)"
            >${currentAnswer}</textarea>
            <div class="word-counter">
              W√∂rter: <span class="count">${wordCount}</span>
            </div>
          </div>
        `;
      }

      function countWords(text) {
        return text.trim() === '' ? 0 : text.trim().split(/\s+/).length;
      }

      function updateWritingAnswer(sectionId, text) {
        state.answers[sectionId] = text;
        try{ localStorage.setItem('schreibenAnswers', JSON.stringify({content: state.answers[sectionId], wordCount: (state.answers[sectionId]||'').trim().split(/\s+/).filter(Boolean).length})); }catch(e){}
        
        const wordCount = countWords(text);
        document.querySelector('.word-counter .count').textContent = wordCount;
      }

      function renderResults() {
        let resultsHTML = `<h2>Ergebnisse</h2>`;
        
        exam.sections.forEach(section => {
          resultsHTML += `<div class="writing-task"><h3>${section.title}</h3>`;
          
          const userAnswer = state.answers[section.id];
          const wordCount = countWords(userAnswer);
          
          resultsHTML += `
            <div class="writing-requirements">
              <h4>Ihre Antwort (${wordCount} W√∂rter):</h4>
              <div style="white-space: pre-wrap; background: white; padding: 15px; border-radius: 6px; border: 1px solid #e1e8f6; margin-top: 10px;">${userAnswer || 'Keine Antwort'}</div>
            </div>
          `;
          
          resultsHTML += `</div>`;
        });
        
        passageContentEl.innerHTML = resultsHTML;
        writingContainer.innerHTML = '';
      }

      document.getElementById('prevBtn-schreiben').addEventListener('click', () => {
        if (state.sectionIndex > 0) {
          state.sectionIndex--;
          state.showResults = false;
          renderAll();
        }
      });

      document.getElementById('nextBtn-schreiben').addEventListener('click', () => {
        if (state.sectionIndex < exam.sections.length - 1) {
          state.sectionIndex++;
          state.showResults = false;
          renderAll();
        }
      });

      document.getElementById('resultBtn-schreiben').addEventListener('click', () => {
        state.showResults = !state.showResults;
        renderAll();
      });

      document.getElementById('resetBtn-schreiben').addEventListener('click', () => {
        if (confirm('M√∂chten Sie wirklich von neu beginnen? Alle Antworten werden gel√∂schÿ™.')) {
          state.answers = {};
          state.showResults = false;
          resetTimer();
          renderAll();
        }
      });

      document.getElementById('saveBtn-schreiben').addEventListener('click', () => {
        statusText.textContent = 'Gespeichert';
        setTimeout(() => { statusText.textContent = 'Nicht gespeichert' }, 2000);
      });

      document.getElementById('submitBtn-schreiben').addEventListener('click', () => {
        if (confirm('M√∂chten Sie die Pr√ºfung wirklich abgeben?')) {
          state.showResults = true;
          renderAll();
        }
      });

      document.getElementById('nextBtn-schreiben').addEventListener('click', () => {
        showPage('ergebnisse-page');
      });

      updateTimerDisplay();
      renderAll();
      startTimer();
      
      window._schreibenState = state;
      window.schreibenApp = {
        updateWritingAnswer
      };
      
      // Setup touch interactions
      setTimeout(setupTouchDragAndDrop, 100);
    }

    // ===== ERGEBNISSE PAGE FUNCTIONALITY =====
    function initErgebnissePage() {
      const CONFIG = {
        totals: { 
          lesen: 105, 
          hoeren: 75, 
          schreiben: 45, 
          gesamt: 225 
        },
        counts: { 
          lesen: 40, 
          hoeren: 20 
        }
      };

      function normalizeAnswer(a) {
        if (a === null || a === undefined || a === '') return '-';
        let s = String(a).trim();
        if (s === '') return '-';
        const low = s.toLowerCase();
        if (["richtig", "true", "yes", "ja"].includes(low)) return 'richtig';
        if (["falsch", "false", "no", "nein"].includes(low)) return 'falsch';
        return s;
      }

      function readExamResults() {
        try {
          const lesen = {};
          const hoeren = {};
          const schreiben = { content: '', wordCount: 0 };

          try {
            if (window._lesenState && window._lesenState.answers) {
              Object.keys(window._lesenState.answers).forEach(k => {
                lesen[k] = window._lesenState.answers[k];
              });
            }
          } catch (e) {}

          try {
            if (window._hoerenState && window._hoerenState.answers) {
              Object.keys(window._hoerenState.answers).forEach(sectionId => {
                const sec = window._hoerenState.answers[sectionId] || {};
                Object.keys(sec).forEach(q => {
                  hoeren[q] = sec[q];
                });
              });
            }
          } catch (e) {}

          try {
            if (window._schreibenState && window._schreibenState.answers) {
              const answers = window._schreibenState.answers;
              if (answers['s1']) {
                schreiben.content = answers['s1'];
              } else {
                const keys = Object.keys(answers);
                if (keys.length > 0) schreiben.content = answers[keys[0]] || '';
              }
              schreiben.wordCount = (schreiben.content && schreiben.content.trim()) ? String(schreiben.content).trim().split(/\s+/).filter(Boolean).length : 0;
            }
          } catch (e) {}

          try {
            if (Object.keys(lesen).length === 0) {
              const storedL = localStorage.getItem('lesenAnswers');
              if (storedL) Object.assign(lesen, JSON.parse(storedL));
            }
          } catch (e) {}

          try {
            if (Object.keys(hoeren).length === 0) {
              const storedH = localStorage.getItem('hoerenAnswers');
              if (storedH) Object.assign(hoeren, JSON.parse(storedH));
            }
          } catch (e) {}

          try {
            if (!schreiben.content) {
              const storedS = localStorage.getItem('schreibenAnswers');
              if (storedS) {
                const obj = JSON.parse(storedS);
                schreiben.content = obj.content || '';
                schreiben.wordCount = obj.wordCount || (schreiben.content.trim() ? String(schreiben.content).trim().split(/\s+/).filter(Boolean).length : 0);
              }
            }
          } catch (e) {}

          return { hoeren, lesen, schreiben };
        } catch (e) {
          return { hoeren: {}, lesen: {}, schreiben: {} };
        }
      }

      function gradeHoeren(u) {
        const c = CORRECT_ANSWERS.hoeren;
        let okCount = 0;
        const d = [];
        
        for (let q = 41; q <= 60; q++) {
          const k = String(q);
          const uA = normalizeAnswer(u[k] || '');
          const exp = normalizeAnswer(c[k] || '');
          const ok = (uA !== '-' && uA.toLowerCase() === exp.toLowerCase());
          if (ok) okCount++;
          const ptsPer = CONFIG.totals.hoeren / CONFIG.counts.hoeren;
          d.push({
            frage: k,
            user: uA,
            correct: exp,
            richtig: ok,
            punkte: ok ? ptsPer.toFixed(2) : '0'
          });
        }
        
        const total = Number((okCount * (CONFIG.totals.hoeren / CONFIG.counts.hoeren)).toFixed(2));
        return { okCount, total, details: d };
      }

      function gradeLesen(u) {
        const c = CORRECT_ANSWERS.lesen;
        let okCount = 0;
        const d = [];
        
        Object.keys(c).forEach(k => {
          const exp = normalizeAnswer(c[k]);
          const uA = normalizeAnswer(u[k] || '');
          const ok = (uA !== '-' && uA.toLowerCase() === exp.toLowerCase());
          if (ok) okCount++;
          const ptsPer = CONFIG.totals.lesen / CONFIG.counts.lesen;
          d.push({
            frage: k,
            user: uA,
            correct: exp,
            richtig: ok,
            punkte: ok ? ptsPer.toFixed(2) : '0'
          });
        });
        
        const total = Number((okCount * (CONFIG.totals.lesen / CONFIG.counts.lesen)).toFixed(2));
        return { okCount, total, details: d };
      }

      function renderResults() {
        const st = readExamResults() || { hoeren: {}, lesen: {}, schreiben: {} };
        const h = gradeHoeren(st.hoeren || {});
        const l = gradeLesen(st.lesen || {});
        const details = document.getElementById('details-ergebnisse');
        const tiles = document.getElementById('topTiles-ergebnisse');
        const sScoreRaw = localStorage.getItem('schreibenScore');
        const sScore = sScoreRaw ? Number(sScoreRaw) : 0;

        details.innerHTML = '';
        tiles.innerHTML = '';

        const tL = `<div class="results-tile">
                    <h3>Lesen</h3>
                    <div class="score">${l.total.toFixed(2)} / ${CONFIG.totals.lesen} Punkte</div>
                    <div class="small-muted">(${(l.total / CONFIG.totals.lesen * 100).toFixed(2)} %)</div>
                  </div>`;
                  
        const tH = `<div class="results-tile">
                    <h3>H√∂ren</h3>
                    <div class="score">${h.total.toFixed(2)} / ${CONFIG.totals.hoeren} Punkte</div>
                    <div class="small-muted">(${(h.total / CONFIG.totals.hoeren * 100).toFixed(2)} %)</div>
                  </div>`;
                  
        const tS = `<div class="results-tile">
                    <h3>Schreiben</h3>
                    <div class="score" id="schreibenScoreDisplay">${sScore.toFixed(2)} / ${CONFIG.totals.schreiben} Punkte</div>
                    <div class="small-muted">Manuelle Eingabe</div>
                  </div>`;
                  
        tiles.innerHTML = tL + tH + tS;

        details.innerHTML = '<h2>üìä Detaillierte Ergebnisse</h2>';
        
        details.innerHTML += renderLesenDetails(st.lesen);
        
        details.innerHTML += `<div class="result-item">
                              <h3>üëÇ H√∂rverstehen - Detaillierte Auswertung</h3>
                              ${buildHoerenDetails(st.hoeren)}
                            </div>`;

        let sHtml = '<div class="result-item"><h3>‚úçÔ∏è Schreiben - Ihre Antwort</h3>';
        const txt = st.schreiben.content ? escapeHtml(st.schreiben.content) : '<span class="small-muted">Kein Text gefunden.</span>';
        const wc = st.schreiben.wordCount || '-';
        
        sHtml += `<div class="small-muted">W√∂rter: ${wc}</div>
                <div style="margin-top:10px;padding:12px;background:#fff;border-radius:8px;border:1px solid #eef6ff;min-height:80px">${txt}</div>
                <div style="margin-top:10px;display:flex;gap:10px;align-items:center">
                  Punkte (0‚Äì45): 
                  <input id="sInput" type="number" min="0" max="45" step="0.5" value="${sScore}"> 
                  <button id="saveS" class="results-btn">Speichern</button>
                </div></div>`;
                
        details.innerHTML += sHtml;

        const total = (l.total + h.total + sScore).toFixed(2);
        const percent = ((total / CONFIG.totals.gesamt) * 100).toFixed(2);
        
        document.getElementById('finalSummary-ergebnisse').innerHTML = `
          <div class="left">
            Gesamtpunktzahl: <strong>${total}</strong> / ${CONFIG.totals.gesamt} Punkte<br>
            <span class="small-muted">Lesen + H√∂ren + Schreiben</span>
          </div>
          <div class="right">
            Prozentsatz: <strong>${percent} %</strong>
          </div>`;

        document.getElementById('saveS').onclick = () => {
          const v = Number(document.getElementById('sInput').value) || 0;
          localStorage.setItem('schreibenScore', v);
          document.getElementById('schreibenScoreDisplay').textContent = `${v.toFixed(2)} / ${CONFIG.totals.schreiben} Punkte`;
          
          const newTotal = (l.total + h.total + v).toFixed(2);
          const newPercent = ((newTotal / CONFIG.totals.gesamt) * 100).toFixed(2);
          
          document.getElementById('finalSummary-ergebnisse').innerHTML = `
            <div class="left">
              Gesamtpunktzahl: <strong>${newTotal}</strong> / ${CONFIG.totals.gesamt} Punkte<br>
              <span class="small-muted">Lesen + H√∂ren + Schreiben</span>
            </div>
            <div class="right">
              Prozentsatz: <strong>${newPercent} %</strong>
            </div>`;
        };
      }

      document.getElementById('calcBtn-ergebnisse').onclick = () => renderResults();
      document.getElementById('backBtn-ergebnisse').onclick = (e) => {
        e.preventDefault();
        showPage('start-page');
      };
      
      renderResults();
    }
    
    // Initialize touch interactions on page load
    document.addEventListener('DOMContentLoaded', function() {
      setTimeout(setupTouchDragAndDrop, 500);
    });
  </script>
</body>
</html>